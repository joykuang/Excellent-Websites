var Pianist=function(a,b){this.ind=a;this.notes=b;this.scheduleAheadTime=0.1;this.sequence=[40,42,47,49,50,42,40,49,47,42,50,49];this.pos=0;this.pan=a==0?-0.8:0.8;this.nextBatchTime;this.lookahead=25;this.isPaused=false;this.isSecond=this.ind==1?true:false;this.isWaiting=this.isSecond?true:false;this.isSpeedingUp=false;this.batchesPlayed=0;this.toggleModeAtBatchNumber=SECOND_PIANIST_WAITS_FOR;this.skippedForwardNotes=0;this.isWarmingUp=true;this.timerID=0;this.init()};Pianist.prototype.init=function(){this.track=new Track(this,this.ind);this.beacon=new Beacon(this,this.track,this.ind);this.track.linkTo(this.beacon);if(this.ind==0){this.setTempo(TEMPO_MASTER)}else{this.setTempo(TEMPO_MASTER)}};Pianist.prototype.beginWarmup=function(){this.noteIndWarmup=0;this.track.beginWarmup()};Pianist.prototype.beginPerformance=function(){this.isWarmingUp=false;this.track.isWarmingUp=false;this.nextBatchTime=0;this.scheduleNextBatch();this.noteOn(arrNotes[0])};Pianist.prototype.scheduleNextBatch=function(){var c=tMaster;if((c+this.scheduleAheadTime)>=this.nextBatchTime){var a;this.batchesPlayed++;if(this.isSecond){if((this.batchesPlayed==SECOND_PIANIST_WAITS_FOR+1)){this.isWaiting=false;this.track.setVisible(true);this.beacon.setVisible(true);this.track.secondPianistEntered()}if(this.isSpeedingUp){if((this.batchesPlayed==this.toggleModeAtBatchNumber+1)){this.setTempo(TEMPO_MASTER);this.isSpeedingUp=false;this.skippedForwardNotes++;this.toggleModeAtBatchNumber+=SECOND_PIANIST_HOLDS_FOR}}else{if((this.batchesPlayed==this.toggleModeAtBatchNumber+1)){this.setTempo(TEMPO_SPEED_UP);this.isSpeedingUp=true;this.toggleModeAtBatchNumber+=SECOND_PIANIST_SPEEDS_UP_FOR}}}for(var b=0;b<this.sequence.length;b++){a=(this.nextBatchTime+this.timePerNote*b)+tBeganPerformance;if((!this.isWaiting)&&(this.track.isVisible)){playNote(this.sequence[b%this.sequence.length],this.ind,a,true)}}this.nextBatchTime=this.nextBatchTime+this.timePerNote*this.sequence.length}this.timerID=window.setTimeout(this.scheduleNextBatch.bind(this),this.lookAhead)};Pianist.prototype.upd=function(d,a){if(this.isWarmingUp){var b=tWarmup/TIME_WARMUP_TOTAL;if(this.ind==0){if((b>=0.1)&&(this.noteIndWarmup<=0)){this.track.setVisible(true);this.track.resetStroke(0.2);this.beacon.setVisible(true);this.noteOn(arrNotes[4]);this.noteIndWarmup++;if(!useSplash){playNote(arrNotes[4],this.ind,0,true)}}else{if((b>0.3)&&(this.noteIndWarmup<=1)){this.noteOn(arrNotes[3]);this.noteIndWarmup++;playNote(arrNotes[3],this.ind,0,true)}else{if((b>0.5)&&(this.noteIndWarmup<=2)){this.noteOn(arrNotes[2]);this.noteIndWarmup++;playNote(arrNotes[2],this.ind,0,true)}else{if((b>0.75)&&(this.noteIndWarmup<=3)){this.noteOn(arrNotes[1]);this.noteIndWarmup++;playNote(arrNotes[1],this.ind,0,true)}}}}}}else{var c;if(this.isPaused){return}if(this.isSecond){if(this.isSpeedingUp){if(tMaster<TIME_SPENT_WAITING){c=0}else{c=Math.floor(((tMaster-TIME_SPENT_WAITING)*this.tempo/60/NOTE_LENGTH))}c-=this.skippedForwardNotes}else{c=Math.floor((tMaster*this.tempo/60/NOTE_LENGTH));c+=this.skippedForwardNotes}}else{c=Math.floor((tMaster*this.tempo/60/NOTE_LENGTH))}c=c%this.sequence.length;if(c!=this.pos){this.pos=c;if(this.isWaiting){}else{this.noteOn(this.sequence[this.pos])}}}};Pianist.prototype.setTempo=function(a){this.tempo=a;this.timePerNote=1/this.tempo*NOTE_LENGTH*60};Pianist.prototype.getTempo=function(){return this.tempo};Pianist.prototype.pausePerformance=function(){muteComputer();this.isPaused=true};Pianist.prototype.resumePerformance=function(){unmuteComputer();this.isPaused=false};Pianist.prototype.noteOn=function(a){this.track.noteOn(a);this.beacon.noteOn()};