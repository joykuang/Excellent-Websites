(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/**
 * Object#toString() ref for stringify().
 */

var toString = Object.prototype.toString;

/**
 * Object#hasOwnProperty ref
 */

var hasOwnProperty = Object.prototype.hasOwnProperty;

/**
 * Array#indexOf shim.
 */

var indexOf = typeof Array.prototype.indexOf === 'function'
  ? function(arr, el) { return arr.indexOf(el); }
  : function(arr, el) {
      for (var i = 0; i < arr.length; i++) {
        if (arr[i] === el) return i;
      }
      return -1;
    };

/**
 * Array.isArray shim.
 */

var isArray = Array.isArray || function(arr) {
  return toString.call(arr) == '[object Array]';
};

/**
 * Object.keys shim.
 */

var objectKeys = Object.keys || function(obj) {
  var ret = [];
  for (var key in obj) {
    if (obj.hasOwnProperty(key)) {
      ret.push(key);
    }
  }
  return ret;
};

/**
 * Array#forEach shim.
 */

var forEach = typeof Array.prototype.forEach === 'function'
  ? function(arr, fn) { return arr.forEach(fn); }
  : function(arr, fn) {
      for (var i = 0; i < arr.length; i++) fn(arr[i]);
    };

/**
 * Array#reduce shim.
 */

var reduce = function(arr, fn, initial) {
  if (typeof arr.reduce === 'function') return arr.reduce(fn, initial);
  var res = initial;
  for (var i = 0; i < arr.length; i++) res = fn(res, arr[i]);
  return res;
};

/**
 * Cache non-integer test regexp.
 */

var isint = /^[0-9]+$/;

function promote(parent, key) {
  if (parent[key].length == 0) return parent[key] = {}
  var t = {};
  for (var i in parent[key]) {
    if (hasOwnProperty.call(parent[key], i)) {
      t[i] = parent[key][i];
    }
  }
  parent[key] = t;
  return t;
}

function parse(parts, parent, key, val) {
  var part = parts.shift();

  // illegal
  if (hasOwnProperty.call(Object.prototype, key)) return;

  // end
  if (!part) {
    if (isArray(parent[key])) {
      parent[key].push(val);
    } else if ('object' == typeof parent[key]) {
      parent[key] = val;
    } else if ('undefined' == typeof parent[key]) {
      parent[key] = val;
    } else {
      parent[key] = [parent[key], val];
    }
    // array
  } else {
    var obj = parent[key] = parent[key] || [];
    if (']' == part) {
      if (isArray(obj)) {
        if ('' != val) obj.push(val);
      } else if ('object' == typeof obj) {
        obj[objectKeys(obj).length] = val;
      } else {
        obj = parent[key] = [parent[key], val];
      }
      // prop
    } else if (~indexOf(part, ']')) {
      part = part.substr(0, part.length - 1);
      if (!isint.test(part) && isArray(obj)) obj = promote(parent, key);
      parse(parts, obj, part, val);
      // key
    } else {
      if (!isint.test(part) && isArray(obj)) obj = promote(parent, key);
      parse(parts, obj, part, val);
    }
  }
}

/**
 * Merge parent key/val pair.
 */

function merge(parent, key, val){
  if (~indexOf(key, ']')) {
    var parts = key.split('[')
      , len = parts.length
      , last = len - 1;
    parse(parts, parent, 'base', val);
    // optimize
  } else {
    if (!isint.test(key) && isArray(parent.base)) {
      var t = {};
      for (var k in parent.base) t[k] = parent.base[k];
      parent.base = t;
    }
    set(parent.base, key, val);
  }

  return parent;
}

/**
 * Compact sparse arrays.
 */

function compact(obj) {
  if ('object' != typeof obj) return obj;

  if (isArray(obj)) {
    var ret = [];

    for (var i in obj) {
      if (hasOwnProperty.call(obj, i)) {
        ret.push(obj[i]);
      }
    }

    return ret;
  }

  for (var key in obj) {
    obj[key] = compact(obj[key]);
  }

  return obj;
}

/**
 * Parse the given obj.
 */

function parseObject(obj){
  var ret = { base: {} };

  forEach(objectKeys(obj), function(name){
    merge(ret, name, obj[name]);
  });

  return compact(ret.base);
}

/**
 * Parse the given str.
 */

function parseString(str){
  var ret = reduce(String(str).split('&'), function(ret, pair){
    var eql = indexOf(pair, '=')
      , brace = lastBraceInKey(pair)
      , key = pair.substr(0, brace || eql)
      , val = pair.substr(brace || eql, pair.length)
      , val = val.substr(indexOf(val, '=') + 1, val.length);

    // ?foo
    if ('' == key) key = pair, val = '';
    if ('' == key) return ret;

    return merge(ret, decode(key), decode(val));
  }, { base: {} }).base;

  return compact(ret);
}

/**
 * Parse the given query `str` or `obj`, returning an object.
 *
 * @param {String} str | {Object} obj
 * @return {Object}
 * @api public
 */

exports.parse = function(str){
  if (null == str || '' == str) return {};
  return 'object' == typeof str
    ? parseObject(str)
    : parseString(str);
};

/**
 * Turn the given `obj` into a query string
 *
 * @param {Object} obj
 * @return {String}
 * @api public
 */

var stringify = exports.stringify = function(obj, prefix) {
  if (isArray(obj)) {
    return stringifyArray(obj, prefix);
  } else if ('[object Object]' == toString.call(obj)) {
    return stringifyObject(obj, prefix);
  } else if ('string' == typeof obj) {
    return stringifyString(obj, prefix);
  } else {
    return prefix + '=' + encodeURIComponent(String(obj));
  }
};

/**
 * Stringify the given `str`.
 *
 * @param {String} str
 * @param {String} prefix
 * @return {String}
 * @api private
 */

function stringifyString(str, prefix) {
  if (!prefix) throw new TypeError('stringify expects an object');
  return prefix + '=' + encodeURIComponent(str);
}

/**
 * Stringify the given `arr`.
 *
 * @param {Array} arr
 * @param {String} prefix
 * @return {String}
 * @api private
 */

function stringifyArray(arr, prefix) {
  var ret = [];
  if (!prefix) throw new TypeError('stringify expects an object');
  for (var i = 0; i < arr.length; i++) {
    ret.push(stringify(arr[i], prefix + '[' + i + ']'));
  }
  return ret.join('&');
}

/**
 * Stringify the given `obj`.
 *
 * @param {Object} obj
 * @param {String} prefix
 * @return {String}
 * @api private
 */

function stringifyObject(obj, prefix) {
  var ret = []
    , keys = objectKeys(obj)
    , key;

  for (var i = 0, len = keys.length; i < len; ++i) {
    key = keys[i];
    if ('' == key) continue;
    if (null == obj[key]) {
      ret.push(encodeURIComponent(key) + '=');
    } else {
      ret.push(stringify(obj[key], prefix
        ? prefix + '[' + encodeURIComponent(key) + ']'
        : encodeURIComponent(key)));
    }
  }

  return ret.join('&');
}

/**
 * Set `obj`'s `key` to `val` respecting
 * the weird and wonderful syntax of a qs,
 * where "foo=bar&foo=baz" becomes an array.
 *
 * @param {Object} obj
 * @param {String} key
 * @param {String} val
 * @api private
 */

function set(obj, key, val) {
  var v = obj[key];
  if (hasOwnProperty.call(Object.prototype, key)) return;
  if (undefined === v) {
    obj[key] = val;
  } else if (isArray(v)) {
    v.push(val);
  } else {
    obj[key] = [v, val];
  }
}

/**
 * Locate last brace in `str` within the key.
 *
 * @param {String} str
 * @return {Number}
 * @api private
 */

function lastBraceInKey(str) {
  var len = str.length
    , brace
    , c;
  for (var i = 0; i < len; ++i) {
    c = str[i];
    if (']' == c) brace = false;
    if ('[' == c) brace = true;
    if ('=' == c && !brace) return i;
  }
}

/**
 * Decode `str`.
 *
 * @param {String} str
 * @return {String}
 * @api private
 */

function decode(str) {
  try {
    return decodeURIComponent(str.replace(/\+/g, ' '));
  } catch (err) {
    return str;
  }
}

},{}],2:[function(require,module,exports){
/**
 * @module ac-base
 */
'use strict';

var globals = require('./ac-base/globals');
var AC = globals.window.AC = globals.window.AC || {};
var ac_Environment = require('./ac-base/Environment');
var ac_onDOMReady = require('./ac-base/Element/onDOMReady');

// IE
if (ac_Environment.Browser.IE) {
	// Run the HTML5 shim for IE < 9
	if (ac_Environment.Browser.IE.documentMode < 9) {
		require('./ac-base/shims/html5.js')();
	}
	// Click-booster for IE < 8, requires DOMReady for execution
	if (ac_Environment.Browser.IE.documentMode < 8) {
		ac_onDOMReady(require('./ac-base/shims/ie/nonClickableImageBooster'));
	}
}

// AC.require compatibility
if (typeof define !== 'undefined') {
	AC.define = define;
	AC.require = require;
}

AC.adler32 = require('./ac-base/adler32');
AC.Ajax = require('./ac-base/Ajax');
AC.Array = require('./ac-base/Array');
AC.bindEventListeners = require('./ac-base/bindEventListeners');
AC.Canvas = require('./ac-base/Canvas');
AC.Class = require('./ac-base/Class');
AC.Date = require('./ac-base/Date');
AC.DeferredQueue = require('./ac-base/DeferredQueue');
AC.EasingFunctions = require('./ac-base/EasingFunctions');
AC.Element = require('./ac-base/Element');
AC.Environment = ac_Environment;
AC.Event = require('./ac-base/Event');
AC.Function = require('./ac-base/Function');
AC.History = require('./ac-base/History');
AC.log = require('./ac-base/log');
AC.namespace = require('./ac-base/namespace');
AC.NotificationCenter = require('./ac-base/NotificationCenter');
AC.Object = require('./ac-base/Object');
AC.onDOMReady = ac_onDOMReady;
AC.onWindowLoad = require('./ac-base/Element/onWindowLoad');
AC.queryParameters = require('./ac-base/queryParameters');
AC.RegExp = require('./ac-base/RegExp');
AC.Registry = require('./ac-base/Registry');
AC.String = require('./ac-base/String');
AC.Synthesize = require('./ac-base/Synthesize');
AC.uid = require('./ac-base/uid');
AC.Viewport = require('./ac-base/Viewport');

AC.windowHasLoaded = false;
AC.Element.addEventListener(globals.window, 'load', function () {
	AC.windowHasLoaded = true;
});

module.exports = AC;

},{"./ac-base/Ajax":3,"./ac-base/Array":7,"./ac-base/Canvas":8,"./ac-base/Class":9,"./ac-base/Date":10,"./ac-base/DeferredQueue":11,"./ac-base/EasingFunctions":12,"./ac-base/Element":13,"./ac-base/Element/onDOMReady":16,"./ac-base/Element/onWindowLoad":17,"./ac-base/Environment":19,"./ac-base/Event":25,"./ac-base/Function":26,"./ac-base/History":27,"./ac-base/NotificationCenter":28,"./ac-base/Object":29,"./ac-base/RegExp":30,"./ac-base/Registry":31,"./ac-base/String":33,"./ac-base/Synthesize":34,"./ac-base/Viewport":35,"./ac-base/adler32":36,"./ac-base/bindEventListeners":37,"./ac-base/globals":38,"./ac-base/log":39,"./ac-base/namespace":40,"./ac-base/queryParameters":41,"./ac-base/shims/html5.js":42,"./ac-base/shims/ie/nonClickableImageBooster":46,"./ac-base/uid":47}],3:[function(require,module,exports){
'use strict';

/**
 * Contains classes and functions for making asynchronous HTTP requests.
 * @name module:ac-base.Ajax
 * @kind namespace
 */
var ac_Ajax = {};

require('./Ajax/ajax-tracker')(ac_Ajax);
require('./Ajax/ajax-response')(ac_Ajax);
require('./Ajax/ajax-request')(ac_Ajax);

/**
 * Get the browser’s transport
 * @return {Object} XMLHttpRequest
 * @name module:ac-base.Ajax.getTransport
 * @kind function
 */
ac_Ajax.getTransport = function() {

	return new XMLHttpRequest();

};

/**
 * Checks a URL’s status using an HTTP head so the file doesn’t load.
 * @param  {String}   url      URL to test whether or not it exists
 * @param  {Function} callback Method that is ran when the request is completed. Passed a boolean whether or not a file exists at the <code>url</code>
 * @name module:ac-base.Ajax.checkURL
 * @kind function
 */
ac_Ajax.checkURL = function(url, callback) {

	var error = ac_Ajax.__validateArguments(url, callback);

	if (error) {
		throw error;
	}

	var transport = ac_Ajax.getTransport();

	this.__handleReadyStateChange(transport, callback);
	transport.open('HEAD', url, true);
	transport.send(null);

};

/**
 * Adds on onreadystatechange event listener to a transport
 * and handles the event with the provided callback
 * @param  {Object}   transport An instance of XMLHttpRequest
 * @param  {Function} callback  The callback to handle the readystate change equal to 4
 * @private
 * @name module:ac-base.Ajax.__handleReadyStateChange
 * @kind function
 */
ac_Ajax.__handleReadyStateChange = function(transport, callback) {

	transport.onreadystatechange = function() {
		if (this.readyState === 4) {
			if (typeof callback === 'function') {
				// True if the file exists, false otherwise
				callback(this.status === 200);
			}
		}
	};

};

/**
 * Returns an error message if any arguments are undefined
 * @param  {String}   url      A url
 * @param  {Function} callback A function
 * @return {String}            An error message
 * @private
 * @name module:ac-base.Ajax.__validateArguments
 * @kind function
 */
ac_Ajax.__validateArguments = function(url, callback) {

	var errors;

	if (!url) {
		errors = 'Must provide a url';
	}

	if (!callback) {
		errors = 'Must provide a callback';
	}

	if (!url && !callback) {
		errors = 'Must provide a url and callback';
	}

	return errors;

};

module.exports = ac_Ajax;

},{"./Ajax/ajax-request":4,"./Ajax/ajax-response":5,"./Ajax/ajax-tracker":6}],4:[function(require,module,exports){
'use strict';

var ac_Class = require('../Class');
var ac_Object = require('../Object');

module.exports = function(ac_Ajax) {

	/**
	 * @param url {String} URL to open.
	 * @param options Dictionary of callbacks for onSuccess, onFailure, onError, and/or onComplete.
	 * @name module:ac-base.Ajax.AjaxRequest
	 * @kind class
	 * @classdesc Request class; create one of these to build an AJAX request.
	 */
	var AjaxRequest = ac_Class();

	AjaxRequest.prototype = /** @lends module:ac-base.Ajax.AjaxRequest# */ {

		__defaultOptions: {
			method: 'get'
		},

		/** @ignore */
		initialize: function(url, options) {

			this._transport = ac_Ajax.getTransport();
			this._mimeTypeOverride = null;
			this._options = null;

			ac_Object.synthesize(this);

			this.setOptions(ac_Object.extend(ac_Object.clone(this.__defaultOptions), options || {}));

			ac_Ajax.AjaxTracker.sharedInstance().addResponder(this);

			this.__configureTransport(url);
		},

		/** @ignore */
		__configureTransport: function(url) {

			this.transport().onreadystatechange = this.__handleTransportStateChange.bind(this);
			this.transport().open(this.options().method, url, true);
			this.transport().setRequestHeader('Content-Type', this.options().contentType);
			this.transport().send(null);

		},

		/** @ignore */
		__handleTransportStateChange: function() {
			if (this.transport().readyState === 4) {
				var ajaxResponse = new ac_Ajax.AjaxResponse(this);
			}
		},

		/**
		 * @param {String} overrideMimeTypeValue
		 * @returns {void}
		 */
		overrideMimeType: function(overrideMimeTypeValue) {
			this._mimeTypeOverride = overrideMimeTypeValue;
			if (this.transport().overrideMimeType) {
				this.transport().overrideMimeType(overrideMimeTypeValue);
			}
		},

		/** @ignore */
		_overrideMimeType: null

	};

	ac_Ajax.AjaxRequest = AjaxRequest;
};

},{"../Class":9,"../Object":29}],5:[function(require,module,exports){
'use strict';

var ac_Class = require('../Class');

module.exports = function(ac_Ajax) {

	/**
	 * Triggers callbacks if transport.readyState === 4 and onComplete
	 * callback if isLoaded has already returned true.
	 * {module:ac-base.Ajax.AjaxRequest} request Request object.
	 * @param  request  An ac_Ajax.AjaxRequest instance
	 * @name module:ac-base.Ajax.AjaxResponse
	 * @kind class
	 * @classdesc One of these is initialized when we get a response from an AJAX call.
	 */
	var AjaxResponse = ac_Class();

	AjaxResponse.prototype = /** @lends module:ac-base.Ajax.AjaxResponse# */ {

		_request: null,
		_transport: null,

		/** @ignore */
		initialize: function(request) {

			this._transport = request.transport();
			this._request = request;

			var isComplete = false;
			var isLoaded = this._transport.readyState === 4;

			if (isLoaded) {
				this.__triggerCallbacks();
				isComplete = true;
			}

			if (isComplete) {

				if (this._request.options().onComplete) {
					this._request.options().onComplete(this);
				}

				ac_Ajax.AjaxTracker.sharedInstance().removeResponder(request);
			}
		},

		// Calls all configured callbacks for matching transportStatus
		/** @ignore */
		__triggerCallbacks: function() {

			var transportStatus = this._transport.status;
			var isSuccessful = transportStatus >= 200 && transportStatus < 300;
			var isFailure = transportStatus >= 400 && transportStatus < 500;
			var isError = transportStatus >= 500 && transportStatus < 600 || transportStatus === 0;

			if (isSuccessful && this._request.options().onSuccess) {
				this._request.options().onSuccess(this);
			}

			if (isFailure && this._request.options().onFailure) {
				this._request.options().onFailure(this);
			}

			if (isError && this._request.options().onError) {
				this._request.options().onError(this);
			}

		},

		/**
		 * @returns {String} The response body as a string.
		 */
		responseText: function() {
			return this._transport.responseText;
		},

		/**
		 * @returns {XMLDocument} The response body as an XML Document Object Model (DOM) object.
		 */
		responseXML: function() {
			return this._transport.responseXML;
		},

		/**
		 * @returns {*} The response body as parsed JSON.
		 */
		responseJSON: function() {
			return JSON.parse(this._transport.responseText);
		}

	};

	ac_Ajax.AjaxResponse = AjaxResponse;
};

},{"../Class":9}],6:[function(require,module,exports){
'use strict';

var ac_Class = require('../Class');

module.exports = function(ac_Ajax) {

	/**
	 * @name module:ac-base.Ajax.AjaxTracker
	 * @classdesc Description TODO
	 * @kind class
	 */
	var AjaxTracker = ac_Class();

	AjaxTracker.prototype = /** @lends module:ac-base.Ajax.AjaxTracker# */ {

		// Used by module:ac-ajax to maintain reference to open AJAX calls.
		/** @ignore */
		__responders: [],

		/** @ignore */
		initialize: function() {},

		/**
		 * Add a responder to the tracker.
		 * @param responder The responder to add.
		 * @returns {Array} Newly populated array of responders.
		 */
		addResponder: function(responder) {
			this.__responders.push(responder);
			return this.__responders;
		},

		/**
		 * Remove a given responder object from this tracker, de-referencing it.
		 * @param responder {module:ac-ajax.AjaxRequest} The responder to remove.
		 * @returns {Boolean} Success or failure.
		 */
		removeResponder: function(responder) {

			var originalLength = this.__responders.length;

			this.__responders = this.__responders.filter(function(value) {
				return value !== responder;
			});

			var newLength = this.__responders.length;

			if(originalLength > newLength) {
				return true;
			}

			return false;

		}
	};

	ac_Ajax.AjaxTracker = AjaxTracker;
};

},{"../Class":9}],7:[function(require,module,exports){
'use strict';

var ac_Environment_Browser = require('./Environment/Browser');

/**
 * @name module:ac-base.Array
 * @kind namespace
 */
var ac_Array = {};

/**
 * @param {Object} arrayLike Take an Array-like object and convert it to an actual Array (for instance a NodeList)
 * @name module:ac-base.Array.toArray
 * @kind function
 */
ac_Array.toArray = function (arrayLike) {
	return Array.prototype.slice.call(arrayLike);
};

/**
 * @param {Array} array Take a multi-dimensional array and flatten it into a single level.
 * @name module:ac-base.Array.flatten
 * @kind function
 */
ac_Array.flatten = function (array) {
	var flattenedArray = [];
	var callback = function (item) {
		if (Array.isArray(item)) {
			item.forEach(callback);
		} else {
			flattenedArray.push(item);
		}
	};

	array.forEach(callback);
	return flattenedArray;
};

/**
 * @param {Array} arr Source array
 * @param {*} value Entry in array to remove
 * @returns {Array} A new array that is the source array without the first instance of the value provided.
 * @name module:ac-base.Array.without
 * @kind function
 */
ac_Array.without = function (arr, value) {
	var newArr;
	var index = arr.indexOf(value);
	var length = arr.length;

	if (index >= 0) {
		// If it’s the last item
		if (index === (length - 1)) {
			newArr = arr.slice(0, (length - 1));

		// If it’s the first item
		} else if (index === 0) {
			newArr = arr.slice(1);

		// If it’s in the middle
		} else {
			newArr = arr.slice(0, index);
			newArr = newArr.concat(arr.slice(index + 1));
		}
	} else {
		return arr;
	}

	return newArr;
};

if (ac_Environment_Browser.name === "IE") {
	require('./shims/ie/Array')(ac_Array, ac_Environment_Browser);
}

module.exports = ac_Array;

},{"./Environment/Browser":20,"./shims/ie/Array":43}],8:[function(require,module,exports){
'use strict';

var ac_Element = require('./Element');

/**
 * @name module:ac-base.Canvas
 * @kind namespace
 */
var ac_Canvas = {};

/**
 * Asynchronous because image source must be loaded before we can retrieve the data.
 * @param {String} src Image location
 * @param {Function} callback The function to be ran when the imageData is retrieved.
 * @name module:ac-base.Canvas.imageDataFromNode
 */
ac_Canvas.imageDataFromFile = function (src, callback) {
	// Callback is required
	if (typeof callback !== 'function') {
		throw new TypeError('Need callback method to call when imageData is retrieved.');
	}

	// If it’s a string, just make sure it isn’t empty
	if (typeof src !== 'string' || src === '') {
		throw new TypeError('Src for imageData must be an Image Node with a src attribute or a string.');
	}

	var img = new Image();

	/** @inner */
	img.onload = function () {
		callback(ac_Canvas.imageDataFromNode(img));
	};

	img.src = src;
};

/**
 * @param {Image} img <code>IMG</code> tag that has already finished loading.
 * @name module:ac-base.Canvas.imageDataFromNode
 */
ac_Canvas.imageDataFromNode = function (img) {
	if (!ac_Element.isElement(img) || img.getAttribute('src') === 'null' || img.width === 0) {
		throw new TypeError('Source node must be an IMG tag and must have already loaded.');
	}

	var imageData;
	var canvas = document.createElement('canvas');
	var context = canvas.getContext('2d');

	canvas.width = img.width;
	canvas.height = img.height;

	context.drawImage(img, 0, 0);
	imageData = context.getImageData(0, 0, img.width, img.height);

	return imageData;
};

module.exports = ac_Canvas;

},{"./Element":13}],9:[function(require,module,exports){
'use strict';

var ac_Object = require('./Object');
var ac_Array = require('./Array');
var ac_Function = require('./Function');
var ac_onDOMReady = require('./Element/onDOMReady');

/**
 * Class methods namespace.
 * Create a new class; similar to Class.create() in Prototype.
 *
 * First argument can be a superclass to extend or a prototype object.
 * If first argument is a superclass, then second argument can be a prototype object.
 *
 * @param {module:ac-base~ACGeneratedClass} [superclass] Provide an existing class that this class.
 * @param {Object} [prototypeObj] Prototype object to use for constructor.
 * @returns {Function}
 * @name module:ac-base.Class
 * @kind function
 * @deprecated
 */
function ac_Class() {
	var args = ac_Array.toArray(arguments);
	var superclass = (typeof args[0] === 'function') ? args.shift() : null;
	var prototypeObj = args.shift() || {};
	var Superclass;

	/**
	 * @inner
	 * @memberof module:ac-base
	 * @constructor
	 * @classdesc Class which is generated by {@link module:ac-base.Class}.
	 */
	var ACGeneratedClass = function () {
		var result;
		var timeoutCallback;

		// Run initialize method in constructor function
		result = ((typeof this.initialize === 'function' && ACGeneratedClass.__shouldInitialize !== false) ? this.initialize.apply(this, arguments) : false);

		// If that method returns {@link module:ac-base.Class.Invalidate}, remove this instance from memory
		if (result === ac_Class.Invalidate) {
			timeoutCallback = function () {
				try {
					// If this is the shared instance for the Class that we intend to invalidate
					if (this && this._parentClass && this._parentClass._sharedInstance === this) {
						this._parentClass._sharedInstance = null;
					}
				} catch (e) {
					throw e;
				}
			};
			// Let the current thread run until it catches its breath.
			window.setTimeout(timeoutCallback.bind(this), 200);
		}
	};

	// Save reference to superclass
	ACGeneratedClass.__superclass = superclass;

	// Extend with provided properties
	if (superclass) {
		// Setup Superclass placeholder
		if (superclass.__superclass) {
			Superclass = ac_Class(superclass.__superclass, superclass.prototype);
		} else {
			Superclass = ac_Class(superclass.prototype);
		}
		Superclass.__shouldInitialize = false;

		// Prototype chain to Superclass
		ACGeneratedClass.prototype = new Superclass();

		// Extend prototype on constructor with provided properties
		ac_Object.extend(ACGeneratedClass.prototype, prototypeObj);

		// Set up $super for methods that take it
		ac_Class.__wrapSuperMethods(ACGeneratedClass);
	} else {
		ACGeneratedClass.prototype = prototypeObj;
	}

	/**
	 * Run this method to access the shared instance of this class, auto-generating it as necessary.
	 * @returns {Object} Singleton instance of the generated class
	 */
	ACGeneratedClass.sharedInstance = function () {
		if (!ACGeneratedClass._sharedInstance) {
			ACGeneratedClass._sharedInstance = new ACGeneratedClass();
			ACGeneratedClass._sharedInstance._parentClass = ACGeneratedClass;
		}
		return ACGeneratedClass._sharedInstance;
	};

	// fill in missing accessors
	ac_Object.synthesize(ACGeneratedClass.prototype);

	// Look for autocreate flag
	ACGeneratedClass.autocreate = prototypeObj.__instantiateOnDOMReady || false;
	delete prototypeObj.__instantiateOnDOMReady;

	// Create a shared instance of this class on DOM ready.
	if (ACGeneratedClass.autocreate) {
		ac_onDOMReady(function () {
			// <code>autocreate</code> property can change between execution and DOMReady, so read it again.
			if (ACGeneratedClass.autocreate) {
				ACGeneratedClass.sharedInstance();
			}
		});
	}

	return ACGeneratedClass;
}

// Wrap the method from the prototype with a method that has a reference
// to the $super, which is the same method name on the parent’s prototype.
/** @ignore */
ac_Class.__wrapSuperMethods = function (ACGeneratedClass) {
	var proto = ACGeneratedClass.prototype;
	var superProto = ACGeneratedClass.__superclass.prototype;
	var property;

	// Loop through proto
	for (property in proto) {
		if (proto.hasOwnProperty(property)) {
			if (typeof proto[property] === 'function') {

				// Get the parameter keys for this method. If the first is $super, let’s wrap it up!
				var nestedMethod = proto[property];
				var paramNames = ac_Function.getParamNames(nestedMethod);

				// If the first arg is called '$super'
				if (paramNames[0] === '$super') {
					// Overwrite the method on the prototype
					/*jshint -W083*/
					proto[property] = (function (property, nestedMethod) {
						var $super = superProto[property];

						// Create closure that holds onto the value of $super
						return function superMethodWrapper() {
							var args = ac_Array.toArray(arguments);
							return nestedMethod.apply(this, [$super.bind(this)].concat(args));
						};

					// These variables will be overwritten in the scope of the for loop.
					// Pass them to the anonymous function to preserve their value at this time
					}(property, nestedMethod));
				}
			}
		}
	}

	return this;
};

/**
 * This method is a no-op and returns false; return this in your class'
 * initialize() method to clean up a shared instance while it's being generated.
 * @name module:ac-base.Class.Invalidate
 * @kind function
 * @deprecated
 */
ac_Class.Invalidate = function () {
	return false;
};

module.exports = ac_Class;

},{"./Array":7,"./Element/onDOMReady":16,"./Function":26,"./Object":29}],10:[function(require,module,exports){
'use strict';

/**
 * @name module:ac-base.Date
 * @kind namespace
 */
var ac_Date = {};

/**
 * Test an Object to see if it is an instance of the Date constructor or not.
 * @param {Object} date The Object to test
 * @return {Boolean} If the Object is a Date or now
 * @name module:ac-base.Date.isDate
 * @kind function
 */
ac_Date.isDate = function (date) {
	return !!(date && typeof date.getTime === 'function');
};

module.exports = ac_Date;

},{}],11:[function(require,module,exports){
'use strict';

var ac_Array = require('./Array');
var ac_Class = require('./Class');
var ac_Object = require('./Object');

var defaultOptions = {
	autoplay: false,
	asynchronous: false
};

/**
 * @param {Object} [options] Options to initialize the instance with
 * @param {Boolean} [options.autoplay=false] Whether or not to play when the first action is added, if not already playing.
 * @param {Boolean} [options.asynchronous=false] If true, wait for didFinish method to be called before continuing to run next method.
 * @name module:ac-base.DeferredQueue
 * @kind class
 * @classdesc Store functions in queue to be ran later, in sequence.
 */
var ac_DeferredQueue = ac_Class( /** @lends module:ac-base.DeferredQueue# */ {

	/** @ingore */
	initialize: function (options) {
		// Setup options
		if (typeof options !== 'object') {
			options = {};
		}
		this._options = ac_Object.extend(ac_Object.clone(defaultOptions), options);
		this._isPlaying = false;
		this._isRunningAction = false;
		this._queue = [];

		// Make sure didFinish is always bound correctly
		this.didFinish = this.__didFinish.bind(this);

		// Synthesize Member Data
		this.synthesize();
	},

	/**
	 * Add an action to the end of the queue
	 * @param {Function} func
	 * @param {Integer} [delay=0]
	 */
	add: function (func, delay) {
		var options = {};
		var action;

		if (delay > 0) {
			options.delay = delay;
		}

		// Create an Action to run
		action = new ac_DeferredQueue.Action(func, options);

		// Add to end of the queue
		this.queue().push(action);

		// Autoplay if applicable
		if (!this.isPlaying() && this._options.autoplay === true) {
			this.start();
		}
	},

	/**
	 * Remove an action from the queue
	 * @param {module:ac-base.DeferredQueue.Action} action
	 */
	remove: function (action) {
		this.setQueue(ac_Array.without(this.queue(), action));
	},

	/**
	 * Run the queue, in order of what was added first.
	 * @returns {void}
	 */
	start: function () {
		if (this.isPlaying()) {
			return false;
		}

		this.setIsPlaying(true);
		this.__runNextAction();
	},

	/**
	 * Stop running through the queue. Still finishes any actions that were already running.
	 * returns {void}
	 */
	stop: function () {
		if (!this.isPlaying()) {
			return false;
		}

		this.setIsPlaying(false);
	},

	/**
	 * Clear out the queue, stop replacement
	 * @returns {void}
	 */
	clear: function () {
		this.setQueue([]);
		this.stop();
	},

	// If this is an asynchronous queue, wait for the previous action to finish before we run the next one.
	/** @ignore */
	__didFinish: function () {
		this.setIsRunningAction(false);
		this.__runNextAction();
	},

	/** @ignore */
	__runNextAction: function () {
		// Must be running to run next
		if (!this.isPlaying()) {
			return false;
		}

		// Make sure that our queue has stuff in it and we’re not waiting for a didFinish
		if (this.queue().length && !this.isRunningAction()) {

			// Get the next action at the front of the queue
			var action = this.queue().shift();

			// Run the action
			action.run();

			// Don’t allow us to run two at the same time
			if (this._options.asynchronous === true) {
				this.setIsRunningAction(true);

				// Don’t run next action yet! Wait for didFinish to be called
				return;
			}

			this.__runNextAction();
		}
	}
});

var actionDefaultOptions = {
	delay: 0
};

/**
 * @param {Function} [func]
 * @param {Object} [options] Options to initialize the instance with
 * @param {Integer} [options.delay=0] The delay, in seconds, to wait between running actions.
 * @name module:ac-base.DeferredQueue.Action
 * @kind class
 * @classdesc An instance of an action that is intended to be ran
 */
ac_DeferredQueue.Action = ac_Class( /** @lends module:ac-base.DeferredQueue.Action# */ {

	/** @ignore */
	initialize: function (func, options) {
		if (typeof func !== 'function') {
			throw new TypeError('Deferred Queue func must be a function.');
		}

		// Setup options
		if (typeof options !== 'object') {
			options = {};
		}
		this._options = ac_Object.extend(ac_Object.clone(actionDefaultOptions), options);
		this.__func = func;

		// Synthesize Member Data
		this.synthesize();
	},

	/**
	 * Run this func
	 * @returns {void}
	 */
	run: function () {
		var func = this.__func;

		// Run with optional delay
		if (typeof this._options.delay === 'number' && this._options.delay > 0) {
			window.setTimeout(function () {
				func();
			}, this._options.delay * 1000);
		} else {
			func();
		}
	}
});

module.exports = ac_DeferredQueue;

},{"./Array":7,"./Class":9,"./Object":29}],12:[function(require,module,exports){
/*jshint -W116*/
'use strict';

/**
 * Transform a given value to an eased value based on a formula.
 * [Visualization of the easing curves](../../example/easing_functions_visualized.html)
 *
 * @function
 * @name module:ac-base.EasingFunctions~EasingFunction
 * @param {Number} time Current position in time. Can be frames/seconds/milliseconds. ('t' in original Penner functions)
 * @param {Number} begin Start value. ('b' in original Penner functions)
 * @param {Number} change Change in value. ('c' in original Penner functions)
 * @param {Number} duration Duration. Can be frames/seconds/milliseconds. ('d' in original Penner functions)
 * @param {Number} [shootover] Functions with 'Back' in their names take an additional optional parameter 'shootover', which controls the amount of overshoot. A higher value means greater overshoot. 'shootover' has a default value of 1.70158, which produces an overshoot of 10 percent. shootover==0 produces cubic easing with no overshoot. ('s' in original Penner functions)
 */

/**
 * @namespace
 * @name module:ac-base.EasingFunctions
 */
var ac_EasingFunctions = /** @lends module:ac-base.EasingFunctions. */ {
	linear: function (time, begin, change, duration) {
		return change * time / duration + begin;
	},

	easeInQuad: function (time, begin, change, duration) {
		return change * (time /= duration) * time + begin;
	},

	easeOutQuad: function (time, begin, change, duration) {
		return -change * (time /= duration) * (time - 2) + begin;
	},

	easeInOutQuad: function (time, begin, change, duration) {
		if ((time /= duration / 2) < 1) return change / 2 * time * time + begin;
		return -change / 2 * ((--time) * (time - 2) - 1) + begin;
	},

	easeInCubic: function (time, begin, change, duration) {
		return change * (time /= duration) * time * time + begin;
	},

	easeOutCubic: function (time, begin, change, duration) {
		return change * ((time = time / duration - 1) * time * time + 1) + begin;
	},

	easeInOutCubic: function (time, begin, change, duration) {
		if ((time /= duration / 2) < 1) return change / 2 * time * time * time + begin;
		return change / 2 * ((time -= 2) * time * time + 2) + begin;
	},

	easeInQuart: function (time, begin, change, duration) {
		return change * (time /= duration) * time * time * time + begin;
	},

	easeOutQuart: function (time, begin, change, duration) {
		return -change * ((time = time / duration - 1) * time * time * time - 1) + begin;
	},

	easeInOutQuart: function (time, begin, change, duration) {
		if ((time /= duration / 2) < 1) return change / 2 * time * time * time * time + begin;
		return -change / 2 * ((time -= 2) * time * time * time - 2) + begin;
	},

	easeInQuint: function (time, begin, change, duration) {
		return change * (time /= duration) * time * time * time * time + begin;
	},

	easeOutQuint: function (time, begin, change, duration) {
		return change * ((time = time / duration - 1) * time * time * time * time + 1) + begin;
	},

	easeInOutQuint: function (time, begin, change, duration) {
		if ((time /= duration / 2) < 1) return change / 2 * time * time * time * time * time + begin;
		return change / 2 * ((time -= 2) * time * time * time * time + 2) + begin;
	},

	easeInSine: function (time, begin, change, duration) {
		return -change * Math.cos(time / duration * (Math.PI / 2)) + change + begin;
	},

	easeOutSine: function (time, begin, change, duration) {
		return change * Math.sin(time / duration * (Math.PI / 2)) + begin;
	},

	easeInOutSine: function (time, begin, change, duration) {
		return -change / 2 * (Math.cos(Math.PI * time / duration) - 1) + begin;
	},

	easeInExpo: function (time, begin, change, duration) {
		return (time == 0) ? begin : change * Math.pow(2, 10 * (time / duration - 1)) + begin;
	},

	easeOutExpo: function (time, begin, change, duration) {
		return (time == duration) ? begin + change : change * (-Math.pow(2, -10 * time / duration) + 1) + begin;
	},

	easeInOutExpo: function (time, begin, change, duration) {
		if (time == 0) return begin;
		if (time == duration) return begin + change;
		if ((time /= duration / 2) < 1) return change / 2 * Math.pow(2, 10 * (time - 1)) + begin;
		return change / 2 * (-Math.pow(2, -10 * --time) + 2) + begin;
	},

	easeInCirc: function (time, begin, change, duration) {
		return -change * (Math.sqrt(1 - (time /= duration) * time) - 1) + begin;
	},

	easeOutCirc: function (time, begin, change, duration) {
		return change * Math.sqrt(1 - (time = time / duration - 1) * time) + begin;
	},

	easeInOutCirc: function (time, begin, change, duration) {
		if ((time /= duration / 2) < 1) return -change / 2 * (Math.sqrt(1 - time * time) - 1) + begin;
		return change / 2 * (Math.sqrt(1 - (time -= 2) * time) + 1) + begin;
	},

	easeInElastic: function (time, begin, change, duration) {
		var shootover = 1.70158;
		var period = 0;
		var amplitude = change;
		if (time == 0) return begin;
		if ((time /= duration) == 1) return begin + change;
		if (!period) period = duration * 0.3;
		if (amplitude < Math.abs(change)) {
			amplitude = change;
			shootover = period / 4;
		}
		else shootover = period / (2 * Math.PI) * Math.asin(change / amplitude);
		return -(amplitude * Math.pow(2, 10 * (time -= 1)) * Math.sin((time * duration - shootover) * (2 * Math.PI) / period)) + begin;
	},

	easeOutElastic: function (time, begin, change, duration) {
		var shootover = 1.70158;
		var period = 0;
		var amplitude = change;
		if (time == 0) return begin;
		if ((time /= duration) == 1) return begin + change;
		if (!period) period = duration * 0.3;
		if (amplitude < Math.abs(change)) {
			amplitude = change;
			shootover = period / 4;
		}
		else shootover = period / (2 * Math.PI) * Math.asin(change / amplitude);
		return amplitude * Math.pow(2, -10 * time) * Math.sin((time * duration - shootover) * (2 * Math.PI) / period) + change + begin;
	},

	easeInOutElastic: function (time, begin, change, duration) {
		var shootover = 1.70158;
		var period = 0;
		var amplitude = change;
		if (time == 0) return begin;
		if ((time /= duration / 2) == 2) return begin + change;
		if (!period) period = duration * (0.3 * 1.5);
		if (amplitude < Math.abs(change)) {
			amplitude = change;
			shootover = period / 4;
		}
		else shootover = period / (2 * Math.PI) * Math.asin(change / amplitude);
		if (time < 1) return -0.5 * (amplitude * Math.pow(2, 10 * (time -= 1)) * Math.sin((time * duration - shootover) * (2 * Math.PI) / period)) + begin;
		return amplitude * Math.pow(2, -10 * (time -= 1)) * Math.sin((time * duration - shootover) * (2 * Math.PI) / period) * 0.5 + change + begin;
	},

	easeInBack: function (time, begin, change, duration, shootover) {
		if (shootover == undefined) shootover = 1.70158;
		return change * (time /= duration) * time * ((shootover + 1) * time - shootover) + begin;
	},

	easeOutBack: function (time, begin, change, duration, shootover) {
		if (shootover == undefined) shootover = 1.70158;
		return change * ((time = time / duration - 1) * time * ((shootover + 1) * time + shootover) + 1) + begin;
	},

	easeInOutBack: function (time, begin, change, duration, shootover) {
		if (shootover == undefined) shootover = 1.70158;
		if ((time /= duration / 2) < 1) return change / 2 * (time * time * (((shootover *= (1.525)) + 1) * time - shootover)) + begin;
		return change / 2 * ((time -= 2) * time * (((shootover *= (1.525)) + 1) * time + shootover) + 2) + begin;
	},

	easeInBounce: function (time, begin, change, duration) {
		return change - ac_EasingFunctions.easeOutBounce(duration - time, 0, change, duration) + begin;
	},

	easeOutBounce: function (time, begin, change, duration) {
		if ((time /= duration) < (1 / 2.75)) {
			return change * (7.5625 * time * time) + begin;
		} else if (time < (2 / 2.75)) {
			return change * (7.5625 * (time -= (1.5 / 2.75)) * time + 0.75) + begin;
		} else if (time < (2.5 / 2.75)) {
			return change * (7.5625 * (time -= (2.25 / 2.75)) * time + 0.9375) + begin;
		} else {
			return change * (7.5625 * (time -= (2.625 / 2.75)) * time + 0.984375) + begin;
		}
	},

	easeInOutBounce: function (time, begin, change, duration) {
		if (time < duration / 2) return ac_EasingFunctions.easeInBounce(time * 2, 0, change, duration) * 0.5 + begin;
		return ac_EasingFunctions.easeOutBounce(time * 2 - duration, 0, change, duration) * 0.5 + change * 0.5 + begin;
	}
};

/**
 * Applies an easing curve to a linear cent value (eg 0.5 means 50% complete), and returns the eased cent value.
 * @param {Number} a float, generally between 0 and 1.
 * @param {String|Function} easing function name (member of module:ac-base.EasingFunctions) or a custom easing function that adhere's to the conventions set in our Penner functions (time, begin, change, duration).
 * @returns {Number} a float.
 */
ac_EasingFunctions.ease = function (centValue, easeType) {
	/*jshint -W065*/
	// first lets check for css-transition-function names - and map to nearest functions
	if (easeType === 'ease') {
		easeType = 'easeInOutSine';

	} else if (easeType === 'ease-in') {
		easeType = 'easeInCubic';

	} else if (easeType === 'ease-out') {
		easeType = 'easeOutCubic';

	} else if (easeType === 'ease-in-out') {
		easeType = 'easeInOutCubic';

	} else if (easeType === 'linear') {
		easeType = 'linear';

	} else if (easeType === 'step-start') {
		return (centValue === 0) ? 0 : 1;

	} else if (easeType === 'step-end') {
		return (centValue === 1) ? 1 : 0;

	} else if (typeof easeType === 'string' && /^steps\(\d+\,\s*(start|end)\)$/.test(easeType)){
	// "steps" timing functions get handled differently.
		var steps      = parseInt(easeType.match(/\d+/)[0]);
		var direction  = easeType.match(/(start|end)/)[0];
		var incrementLength = (1/steps);
		return Math[( direction === 'start' ) ? 'floor' : 'ceil']((centValue / incrementLength))*incrementLength;
	}
	if (typeof easeType === 'string') {
	// check for a matching penner function
		if (typeof ac_EasingFunctions[easeType] === 'function' && easeType !== 'ease') {
			easeType = ac_EasingFunctions[easeType];
		} else {
			throw new TypeError('"' + easeType + '" is not a valid easing type');
		}
	}
	// return value as passed through appropriate penner function
	return easeType(centValue, 0, 1, 1);
};

module.exports = ac_EasingFunctions;

},{}],13:[function(require,module,exports){

var ac_Viewport = require('./Viewport');
var ac_log = require('./log');
var events = require('./Element/events');
var vendorTransformHelper = require('./Element/vendorTransformHelper');
var ac_Environment_Browser = require('./Environment/Browser');

/**
 * Utility methods dealing with Elements
 * @name module:ac-base.Element
 * @kind namespace
 */
var ac_Element = {
	addEventListener: events.addEventListener,
	removeEventListener: events.removeEventListener,
	addVendorPrefixEventListener: events.addVendorPrefixEventListener,
	removeVendorPrefixEventListener: events.removeVendorPrefixEventListener,
	/**
	 * @deprecated Use module:ac-base.Element.addVendorPrefixEventListener instead.
	 * @name module:ac-base.Element.addVendorEventListener
	 * @kind function
	 */
	addVendorEventListener: function (element, type, listener, useCapture) {
		ac_log('ac-base.Element.addVendorEventListener is deprecated. Please use ac-base.Element.addVendorPrefixEventListener.');
		return this.addVendorPrefixEventListener(element, type, listener, useCapture);
	},
	/**
	 * @deprecated Use module:ac-base.Element.removeVendorPrefixEventListener instead.
	 * @name module:ac-base.Element.addVendorEventListener
	 * @kind function
	 */
	removeVendorEventListener: function (element, type, listener, useCapture) {
		ac_log('ac-base.Element.removeVendorEventListener is deprecated. Please use ac-base.Element.removeVendorPrefixEventListener.');
		return this.removeVendorPrefixEventListener(element, type, listener, useCapture);
	}
};

// Initialize ac_Element.__EventDelegate
require('./Element/EventDelegate')(ac_Element);

/**
 * @param {Element | String} element
 * @returns The Node with the ID <code>element</code> or return the Node directly, else return null
 * @name module:ac-base.Element.getElementById
 * @kind function
 */
ac_Element.getElementById = function (element) {
	if (typeof element === 'string') {
		element = document.getElementById(element);
	}
	if (ac_Element.isElement(element)) {
		return element;
	} else {
		return null;
	}
};

/**
 * @param {String} selector CSS String to select elements by.
 * @param {Element} context Optional; Scope the search to a specific Element Node. document.body is the default.
 * @returns {Array} Array of Elements as Nodes (Not a Node List)
 * @name module:ac-base.Element.selectAll
 * @kind function
 */
ac_Element.selectAll = function (selector, context) {
	if (typeof context === 'undefined') {
		context = document;
	} else if (!ac_Element.isElement(context) && context.nodeType !== 9 && context.nodeType !== 11) {
		throw new TypeError('ac-base.Element.selectAll: Invalid context nodeType');
	}
	if (typeof selector !== 'string') {
		throw new TypeError('ac-base.Element.selectAll: Selector must be a string');
	}
	// selectAll is shimmed using ac_Array.toArray, so this is fine
	return Array.prototype.slice.call(context.querySelectorAll(selector));
};

/**
 * @param {String} selector CSS String to select elements by.
 * @param {Element} context Optional; Scope the search to a specific Element Node. document.body is the default.
 * @returns {Element} First element that matches selector in DOM
 * @name module:ac-base.Element.select
 * @kind function
 */
ac_Element.select = function (selector, context) {
	if (typeof context === 'undefined') {
		context = document;
	} else if (!ac_Element.isElement(context) && context.nodeType !== 9 && context.nodeType !== 11) {
		throw new TypeError('ac-base.Element.select: Invalid context nodeType');
	}
	if (typeof selector !== 'string') {
		throw new TypeError('ac-base.Element.select: Selector must be a string');
	}
	return context.querySelector(selector);
};

/**
 * No polyfill, sizzle is used in IE shim, which would be
 * the only unsupported place for this in the matrix.
 * @ignore
 */
var matches = window.Element ? (function(proto) {
	return proto.matches ||
		proto.matchesSelector ||
		proto.webkitMatchesSelector ||
		proto.mozMatchesSelector ||
		proto.msMatchesSelector ||
		proto.oMatchesSelector;
}(Element.prototype)) : null;

/**
 * <p>Check to see if an element matches a CSS selector</p>
 * <p>Usage:</p>
 * <pre>
 * module:ac-base.Element.matchesSelector(document.getElementById("foo"), "#foo") -> true
 * module:ac-base.Element.matchesSelector(document.body, "body #foo") -> false
 * </pre>
 * @param {Element} element DOM element you want to check against a selector
 * @param {String} selector CSS Selector you want to check against
 * @returns {Boolean} True if the element is matched by the selector. False otherwise.
 * @name module:ac-base.Element.select
 * @kind function
 */
ac_Element.matchesSelector = function (element, selector) {
	// matches will throw a TypeError for non-elements
	return ac_Element.isElement(element) ? matches.call(element, selector) : false;
};

/**
 * @deprecated Use module:ac-base.Element.filterBySelector instead.
 * @name module:ac-base.Element.matches
 * @kind function
 */
ac_Element.matches = function (element, selector) {
	ac_log('ac-base.Element.matches is deprecated. Use ac-base.Element.filterBySelector instead.');
	return ac_Element.filterBySelector(selector, element);
};

/**
 * <p>Filter an array of elements with a CSS selector</p>
 * <p>Usage:</p>
 * <pre>
 * module:ac-base.Element.filterBySelector(module:ac-base.Element.selectAll(".foo"), ".foo")
 * module:ac-base.Element.filterBySelector(module:ac-base.Element.selectAll("body"), "body #foo") -> false
 * </pre>
 * @param {Array} elements The array of DOM elements you want to filter
 * @param {String} selector The CSS Selector to use for the filter
 * @returns {Array} An array containing all matched elements. This array can be empty.
 * @name module:ac-base.Element.filterBySelector
 * @kind function
 */
ac_Element.filterBySelector = function (elements, selector) {
	var arr = [];
	// @todo Cannot use Array.prototype.filter until removing "the other" script
	for (var i = 0, l = elements.length; i < l; i++) {
		// matches will throw a TypeError for non-elements
		if (ac_Element.isElement(elements[i]) && matches.call(elements[i], selector)) {
			arr[arr.length] = elements[i];
		}
	}
	return arr;
};

/**
 * @deprecated Use ac-base.Element.setStyle instead.
 * @name module:ac-base.Element.setOpacity
 * @kind function
 */
ac_Element.setOpacity = function (element, value) {
	ac_log('ac-base.Element.setOpacity is deprecated. Use ac-base.Element.setStyle instead.');
	return ac_Element.setStyle(element, { opacity: value });
};

/**
 * <p>Set one or more CSS styles on a DOM element.</p>
 * <p>Usage:</p>
 * <pre>
 * // element and style paramaters as strings
 * module:ac-base.Element.setStyle('nav', 'float:left; background:#ccc;');
 * // element paramater as DOM element, style paramater as an object
 * var element = document.getElementById('nav');
 * module:ac-base.Element.setStyle(element, {
 *     float: "left",
 *     background: "#ccc"
 * });
 * </pre>
 * @param {String | Element} element The DOM element to set the style/s on. May either be a valid DOM element
 * or the id as a string of the element you want to target.
 * @param {String | Object} style One or more styles as CSS string or an object with property/value pairs.
 * @returns element as Node
 * @name module:ac-base.Element.setStyle
 * @kind function
 */
ac_Element.setStyle = function (element, styles) {
	if ((typeof styles !== 'string' && typeof styles !== 'object') || Array.isArray(styles)) {
		throw new TypeError('styles argument must be either an object or a string');
	}

	element = ac_Element.getElementById(element);
	var stylesObj;
	var camelCaseProp;
	var prop;

	stylesObj = ac_Element.setStyle.__explodeStyleStringToObject(styles);

	// iterate over stylesObj and set styles
	for (prop in stylesObj) {
		if (stylesObj.hasOwnProperty(prop)) {
			camelCaseProp = prop.replace(/-(\w)/g, ac_Element.setStyle.__camelCaseReplace);
			ac_Element.setStyle.__setStyle(element, camelCaseProp, stylesObj, stylesObj[prop]);
		}
	}

	return element;
};

ac_Element.setStyle.__explodeStyleStringToObject = function (styles) {
	var stylesObj = (typeof styles === 'object') ? styles : {};
	var splitStyles;
	var colon;
	var len;
	var i;

	if (typeof styles === 'string') {
		splitStyles = styles.split(';');
		len = splitStyles.length;
		for (i = 0; i < len; i += 1) {
			colon = splitStyles[i].indexOf(':');
			if (colon > 0) {
				stylesObj[splitStyles[i].substr(0, colon).trim()] = splitStyles[i].substr(colon + 1).trim();
			}
		}
	}

	return stylesObj;
};

ac_Element.setStyle.__setStyle = function (element, camelCaseProp, stylesObj, stylesValue) {
	if (typeof element.style[camelCaseProp] !== 'undefined') {
		element.style[camelCaseProp] = stylesValue;
	}
};

// replace function to handle camelCasing for module:ac-base.Element.setStyle and getStyle.
// Accounts for Mozilla expecting 'Moz'.
/** @ignore */
ac_Element.setStyle.__camelCaseReplace = function (match, group, offset, string) {
	return (offset === 0) && (string.substr(1, 3) !== 'moz') ? group : group.toUpperCase();
};

/**
 * @param {Element} element
 * @param {String} style
 * @returns {String} The value for the style property on this Element
 * @name module:ac-base.Element.getStyle
 * @kind function
 */
ac_Element.getStyle = function (element, style, css) {
	var value;

	style = style.replace(/-(\w)/g, ac_Element.setStyle.__camelCaseReplace);

	element = ac_Element.getElementById(element);
	style = (style === 'float') ? 'cssFloat' : style;

	css = css || window.getComputedStyle(element, null);
	value = css ? css[style] : null;

	if (style === 'opacity') {
		return value ? parseFloat(value) : 1.0;
	}

	return value === 'auto' ? null : value;
};

/**
 * <p>Returns an object with top and left offset values for an element relative
 * to the absolute top and left locations of html document.</p>
 * @param {Element} element
 * @returns {Object} An object with numeric values for top and left properties.
 * @name module:ac-base.Element.cumulativeOffset
 * @kind function
 */
ac_Element.cumulativeOffset = function (element) {
	var box = ac_Element.getBoundingBox(element);
	var scrollOffsets = ac_Viewport.scrollOffsets();
	var offset = [box.top + scrollOffsets.y, box.left + scrollOffsets.x];
	offset.top = offset[0];
	offset.left = offset[1];
	return offset;
};

/**
 * @param {Element} element
 * <p>Returns the bounding box values for an element including width and height.
 * Borders and padding are included. Values are affected by box-sizing.</p>
 * @param {Element} The element you want to query
 * @returns {Object} An object with top, right, bottom, left, width and height values as numbers
 * @name module:ac-base.Element.getBoundingBox
 * @kind function
 */
ac_Element.getBoundingBox = function (element) {
	element = ac_Element.getElementById(element);
	var rect = element.getBoundingClientRect();
	var w = rect.width || rect.right - rect.left;
	var h = rect.height || rect.bottom - rect.top;

	return {
		top: rect.top,
		right: rect.right,
		bottom: rect.bottom,
		left: rect.left,
		width: w,
		height: h
	};
};

/**
 * <p>Returns the width and height of an element's content box. Padding and
 * borders are not included. Accounts for box-sizing:border-box;.</p>
 * @param {Element} The element you want to query
 * @returns {Object} An object with width and height values as numbers
 * @name module:ac-base.Element.getInnerDimensions
 * @kind function
 */
ac_Element.getInnerDimensions = function (element) {
	var dims = ac_Element.getBoundingBox(element);
	var w = dims.width;
	var h = dims.height;
	var style;
	var styleValue;
	var css = window.getComputedStyle ? window.getComputedStyle(element, null) : null;

	['padding', 'border'].forEach(function (prop) {
		['Top', 'Right', 'Bottom', 'Left'].forEach(function (side) {
			style = prop === 'border' ? prop + side + 'Width' : prop + side;
			styleValue = parseFloat(ac_Element.getStyle(element, style, css));
			styleValue = isNaN(styleValue) ? 0 : styleValue;
			if (side === 'Right' || side === 'Left') {
				w -= styleValue;
			}
			if (side === 'Top' || side === 'Bottom') {
				h -= styleValue;
			}
		});
	});

	return {
		width: w,
		height: h
	};
};

/**
 * <p>Returns the width and height of an element including borders and margins.
 * Accounts for box-sizing:border-box;.</p>
 * @param {Element} The element you want to query
 * @returns {Object} An object with width and height values as numbers
 * @name module:ac-base.Element.getOuterDimensions
 * @kind function
 */
ac_Element.getOuterDimensions = function (element) {
	var dims = ac_Element.getBoundingBox(element);
	var w = dims.width;
	var h = dims.height;
	var marginStyle;
	var css = window.getComputedStyle ? window.getComputedStyle(element, null) : null;

	['margin'].forEach(function (prop) {
		['Top', 'Right', 'Bottom', 'Left'].forEach(function (side) {
			marginStyle = parseFloat(ac_Element.getStyle(element, prop + side, css));
			marginStyle = isNaN(marginStyle) ? 0 : marginStyle;
			if (side === 'Right' || side === 'Left') {
				w += marginStyle;
			}
			if (side === 'Top' || side === 'Bottom') {
				h += marginStyle;
			}
		});
	});

	return {
		width:  w,
		height: h
	};
};

/**
 * Return <code>true</code> or <code>false</code> depending on whether the className provided exists on the element.
 * @param {Element} element
 * @param {String} cls className to test against
 * @name module:ac-base.Element.hasClassName
 * @kind function
 */
ac_Element.hasClassName = function (element, cls) {
	var matchedElement = ac_Element.getElementById(element);

	if (matchedElement && matchedElement.className !== '') {
		return new RegExp('(\\s|^)' + cls + '(\\s|$)').test(matchedElement.className);
	} else {
		return false;
	}
};

/**
 * Adds a className to an Element.
 * @param {Element} element
 * @param {String} cls className to add
 * @name module:ac-base.Element.addClassName
 * @kind function
 */
ac_Element.addClassName = function (element, cls) {
	var matchedElement = ac_Element.getElementById(element);

	// use classList when available as it is more performant and does not trigger a repaint
	if (matchedElement.classList) {
		matchedElement.classList.add(cls);

	// check hasClassName first to avoid unnecessary repaints resulting from modifying the className property
	} else if (!ac_Element.hasClassName(matchedElement, cls)) {
		matchedElement.className += " " + cls;
	}
};

/**
 * Removes a className from an Element.
 * @param {Element} element
 * @param {String} cls className to remove
 * @name module:ac-base.Element.removeClassName
 * @kind function
 */
ac_Element.removeClassName = function (element, cls) {
	var matchedElement = ac_Element.getElementById(element);

	if (ac_Element.hasClassName(matchedElement, cls)) {
		var reg = new RegExp('(\\s|^)' + cls + '(\\s|$)');
		matchedElement.className = matchedElement.className.replace(reg, '$1').trim();
	}
};

/**
 * Toggles a className on an element. If the className is not present, it is added.
 * If it is present, it is removed.
 * @param {Element} element
 * @param {String} cls className to toggle
 * @name module:ac-base.Element.toggleClassName
 * @kind function
 */
ac_Element.toggleClassName = function (element, cls) {
	var matchedElement = ac_Element.getElementById(element);

	if (matchedElement.classList) {
		matchedElement.classList.toggle(cls);
	} else {
		if (ac_Element.hasClassName(matchedElement, cls)) {
			ac_Element.removeClassName(matchedElement, cls);
		} else {
			ac_Element.addClassName(matchedElement, cls);
		}
	}
};

/**
 * Test whether or not an Object is an Element.
 * @param {Object} object
 * @name module:ac-base.Element.isElement
 * @kind function
 */
ac_Element.isElement = function (object) {
	return !!(object && object.nodeType === 1);
};

/**
 * Sets all the vendor specific style {{{property}}} to {{{value}}} on {{{element}}}.
 * @param {Element} element : the element for which to set the style upon
 * @param {String} property : the css property, e.g. borderRadius, webkitBorderRadius, border-radius, etc...
 * @param {String|Number} value : the value for which to set the element's css property
 * @name module:ac-base.Element.setVendorPrefixStyle
 * @kind function
 */
ac_Element.setVendorPrefixStyle = function (element, property, value) {
	if (typeof property !== 'string') {
		throw new TypeError('ac-base.Element.setVendorPrefixStyle: property must be a string');
	}
	if (typeof value !== 'string' && typeof value !== 'number') {
		throw new TypeError('ac-base.Element.setVendorPrefixStyle: value must be a string or a number');
	}

	// Coerce value to string
	value += '';

	element = ac_Element.getElementById(element);
	// Empty value accounts for non-vendor-prefixed properties
	var prefixes = ['', 'webkit', 'Moz', 'ms', 'O'];
	var prefixedCamelProp;
	var prefixedValue;

	// Strip prefix from property if it has one
	property = property.replace(/-(webkit|moz|ms|o)-/i, '');
	// Strip js camelcase vendor prefix if it has one and lowercase first letter. e.g. webkitTransform
	property = property.replace(/^(webkit|Moz|ms|O)/, '');
	property = property.charAt(0).toLowerCase() + property.slice(1);

	// camelCase property
	property = property.replace(/-(\w)/, function (match, group) {
		return group.toUpperCase();
	});

	// Insert token for vendor prefix replacement in values
	value = value.replace(/-(webkit|moz|ms|o)-/, '-vendor-');

	// Iterate through prefixes array testing for existence of property. Update if present.
	prefixes.forEach(function (prefix) {
		// Apply prefixes
		prefixedCamelProp = (prefix === '') ? property : prefix + property.charAt(0).toUpperCase() + property.slice(1);
		prefixedValue = (prefix === '') ? value.replace('-vendor-', '') : value.replace('-vendor-', '-' + prefix.charAt(0).toLowerCase() + prefix.slice(1) + '-');

		if (prefixedCamelProp in element.style) {
			ac_Element.setStyle(element, prefixedCamelProp + ':' + prefixedValue);
		}
	});

};

/**
 * Returns the style value for a specific property as a string and, if necessary, prefixed
 * with the correct vendor prefix for the executing browser.
 * @param {Element | String} element The DOM element from which to return the style. Can either
 * be a valid DOM element or the element's ID as a string.
 * @param {String} property The CSS property to fetch the style for. Will accept either a CSS
 * property or a javascript Element.style property name. Vendor prefixes are optional. Any
 * acceptable property as a string will return the same results. e.g. -webkit-box-shadow,
 * -moz-box-shadow, boxShadow, and msBoxShadow will all yield the same return value.
 * @returns The specified property's style as a string
 * @name module:ac-base.Element.getVendorPrefixStyle
 * @kind function
 */
ac_Element.getVendorPrefixStyle = function (element, property) {
	if (typeof property !== 'string') {
		throw new TypeError('ac-base.Element.getVendorPrefixStyle: property must be a string');
	}

	element = ac_Element.getElementById(element);
	var prefixes = ['', 'webkit', 'Moz', 'ms', 'O'];
	var style;

	// Strip css vendor prefix from property if it has one. e.g. -webkit-transform
	property = property.replace(/-(webkit|moz|ms|o)-/i, '');
	// Strip js camelcase vendor prefix if it has one and lowercase first letter. e.g. webkitTransform
	property = property.replace(/^(webkit|Moz|ms|O)/, '').charAt(0).toLowerCase() + property.slice(1);

	// camelCase property
	property = property.replace(/-(\w)/, function (match, group) {
		return group.toUpperCase();
	});

	// Iterate through prefixes array, testing for existence of property. module:ac-base.Element.getStyle runs on the first match.
	prefixes.some(function (prefix, index) {
		// Apply prefixes
		var prefixedCamelProp = (prefix === '') ? property : prefix + property.charAt(0).toUpperCase() + property.slice(1);

		if (prefixedCamelProp in element.style) {
			style = ac_Element.getStyle(element, prefixedCamelProp);
			return true;
		}
	});

	return style;
};

/**
 * Inserts nodes - Handles four insertion cases: before, after, first and last (default)
 * @param {Element} element The element to be inserted. Must be one of three nodeTypes - element, textNode, documentFragment
 * @param {Element} target The node to be used as the target in relation to placement of element.
 * @param {String} placement Optional; Where to insert the element in relation to the target.
 * <p><strong>Accepted values:</strong></p>
 * <dl>
 *     <dt>‘first’:</dt><dd>Inserts ‘element’ as the first child of ‘target’.</dd>
 *     <dt>‘before’:</dt><dd>Inserts ‘element’ immediately before ‘target’.</dd>
 *     <dt>‘after’:</dt><dd>Inserts ‘element’ immediately after ‘target’.</dd>
 *     <dt>Default behavior:</dt><dd>Appends ‘element’ as the last child of ‘target’.</dd>
 * </dl>
 * @name module:ac-base.Element.insert
 * @kind function
 */
ac_Element.insert = function (element, target, placement) {
	// Restrict node types passed: 1 = element, 3 = text node, 11 = document fragment
	if (!element || !(element.nodeType === 1 || element.nodeType === 3 || element.nodeType === 11)) {
		throw new TypeError('ac-base.Element.insert: element must be a valid node of type element, text, or document fragment');
	}
	if (!target || !(target.nodeType === 1 || target.nodeType === 11)) {
		throw new TypeError('ac-base.Element.insert: target must be a valid node of type element or document fragment');
	}

	// Placement is optional; defaults to ‘last’
	switch (placement) {
	case 'before':
		if (target.nodeType === 11) {
			throw new TypeError('ac-base.Element.insert: target cannot be nodeType of documentFragment when using placement ‘before’');
		}
		target.parentNode.insertBefore(element, target);
		break;
	case 'after':
		if (target.nodeType === 11) {
			throw new TypeError('ac-base.Element.insert: target cannot be nodeType of documentFragment when using placement ‘after’');
		}
		target.parentNode.insertBefore(element, target.nextSibling);
		break;
	case 'first':
		target.insertBefore(element, target.firstChild);
		break;
	default: //'last'
		target.appendChild(element);
	}
};

/**
 * Insert a node into a parent's children at a given index.
 * @param  {Element} element The element to be inserted.
 * @param  {Element} target The parent element in which the first element will be inserted to.
 * @param  {Number} index Zero-based index at which to insert the first element into the target.
 * @name module:ac-base.Element.insertAt
 * @kind function
 */
ac_Element.insertAt = function (element, target, index) {
	var children;
	var len;
	var i;

	element = ac_Element.getElementById(element);
	target = ac_Element.getElementById(target);

	if (!ac_Element.isElement(element) || !ac_Element.isElement(target)) {
		throw new TypeError('ac-base.Element.insertAt: element must be a valid DOM element');
	}

	children = ac_Element.children(target);

	// allow negative indices
	if (index < 0 && children.length) {
		index += children.length;
	}

	// take into account the case where we're inserting an element that's
	// already a child of the container
	if (target.contains(element) && index > children.indexOf(element)) {
		index++;
	}

	if (children && index <= children.length - 1) {
		for (i = 0, len = children.length; i < len; i++) {
			if (i === index) {
				target.insertBefore(element, children[i]);
				break;
			}
		}
	} else {
		// for incices larger than the largest index, append to end
		target.appendChild(element);
	}
};

/**
 * Returns an array of DOM elements (nodeType:3) that are direct children of element
 * @todo Cannot use Array.prototype.filter until removing "the other" script
 * @param   {Element} element Where to retrieve child elements from.
 * @returns {Element|null} an array of DOM elements, or null if none
 * @name module:ac-base.Element.children
 * @kind function
 */
ac_Element.children = function (element) {
	var _children, child;

	element = ac_Element.getElementById(element);

	if (!ac_Element.isElement(element)) {
		throw new TypeError('ac-base.Element.children: element must be a valid DOM element');
	}

	if (element.children) {
		_children = [];
		for (var i = 0, l = element.children.length; i < l; i++) {
			child = element.children[i];
			if (child && child.nodeType === 1) {
				_children.push(child);
			}
		}
	}

	return _children.length ? _children : null;
};

/**
 * Removes nodes. Will optionally retain a reference to the removed node.
 * @param {Element} element The element to be removed.
 * @param {Boolean} retainReference If true a reference to the removed element will be returned.
 * @name module:ac-base.Element.remove
 * @kind function
 */
ac_Element.remove = function (element, retainReference) {
	if (!ac_Element.isElement(element)) {
		throw new TypeError('ac-base.Element.remove: element must be a valid DOM element');
	}
	if (retainReference === true) {
		var removedNode = element.parentNode.removeChild(element);
		return removedNode;
	} else {
		element.parentNode.removeChild(element);
	}
};

/**
 * Determines the offset of the top/left of the element from the top/left of the viewport.
 * @param {Element} element
 * @returns {Object} x, y coordinates (px) of the top/left corner of the element relative to the top/left corner of the viewport.
 * @name module:ac-base.Element.viewportOffset
 * @kind function
 */
ac_Element.viewportOffset = function (element) {
	var offset = ac_Element.getBoundingBox(element);
	return { x: offset.left, y: offset.top };
};

/**
 * Determines the amount of the height of the element that is in view.
 * @param {Element} element
 * @returns {Integer} Number of pixels of the element that are currently within the viewport.
 * @name module:ac-base.Element.pixelsInViewport
 * @kind function
 */
ac_Element.pixelsInViewport = function (element, elementMetrics) {
	// Amount of the element that is visible inside of the viewport (px)
	var pixelsInView;

	if (!ac_Element.isElement(element)) {
		throw new TypeError('ac-base.Element.pixelsInViewport : element must be a valid DOM element');
	}

	// Get element and viewport metrics
	var viewportMetrics = ac_Viewport.dimensions();
	elementMetrics = elementMetrics || ac_Element.getBoundingBox(element);

	// Determine the offset from the top of the element relative to the top edge
	// of the viewport (px)
	var elementViewportOffsetY = elementMetrics.top;

	// If element is fully in view or cropped by bottom edge of viewport
	if (elementViewportOffsetY >= 0) {
		pixelsInView = viewportMetrics.height - elementViewportOffsetY;

		// If the bottom edge of element is in view and the top edge, then it
		// is fully in view
		if (pixelsInView > elementMetrics.height) {
			pixelsInView = elementMetrics.height;
		}

		// If element is cropped by top edge of viewport or is scrolled out of
		// view above top edge of viewport
	} else {
		pixelsInView = elementMetrics.height + elementViewportOffsetY;
	}

	// If the element is completely out of view past the bottom edge of
	// the viewport, then 0 px of it is in view
	if (pixelsInView < 0) {
		pixelsInView = 0;
	}

	if (pixelsInView > viewportMetrics.height){
		pixelsInView = viewportMetrics.height;
	}

	return pixelsInView;
};

/**
 * Determines the percentage of the height of the element that is in view.
 * @param {Element} element
 * @returns {Float} 0-1, Percentage of the element within the viewport.
 * @name module:ac-base.Element.percentInViewport
 * @kind function
 */
ac_Element.percentInViewport = function (element) {
	var elementMetrics = ac_Element.getBoundingBox(element);
	var pixelsInView = ac_Element.pixelsInViewport(element, elementMetrics);
	return pixelsInView / elementMetrics.height;
};

/**
 * @param {Element} element
 * @param {Float} percentageThreshold Optional. Default : 0, Range: [0, 1]
 * @returns {Boolean} Whether or not that element is visible on the page (within the viewport) past a certain threshold percentage.
 * @name module:ac-base.Element.isInViewport
 * @kind function
 */
ac_Element.isInViewport = function (element, percentageThreshold) {

	// Ensure that percentageThreshold is defined and within bounds.
	if (typeof percentageThreshold !== "number" || 1 < percentageThreshold || percentageThreshold < 0){
		percentageThreshold = 0;
	}

	var percentInViewport = ac_Element.percentInViewport(element);
	return (percentInViewport > percentageThreshold || percentInViewport === 1);
};

var eachAncestor = function (element, handler) {
	element = ac_Element.getElementById(element);
	var ancestor = element.parentNode;

	while (ancestor && ac_Element.isElement(ancestor)) {
		if (typeof handler === 'function') {

			// If the handler returns false
			// break out of the loop
			if (handler(ancestor) === false) {
				break;
			}

		}

		// if we aren’t at document.body yet
		// keep moving up
		if (ancestor !== document.body) {
			ancestor = ancestor.parentNode;

		} else {
			// stop on document.body
			ancestor = null;
		}
	}
};

/**
 * Returns an array of ancestors for an element.
 * @param {Element} element The element to return an ancestor of
 * @param {Boolean} cssSelector If specified, will filter ancestors based on selector
 * @returns {Array} array of elements
 * @name module:ac-base.Element.ancestors
 * @kind function
 */
ac_Element.ancestors = function (element, cssSelector) {
	var elements = [];

	// iterate over ancestors and add to elements array
	eachAncestor(element, function (ancestor) {
		// add to elements array if cssSelector is not defined or if cssSelector matches the element
		if (cssSelector === undefined || ac_Element.matchesSelector(ancestor, cssSelector)) {
			elements.push(ancestor);
		}
	});

	return elements;
};

/**
 * Returns first matching ancestor for an element.
 * If no <code>cssSelector</code> is specified, returns <code>parentNode</code>, as if <code>cssSelector</code> were ‘*’.
 * @param {Element} element The element to return ancestors
 * @param {Boolean} cssSelector If specified, will return first ancestor that matches selector
 * @returns First matched element or null if no match
 * @name module:ac-base.Element.ancestor
 * @kind function
 */
ac_Element.ancestor = function (element, cssSelector) {
	element = ac_Element.getElementById(element);
	var firstMatch = null;

	if (element !== null && cssSelector === undefined) {
		return element.parentNode;
	}

	// iterate over all ancestors and return the first match
	eachAncestor(element, function (ancestor) {
		if (ac_Element.matchesSelector(ancestor, cssSelector)) {
			firstMatch = ancestor;
			return false;
		}
	});

	return firstMatch;
};

/**
 * Sets all the appropriate vendor prefixed transform properties to {{{transformFunctions}}} on {{{element}}}.
 * If the 3D version of the transform is available it will set that in favor of the 2D transform.
 * @param {Element} element : the element for which to set the style upon
 * @param {String|Object} transformFunctions : the value for which to set the element's transform property. As a string
 * it takes the form of <code>[transformFunction]([parameters])</code>. As an object, pass the
 * <code>[transformFunctions]</code> as the key and the <code>[parameters]</code> as string to the key's value.
 * @name module:ac-base.Element.setVendorPrefixTransform
 * @kind function
 */
ac_Element.setVendorPrefixTransform = function (element, transformFunctions) {
	if ((typeof transformFunctions !== 'string' && typeof transformFunctions !== 'object') || Array.isArray(transformFunctions) || transformFunctions === null) {
		throw new TypeError('ac-base.Element.setVendorPrefixTransform: transformFunctions argument must be either an object or a string');
	}

	ac_Element.setVendorPrefixStyle(element, 'transform', vendorTransformHelper.convert2dFunctions(transformFunctions));
};

if (ac_Environment_Browser.name === "IE") {
	require('./shims/ie/Element')(ac_Element, ac_Environment_Browser);
}

module.exports = ac_Element;

},{"./Element/EventDelegate":14,"./Element/events":15,"./Element/vendorTransformHelper":18,"./Environment/Browser":20,"./Viewport":35,"./log":39,"./shims/ie/Element":44}],14:[function(require,module,exports){
'use strict';

module.exports = function (ac_Element) {
	/**
	 * EventDelegate handles intercepting the event bubble and firing
	 * a handler when the event target matches its css selector
	 * @param {Element} element
	 * @param {Object} options
	 * @name module:ac-base.Element~EventDelegate
	 * @kind class
	 */
	function EventDelegate(element, options) {
		this.element = element;
		this.options = options || {};
	}

	EventDelegate.prototype = /** @lends module:ac-base.Element~EventDelegate# */ {
		/**
		 * Finds if a passed element matches the object's css selector, or if it is a descendant
		 * of an element that matches the selector
		 * @param {Element} element that will be matched against a css selector or whose ancestors will be checked
		 * @ignore
		 */
		__findMatchingTarget: function (eventTarget) {
			var delegateTarget = null;

			if (ac_Element.matchesSelector(eventTarget, this.options.selector)) {
				delegateTarget = eventTarget;

			} else {
				delegateTarget = ac_Element.ancestor(eventTarget, this.options.selector);

			}
			return delegateTarget;
		},
		/**
		 * Generates a method that will actually be attached as a dom event listener
		 * @ignore
		 */
		__generateDelegateMethod: function () {
			var self = this;
			var handler = self.options.handler;

			return function (evt) {
				var eventTarget = evt.target || evt.srcElement;
				var delegateTarget = self.__findMatchingTarget(eventTarget);
				var delegateEvent;

				if (delegateTarget !== null) {
					delegateEvent = new EventDelegate.Event(evt);
					delegateEvent.setTarget(delegateTarget);

					handler(delegateEvent);
				}
			};
		},
		/**
		 * Attaches the result of __generateDelegateMethod as an event listener
		 * @name EventDelegate.prototype.attachEventListener
		 * @returns {Function} Generated method that is attached as a DOM listener
		 */
		attachEventListener: function () {
			this.__delegateMethod = this.__generateDelegateMethod();
			ac_Element.addEventListener(this.element, this.options.eventType, this.__delegateMethod);
			return this.__delegateMethod;
		},
		/**
		 * Removes event listener
		 */
		unbind: function () {
			ac_Element.removeEventListener(this.element, this.options.eventType, this.__delegateMethod);
			this.__delegateMethod = undefined;
		}
	};

	/**
	 * Holds all instances of EventDelegate
	 * @type {Array.<module:ac-base.Element~EventDelegate>}
	 * @memberof module:ac-base.Element~EventDelegate
	 */
	EventDelegate.instances = [];

	/**
	 * Iterates through all instances in EventDelegate.instances and fires passed function for each instance
	 * @param {Function} filterMethod Function used to filter results
	 * @name module:ac-base.Element~EventDelegate.filterInstances
	 * @returns {Array.<module:ac-base.Element~EventDelegate>} Array of event delegates where filter method returned true
	 */
	EventDelegate.filterInstances = function (filterMethod) {
		var matches = [];

		EventDelegate.instances.forEach(function (eventDelegate) {
			if (filterMethod(eventDelegate) === true) {
				matches.push(eventDelegate);
			}
		});

		return matches;
	};

	/**
	 * Event type that gets passed to delegate handlers
	 * @constructor
	 * @param {evt} Native DOM Event
	 * @name module:ac-base.Element~EventDelegate~Event
	 */
	EventDelegate.Event = function (evt) {
		this.originalEvent = evt;
	};

	/**
	 * Sets the target element for the instance
	 * @param {Element} DOM Element
	 * @name module:ac-base.Element~EventDelegate~Event#setTarget
	 */
	EventDelegate.Event.prototype.setTarget = function (target) {
		this.target = target;
		this.currentTarget = target;
	};

	/**
	 * Creates an event delegate and attaches it to an element
	 * @param {Element} DOM Element
	 * @param {String} Type of event to listen for (eg, 'click', 'keyup', etc)
	 * @param {String} CSS Selector to filter targets against
	 * @param {Function} Function to be fired for the event
	 * @name module:ac-base.Element.addEventDelegate
	 * @name module:ac-base.Element.addEventDelegate
	 * @kind function
	 */
	ac_Element.addEventDelegate = function (element, eventType, selector, handler) {
		var eventDelegate = new ac_Element.__EventDelegate(element, {
			eventType:eventType,
			selector:selector,
			handler:handler
		});

		EventDelegate.instances.push(eventDelegate);

		return eventDelegate.attachEventListener();
	};

	/**
	 * Removes an event delegate from an element
	 * @param {Element} DOM Element
	 * @param {String} Type of event to listen for (eg, 'click', 'keyup', etc)
	 * @param {String} CSS Selector to filter targets against
	 * @param {Function} Function to be fired for the event
	 * @name module:ac-base.Element.removeEventDelegate
	 * @kind function
	 */
	ac_Element.removeEventDelegate = function (element, eventType, selector, handler) {
		var eventDelegates = ac_Element.__EventDelegate.filterInstances(function (eventDelegate) {
			var options = eventDelegate.options;

			return eventDelegate.element === element && options.selector === selector && options.eventType === eventType && options.handler === handler;
		});

		eventDelegates.forEach(function (eventDelegate) {
			eventDelegate.unbind();
		});
	};

	ac_Element.__EventDelegate = EventDelegate;
};

},{}],15:[function(require,module,exports){
'use strict';

var events = {};

/**
 * Cross-browser event handling
 * @param {Element} target Element to listen for event on
 * @param {string} type
 * @param {function} listener
 * @param {boolean} [useCapture=false]
 * @returns target
 * @name module:ac-base.Element.addEventListener
 * @kind function
 */
events.addEventListener = function (target, type, listener, useCapture) {
	if (target.addEventListener) {
		target.addEventListener(type, listener, useCapture);
	} else if (target.attachEvent) {
		target.attachEvent('on' + type, listener);
	} else {
		target['on' + type] = listener;
	}
	return target;
};

/**
 * Cross-browser event dispatch
 * @param  {Element} target Element that will dispatch the event
 * @param  {String} type   The name of the event to fire
 * @return {Element}       target
 * @name module:ac-base.Element.dispatchEvent
 * @kind function
 */
events.dispatchEvent = function (target, type) {
	if (document.createEvent) {
		target.dispatchEvent(new CustomEvent(type));
	} else {
		target.fireEvent('on' + type, document.createEventObject());
	}
	return target;
};

/**
 * Cross-browser event removing
 * @param {Element} target Element to listen for event on
 * @param {string} type
 * @param {function} listener
 * @param {boolean} [useCapture=false]
 * @returns target
 * @name module:ac-base.Element.removeEventListener
 * @kind function
 */
events.removeEventListener = function (target, type, listener, useCapture) {
	if (target.removeEventListener) {
		target.removeEventListener(type, listener, useCapture);
	} else {
		target.detachEvent('on' + type, listener);
	}
	return target;
};

/**
 * Sets all the vendor event listeners of type on element.
 * @param {Element} element : the element for which to set the listener upon
 * @param {String} type : a string representing the event type to listen for, e.g. animationEnd, webkitAnimationEnd, etc... IMPORTANT: This value is expected to be a string in camelCase.
 * @param {Function} listener : the object that receives a notification when an event of the specified type occurs.
 * @param {Boolean} useCapture : If true, useCapture indicates that the user wishes to initiate capture.
 * @returns target
 * @name module:ac-base.Element.addVendorPrefixEventListener
 * @kind function
 */
events.addVendorPrefixEventListener = function (element, type, listener, useCapture) {
	if (type.match(/^webkit/i)) {
		type = type.replace(/^webkit/i, '');
	} else if (type.match(/^moz/i)) {
		type = type.replace(/^moz/i, '');
	} else if (type.match(/^ms/i)) {
		type = type.replace(/^ms/i, '');
	} else if (type.match(/^o/i)) {
		type = type.replace(/^o/i, '');
	} else {
		type = type.charAt(0).toUpperCase() + type.slice(1);
	}

	// To avoid adding the same event twice, we need to sniff the user agent.
	// Once we've confirmed a browser supports the generic event name, we'll
	// change this if to be < that build.
	if (/WebKit/i.test(window.navigator.userAgent)) {
		return events.addEventListener(element, 'webkit' + type, listener, useCapture);
	} else if (/Opera/i.test(window.navigator.userAgent)) {
		return events.addEventListener(element, 'O' + type, listener, useCapture);
	} else if (/Gecko/i.test(window.navigator.userAgent) || /Trident/i.test(window.navigator.userAgent)) {
		return events.addEventListener(element, type.toLowerCase(), listener, useCapture);
	} else {
		type = type.charAt(0).toLowerCase() + type.slice(1);
		return events.addEventListener(element, type, listener, useCapture);
	}
};

/**
 * Removes all the vendor event listeners of type on an element.
 * @param {Element} element : the element for which to remove the listener from
 * @param {String} type : a string representing the event type to listen for, e.g. animationEnd, webkitAnimationEnd, etc... IMPORTANT: This value is expected to be a string in camelCase.
 * @param {Function} listener : the object that receives a notification when an event of the specified type occurs.
 * @param {Boolean} useCapture : If true, useCapture indicates that the user wishes to initiate capture.
 * @name module:ac-base.Element.removeVendorPrefixEventListener
 * @kind function
 */
events.removeVendorPrefixEventListener = function (element, type, listener, useCapture) {
	if (type.match(/^webkit/i)) {
		type = type.replace(/^webkit/i, '');
	} else if (type.match(/^moz/i)) {
		type = type.replace(/^moz/i, '');
	} else if (type.match(/^ms/i)) {
		type = type.replace(/^ms/i, '');
	} else if (type.match(/^o/i)) {
		type = type.replace(/^o/i, '');
	} else {
		type = type.charAt(0).toUpperCase() + type.slice(1);
	}

	events.removeEventListener(element, 'webkit' + type, listener, useCapture);
	events.removeEventListener(element, 'O' + type, listener, useCapture);
	events.removeEventListener(element, type.toLowerCase(), listener, useCapture);

	type = type.charAt(0).toLowerCase() + type.slice(1);
	return events.removeEventListener(element, type, listener, useCapture);
};

module.exports = events;

},{}],16:[function(require,module,exports){
/**
 * Originally based on contentloaded.js, this has been refactored to use
 * AC helpers and logic similar to module:ac-base.onWindowLoad.
 *
 * @name module:ac-base.onDOMReady
 * @param {Function} callback Function reference
 * @returns void
 */
/*
 * Original Script: contentloaded.js
 * Author: Diego Perini (diego.perini at gmail.com)
 * Summary: cross-browser wrapper for DOMContentLoaded
 * Updated: 20101020
 * License: MIT
 * Version: 1.2
 *
 * URL:
 * http://javascript.nwbox.com/ContentLoaded/
 * http://javascript.nwbox.com/ContentLoaded/MIT-LICENSE
 */
'use strict';

/** @ignore */
var globals = require('../globals');
/** @ignore */
var events = require('./events');
/** @ignore */
var pollId;
/** @ignore */
var queue;

/**
 * A method to run once the dom is ready
 * @ignore
 */
function onReady(event) {
	var doc = globals.document;
	var win = globals.window;

	if (event.type === 'readystatechange' && doc.readyState !== 'complete') {
		return;
	}

	// Run the queued actions!
	var i = queue.length;
	while (i--) {
		queue.shift().call(win, event.type || event);
	}
	// Stop caring. It’s not going to happen again!
	events.removeEventListener(doc, 'DOMContentLoaded', onReady, false);
	events.removeEventListener(doc, 'readystatechange', onReady, false);
	events.removeEventListener(win, 'load', onReady, false);
	clearTimeout(pollId);
}

/** @ignore */
function poll() {
	try {
		globals.document.documentElement.doScroll('left');
	} catch(e) {
		pollId = setTimeout(poll, 50);
		return;
	}
	onReady('poll');
}

module.exports = function ac_onDOMReady(callback) {
	var doc = globals.document;
	var win = globals.window;

	// If the window has loaded, let’s just run the action immediately
	if (doc.readyState === 'complete') {
		callback.call(win, 'lazy');

	// Otherwise, queue ‘er up!
	} else {
		if (!queue || !queue.length) {
			queue = [];
			events.addEventListener(doc, 'DOMContentLoaded', onReady, false);
			events.addEventListener(doc, 'readystatechange', onReady, false);
			events.addEventListener(win, 'load', onReady, false);
			if (doc.createEventObject && doc.documentElement.doScroll) {
				try {
					if (!win.frameElement) {
						poll();
					}
				} catch(e) {}
			}
		}
		queue.push(callback);
	}
};

},{"../globals":38,"./events":15}],17:[function(require,module,exports){
/**
 * Similarly to module:ac-base.onDOMReady, will fire function passed
 * as argument when window is loaded. If window has already loaded
 *
 * @name module:ac-base.onWindowLoad
 * @see https://developer.mozilla.org/en-US/docs/Web/API/document.readyState
 * @returns void
 */
'use strict';

/** @ignore */
var globals = require('../globals');
/** @ignore */
var events = require('./events');
/** @ignore */
var queue;

/**
 * A method to run once the window has loaded, if it hasn’t already
 * @ignore
 */
function onLoad() {
	// Run the queued actions!
	var i = queue.length;
	while (i--) {
		queue.shift()();
	}
	// Stop caring. It’s not going to happen again!
	events.removeEventListener(globals.window, 'load', onLoad);
}

module.exports = function ac_onWindowLoad(callback) {
	// If the window has loaded, let’s just run the action immediately
	if (globals.document.readyState === 'complete') {
		callback();

	// Otherwise, queue ‘er up!
	} else {
		if (!queue) {
			queue = [];
			events.addEventListener(globals.window, 'load', onLoad);
		}
		queue.push(callback);
	}
};

},{"../globals":38,"./events":15}],18:[function(require,module,exports){
'use strict';

/*
 * A static helper object that handles the work for module:ac-base.Element.setVendorPrefixTransform.
 * Functionality is abstracted out into this helper object in order to break it up into manageable chunks
 * and also to enable testing of the code that would otherwise be unreachable by the test suites.
 */
/** @ignore */
var vendorTransformHelper = {

	__objectifiedFunctions: {},

	/*
		The paramMaps are used as templates for mapping 2D transform function parameters into
		their equivalent 3D function counterparts. 'p1', 'p2', etc. are replacement tokens that
		correspond to the 2D function parameters. p1 is the first 2D parameter, p2 is the second and so on.
	*/
	__paramMaps: {
		translate: 'p1, p2, 0',
		translateX: 'p1, 0, 0',
		translateY: '0, p1, 0',
		scale: 'p1, p2, 1',
		scaleX: 'p1, 1, 1',
		scaleY: '1, p1, 1',
		rotate: '0, 0, 1, p1',
		matrix: 'p1, p2, 0, 0, p3, p4, 0, 0, 0, 0, 1, 0, p5, p6, 0, 1'
	},

	/*
		@param {String|Object} functions2d A space separated string of transform functions, or an object
		with function names as the keys and a string of comma separataed parameters as the values.
		@returns {String} A space separated list of transform functions with any eligible 2D functions
		mapped to their 3D counterparts.
	*/
	convert2dFunctions: function (functions2d) {
		var values;

		this.__init(functions2d);
		// loop through functions & replace 2d function with 3d function where available
		for (var func in this.__objectifiedFunctions) {
			if (this.__objectifiedFunctions.hasOwnProperty(func)) {
				values = this.__objectifiedFunctions[func].replace(' ', '').split(',');
				if (func in this.__paramMaps) {
					for (var map in this.__paramMaps) {
						if (func === map) {
							this.valuesToSet.push(this.__stripFunctionAxis(func) + '3d(' + this.__map2DTransformParams(values, this.__paramMaps[func]) + ')');
						}
					}
				} else {
					this.valuesToSet.push(func + '(' + this.__objectifiedFunctions[func] + ')');
				}
			}
		}
		return this.valuesToSet.join(' ');
	},

	/*
		Handles some light house cleaning - resetting properties.
		Expects to receive the functions2d parameter from convert2dFunctions and fills the
		_objectifiedFunctions property with key/value pairs from this string or object.
		@param {String|Object} functions2d A space separated string of transform functions, or an object
		with function names as the keys and a string of comma separataed parameters as the values.
		@returns {undefined}
	*/
	__init: function (functions2d) {
		this.valuesToSet = [];
		this.__objectifiedFunctions = (typeof functions2d === 'object') ? functions2d : {};
		if (typeof functions2d === 'string') {
			this.__objectifiedFunctions = this.__objectifyFunctionString(functions2d);
		}
	},

	/*
		@param {Array} params2d Array containing all the parameters from a transform function as
		individual members.
		@param {String} template3d One of the parameter maps from the __paramMaps object.
		@returns {String} The template3d parameter with the 2D function values mapped into it.
	*/
	__map2DTransformParams: function (params2d, template3d) {
		params2d.forEach(function (val, i) {
			template3d = template3d.replace('p' + (i + 1), val);
		});
		return template3d;
	},

	/*
		Splits a space separated string of transform functions into an array with each
		function as a member.
		@param {String} functionString A space separated string of transform functions
		@returns {Array} An array with each function from the string as a member
	*/
	__splitFunctionStringToArray: function (functionString) {
		return functionString.match(/[\w]+\(.+?\)/g);
	},

	/*
		Takes a single transform function as a string and splits its name and parameters into an array.
		@param {String} functionString
		@returns {Array} The resulting array from a match() method. The entire functionString
		will be the first member with the function name and the parameters populating the
		second and third members respectively.
	*/
	__splitFunctionNameAndParams: function (functionString) {
		return functionString.match(/(.*)\((.*)\)/);
	},

	/*
		Strips the X or Y axis off the end of a transform function.
		@param {String} func A transform function name that specifies an X or Y axis at the end
		@returns {String} The function with the axis removed
	*/
	__stripFunctionAxis: function (func) {
		return func.match(/([a-z]+)(|X|Y)$/)[1];
	},

	/*
		Splits a string of transform functions into an object consisting of the function
		names as the keys and the parameters as their respective values.
		@param {String} functionString A space separated string of transform functions
		@returns {Object} An object filled with keys as function names and values as their
		respective parameters
	*/
	__objectifyFunctionString: function (functionString) {
		var self = this;
		var splitMember;
		this.__splitFunctionStringToArray(functionString).forEach(function (member) {
			splitMember = self.__splitFunctionNameAndParams(member);
			self.__objectifiedFunctions[splitMember[1]] = splitMember[2];
		});
		return this.__objectifiedFunctions;
	}
};

module.exports = vendorTransformHelper;

},{}],19:[function(require,module,exports){
'use strict';

/**
 * @name module:ac-base.Environment
 * @kind namespace
 */
var ac_Environment = {
	Browser: require('./Environment/Browser'),
	Feature: require('./Environment/Feature')
};

module.exports = ac_Environment;

},{"./Environment/Browser":20,"./Environment/Feature":23}],20:[function(require,module,exports){
'use strict';

var BrowserData = require('./Browser/BrowserData');

/**
	@namespace
	@name module:ac-base.Environment.Browser

	@description
	Reports information about the user's browser and device based on the userAgent string and feature detection.

	<br /><br />

	<h2>Immutable Properties</h2>
	<ul>
		<li>
			<h3><em class="light fixedFont">{String}</em> name</h3>
			<p>The name of the browser</p>
		</li>
		<li>
			<h3><em class="light fixedFont">{Float}</em> version</h3>
			<p>The version of the browser</p>
		</li>
		<li>
			<h3><em class="light fixedFont">{String}</em> os</h3>
			<p>The Operating System (No version)</p>
		</li>
		<li>
			<h3><em class="light fixedFont">{String}</em> osVersion</h3>
			<p>The Operating System Version</p>
		</li>
		<li>
			<h3><em class="light fixedFont">{String}</em> lowerCaseUserAgent</h3>
			<p>The userAgent string converted to lower case.</p>
		</li>
	</ul>

	@reference http://www.quirksmode.org/js/detect.html
*/

var ac_Environment_Browser = BrowserData.create();

/**
 * Returns true/false whether the browser is WebKit based
 * @param  {String}  userAgentString
 * @return {Boolean}
 */
ac_Environment_Browser.isWebKit = function(userAgentString) {
	var userAgent = userAgentString || window.navigator.userAgent;
	return userAgent ? !! userAgent.match(/applewebkit/i) : false;
};

/**
 * @type {String}
 */
ac_Environment_Browser.lowerCaseUserAgent = navigator.userAgent.toLowerCase();

if (ac_Environment_Browser.name === "IE") {
	require('../shims/ie/Environment/Browser')(ac_Environment_Browser);
}


module.exports = ac_Environment_Browser;

},{"../shims/ie/Environment/Browser":45,"./Browser/BrowserData":21}],21:[function(require,module,exports){
'use strict';

var _data = require('./data');
var ac_RegExp = require('../../RegExp');

function BrowserData() { }

BrowserData.prototype = {
	/**
	 * Parses string (such as userAgent) and returns the browser version
	 * @param  {String} stringToSearch
	 * @return {Number}
	 * @ignore
	 */
	__getBrowserVersion: function(stringToSearch, identity) {

		if (!stringToSearch || !identity) {
			return;
		}

		// Filters data.browser for the member with a identity equal to identity
		var filteredData = _data.browser.filter(function(item) {
			return item.identity === identity;
		})[0];

		var versionSearchString = filteredData.versionSearch || identity;
		var index = stringToSearch.indexOf(versionSearchString);

		if (index > -1) {
			return parseFloat(stringToSearch.substring(index + versionSearchString.length + 1));
		}
	},

	/**
	 * Alias for __getIdentityStringFromArray
	 * @param  {Array} browserData | Expects data.browser
	 * @return {String}
	 * @ignore
	 */
	__getName: function(dataBrowser) {
		return this.__getIdentityStringFromArray(dataBrowser);
	},

	/**
	 * Expects single member of data.browser or data.os
	 * and returns a string to be used in os or name.
	 * @param  {Object} item
	 * @return {String}
	 * @ignore
	 */
	__getIdentity: function(item) {
		if (item.string) {
			return this.__matchSubString(item);
		} else if (item.prop) {
			return item.identity;
		}
	},

	/**
	 * Iterates through data.browser or data.os returning the correct
	 * browser or os identity
	 * @param  {Array} dataArray
	 * @return {String}
	 * @ignore
	 */
	__getIdentityStringFromArray: function(dataArray) {
		for (var i = 0, l = dataArray.length, identity; i < l; i++) {
			identity = this.__getIdentity(dataArray[i]);
			if (identity) {
				return identity;
			}
		}
	},

	/**
	 * Alias for __getIdentityStringFromArray
	 * @param  {Array} OSData | Expects data.os
	 * @return {String}
	 * @ignore
	 */
	__getOS: function(dataOS) {
		return this.__getIdentityStringFromArray(dataOS);
	},

	/**
	 * Parses string (such as userAgent) and returns the operating system version
	 * @param {String} stringToSearch
	 * @param {String} osIdentity
	 * @return {String|Number} int if not a decimal delimited version
	 * @ignore
	 */
	__getOSVersion: function(stringToSearch, osIdentity) {

		if (!stringToSearch || !osIdentity) {
			return;
		}

		// Filters data.os returning the member with an identity equal to osIdentity
		var filteredData = _data.os.filter(function(item) {
			return item.identity === osIdentity;
		})[0];

		var versionSearchString = filteredData.versionSearch || osIdentity;
		var regex = new RegExp(versionSearchString + ' ([\\d_\\.]+)', 'i');
		var version = stringToSearch.match(regex);

		if (version !== null) {
			return version[1].replace(/_/g, '.');
		}
	},

	/**
	 * Regular expression and indexOf against item.string using item.subString as the pattern
	 * @param  {Object} item
	 * @return {String}
	 * @ignore
	 */
	__matchSubString: function(item) {
		var subString = item.subString;
		var matches;
		if (subString) {
			matches = ac_RegExp.isRegExp(subString) && !! item.string.match(subString);
			if (matches || item.string.indexOf(subString) > -1) {
				return item.identity;
			}
		}
	}
};

BrowserData.create = function () {
	var instance = new BrowserData();
	var out = {};
	out.name      = instance.__getName(_data.browser);
	out.version   = instance.__getBrowserVersion(_data.versionString, out.name);
	out.os        = instance.__getOS(_data.os);
	out.osVersion = instance.__getOSVersion(_data.versionString, out.os);
	return out;
};

module.exports = BrowserData;

},{"../../RegExp":30,"./data":22}],22:[function(require,module,exports){
'use strict';

module.exports = {
	// Used to test getName
	browser: [
		{
			string: window.navigator.userAgent,
			subString: "Chrome",
			identity: "Chrome"
		},
		{
			string: window.navigator.userAgent,
			subString: /silk/i,
			identity: "Silk"
		},
		{
			string: window.navigator.userAgent,
			subString: "OmniWeb",
			versionSearch: "OmniWeb/",
			identity: "OmniWeb"
		},
		{
			string: window.navigator.userAgent,
			subString: /mobile\/[^\s]*\ssafari\//i,
			identity: "Safari Mobile",
			versionSearch: "Version"
		},
		{
			string: window.navigator.vendor,
			subString: "Apple",
			identity: "Safari",
			versionSearch: "Version"
		},
		{
			prop: window.opera,
			identity: "Opera",
			versionSearch: "Version"
		},
		{
			string: window.navigator.vendor,
			subString: "iCab",
			identity: "iCab"
		},
		{
			string: window.navigator.vendor,
			subString: "KDE",
			identity: "Konqueror"
		},
		{
			string: window.navigator.userAgent,
			subString: "Firefox",
			identity: "Firefox"
		},
		{
			string: window.navigator.vendor,
			subString: "Camino",
			identity: "Camino"
		},
		{ // for newer Netscapes (6+)
			string: window.navigator.userAgent,
			subString: "Netscape",
			identity: "Netscape"
		},
		// IE < 11
		{
			string: window.navigator.userAgent,
			subString: "MSIE",
			identity: "IE",
			versionSearch: "MSIE"
		},
		// IE >= 11
		{
			string: window.navigator.userAgent,
			subString: "Trident",
			identity: "IE",
			versionSearch: "rv"
		},
		{
			string: window.navigator.userAgent,
			subString: "Gecko",
			identity: "Mozilla",
			versionSearch: "rv"
		},
		{ // for older Netscapes (4-)
			string: window.navigator.userAgent,
			subString: "Mozilla",
			identity: "Netscape",
			versionSearch: "Mozilla"
		}
	],
	// Used to test getOS
	os: [
		{
			string: window.navigator.platform,
			subString: "Win",
			identity: "Windows",
			versionSearch: "Windows NT"
		},
		{
			string: window.navigator.platform,
			subString: "Mac",
			identity: "OS X"
		},
		{
			string: window.navigator.userAgent,
			subString: "iPhone",
			identity: "iOS",
			versionSearch: "iPhone OS"
		},
		{
			string: window.navigator.userAgent,
			subString: "iPad",
			identity: "iOS",
			versionSearch: "CPU OS"
		},
		{
			string: window.navigator.userAgent,
			subString: /android/i,
			identity: "Android"
		},
		{
			string: window.navigator.platform,
			subString: "Linux",
			identity: "Linux"
		}
	],
	// Used to test version and osVersion
	versionString: window.navigator.userAgent || window.navigator.appVersion || undefined
};

},{}],23:[function(require,module,exports){
'use strict';

var ac_log = require('../log');

/**
	@namespace
	@name module:ac-base.Environment.Feature
*/
var ac_Environment_Feature = {
	localStorageAvailable: require('./Feature/localStorageAvailable')
};
var hasOwnProp = Object.prototype.hasOwnProperty;

(function () {
	var style = null;
	var prefixes = null;
	var preFixes = null;
	var css = null;

	/**
	 * @deprecated Please use module:ac-base.Environment.Feature.cssPropertyAvailable instead.
	 */
	ac_Environment_Feature.isCSSAvailable = function (property) {
		ac_log('ac-base.Environment.Feature.isCSSAvailable is deprecated. Please use ac-base.Environment.Feature.cssPropertyAvailable instead.');
		return this.cssPropertyAvailable(property);
	};

	/**
		Sets all the vendor specific style property to value on element.
		@param {String} property The CSS property to test, can be of the form: webkitBorderRadius, mozBorderRadius, etc.; borderRadius -webkit-border-radius, -moz-border-radius, etc.; border-radius

		@returns true if the current browser supports the given CSS property, otherwise, returns false.
	*/
	ac_Environment_Feature.cssPropertyAvailable = function (property) {
		if (style === null) {
			style = document.createElement('browserdetect').style;
		}
		if (prefixes === null) {
			prefixes = ['-webkit-', '-moz-', '-o-', '-ms-', '-khtml-', ''];
		}
		if (preFixes === null) {
			preFixes = ['Webkit', 'Moz', 'O', 'ms', 'Khtml', ''];
		}
		if (css === null) {
			css = {};
		}

		property = property.replace(/([A-Z]+)([A-Z][a-z])/g, '$1\\-$2').replace(/([a-z\d])([A-Z])/g, '$1\\-$2').replace(/^(\-*webkit|\-*moz|\-*o|\-*ms|\-*khtml)\-/, '').toLowerCase();
		switch (property) {
		case 'gradient':
			if (css.gradient !== undefined) {
				return css.gradient;
			}

			property = 'background-image:';
			var value1 = 'gradient(linear,left top,right bottom,from(#9f9),to(white));';
			var value2 = 'linear-gradient(left top,#9f9, white);';

			style.cssText = (property + prefixes.join(value1 + property) + prefixes.join(value2 + property)).slice(0, -property.length);
			css.gradient = (style.backgroundImage.indexOf('gradient') !== -1);
			return css.gradient;

		case 'inset-box-shadow':
			if (css['inset-box-shadow'] !== undefined) {
				return css['inset-box-shadow'];
			}

			property = 'box-shadow:';
			var value = '#fff 0 1px 1px inset;';

			style.cssText = prefixes.join(property + value);
			css['inset-box-shadow'] = (style.cssText.indexOf('inset') !== -1);
			return css['inset-box-shadow'];

		default:
			var properties = property.split('-');
			var length = properties.length;
			var Property;
			var i;
			var j;

			if (properties.length > 0) {
				property = properties[0];
				for (i = 1; i < length; i += 1) {
					property += properties[i].substr(0, 1).toUpperCase() + properties[i].substr(1);
				}
			}
			Property = property.substr(0, 1).toUpperCase() + property.substr(1);

			if (css[property] !== undefined) {
				return css[property];
			}

			for (j = preFixes.length - 1; j >= 0; j -= 1) {
				if (style[preFixes[j] + property] !== undefined || style[preFixes[j] + Property] !== undefined) {
					css[property] = true;
					return true;
				}
			}
			return false;

		}
	};
}());

/**
 * @deprecated Please use module:ac-base.Environment.Feature.threeDTransformsAvailable
 */
ac_Environment_Feature.supportsThreeD = function () {
	ac_log('ac-base.Environment.Feature.supportsThreeD is deprecated. Please use ac-base.Environment.Feature.threeDTransformsAvailable instead.');
	return this.threeDTransformsAvailable();
};

/**
	Returns whether the browser supports the 3d media query
	@returns {Boolean} whether or not the browser supports the 3d media query
*/
ac_Environment_Feature.threeDTransformsAvailable = function () {
	// Memoize previously returned value
	if (typeof this._threeDTransformsAvailable !== 'undefined') {
		return this._threeDTransformsAvailable;
	}

	var div, style;

	try {
		this._threeDTransformsAvailable = false;

		if (hasOwnProp.call(window, 'styleMedia')) {
			this._threeDTransformsAvailable = window.styleMedia.matchMedium('(-webkit-transform-3d)');

		} else if (hasOwnProp.call(window, 'media')) {
			this._threeDTransformsAvailable = window.media.matchMedium('(-webkit-transform-3d)');
		}

		// chrome returns all the values as true, but doesn't actually have 3d support
		if (!this._threeDTransformsAvailable) {
			if (!(style = document.getElementById('supportsThreeDStyle'))) {
				style = document.createElement('style');
				style.id = 'supportsThreeDStyle';
				style.textContent = '@media (transform-3d),(-o-transform-3d),(-moz-transform-3d),(-ms-transform-3d),(-webkit-transform-3d) { #supportsThreeD { height:3px } }';
				document.querySelector('head').appendChild(style);
			}

			if (!(div = document.querySelector('#supportsThreeD'))) {
				div = document.createElement('div');
				div.id = 'supportsThreeD';
				document.body.appendChild(div);
			}
			this._threeDTransformsAvailable = (div.offsetHeight === 3) || style.style['MozTransform'] !== undefined || style.style['WebkitTransform'] !== undefined;
		}

		return this._threeDTransformsAvailable;
	} catch (e) {
		return false;
	}
};

/**
 * @deprecated module:ac-base.Environment.Feature.supportsCanvas is deprecated. Please use module:ac-base.Environment.Feature.canvasAvailable instead.
 */
ac_Environment_Feature.supportsCanvas = function () {
	ac_log('ac-base.Environment.Feature.supportsCanvas is deprecated. Please use ac-base.Environment.Feature.canvasAvailable instead.');
	return this.canvasAvailable();
};

/**
	Detects whether or not the browser understands the HTML5 Canvas API.
	@returns {Boolean} true if the browser supports canvas.
*/
ac_Environment_Feature.canvasAvailable = function () {
	// Memoize previously returned value
	if (typeof this._canvasAvailable !== 'undefined') {
		return this._canvasAvailable;
	}

	var canvas = document.createElement('canvas');

	this._canvasAvailable = !!(typeof canvas.getContext === 'function' && canvas.getContext('2d'));
	return this._canvasAvailable;
};

/**
	Returns whether the browser supports HTML5 sessionStorage, and
	does not have privacy mode enabled or cookies turned off.
	@returns {Boolean} true if the browser supports sessionStorage
*/
ac_Environment_Feature.sessionStorageAvailable = function () {
	// Memoize previously returned value
	if (typeof this._sessionStorageAvailable !== 'undefined') {
		return this._sessionStorageAvailable;
	}

	try {
		if (typeof window.sessionStorage !== 'undefined' && typeof window.sessionStorage.setItem === 'function') {
			window.sessionStorage.setItem('ac_browser_detect', 'test');
			this._sessionStorageAvailable = true;
			window.sessionStorage.removeItem('ac_browser_detect', 'test');
		} else {
			this._sessionStorageAvailable = false;
		}
	} catch (e) {
		this._sessionStorageAvailable = false;
	}
	return this._sessionStorageAvailable;
};

/**
	Returns whether the browser has cookies enabled.
	@returns {Boolean} true if cookies are enabled.
*/
ac_Environment_Feature.cookiesAvailable = function () {
	// Memoize previously returned value
	if (typeof this._cookiesAvailable !== 'undefined') {
		return this._cookiesAvailable;
	}
	this._cookiesAvailable = (hasOwnProp.call(document, 'cookie') && !!navigator.cookieEnabled) ? true : false;
	return this._cookiesAvailable;
};

/**
	Some devices swap the width/height when in landscape, so we want to make
	sure we're always reporting width as the lesser value. Except when the
	device isn't orientable, then we want to honor window.screen.width.
	@ignore
*/
ac_Environment_Feature.__normalizedScreenWidth = function () {
	// We only care if the device is orientable
	if (typeof window.orientation === 'undefined') {
		return window.screen.width;
	}
	return window.screen.width < window.screen.height ? window.screen.width : window.screen.height;
};

/**
 * Tests for touch support on the device.
 * DocumentTouch is specific to Firefox <25 support.
 *
 * @returns {Boolean} true if the device supports touch.
 */
ac_Environment_Feature.touchAvailable = function () {
	return !!(('ontouchstart' in window) || window.DocumentTouch && document instanceof window.DocumentTouch);
};

/**
	Attempts to determine if device is a desktop. The test is based on the assumptions
	that desktop machines don't support touch and aren't orientable
	@returns {Boolean} true if device has no support for touch and orientation
*/
ac_Environment_Feature.isDesktop = function () {
	if (!this.touchAvailable() && !window.orientation) {
		return true;
	}
	return false;
};

/**
	Attempts to determine if device is handheld. e.g. phones and iPod Touches.
	The test is based on the value of module:ac-base.Environment.Feature.isDesktop() and
	if the device screen width is less than or equal to 480 pixels.
	@returns {Boolean} true if the device is determined to be handheld
*/
ac_Environment_Feature.isHandheld = function () {
	return !this.isDesktop() && !this.isTablet();
};

/**
	Attempts to determine if device is a tablet. i.e. iPad or Nexus 7.
	The test is based on the value of module:ac-base.Environment.Feature.isDesktop() and
	if the device screen width is greater than 480 pixels.
	@returns {Boolean} true if the device is determined to be a tablet
*/
ac_Environment_Feature.isTablet = function () {
	return !this.isDesktop() && this.__normalizedScreenWidth() > 480;
};

/**
	Attempts to determine whether the display is retina.
	@returns {Boolean} true if DPR is determined to be greater than or equal to 1.5
*/
ac_Environment_Feature.isRetina = function () {
	// Vendor prefixes and media queries for DPR detection are a mess
	var mediaQueryStrings = [
		'min-device-pixel-ratio:1.5',
		'-webkit-min-device-pixel-ratio:1.5',
		'min-resolution:1.5dppx',
		'min-resolution:144dpi',
		'min--moz-device-pixel-ratio:1.5'
	];
	var i;

	// Use devicePixelRatio if available
	if (window.devicePixelRatio !== undefined) {
		if (window.devicePixelRatio >= 1.5) {
			return true;
		}

	// Else resort to matchMedia
	} else {
		for (i = 0; i < mediaQueryStrings.length; i += 1) {
			if (window.matchMedia('(' + mediaQueryStrings[i] + ')').matches === true) {
				return true;
			}
		}
	}

	// Otherwise return false
	return false;
};

/**
 * Browser support for SVG in background images very closely matches that of SVG in <img> tags.
 * Detecting this feature checks for support as both inline and background images.
 * @returns {Boolean} true if SVG support is available
 */
ac_Environment_Feature.svgAvailable = function () {
    return document.implementation.hasFeature('http://www.w3.org/TR/SVG11/feature#Image', '1.1');
};

module.exports = ac_Environment_Feature;

},{"../log":39,"./Feature/localStorageAvailable":24}],24:[function(require,module,exports){
'use strict';

var isAvailable = null;

/**
 * Returns whether the browser supports HTML5 localStorage, and
 * does not have privacy mode enabled or cookies turned off.
 * NOTE: Does not support Firefox <= 13 because of a bug where Firefox interprets a nonexistent item as null instead of undefined
 * @returns {Boolean} true if the browser supports localStorage
 * @name module:ac-base.Environment.Feature.localStorageAvailable
 * @kind function
 */
module.exports = function localStorageAvailable() {
	// Memoize previously returned value
	if (isAvailable === null) {
		isAvailable = !!(window.localStorage && window.localStorage.non_existent !== null);
	}
	return isAvailable;
};

},{}],25:[function(require,module,exports){
'use strict';

/**
 * @name module:ac-base.Event
 * @kind namespace
 */
var ac_Event = {};

/**
 * Stop propagation of event and prevent default behavior.
 * @param {Event} evt The event to stop
 * @name module:ac-base.Event.stop
 * @kind function
 */
ac_Event.stop = function (evt) {
	if (!evt) {
		evt = window.event;
	}

	if (evt.stopPropagation) {
		evt.stopPropagation();
	} else {
		evt.cancelBubble = true;
	}

	if (evt.preventDefault) {
		evt.preventDefault();
	}

	evt.stopped = true;
	evt.returnValue = false;
};

/**
 * Cross-browser event target getter
 * @param {Event} evt
 * @name module:ac-base.Event.target
 * @kind function
 */
ac_Event.target = function (evt) {
	return (typeof evt.target !== 'undefined') ? evt.target : evt.srcElement;
};

/**
 * @enum Keycode Map
 */
ac_Event.Keys = {
	UP:       38,
	DOWN:     40,
	LEFT:     37,
	RIGHT:    39,
	ESC:      27,
	SPACE:    32,
	BACKSPACE: 8,
	DELETE:   46,
	END:      35,
	HOME:     36,
	PAGEDOWN: 34,
	PAGEUP:   33,
	RETURN:   13,
	TAB:       9
};

module.exports = ac_Event;

},{}],26:[function(require,module,exports){
'use strict';

var ac_Array = require('./Array');

/**
 * @name module:ac-base.Function
 * @kind namespace
 */
var ac_Function = {};

/**
 * Empty function. Useful for things like defaults for callbacks, etc.
 * @name module:ac-base.Function.emptyFunction
 * @kind function
 */
ac_Function.emptyFunction = function () {};

/**
 * Bind <code>this</code> to an Object for a Function
 * @name module:ac-base.Function.bindAsEventListener
 * @kind function
 */
ac_Function.bindAsEventListener = function (__method, obj) {
	// Pass arguments after method name and obj as arguments to method
	var args = ac_Array.toArray(arguments).slice(2);
	return function (event) {
		return __method.apply(obj, [event || window.event].concat(args));
	};
};

/**
 * @returns {Array} Names of arguments as strings as described in function’s implementation.
 * @name module:ac-base.Function.getParamNames
 * @kind function
 */
ac_Function.getParamNames = function (func) {
	var funStr = func.toString();
	return funStr.slice(funStr.indexOf('(') + 1, funStr.indexOf(')')).match(/([^\s,]+)/g) || [];
};

/**
 * Wrapper for requestAnimationFrame that executes/iterates a rendering function over a set
 * duration, passing it the percent of the duration that has passed with each call.
 * @param drawFrameFunction {Function} animation rendering function that accepts a single
 * argument as a {Number} indicating the percent of the duration that has
 * passed as decimal (0-1).
 * @param duration {Float} duration of animation in seconds.
 * @param afterFinish {Function} optional; Function to be executed once the animation
 * duration has expired.
 * @name module:ac-base.Function.iterateFramesOverAnimationDuration
 * @kind function
 */
ac_Function.iterateFramesOverAnimationDuration = function (drawFrameFunction, duration, afterFinish) {
	var percentProgress = 0;
	var animationFrameRequestID;
	var requestAnimationFrameIteratorFunction;
	var startTime;

	// Convert duration to milliseconds
	duration = duration * 1000;

	// Function to be ran every animation frame
	requestAnimationFrameIteratorFunction = function (t) {
		startTime = startTime || t;
		// Determine the progress we’ve made relative to how long we plan to animate in total
		// Allow zero duration to defer to next frame, but avoid divide by zero and report percent of 1
		percentProgress = duration ? Math.min(Math.max(0, (t - startTime) / duration), 1) : 1;
		drawFrameFunction(percentProgress);

		// We’ve still got some animating to do!
		if (percentProgress < 1) {
			animationFrameRequestID = window.requestAnimationFrame(requestAnimationFrameIteratorFunction);
		// We’ve ran for our entire duration
		} else {
			// Clean up requestAnimationFrame if it’s still outstanding
			window.cancelAnimationFrame(animationFrameRequestID);

			if (typeof afterFinish === 'function') {
				afterFinish();
			}
		}
	};

	// Run initial draw, which will call itself recursively every animation frame until the duration has expired
	animationFrameRequestID = window.requestAnimationFrame(requestAnimationFrameIteratorFunction);
};

module.exports = ac_Function;

},{"./Array":7}],27:[function(require,module,exports){
'use strict';

var ac_NotificationCenter = require('./NotificationCenter');
var ac_Class = require('./Class');
var ac_Object = require('./Object');
var ac_Element = require('./Element');

/**
 * @namespace
 * @name module:ac-base.History
 */
var ac_History = {};

ac_History.HashChange = ac_Class({
	initialize: function (notificationString) {
		this._boundEventHandler = null;
		this._notificationString = notificationString || 'ac-history-hashchange';

		this.synthesize();
	},

	__eventHandler: function (evt) {
		var hashChangeEvent = new ac_History.HashChange.Event(evt);
		ac_NotificationCenter.publish(this.notificationString(), { data: hashChangeEvent }, false);
	},

	__bindWindowEvent: function () {
		this.setBoundEventHandler(this.__eventHandler.bind(this));
		ac_Element.addEventListener(window, 'hashchange', this.boundEventHandler());
	},

	__unbindWindowEvent: function () {
		ac_Element.removeEventListener(window, 'hashchange', this.boundEventHandler());
		this.setBoundEventHandler(null);
	},

	subscribe: function (callback) {
		if (this.boundEventHandler() === null) {
			this.__bindWindowEvent();
		}

		ac_NotificationCenter.subscribe(this.notificationString(), callback);
	},

	unsubscribe: function (callback) {
		ac_NotificationCenter.unsubscribe(this.notificationString(), callback);
		if (!ac_NotificationCenter.hasSubscribers(this.notificationString())) {
			this.__unbindWindowEvent();
		}
	}

});

ac_History.HashChange.Event = ac_Class({
	initialize: function (originalEvt) {
		this.event = originalEvt;

		ac_Object.extend(this, originalEvt);

		if (this.hasOwnProperty('oldURL') && this.oldURL.match('#')) {
			this.oldHash = this.oldURL.split("#")[1];
		}
		if (this.hasOwnProperty('newURL') && this.newURL.match('#')) {
			this.newHash = this.newURL.split("#")[1];
		}
	}
});

module.exports = ac_History;

},{"./Class":9,"./Element":13,"./NotificationCenter":28,"./Object":29}],28:[function(require,module,exports){
'use strict';

var subscribers = {};

/**
 * Publishes one-to-many notifications; similar to events but do not have to be attached to an element;
 * @name module:ac-base.NotificationCenter
 * @kind namespace
 * @deprecated
 */
module.exports = /** @lends module:ac-base.NotificationCenter. */ {
	/**
	 * @param {String} event Name of the event to publish
	 * @param {Object} options Object contains the target and data for this event to pass on
	 * @param {Boolean} asynchronous Whether to publish notification immediately (<code>false</code>) or after a timeout (<code>true</code>)
	 */
	publish: function (event, options, asynchronous) {
		options = options || {};

		var publish = function () {
			if ((!subscribers[event]) || subscribers[event].length < 1) {
				return;
			}

			subscribers[event].forEach(function (subscriber) {
				if (typeof subscriber !== 'undefined') {
					if (subscriber.target && options.target) {
						if (subscriber.target === options.target) {
							subscriber.callback(options.data);
						}
					} else {
						subscriber.callback(options.data);
					}
				}
			});
		};

		if (asynchronous === true) {
			window.setTimeout(publish, 10);
		} else {
			publish();
		}
	},



	/**
	 * @param {String} event Name of the event to publish
	 * @param {Function} callback Function to run when this notification is published
	 * @param {Object} target Object that is expected to publish the notification
	 */
	subscribe: function (event, callback, target) {
		if (!subscribers[event]) {
			subscribers[event] = [];
		}

		subscribers[event].push({
			callback: callback,
			target: target
		});
	},



	/**
	 * @param {String} event Name of the event to publish
	 * @param {Function} callback Function to run when this notification is published
	 * @param {Object} target Object that is expected to publish the notification
	 */
	unsubscribe: function (event, callback, target) {
		// Clone array so that we don’t modify the original while we are iterating through it
		var subscribersForEventClone = subscribers[event].slice(0);

		subscribers[event].forEach(function (subscriber, i) {
			if (typeof subscriber !== 'undefined') {
				if (target) {
					if (callback === subscriber.callback && subscriber.target === target) {
						// Modify clone so that index positions in original do not change
						subscribersForEventClone.splice(i, 1);
					}
				} else if (callback === subscriber.callback) {
					// Modify clone so that index positions in original do not change
					subscribersForEventClone.splice(i, 1);
				}
			}
		});

		// Overwrite original with clone to accept changes
		subscribers[event] = subscribersForEventClone;
	},



	/**
	 * @param {String} event Name of the event to check
	 * @param {Object} target Object that is expected to publish the notification
	 */
	hasSubscribers: function (event, target) {
		// If there are no subscribers to event name
		if ((!subscribers[event]) || subscribers[event].length < 1) {
			return false;
		}

		if (!target) {
			return true;
		}

		var i = subscribers[event].length;
		var subscriber;
		while (i--) {
			subscriber = subscribers[event][i];
			// If any subscribers have a target and we’re looking to match to a target
			if (subscriber.target && target) {
				// And if the target is what we’re trying to match
				if (subscriber.target === target) {
					return true;
				}
			}
		}

		return false;
	}
};

},{}],29:[function(require,module,exports){
/*jshint -W040*/
'use strict';

var ac_Synthesize = require('./Synthesize');
var qs = require('qs');

/**
 * @name module:ac-base.Object
 * @kind namespace
 */
var ac_Object = {};

var hasOwnProp = Object.prototype.hasOwnProperty;

/**
 * Add properties from one object into another. Not a deep copy.
 * @param {Object} destination The object where the properties will end up. Properties in
 * this Object that have the same key as properties in the source object will be overwritten
 * with the source property’s value. If destination is not provided a blank object is created.
 * @param {Object} source The properties to add / overwrite in the destination Object.
 * An infinite number of source paramaters may be passed.
 * @name module:ac-base.Object.extend
 * @kind function
 */
ac_Object.extend = function extend() {
	var args;
	var dest;

	if (arguments.length < 2) {
		args = [{}, arguments[0]];
	} else {
		args = [].slice.call(arguments);
	}

	dest = args.shift();

	args.forEach(function (source) {
		for (var property in source) {
			// Anything that does not prototype Object will not have this method
			if (hasOwnProp.call(source, property)) {
				dest[property] = source[property];
			}
		}
	});

	return dest;
};

/**
 * Create a new Object that has the same properties as the original.
 * @param {Object} object The Object to make a clone of.
 * @name module:ac-base.Object.clone
 * @kind function
 */
ac_Object.clone = function clone(object) {
	return ac_Object.extend({}, object);
};


if (Object.getPrototypeOf) {
	ac_Object.getPrototypeOf = Object.getPrototypeOf;
} else {
	if (typeof this.__proto__ === 'object') {
		/** @ignore */
		ac_Object.getPrototypeOf = function getPrototypeOf(obj) {
			return obj.__proto__;
		};
	} else {
		/**
		 * @name module:ac-base.Object.getPrototypeOf
		 * @kind function
		 */
		ac_Object.getPrototypeOf = function getPrototypeOf(obj) {
			var constructor = obj.constructor;
			var oldConstructor;
			if (hasOwnProp.call(obj, 'constructor')) {
				oldConstructor = constructor;
				// reset constructor
				if (!(delete obj.constructor)) {
					// can't delete obj.constructor, return null
					return null;
				}
				// get real constructor
				constructor = obj.constructor;
				// restore constructor
				obj.constructor = oldConstructor;
			}
			// needed for IE
			return constructor ? constructor.prototype : null;
		};
	}
}

/**
 * Convert object to query string
 * @param {Object} object
 * @returns {String} Returns query string representation of object
 * @name module:ac-base.Object.toQueryParameters
 * @kind function
 */
ac_Object.toQueryParameters = function (object) {

	if (typeof object !== 'object'){
		throw new TypeError('toQueryParameters error: argument is not an object');
	}

	return qs.stringify(object);
};

/**
 * @param {Object} object
 * @returns {Boolean} Return true if and only if object is empty ({}).
 * @name module:ac-base.Object.isEmpty
 * @kind function
 */
ac_Object.isEmpty = function (object) {
	var prop;

	if (typeof object !== 'object') {
		throw new TypeError('ac-base.Object.isEmpty : Invalid parameter - expected object');
	}

	for (prop in object) {
		if (hasOwnProp.call(object, prop)) {
			return false;
		}
	}

	return true;
};

/**
 * @param {Object} object
 * @name module:ac-base.Object.synthesize
 * @kind function
 */
ac_Object.synthesize = function (object) {
	if (typeof object === 'object') {
		// Create new instance of module:ac-base.Synthesize and extend it with your object
		ac_Object.extend(object, ac_Object.clone(ac_Synthesize));

		// Synthesize member data in extended object
		object.synthesize();
		return object;
	} else {
		throw new TypeError('Argument supplied was not a valid object.');
	}
};

module.exports = ac_Object;

},{"./Synthesize":34,"qs":1}],30:[function(require,module,exports){
'use strict';

/**
 * @name module:ac-base.RegExp
 * @kind namespace
 */
var ac_RegExp = {};

/**
 * @param {Object} obj Object to test whether or not it is a Regular Expression
 * @name module:ac-base.RegExp.isRegExp
 * @kind function
 */
ac_RegExp.isRegExp = function (obj) {
	return window.RegExp ? obj instanceof RegExp : false;
};

module.exports = ac_RegExp;

},{}],31:[function(require,module,exports){
'use strict';

var ac_Class = require('./Class');
var ac_Object = require('./Object');
var ac_Element = require('./Element');

/**
	@class
	@name module:ac-base.Registry
	@version 2.0
	@author <a href="mailto:kyle_olson@apple.com">Kyle Olson</a>

	@description The Component registry is used to create useful groups of instances of Components that are relevant to their intended use. (e.g. ‘gallery’ vs. ‘slideshow’ Components)

	<br /><br />

	They are also used to match elements to a Component based on the html classname, qualifier function, and the Component hierarchy. The model contains a structural hierarchy of Components, but the actual link is maintained by the ‘parent’ variable in each Component.

	<br /><br />

	The registry is also the appropriate place to create a new Component, as it automatically adds it to the model, lookup object, and does some validation.

	<br /><br />

	@todo Document the Model hierarchy and specificity (including className vs Qualifier)
	@todo Document the idea of the _base Component

	@property {String} prefix Used to match Elements to Components based on the classname attribute.
	@property {Array} reservedNames List of strings that cannot be used as Component names for any Components this Registry manages.
	@property {Array} __model Two-dimensional array that keeps track of the index level heirarchy of the Components in this Registry.
	@property {Object} __lookup Dictionary that keeps track of all Components in the Registry by name.

	@param {String} prefix This prefix is used for matching based on classname. An Element will match a Component if it has a classname of the <code>prefix</code> appended with the <code>name</code> of the Component.

	@param {Object} options Optional; Customize the behavior of this Registry.
*/
var ac_Registry = ac_Class();
ac_Registry.Component = require('./Registry/Component');

ac_Registry.prototype = {
	__defaultOptions: {
		contextInherits: [],
		matchCatchAll: false
	},

	/** @inner */
	initialize: function (prefix, options) {
		if (typeof prefix !== 'string') {
			throw new Error('Prefix not defined for Component Registry');
		}

		// Setup options
		if (typeof options !== 'object') {
			options = {};
		}
		this._options = ac_Object.extend(ac_Object.clone(this.__defaultOptions), options);

		this._prefix = prefix;
		this._reservedNames = [];
		this.__model = [];
		this.__lookup = {};

		// Synthesize Member Data
		ac_Object.synthesize(this);
	},



	/**
		Add a Component to this registry

		<br /><br />

		Note: You must add <code>_base</code> as the first Component or else it will generate a <code>_base</code> Component automatically, with an empty property dictionary.

		@param {String} name A unique identifier for this Component. Also used for the html classname attribute to decide whether or not a gallery is of this Component (e.g. ‘image’ would be the Component if the classname was ‘autogallery-image’).
		@param {Object} properties Optional; A dictionary of keys and values that this Component’s intended use will understand. These are the properties that will be merged with the parents’ and <code>_base</code> properties to form the properties Object passed to whatever Object uses this Component Registry. The default is empty object, which will inherit all parent properties.
		@param {Function} qualifier Optional; A Function that can be used to determine whether or not an Element is of a certain Component without needing the classname attribute. Should return true or false. Use <code>module:ac-base.Function.emptyFunction</code> to opt out of having a qualifier if you still want to define a <code>parentComponentName</code>. The qualifier Function will be passed the Element and the <code>prefix</code> for the classname attribute, and will be bound such that <code>this</code> will refer to the instance of Component that is attempting to be matched.
		@param {String} parentComponentName Optional; Link this Component to a parent Component, which means this Component will be more specific (higher index level in the model) and will be considered before any Components at a lower index in the model. When asking a Component for its properties, it will extend a clone of its parent’s properties and return the extended Object. The parent will do the same with its parent before returning its properties, all the way to index level 0 (<code>_base</code>).
		@param {Object} context Optional; If you need to store more information in a Component that you will access later, you can put it inside of the context object. An example of when you might use this would be for a delegate that is associated with a Component. This information is presumably used by the Object that deals with the Registry and asks it for matches.

		@returns {module:ac-base.Registry.Component} The Component that was created, or <code>null</code> if something went wrong.
	*/
	addComponent: function (name, properties, qualifier, parentComponentName, context) {
		var parent = null;
		var component;

		// Make sure Component name isn’t reserved
		if (!this.__isReserved(name)) {

			// The only property that is required to create a new Component is a name
			if (typeof name === 'string') {

				// Find the parent Component instance
				if (typeof parentComponentName === 'string') {
					parent = this.lookup(parentComponentName);
				}

				// <code>_base</code> is the parent if there is no parent defined
				// Create the <code>_base</code> Component if one doesn’t exist.
				if (!parent && name !== '_base') {
					parent = this.lookup('_base') || this.addComponent('_base');
				}

				// Warn me if we are overwriting an existing Component
				if (this.lookup(name)) {
					throw new Error('Cannot overwrite existing Component: ' + name);
				}

				// Context inheritance
				if (typeof context !== 'object') {
					context = {};
				}
				if (typeof context.inherits === 'undefined' && Array.isArray(this._options.contextInherits)) {
					context.inherits = this._options.contextInherits;
				}

				// Create your new instance of Component and add it to the lookup
				// Add Component to the lookup table
				component = this.__lookup[name] = new ac_Registry.Component(name, properties, qualifier, parent, context);

				// Add this Component to the model
				this.__addToModel(component);

				return component;
			}
		}

		return null;
	},



	/**
		Try to match this element to a Component.

		@param {Element} element Element to test against

		@returns {module:ac-base.Registry.Component} The Component that matches this element first, or <code>null</code> if there is no Component that matches.
	*/
	match: function (element) {
		var component;

		// Try to match against the html classname attribute on the element
		if (component = this.__matchName(element)) {
			return component;
		}

		// Try to match against the qualifiers
		if (component = this.__matchQualifier(element)) {
			return component;
		}

		if (this.options().matchCatchAll === true) {
			// Catch all (if no other types matched)
			if (typeof this.__model[1] !== 'undefined') {
				if (typeof this.__model[1][0] !== 'undefined') {
					return this.__model[1][0];
				} else {
					throw new Error('Catchall Type not defined');
				}
			} else {
				throw new Error('No non-_base types defined at index 1.');
			}
		}

		return null;
	},



	/**
		@inner
		Test each Component for a match based on html classname attribute (e.g. ‘autogallery-image’);

		@params {Element} element
	*/
	__matchName: function (element) {
		
		// If we don’t have an element, fail here
		if (!ac_Element.isElement(element)) {
			return null;
		}

		// Iterate through model from the index with highest specificity/level to lowest
		var i, ii;
		for (i = this.__model.length - 1; i >= 0; i--) {
			// Iterate through this level if the level is defined
			// (in chronological order of when the Component was defined)
			if (Array.isArray(this.__model[i])) {
				for (ii = this.__model[i].length - 1; ii >= 0; ii--) {

					// The first Component with a html classname attribute that matches
					if (ac_Element.hasClassName(element, this._prefix + this.__model[i][ii].name())) {
						return this.__model[i][ii];
					}
				}
			}
		}

		return null;
	},



	/**
		@inner
		Test each Component for a match based on qualifier function

		@params {Element} element
	*/
	__matchQualifier: function (element) {
		
		// If we don’t have an element, fail here
		if (!ac_Element.isElement(element)) {
			return null;
		}

		// Iterate through model from the index with highest specificity/level to lowest
		var i, ii;
		for (i = this.__model.length - 1; i >= 0; i--) {
			// Iterate through this level if the level is defined
			// (in chronological order of when the Component was defined)
			if (Array.isArray(this.__model[i])) {
				for (ii = this.__model[i].length - 1; ii >= 0; ii--) {

					// The first Component that passes a qualifier
					if (typeof this.__model[i][ii].qualifier === 'function') {
						if (this.__model[i][ii].qualifier.apply(this.__model[i][ii], [element, this._prefix]) === true) {
							return this.__model[i][ii];
						}
					}
				}
			}
		}

		return null;
	},



	/**
		@inner
		Add the Component to the model at its index level

		@params {module:ac-base.Registry.Component} component
	*/
	__addToModel: function (component) {
		if (ac_Registry.Component.isComponent(component)) {
			// If this is the first Component at this index, create a new Array in the model to store it
			if (typeof this.__model[component.level()] === 'undefined') {
				this.__model[component.level()] = [];
			}

			// Add Component to the model at your index level
			this.__model[component.level()].push(component);
		}
	},



	/**
		Lookup a Component by name.

		@param {String} name The name of the Component you are looking for

		@returns {module:ac-base.Registry.Component} The Component with that name, or <code>null</code> if there isn’t one in this Registry.
	*/
	lookup: function (name) {
		if (typeof name === 'string') {
			if (typeof this.__lookup[name] !== 'undefined') {
				return this.__lookup[name];
			}
		}
		return null;
	},



	/**
		Determine whether a Component is registered in this particular instance of <code>module:ac-base.Registry</code>

		@param {module:ac-base.Registry.Component} component The name of the Component you are testing

		@returns {Boolean}
	*/
	hasComponent: function (component) {
		var comparisionComponent;
		// If the component is an object and has a name
		if (typeof component === 'object' && typeof component.name === 'function') {
			// If a component exists in this Registry by that name
			if (comparisionComponent = this.lookup(component.name())) {
				return comparisionComponent === component;
			}
		}
		return false;
	},

	/**
		Reserve a name so that Components added to this registry after this point cannot be named with that String.

		<br /><br />

		Note: Name cannot be reserved if a Component in this registry has already used that name before you try to reserve it.

		@param {String} name
	*/
	reserveName: function (name) {
		if (typeof name === 'string') {
			if (this.lookup(name) !== null) {
				throw new Error('Cannot reserve name: Component with name already exists.');
			} else if (!this.__isReserved(name)) {
				this._reservedNames.push(name);
			}
		} else {
			throw new Error('Cannot reserve name: Name must be a string');
		}
	},

	/**
		@inner
		Check if a name is reserved.

		@param {String} name
	*/
	__isReserved: function (name) {
		if (typeof name === 'string') {
			return (this._reservedNames.indexOf(name) !== -1);
		} else {
			throw new Error('Cannot check if this name is reserved because it is not a String.');
		}
	}
};

module.exports = ac_Registry;

},{"./Class":9,"./Element":13,"./Object":29,"./Registry/Component":32}],32:[function(require,module,exports){
'use strict';

var ac_Class = require('../Class');
var ac_Function = require('../Function');
var ac_Object = require('../Object');

/**
 * @version 2.0
 * @author <a href="mailto:kyle_olson@apple.com">Kyle Olson</a>

 * @description A Component is collection of properties in an object that is attributed to a unique identifier. The intended use for this is for creating a set of ‘properties’ to be used for another class or function, but it can really be used for anything similar. A Component is assumed to be associated with an element on the page, which is probably associated with an instance of a class.

 * <br /><br />

 * Components also have the notion of inheritance. You can define a parent Component for any given Component and create a hierarchical link between the two Components. This is used to extend the properties object with all parents to create inheritance within that object when getting the properties.

 * <br /><br />

 * The qualifier is only used externally. A Component registry will use the qualifier to match an element to a Component if it can not already be matched based on an html classname attribute. The qualifier receives the element plus a string, and is expected to return exactly <code>true</code> if that element should be of this Component. Anything else is considered false.  The context can be used to store any other data that you might need related to your Component. Anything can be stored in the context, but some of the values might be considered by other scripts, such as <code>module:ac-base.AutoGallery</code>, to be key values that allow for extra behavior to be attributed to a particular Component.

 * @param {String} name A unique identifier for this Component. Also used for the html classname attribute to decide whether or not a gallery is of this Component (e.g. ‘image’ would be the Component if the classname was ‘autogallery-image’).
 * @param {Object} properties Optional; A dictionary of keys and values that this Component’s intended use will understand. These are the properties that will be merged with the parents’ and <code>_base</code> properties to form the properties Object passed to whatever Object uses this Component Registry. The default is empty object, which will inherit all parent properties.
 * @param {Function} qualifier Optional; A Function that can be used to determine whether or not an Element is of a certain Component without needing the classname attribute. Should return true or false. Use <code>module:ac-base.Function.emptyFunction</code> to opt out of having a qualifier if you still want to define a <code>parentComponentName</code>. The qualifier Function will be passed the Element and the <code>prefix</code> for the classname attribute, and will be bound such that <code>this</code> will refer to the instance of Component that is attempting to be matched.
 * @param {String} parentComponentName Optional; Link this Component to a parent Component, which means this Component will be more specific (higher index level in the model) and will be considered before any Components at a lower index in the model. When asking a Component for its properties, it will extend a clone of its parent’s properties and return the extended Object. The parent will do the same with its parent before returning its properties, all the way to index level 0 (<code>_base</code>).
 * @param {Object} context Optional; If you need to store more information in a Component that you will access later, you can put it inside of the context object. An example of when you might use this would be for a delegate that is associated with a Component. This information is presumably used by the Object that deals with the Registry and asks it for matches.
 * @name module:ac-base.Registry.Component
 * @kind class
 */
var ac_Registry_Component = ac_Class();
ac_Registry_Component.prototype = /** @lends @module:ac-base.Registry.Component# */ {

	/** @ignore */
	initialize: function (name, properties, qualifier, parent, context) {
		if (typeof name !== 'string') {
			throw new Error('Cannot create Component without a name');
		}
		this._name = name;
		this._properties = properties || {};
		this.qualifier = typeof qualifier === 'function' ? qualifier : ac_Function.emptyFunction;
		this._parent = parent;
		this._context = context || {};

		// Synthesize Member Data
		ac_Object.synthesize(this);
	},

	/**
	 * @returns {Object} The properties for this Component, extended from the properties of its parents’, all the way back up to _base.
	 */
	properties: function () {
		var parentProperties = (typeof this._parent === 'undefined' || this._parent === null) ? {} : this._parent.properties();
		return ac_Object.extend(parentProperties, this._properties);
	},

	/**
	 * Getter for the context Dictionary. Use this method to take advantage of context inheritance. Context inheritance means that the Component will use it’s parent’s value for a context key if it does not have something defined on it’s own context for that key. There is no Object extending with Context inheritance.
	 * @param {Stirng} key Get the value for this key as it exists in the context object for this Component.
	 * @returns The value in the context dictionary for this key, or null if the key does not exist in the context.
	 */
	context: function (key) {
		// If we have a value for this key, return it.
		if (this._context[key]) {
			return this._context[key];

		// If there is no value for this key in this context, check the parent’s if that key is set to inherit
		} else if (Array.isArray(this._context.inherits) && this._context.inherits.indexOf[key] !== -1) {
			return (this.parent()) ? this.parent().context(key) : null;
		}

		return null;
	},

	/**
	 * The level is the number of parents a Component has (not including _base) and is factored into the specificity of the Component. A Registry will use this level for the order in which it tries to match.
	 * @returns {Integer} The level of this Component
	 */
	level: function () {
		// Memoize level as it is not intended to change.
		if (typeof this._level !== 'undefined') {
			return this._level;
		}

		// _base is a key word that assumes level 0
		if (this._name === '_base') {
			return 0;

		// If there is no parent or if the parent is _base, assume level 1
		} else if (typeof this._parent === 'undefined' || this._parent.name() === '_base') {
			return 1;

		// Otherwise if there is a parent the level is always 1 more than the parent’s
		} else {
			return this._parent.level() + 1;
		}
	}
};

/**
 * @param {Object} obj Test if the Object is an instance of module:ac-base.Registry.Component
 * @returns {Boolean} Whether or not this Object is an instance of module:ac-base.Registry.Component
 * @name module:ac-base.Registry.Component.isComponent
 * @kind function
 */
ac_Registry_Component.isComponent = function (obj) {
	return (obj instanceof ac_Registry_Component);
};

module.exports = ac_Registry_Component;

},{"../Class":9,"../Function":26,"../Object":29}],33:[function(require,module,exports){
'use strict';

var qs = require('qs');

/**
 * @name module:ac-base.String
 * @kind namespace
 */
var ac_String = {};

/**
 * Returns <code>true</code> or <code>false</code> whether or not the Object is a string
 * @param {Object} object Object to test against
 * @name module:ac-base.String.isString
 * @kind function
 */
ac_String.isString = function (object) {
	return (typeof object === 'string');
};

/**
 * Returns string with dashes remove and characters following dashes in uppercase
 * @param {String} string String to turn into camelCase
 * @name module:ac-base.String.toCamelCase
 * @kind function
 */
ac_String.toCamelCase = function (string) {
	if (!ac_String.isString(string)) {
		throw new TypeError('Argument must be of type String.');
	}

	return string.replace(/-+(.)?/g, function (match, character) {
		return character ? character.toUpperCase() : '';
	});
};

/**
 * @param {String} queryString String to turn into object
 * @name module:ac-base.String.queryStringToObject
 * @kind function
 */
ac_String.queryStringToObject = function (queryString) {
	// var queryObject = {};
	// var regExp = new RegExp('([^?=&]+)(=([^&]*))?', 'g');

	if (!ac_String.isString(queryString)) {
		throw new TypeError('QueryStringToObject error: argument must be a string');
	}
	return qs.parse(queryString);

	// queryString.replace(
	//  regExp,
	//  function($0, key, $2, value) { queryObject[key] = value; }
	// );

	// return queryObject;
};

/**
 * Convert key/value into a query string pair
 * @param {String} key
 * @param {String} value
 * @returns {String} Returns query string representation of a key/value pair
 * @name module:ac-base.String.toQueryPair
 * @kind function
 */
ac_String.toQueryPair = function (key, value) {

	if (!ac_String.isString(key) || !ac_String.isString(value)) {
		throw new TypeError('toQueryPair error: argument must be a string');
	}

	return encodeURIComponent(key) + '=' + encodeURIComponent(value);
};

module.exports = ac_String;

},{"qs":1}],34:[function(require,module,exports){
'use strict';

/**
 * Contains methods that automatically make getter and setter
 * methods for you based on the existence of private variables.

 * <br/><br/>

 * Getter and Setter methods are used to control how external scripts can access your
 * object’s member data. There are any number of reasons why you might want to do this,
 * but just a couple examples are:

 * <ul>
 *     <li>To validate the value you’re trying to set will work for the intended use of your variable.</li>
 *     <li>To create hooks any time a variable changes, in case you need to update something else in your script at that time.</li>
 *     <li>To calculate the value of the variable at the time of getting it (memoization).</li>
 * </ul>

 * <br/>

 * <h2>Naming Convention</h2>
 * We follow the convention from Objective-C for naming getter/setter methods. If your
 * variable is called '_variable', then the getter method would be 'variable' (without
 * the _) and the setter would be 'setVariable' (notice the camelCase).

 * <br/><br/>

 * <h2>Applicable Variables</h2>
 * Variables that are applicable to receive setters/getters are determined
 * by two conditions:

 * <ol>
 *     <li>Its key is preceded by '_' (e.x. _key)</li>
 *     <li>It is not of the type “function”</li>
 * </ol>

 * <br/>

 * A variable preceded by __ (two underscores) is ignored by module:ac-base.Synthesize. This is
 * a convention you can use to make variables that are private, which is to say
 * that they are not intended to be touched or used at all outside of the context
 * of the object that holds it.

 * <br/><br/>

 * <strong>NOTE:</strong> Variables preceded by a single _ are also considered private, which is
 * why you’re creating getter/setter methods in the first place. External scripts are
 * not intended to directly touch those variables. Instead they should access them
 * through the getter/setter methods.

 * <br/><br/>

 * <h2>Custom Getters/Setters</h2>

 * To have custom getter/setter methods for your variables, you simply define them
 * in your object before synthesizing. Before setting either method, module:ac-base.Synthesize
 * will check to see if there is already a value for the variable that follows the
 * naming convention for getters/setters. If there already is something defined, it
 * ignores it.

 * <br/><br/>

 * <strong>NOTE:</strong> Custom getter methods are still expected to return the final value
 * of the variable after it has been gotten.

 * <br/><br/>

 * <strong>NOTE:</strong> If you want neither a getter nor a setter for your variable, consider
 * using the __ syntax described above. Do not provide null/useless values for the
 * getter/setter variable names following the naming convention for your variable.

 * <br/><br/>

 * @example
 * var myObj = module:ac-base.Object.synthesize({
 *     ...
 * });

 * @example
 * var myObj = { ... };
 * module:ac-base.Synthesize.synthesize(myObj);
 */

/**
 * This is the method you call to synthesize your object. If you have extended
 * your object with module:ac-base.Synthesize, then you do not need to pass any arguments
 * to this method (i.e. if <code>this</code> inside of your method would be the object
 * you're trying to synthesize). Otherwise you can provide an object to it directly.
 *
 * @namespace
 * @name module:ac-base.Synthesize
 * @version 1.1
 * @author <a href="mailto:kyle_olson@apple.com">Kyle Olson</a>
 */
var ac_Synthesize = {};

/**
 * Private method for creating a setter when synthesizing a private variable
 * if one doesn’t already exist.
 * @ignore
 */
function synthesizeGetter(privateVariable, object) {
		// Get name of getter function
		var functionName = privateVariable.slice(1, privateVariable.length);

		// Define getter if not already defined
		if (typeof object[functionName] === 'undefined') {
			object[functionName] = function () {
				return object[privateVariable];
			};
		}
}

/**
 * Private method for creating a setter when synthesizing a private variable
 * if one doesn't already exist.
 * @ignore
 */
function synthesizeSetter(privateVariable, object) {
	var functionName = privateVariable.slice(1, privateVariable.length);
	functionName = 'set' + functionName.slice(0, 1).toUpperCase() + functionName.slice(1, functionName.length);

	// Define setter if not already defined
	if (typeof object[functionName] === 'undefined') {
		object[functionName] = function (value) {
			object[privateVariable] = value;
		};
	}
}

/**
 * @function
 * @name module:ac-base.Synthesize.synthesize
 * @param {Object} object The object to synthesize (or <code>this</code> by default).
 */
ac_Synthesize.synthesize = function (object) {
	if (typeof object !== 'object') {
		object = this;
	}

	var privateVariable;

	// Check all properties under object, ignore inherited properties
	for (privateVariable in object) {
		if (object.hasOwnProperty(privateVariable)) {
			// Check that first character is private variable indicator '_' and not '__'
			if (privateVariable.charAt(0) === '_' && privateVariable.charAt(1) !== '_') {
				// Don't create getter/setters for functions
				if (typeof object[privateVariable] !== 'function') {
					synthesizeGetter(privateVariable, object);
					synthesizeSetter(privateVariable, object);
				}
			}
		}
	}
};

module.exports = ac_Synthesize;

},{}],35:[function(require,module,exports){
'use strict';

/**
 * @name module:ac-base.Viewport
 * @kind namespace
 */
var ac_Viewport = {};

/**
 * @returns {Object} Left scroll offset as x, top scroll offset as y.
 * @name module:ac-base.Viewport.scrollOffsets
 * @kind function
 */
ac_Viewport.scrollOffsets = function () {
	return {
		x: window.pageXOffset || document.documentElement.scrollLeft || document.body.scrollLeft,
		y: window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
	};
};

/**
 * @returns {Object} Returns window width and height (px).
 * @name module:ac-base.Viewport.dimensions
 * @kind function
 */
ac_Viewport.dimensions = function () {
	return {
		height: window.innerHeight || document.documentElement.clientHeight,
		width: window.innerWidth || document.documentElement.clientWidth
	};
};

module.exports = ac_Viewport;

},{}],36:[function(require,module,exports){
'use strict';

/**
 * @reference http://en.wikipedia.org/wiki/Adler-32
 * @param {String} string The string you want to get the checksum for.
 * @returns {Integer} Adler-32 checksum for string provided
 * @name module:ac-base.adler32
 * @kind function
 */
module.exports = function ac_adler32(string) {
	var adlerModulo = 65521;
	var checksum16a = 1;
	var checksum16b = 0;
	var unicodeValueForCurrentChar;
	var i;

	for (i = 0; i < string.length; i += 1) {
		unicodeValueForCurrentChar = string.charCodeAt(i);
		checksum16a = (checksum16a + unicodeValueForCurrentChar) % adlerModulo;
		checksum16b = (checksum16b + checksum16a) % adlerModulo;
	}

	return (checksum16b << 16) | checksum16a;
};

},{}],37:[function(require,module,exports){
'use strict';

var ac_Element = require('./Element');
var ac_Function = require('./Function');

/**
 * Add multiple event listeners to the same element and bind the callback methods to an object.
 * @param {Object} object What your method is bound to.
 * @param {Element} element The element that we are listening on.
 * @param {Object} handlerDictionary dictionary of event names and functions to run on that event.
 * @name module:ac-base.bindEventListeners
 * @kind function
 * @deprecated
 */
module.exports = function ac_bindEventListeners(object, element, handlerDictionary) {
	var aKey;

	element = ac_Element.getElementById(element);

	if (!ac_Element.isElement(element)) {
		throw 'Invalid or non-existent element passed to bindEventListeners.';
	}

	for (aKey in handlerDictionary) {
		if (handlerDictionary.hasOwnProperty(aKey)) {
			var aVal = handlerDictionary[aKey];
			if (typeof aVal === 'function') {
				ac_Element.addEventListener(element, aKey, ac_Function.bindAsEventListener(aVal, object));
			} else if (typeof aVal === 'string') {
				ac_Element.addEventListener(element, aKey, ac_Function.bindAsEventListener(object[aVal], object));
			}
		}
	}
};

},{"./Element":13,"./Function":26}],38:[function(require,module,exports){
/*global window, document*/
'use strict';

module.exports = {
	console: window.console,
	document: document,
	window: window
};

},{}],39:[function(require,module,exports){
'use strict';

var localStorageAvailable = require('./Environment/Feature/localStorageAvailable');
var debugMessagingKey = 'f7c9180f-5c45-47b4-8de4-428015f096c0';
var allowDebugMessaging = (localStorageAvailable() && !!window.localStorage.getItem(debugMessagingKey));

/**
 * If there’s a console, print a message.
 * @param {String} message Error string to print.
 * @name module:ac-base.log
 * @kind function
 */
module.exports = function ac_log(message) {
	if (window.console && typeof console.log === 'function' && allowDebugMessaging) {
		console.log(message);
	}
};

},{"./Environment/Feature/localStorageAvailable":24}],40:[function(require,module,exports){
'use strict';

/**
 * Ensure that a given namespace exists.
 * @param {String} namespacePath The namespace to ensure.
 * @name module:ac-base.namespace
 * @kind function
 * @deprecated
 */
module.exports = function ac_namespace(namespacePath) {
	var i;

	if (!(namespacePath && namespacePath.match && namespacePath.match(/\S/))) {
		throw 'Attempt to create namespace with no name.';
	}

	var splitnamespaceArr = namespacePath.split(/\./);
	var cursor = window;

	for (i = 0; i < splitnamespaceArr.length; i++) {
		cursor[splitnamespaceArr[i]] = cursor[splitnamespaceArr[i]] || {};
		cursor = cursor[splitnamespaceArr[i]];
	}
};

},{}],41:[function(require,module,exports){
'use strict';

var ac_String = require('./String');

/**
 * Returns and object populated from the url query string.
 * If no query string is present, an empty object is returned
 * @returns {Object} key/value mappings to query string
 * @name module:ac-base.queryParameters
 * @kind function
 */
module.exports = function queryParameters() {
	var object = {};
	var queryString = window.location.toString().split('?')[1];

	if (ac_String.isString(queryString)) {
		object = ac_String.queryStringToObject(queryString);
	}

	return object;
};

},{"./String":33}],42:[function(require,module,exports){
'use strict';

module.exports = function() {
	var arr = [
		'abbr',
		'article',
		'aside',
		'command',
		'details',
		'figcaption',
		'figure',
		'footer',
		'header',
		'hgroup',
		'mark',
		'meter',
		'nav',
		'output',
		'picture',
		'progress',
		'section',
		'source',
		'summary',
		'time',
		'video'
	];
	arr.forEach(function (name) {
		document.createElement(name);
	});
};

},{}],43:[function(require,module,exports){
'use strict';

module.exports = function (ac_Array, ac_Environment_Browser) {

	/**
	 * Decorate module:ac-base.Array.toArray for < IE8
	 * The original method returns Array.prototype.slice.call(arrayLike);
	 * The Array.prototype.slice method throws an exception when used with
	 * nodelists and similar host objects in < IE8.
	 * We have to hold IE's hand here to manually produce the array.
	 */
	if (ac_Environment_Browser.IE.documentMode <= 8) {
		ac_Array.toArray = function (arrayLike) {
			var array = [];
			var len = arrayLike.length;
			var i;

			if (len > 0) {
				for (i = 0; i < len; i += 1) {
					array.push(arrayLike[i]);
				}
			}
			return array;
		};
	}
};

},{}],44:[function(require,module,exports){
'use strict';

var ac_Array = require('../../Array');
var ac_sizzle = require('../../vendor/Sizzle');

module.exports = function(ac_Element, ac_Environment_Browser, sizzle) {

	var documentMode = ac_Environment_Browser.IE.documentMode;

	sizzle = sizzle || ac_sizzle;

	if (documentMode < 8) {
		/**
		 * module:ac-base.Element.selectAll shim for IE < 8
		 * Fallback to sizzle needed due to lack of native querySelectorAll
		 */
		ac_Element.selectAll = function (selector, context) {
			if (typeof context === 'undefined') {
				context = document;
			} else if (!ac_Element.isElement(context) && context.nodeType !== 9 && context.nodeType !== 11) {
				throw new TypeError('ac-base.Element.selectAll: Invalid context nodeType');
			}
			if (typeof selector !== 'string') {
				throw new TypeError('ac-base.Element.selectAll: Selector must be a string');
			}

			// if context is document fragment
			if (context.nodeType === 11) {
				var matches = [];
				var childMatches;
				ac_Array.toArray(context.childNodes).forEach(function (node) {
					// check the child node
					if (sizzle.matchesSelector(node, selector)) {
						matches.push(node);
					}
					// check the child node's children
					if (childMatches = sizzle(selector, node).length > 0) {
						matches.concat(childMatches);
					}
				});
				return matches;
			}
			return sizzle(selector, context);
		};

	} else if (documentMode < 9) {
		/**
		 * module:ac-base.Element.selectAll shim for IE 8
		 * Use native querySelectorAll but convert to array with shim
		 */
		ac_Element.selectAll = function (selector, context) {
			if (typeof context === 'undefined') {
				context = document;
			} else if (!ac_Element.isElement(context) && context.nodeType !== 9 && context.nodeType !== 11) {
				throw new TypeError('ac-base.Element.selectAll: Invalid context nodeType');
			}
			if (typeof selector !== 'string') {
				throw new TypeError('ac-base.Element.selectAll: Selector must be a string');
			}
			return ac_Array.toArray(context.querySelectorAll(selector));
		};
	}

	/**
	 * module:ac-base.Element.select shim for IE < 8
	 * Fallback to sizzle needed due to lack of native querySelectorAll
	 */
	if (documentMode < 8) {
		ac_Element.select = function (selector, context) {
			if (typeof context === 'undefined') {
				context = document;
			} else if (!ac_Element.isElement(context) && context.nodeType !== 9 && context.nodeType !== 11) {
				throw new TypeError('ac-base.Element.select: Invalid context nodeType');
			}
			if (typeof selector !== 'string') {
				throw new TypeError('ac-base.Element.select: Selector must be a string');
			}
			// if context is document fragment
			if (context.nodeType === 11) {
				var match = [];
				var childMatches;
				ac_Array.toArray(context.childNodes).some(function (node) {
					// if the child node matches, return that, else look for a match in its children
					if (sizzle.matchesSelector(node, selector)) {
						match = node;
						return true;
					} else if (childMatches = sizzle(selector, node).length > 0) {
						match = childMatches[0];
						return true;
					}
				});
				return match;
			}
			return sizzle(selector, context)[0];
		};
	}

	/**
	 * IE 9 and below account for the absence of Element.prototype.matches
	 * and/or Element.prototype.msMatchesSelector.
	 */
	if (documentMode < 9) {

		ac_Element.matchesSelector = function (element, selector) {
			return sizzle.matchesSelector(element, selector);
		};

		ac_Element.filterBySelector = function (elements, selector) {
			return sizzle.matches(selector, elements);
		};
	}

	/**
	 * IE 8 and below getStyle shim accounts for the absence of getComputedStyle as well as IE's
	 * currentStyle object's lack of support for background, font and border css shorthand props.
	 */
	if (documentMode < 9 && typeof window.getComputedStyle !== 'function') {
		ac_Element.getStyle = function (element, style, css) {
			element = ac_Element.getElementById(element);
			var alphaFilter;
			var value;

			css = css || element.currentStyle;
			if (css) {
				style = style.replace(/-(\w)/g, ac_Element.setStyle.__camelCaseReplace);

				// IE's currentStyle uses styleFloat instead of float
				style = style === 'float' ? 'styleFloat' : style;

				// Handle opacity
				if (style === 'opacity') {
					alphaFilter = element.filters['DXImageTransform.Microsoft.Alpha'] || element.filters.Alpha;
					if (alphaFilter) {
						return parseFloat(alphaFilter.Opacity / 100);
					}
					return 1.0;
				}

				value = css[style] || null;
				return value === 'auto' ? null : value;
			}
		};
	}

	/**
	 * Shimming the __setStyle private method of module:ac-base.Element.setStyle. IE requires opacity to be
	 * set via the proprietary IE filters. The shimmed __setStyle method calls on the IE only
	 * private method module:ac-base.Element.setStyle.__setOpacity to handle this task. If the style being
	 * set is not opacity, __setStyle defers back to an original stashed version of __setStyle
	 * to handle the task. Referred to here as module:ac-base.Element.setStyle.__superSetStyle.
	 */
	if (documentMode <= 8) {

		ac_Element.setStyle.__superSetStyle = ac_Element.setStyle.__setStyle;

		ac_Element.setStyle.__setStyle = function (element, camelCaseProp, stylesObj, stylesValue) {
			if (camelCaseProp === 'opacity') {
				ac_Element.setStyle.__setOpacity(element, stylesValue);
			// else do it the easy way
			} else {
				ac_Element.setStyle.__superSetStyle(element, camelCaseProp, stylesObj, stylesValue);
			}
		};

		ac_Element.setStyle.__setOpacity = function (element, value) {
			value = (value > 1) ? 1 : ((value < 0.00001) ? 0 : value) * 100;
			var alphaFilter = element.filters['DXImageTransform.Microsoft.Alpha'] || element.filters.Alpha;

			if (alphaFilter) {
				// Favor modifying existing filters via the filters collection if already set.
				alphaFilter.Opacity = value;
			} else {
				// Don't clobber existing filter string if any
				element.style.filter += ' progid:DXImageTransform.Microsoft.Alpha(Opacity=' + value + ')';
			}
		};
	}

	/**
	 * Rudimentary shim for getBoundingClientRect in IE < 8.
	 * getBoundingClientRect is available in IE8 even with documentMode as IE7.
	 * It is not available in vanilla IE7.
	 */
	if (ac_Environment_Browser.version < 8) {
		ac_Element.getBoundingBox = function (element) {
			element = ac_Element.getElementById(element);
			var left = element.offsetLeft;
			var top = element.offsetTop;
			var w = element.offsetWidth;
			var h = element.offsetHeight;
			return {
				top: top,
				right: left + w,
				bottom: top + h,
				left: left,
				width: w,
				height: h
			};
		};
	}
};

},{"../../Array":7,"../../vendor/Sizzle":48}],45:[function(require,module,exports){
'use strict';

module.exports = function(ac_Environment_Browser) {

	/**
	* Function to detect what version or document/standards mode IE is rendering the page as.
	* Accounts for later versions of IE rendering pages in earlier standards modes. E.G. it is
	* possible to set the X-UA-Compatible tag to tell IE9 to render pages in IE7 standards mode.
	*
	* Based on Microsoft test
	* @see http://msdn.microsoft.com/en-us/library/jj676915(v=vs.85).aspx
	*/
	function __getIEDocumentMode() {
		var ie;

		// IE8 or later
		if (document.documentMode) {
			ie = parseInt(document.documentMode, 10);
		// IE 5-7
		} else {
			// Assume quirks mode unless proven otherwise
			ie = 5;
			if (document.compatMode) {
				// standards mode
				if (document.compatMode === "CSS1Compat") {
					ie = 7;
				}
			}
			// There is no test for IE6 standards mode because that mode
			// was replaced by IE7 standards mode; there is no emulation.
		}

		return ie;
	}

	ac_Environment_Browser.IE = {
		documentMode: __getIEDocumentMode()
	};
};

},{}],46:[function(require,module,exports){
'use strict';

var ac_Element = require('../../Element');

/*
 * Used by the nonClickableImageBooster method
 * TODO: Investigate at which IE version hasLayout becomes moot
 * Given an element and a specific ancestor element, search all elements in the ancestor
 * chain up to and including the specified ancestor element for the hasLayout property.
 * Returns true if any element in the chain has hasLayout.
 */
/** @ignore */
function ancestorHasLayout(element, limitElement) {
	var hasLayout = false;
	var currentElement = element.parentNode;
	while (currentElement !== limitElement) {
		if (currentElement) {
			if (currentElement.currentStyle.hasLayout) {
				hasLayout = true;
				break;
			}
			currentElement = currentElement.parentNode;
		}
	}
	return hasLayout;
}

/**
 * Fixing the non-clickable image bug for IE versions and compatibliity modes <= 7
 *
 * This bug occurs when an image is the grandchild of an <a> and the image’s parent node’s
 * hasLayout IE property is true. The image becomes non-clickable while the rest of the
 * area around the image, inside of the <a> remains clickable.
 *
 * See http://www.brunildo.org/test/IEaL.html for an example.
 */
module.exports = function() {
	var parent;
	var anchor;
	var booster;
	var aPosition;
	var zIndices = [];
	var zIdx;
	// 1x1 transparent gif
	// @see http://css-tricks.com/snippets/html/base64-encode-of-1x1px-transparent-gif/
	// @see http://stackoverflow.com/questions/6018611/smallest-data-uri-image-possible-for-a-transparent-image
	// IE7 does not support data uri
	// url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)
	var baseUri = (location.protocol === 'https:' ? 'https://ssl' :  'http://images') + '.apple.com';
	var g = 'g';
	var backgroundImage = 'url(' + baseUri + '/global/elements/blank.' + g + 'if)';

	// Eligible elements are images that are grandchildren of <a>'s
	ac_Element.selectAll('a > * img').forEach(function (img) {
		parent = img.parentNode;
		anchor = ac_Element.ancestor(img, 'a');

		// The bug is triggered when an image's ancestor node has layout
		if (ancestorHasLayout(img, anchor) && img.height > 0 && img.width > 0) {

			// We only need one booster per anchor
			if (!ac_Element.select('ieclickbooster', anchor)) {
				booster = document.createElement('ieclickbooster');
				aPosition = ac_Element.getStyle(anchor, 'position');

				if (aPosition === 'static') {
					ac_Element.setStyle(anchor, { position: 'relative' });
				}

				// Collect zIndices for all of the anchor's direct children
				ac_Element.selectAll('> *', anchor).forEach(function (element) {
					var elementZidx = parseInt(element.currentStyle.zIndex, 10);
					if (elementZidx > 0) {
						zIndices.push(elementZidx);
					}
				});
				zIndices.sort(function (a, b) {
					return b - a;
				});

				zIdx = zIndices[0] ? zIndices[0].toString() : '1';

				ac_Element.insert(booster, anchor);

				ac_Element.setStyle(booster, {
					display: 'block',
					position: 'absolute',
					top: '0',
					bottom: '0',
					left: '0',
					right: '0',
					background: backgroundImage,
					cursor: 'pointer',
					zIndex: zIdx
				});
			}
		}
	});
};

},{"../../Element":13}],47:[function(require,module,exports){
'use strict';

var uid = 0;

/**
 * Return an integer which is incremented each time; used to make HTML IDs unique.
 * @returns {Integer}
 * @name module:ac-base.uid
 * @kind function
 */
module.exports = function ac_uid() {
	return uid++;
};

},{}],48:[function(require,module,exports){
/*!
 * Sizzle CSS Selector Engine
 *  Copyright 2012, The Dojo Foundation
 *  Released under the MIT, BSD, and GPL Licenses.
 *  More information: http://sizzlejs.com/
 */
/* istanbul ignore next */
(function( window, undefined ) {

var cachedruns,
	dirruns,
	sortOrder,
	siblingCheck,
	assertGetIdNotName,

	document = window.document,
	docElem = document.documentElement,

	strundefined = "undefined",
	hasDuplicate = false,
	baseHasDuplicate = true,
	done = 0,
	slice = [].slice,
	push = [].push,

	expando = ( "sizcache" + Math.random() ).replace( ".", "" ),

	// Regex

	// Whitespace characters http://www.w3.org/TR/css3-selectors/#whitespace
	whitespace = "[\\x20\\t\\r\\n\\f]",
	// http://www.w3.org/TR/css3-syntax/#characters
	characterEncoding = "(?:\\\\.|[-\\w]|[^\\x00-\\xa0])",

	// Loosely modeled on Javascript identifier characters
	identifier = "(?:[\\w#_-]|[^\\x00-\\xa0]|\\\\.)",
	// Acceptable operators http://www.w3.org/TR/selectors/#attribute-selectors
	operators = "([*^$|!~]?=)",
	attributes = "\\[" + whitespace + "*(" + characterEncoding + "+)" + whitespace +
		"*(?:" + operators + whitespace + "*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|(" + identifier + "+)|)|)" + whitespace + "*\\]",
	pseudos = ":(" + characterEncoding + "+)(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|(.*))\\)|)",
	pos = ":(nth|eq|gt|lt|first|last|even|odd)(?:\\((\\d*)\\)|)(?=[^-]|$)",
	combinators = whitespace + "*([\\x20\\t\\r\\n\\f>+~])" + whitespace + "*",
	groups = "(?=[^\\x20\\t\\r\\n\\f])(?:\\\\.|" + attributes + "|" + pseudos.replace( 2, 7 ) + "|[^\\\\(),])+",

	// Leading and non-escaped trailing whitespace, capturing some non-whitespace characters preceding the latter
	rtrim = new RegExp( "^" + whitespace + "+|((?:^|[^\\\\])(?:\\\\.)*)" + whitespace + "+$", "g" ),

	rcombinators = new RegExp( "^" + combinators ),

	// All simple (non-comma) selectors, excluding insignifant trailing whitespace
	rgroups = new RegExp( groups + "?(?=" + whitespace + "*,|$)", "g" ),

	// A selector, or everything after leading whitespace
	// Optionally followed in either case by a ")" for terminating sub-selectors
	rselector = new RegExp( "^(?:(?!,)(?:(?:^|,)" + whitespace + "*" + groups + ")*?|" + whitespace + "*(.*?))(\\)|$)" ),

	// All combinators and selector components (attribute test, tag, pseudo, etc.), the latter appearing together when consecutive
	rtokens = new RegExp( groups.slice( 19, -6 ) + "\\x20\\t\\r\\n\\f>+~])+|" + combinators, "g" ),

	// Easily-parseable/retrievable ID or TAG or CLASS selectors
	rquickExpr = /^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,

	rsibling = /[\x20\t\r\n\f]*[+~]/,
	rendsWithNot = /:not\($/,

	rheader = /h\d/i,
	rinputs = /input|select|textarea|button/i,

	rbackslash = /\\(?!\\)/g,

	matchExpr = {
		"ID": new RegExp( "^#(" + characterEncoding + "+)" ),
		"CLASS": new RegExp( "^\\.(" + characterEncoding + "+)" ),
		"NAME": new RegExp( "^\\[name=['\"]?(" + characterEncoding + "+)['\"]?\\]" ),
		"TAG": new RegExp( "^(" + characterEncoding.replace( "[-", "[-\\*" ) + "+)" ),
		"ATTR": new RegExp( "^" + attributes ),
		"PSEUDO": new RegExp( "^" + pseudos ),
		"CHILD": new RegExp( "^:(only|nth|last|first)-child(?:\\(" + whitespace +
			"*(even|odd|(([+-]|)(\\d*)n|)" + whitespace + "*(?:([+-]|)" + whitespace +
			"*(\\d+)|))" + whitespace + "*\\)|)", "i" ),
		"POS": new RegExp( pos, "ig" ),
		// For use in libraries implementing .is()
		"needsContext": new RegExp( "^" + whitespace + "*[>+~]|" + pos, "i" )
	},

	classCache = {},
	cachedClasses = [],
	compilerCache = {},
	cachedSelectors = [],

	// Mark a function for use in filtering
	markFunction = function( fn ) {
		fn.sizzleFilter = true;
		return fn;
	},

	// Returns a function to use in pseudos for input types
	createInputFunction = function( type ) {
		return function( elem ) {
			// Check the input's nodeName and type
			return elem.nodeName.toLowerCase() === "input" && elem.type === type;
		};
	},

	// Returns a function to use in pseudos for buttons
	createButtonFunction = function( type ) {
		return function( elem ) {
			var name = elem.nodeName.toLowerCase();
			return (name === "input" || name === "button") && elem.type === type;
		};
	},

	// Used for testing something on an element
	assert = function( fn ) {
		var pass = false,
			div = document.createElement("div");
		try {
			pass = fn( div );
		} catch (e) {}
		// release memory in IE
		div = null;
		return pass;
	},

	// Check if attributes should be retrieved by attribute nodes
	assertAttributes = assert(function( div ) {
		div.innerHTML = "<select></select>";
		var type = typeof div.lastChild.getAttribute("multiple");
		// IE8 returns a string for some attributes even when not present
		return type !== "boolean" && type !== "string";
	}),

	// Check if getElementById returns elements by name
	// Check if getElementsByName privileges form controls or returns elements by ID
	assertUsableName = assert(function( div ) {
		// Inject content
		div.id = expando + 0;
		div.innerHTML = "<a name='" + expando + "'></a><div name='" + expando + "'></div>";
		docElem.insertBefore( div, docElem.firstChild );

		// Test
		var pass = document.getElementsByName &&
			// buggy browsers will return fewer than the correct 2
			document.getElementsByName( expando ).length ===
			// buggy browsers will return more than the correct 0
			2 + document.getElementsByName( expando + 0 ).length;
		assertGetIdNotName = !document.getElementById( expando );

		// Cleanup
		docElem.removeChild( div );

		return pass;
	}),

	// Check if the browser returns only elements
	// when doing getElementsByTagName("*")
	assertTagNameNoComments = assert(function( div ) {
		div.appendChild( document.createComment("") );
		return div.getElementsByTagName("*").length === 0;
	}),

	// Check if getAttribute returns normalized href attributes
	assertHrefNotNormalized = assert(function( div ) {
		div.innerHTML = "<a href='#'></a>";
		return div.firstChild && typeof div.firstChild.getAttribute !== strundefined &&
			div.firstChild.getAttribute("href") === "#";
	}),

	// Check if getElementsByClassName can be trusted
	assertUsableClassName = assert(function( div ) {
		// Opera can't find a second classname (in 9.6)
		div.innerHTML = "<div class='hidden e'></div><div class='hidden'></div>";
		if ( !div.getElementsByClassName || div.getElementsByClassName("e").length === 0 ) {
			return false;
		}

		// Safari caches class attributes, doesn't catch changes (in 3.2)
		div.lastChild.className = "e";
		return div.getElementsByClassName("e").length !== 1;
	});

var Sizzle = function( selector, context, results, seed ) {
	results = results || [];
	context = context || document;
	var match, elem, xml, m,
		nodeType = context.nodeType;

	if ( nodeType !== 1 && nodeType !== 9 ) {
		return [];
	}

	if ( !selector || typeof selector !== "string" ) {
		return results;
	}

	xml = isXML( context );

	if ( !xml && !seed ) {
		if ( (match = rquickExpr.exec( selector )) ) {
			// Speed-up: Sizzle("#ID")
			if ( (m = match[1]) ) {
				if ( nodeType === 9 ) {
					elem = context.getElementById( m );
					// Check parentNode to catch when Blackberry 4.6 returns
					// nodes that are no longer in the document #6963
					if ( elem && elem.parentNode ) {
						// Handle the case where IE, Opera, and Webkit return items
						// by name instead of ID
						if ( elem.id === m ) {
							results.push( elem );
							return results;
						}
					} else {
						return results;
					}
				} else {
					// Context is not a document
					if ( context.ownerDocument && (elem = context.ownerDocument.getElementById( m )) &&
						contains( context, elem ) && elem.id === m ) {
						results.push( elem );
						return results;
					}
				}

			// Speed-up: Sizzle("TAG")
			} else if ( match[2] ) {
				push.apply( results, slice.call(context.getElementsByTagName( selector ), 0) );
				return results;

			// Speed-up: Sizzle(".CLASS")
			} else if ( (m = match[3]) && assertUsableClassName && context.getElementsByClassName ) {
				push.apply( results, slice.call(context.getElementsByClassName( m ), 0) );
				return results;
			}
		}
	}

	// All others
	return select( selector, context, results, seed, xml );
};

var Expr = Sizzle.selectors = {

	// Can be adjusted by the user
	cacheLength: 50,

	match: matchExpr,

	order: [ "ID", "TAG" ],

	attrHandle: {},

	createPseudo: markFunction,

	find: {
		"ID": assertGetIdNotName ?
			function( id, context, xml ) {
				if ( typeof context.getElementById !== strundefined && !xml ) {
					var m = context.getElementById( id );
					// Check parentNode to catch when Blackberry 4.6 returns
					// nodes that are no longer in the document #6963
					return m && m.parentNode ? [m] : [];
				}
			} :
			function( id, context, xml ) {
				if ( typeof context.getElementById !== strundefined && !xml ) {
					var m = context.getElementById( id );

					return m ?
						m.id === id || typeof m.getAttributeNode !== strundefined && m.getAttributeNode("id").value === id ?
							[m] :
							undefined :
						[];
				}
			},

		"TAG": assertTagNameNoComments ?
			function( tag, context ) {
				if ( typeof context.getElementsByTagName !== strundefined ) {
					return context.getElementsByTagName( tag );
				}
			} :
			function( tag, context ) {
				var results = context.getElementsByTagName( tag );

				// Filter out possible comments
				if ( tag === "*" ) {
					var elem,
						tmp = [],
						i = 0;

					for ( ; (elem = results[i]); i++ ) {
						if ( elem.nodeType === 1 ) {
							tmp.push( elem );
						}
					}

					return tmp;
				}
				return results;
			}
	},

	relative: {
		">": { dir: "parentNode", first: true },
		" ": { dir: "parentNode" },
		"+": { dir: "previousSibling", first: true },
		"~": { dir: "previousSibling" }
	},

	preFilter: {
		"ATTR": function( match ) {
			match[1] = match[1].replace( rbackslash, "" );

			// Move the given value to match[3] whether quoted or unquoted
			match[3] = ( match[4] || match[5] || "" ).replace( rbackslash, "" );

			if ( match[2] === "~=" ) {
				match[3] = " " + match[3] + " ";
			}

			return match.slice( 0, 4 );
		},

		"CHILD": function( match ) {
			/* matches from matchExpr.CHILD
				1 type (only|nth|...)
				2 argument (even|odd|\d*|\d*n([+-]\d+)?|...)
				3 xn-component of xn+y argument ([+-]?\d*n|)
				4 sign of xn-component
				5 x of xn-component
				6 sign of y-component
				7 y of y-component
			*/
			match[1] = match[1].toLowerCase();

			if ( match[1] === "nth" ) {
				// nth-child requires argument
				if ( !match[2] ) {
					Sizzle.error( match[0] );
				}

				// numeric x and y parameters for Expr.filter.CHILD
				// remember that false/true cast respectively to 0/1
				match[3] = +( match[3] ? match[4] + (match[5] || 1) : 2 * ( match[2] === "even" || match[2] === "odd" ) );
				match[4] = +( ( match[6] + match[7] ) || match[2] === "odd" );

			// other types prohibit arguments
			} else if ( match[2] ) {
				Sizzle.error( match[0] );
			}

			return match;
		},

		"PSEUDO": function( match ) {
			var argument,
				unquoted = match[4];

			if ( matchExpr["CHILD"].test( match[0] ) ) {
				return null;
			}

			// Relinquish our claim on characters in `unquoted` from a closing parenthesis on
			if ( unquoted && (argument = rselector.exec( unquoted )) && argument.pop() ) {

				match[0] = match[0].slice( 0, argument[0].length - unquoted.length - 1 );
				unquoted = argument[0].slice( 0, -1 );
			}

			// Quoted or unquoted, we have the full argument
			// Return only captures needed by the pseudo filter method (type and argument)
			match.splice( 2, 3, unquoted || match[3] );
			return match;
		}
	},

	filter: {
		"ID": assertGetIdNotName ?
			function( id ) {
				id = id.replace( rbackslash, "" );
				return function( elem ) {
					return elem.getAttribute("id") === id;
				};
			} :
			function( id ) {
				id = id.replace( rbackslash, "" );
				return function( elem ) {
					var node = typeof elem.getAttributeNode !== strundefined && elem.getAttributeNode("id");
					return node && node.value === id;
				};
			},

		"TAG": function( nodeName ) {
			if ( nodeName === "*" ) {
				return function() { return true; };
			}
			nodeName = nodeName.replace( rbackslash, "" ).toLowerCase();

			return function( elem ) {
				return elem.nodeName && elem.nodeName.toLowerCase() === nodeName;
			};
		},

		"CLASS": function( className ) {
			var pattern = classCache[ className ];
			if ( !pattern ) {
				pattern = classCache[ className ] = new RegExp( "(^|" + whitespace + ")" + className + "(" + whitespace + "|$)" );
				cachedClasses.push( className );
				// Avoid too large of a cache
				if ( cachedClasses.length > Expr.cacheLength ) {
					delete classCache[ cachedClasses.shift() ];
				}
			}
			return function( elem ) {
				return pattern.test( elem.className || (typeof elem.getAttribute !== strundefined && elem.getAttribute("class")) || "" );
			};
		},

		"ATTR": function( name, operator, check ) {
			if ( !operator ) {
				return function( elem ) {
					return Sizzle.attr( elem, name ) != null;
				};
			}

			return function( elem ) {
				var result = Sizzle.attr( elem, name ),
					value = result + "";

				if ( result == null ) {
					return operator === "!=";
				}

				switch ( operator ) {
					case "=":
						return value === check;
					case "!=":
						return value !== check;
					case "^=":
						return check && value.indexOf( check ) === 0;
					case "*=":
						return check && value.indexOf( check ) > -1;
					case "$=":
						return check && value.substr( value.length - check.length ) === check;
					case "~=":
						return ( " " + value + " " ).indexOf( check ) > -1;
					case "|=":
						return value === check || value.substr( 0, check.length + 1 ) === check + "-";
				}
			};
		},

		"CHILD": function( type, argument, first, last ) {

			if ( type === "nth" ) {
				var doneName = done++;

				return function( elem ) {
					var parent, diff,
						count = 0,
						node = elem;

					if ( first === 1 && last === 0 ) {
						return true;
					}

					parent = elem.parentNode;

					if ( parent && (parent[ expando ] !== doneName || !elem.sizset) ) {
						for ( node = parent.firstChild; node; node = node.nextSibling ) {
							if ( node.nodeType === 1 ) {
								node.sizset = ++count;
								if ( node === elem ) {
									break;
								}
							}
						}

						parent[ expando ] = doneName;
					}

					diff = elem.sizset - last;

					if ( first === 0 ) {
						return diff === 0;

					} else {
						return ( diff % first === 0 && diff / first >= 0 );
					}
				};
			}

			return function( elem ) {
				var node = elem;

				switch ( type ) {
					case "only":
					case "first":
						while ( (node = node.previousSibling) ) {
							if ( node.nodeType === 1 ) {
								return false;
							}
						}

						if ( type === "first" ) {
							return true;
						}

						node = elem;

						/* falls through */
					case "last":
						while ( (node = node.nextSibling) ) {
							if ( node.nodeType === 1 ) {
								return false;
							}
						}

						return true;
				}
			};
		},

		"PSEUDO": function( pseudo, argument, context, xml ) {
			// pseudo-class names are case-insensitive
			// http://www.w3.org/TR/selectors/#pseudo-classes
			// Prioritize by case sensitivity in case custom pseudos are added with uppercase letters
			var fn = Expr.pseudos[ pseudo ] || Expr.pseudos[ pseudo.toLowerCase() ];

			if ( !fn ) {
				Sizzle.error( "unsupported pseudo: " + pseudo );
			}

			// The user may set fn.sizzleFilter to indicate
			// that arguments are needed to create the filter function
			// just as Sizzle does
			if ( !fn.sizzleFilter ) {
				return fn;
			}

			return fn( argument, context, xml );
		}
	},

	pseudos: {
		"not": markFunction(function( selector, context, xml ) {
			// Trim the selector passed to compile
			// to avoid treating leading and trailing
			// spaces as combinators
			var matcher = compile( selector.replace( rtrim, "$1" ), context, xml );
			return function( elem ) {
				return !matcher( elem );
			};
		}),

		"enabled": function( elem ) {
			return elem.disabled === false;
		},

		"disabled": function( elem ) {
			return elem.disabled === true;
		},

		"checked": function( elem ) {
			// In CSS3, :checked should return both checked and selected elements
			// http://www.w3.org/TR/2011/REC-css3-selectors-20110929/#checked
			var nodeName = elem.nodeName.toLowerCase();
			return (nodeName === "input" && !!elem.checked) || (nodeName === "option" && !!elem.selected);
		},

		"selected": function( elem ) {
			// Accessing this property makes selected-by-default
			// options in Safari work properly
			if ( elem.parentNode ) {
				elem.parentNode.selectedIndex;
			}

			return elem.selected === true;
		},

		"parent": function( elem ) {
			return !!elem.firstChild;
		},

		"empty": function( elem ) {
			return !elem.firstChild;
		},

		"contains": markFunction(function( text ) {
			return function( elem ) {
				return ( elem.textContent || elem.innerText || getText( elem ) ).indexOf( text ) > -1;
			};
		}),

		"has": markFunction(function( selector ) {
			return function( elem ) {
				return Sizzle( selector, elem ).length > 0;
			};
		}),

		"header": function( elem ) {
			return rheader.test( elem.nodeName );
		},

		"text": function( elem ) {
			var type, attr;
			// IE6 and 7 will map elem.type to 'text' for new HTML5 types (search, etc)
			// use getAttribute instead to test this case
			return elem.nodeName.toLowerCase() === "input" &&
				(type = elem.type) === "text" &&
				( (attr = elem.getAttribute("type")) == null || attr.toLowerCase() === type );
		},

		// Input types
		"radio": createInputFunction("radio"),
		"checkbox": createInputFunction("checkbox"),
		"file": createInputFunction("file"),
		"password": createInputFunction("password"),
		"image": createInputFunction("image"),

		"submit": createButtonFunction("submit"),
		"reset": createButtonFunction("reset"),

		"button": function( elem ) {
			var name = elem.nodeName.toLowerCase();
			return name === "input" && elem.type === "button" || name === "button";
		},

		"input": function( elem ) {
			return rinputs.test( elem.nodeName );
		},

		"focus": function( elem ) {
			var doc = elem.ownerDocument;
			return elem === doc.activeElement && (!doc.hasFocus || doc.hasFocus()) && !!(elem.type || elem.href);
		},

		"active": function( elem ) {
			return elem === elem.ownerDocument.activeElement;
		}
	},

	setFilters: {
		"first": function( elements, argument, not ) {
			return not ? elements.slice( 1 ) : [ elements[0] ];
		},

		"last": function( elements, argument, not ) {
			var elem = elements.pop();
			return not ? elements : [ elem ];
		},

		"even": function( elements, argument, not ) {
			var results = [],
				i = not ? 1 : 0,
				len = elements.length;
			for ( ; i < len; i = i + 2 ) {
				results.push( elements[i] );
			}
			return results;
		},

		"odd": function( elements, argument, not ) {
			var results = [],
				i = not ? 0 : 1,
				len = elements.length;
			for ( ; i < len; i = i + 2 ) {
				results.push( elements[i] );
			}
			return results;
		},

		"lt": function( elements, argument, not ) {
			return not ? elements.slice( +argument ) : elements.slice( 0, +argument );
		},

		"gt": function( elements, argument, not ) {
			return not ? elements.slice( 0, +argument + 1 ) : elements.slice( +argument + 1 );
		},

		"eq": function( elements, argument, not ) {
			var elem = elements.splice( +argument, 1 );
			return not ? elements : elem;
		}
	}
};

// Deprecated
Expr.setFilters["nth"] = Expr.setFilters["eq"];

// Back-compat
Expr.filters = Expr.pseudos;

// IE6/7 return a modified href
if ( !assertHrefNotNormalized ) {
	Expr.attrHandle = {
		"href": function( elem ) {
			return elem.getAttribute( "href", 2 );
		},
		"type": function( elem ) {
			return elem.getAttribute("type");
		}
	};
}

// Add getElementsByName if usable
if ( assertUsableName ) {
	Expr.order.push("NAME");
	Expr.find["NAME"] = function( name, context ) {
		if ( typeof context.getElementsByName !== strundefined ) {
			return context.getElementsByName( name );
		}
	};
}

// Add getElementsByClassName if usable
if ( assertUsableClassName ) {
	Expr.order.splice( 1, 0, "CLASS" );
	Expr.find["CLASS"] = function( className, context, xml ) {
		if ( typeof context.getElementsByClassName !== strundefined && !xml ) {
			return context.getElementsByClassName( className );
		}
	};
}

// If slice is not available, provide a backup
try {
	slice.call( docElem.childNodes, 0 )[0].nodeType;
} catch ( e ) {
	slice = function( i ) {
		var elem, results = [];
		for ( ; (elem = this[i]); i++ ) {
			results.push( elem );
		}
		return results;
	};
}

var isXML = Sizzle.isXML = function( elem ) {
	// documentElement is verified for cases where it doesn't yet exist
	// (such as loading iframes in IE - #4833)
	var documentElement = elem && (elem.ownerDocument || elem).documentElement;
	return documentElement ? documentElement.nodeName !== "HTML" : false;
};

// Element contains another
var contains = Sizzle.contains = docElem.compareDocumentPosition ?
	function( a, b ) {
		return !!( a.compareDocumentPosition( b ) & 16 );
	} :
	docElem.contains ?
	function( a, b ) {
		var adown = a.nodeType === 9 ? a.documentElement : a,
			bup = b.parentNode;
		return a === bup || !!( bup && bup.nodeType === 1 && adown.contains && adown.contains(bup) );
	} :
	function( a, b ) {
		while ( (b = b.parentNode) ) {
			if ( b === a ) {
				return true;
			}
		}
		return false;
	};

/**
 * Utility function for retrieving the text value of an array of DOM nodes
 * @param {Array|Element} elem
 */
var getText = Sizzle.getText = function( elem ) {
	var node,
		ret = "",
		i = 0,
		nodeType = elem.nodeType;

	if ( nodeType ) {
		if ( nodeType === 1 || nodeType === 9 || nodeType === 11 ) {
			// Use textContent for elements
			// innerText usage removed for consistency of new lines (see #11153)
			if ( typeof elem.textContent === "string" ) {
				return elem.textContent;
			} else {
				// Traverse its children
				for ( elem = elem.firstChild; elem; elem = elem.nextSibling ) {
					ret += getText( elem );
				}
			}
		} else if ( nodeType === 3 || nodeType === 4 ) {
			return elem.nodeValue;
		}
		// Do not include comment or processing instruction nodes
	} else {

		// If no nodeType, this is expected to be an array
		for ( ; (node = elem[i]); i++ ) {
			// Do not traverse comment nodes
			ret += getText( node );
		}
	}
	return ret;
};

Sizzle.attr = function( elem, name ) {
	var attr,
		xml = isXML( elem );

	if ( !xml ) {
		name = name.toLowerCase();
	}
	if ( Expr.attrHandle[ name ] ) {
		return Expr.attrHandle[ name ]( elem );
	}
	if ( assertAttributes || xml ) {
		return elem.getAttribute( name );
	}
	attr = elem.getAttributeNode( name );
	return attr ?
		typeof elem[ name ] === "boolean" ?
			elem[ name ] ? name : null :
			attr.specified ? attr.value : null :
		null;
};

Sizzle.error = function( msg ) {
	throw new Error( "Syntax error, unrecognized expression: " + msg );
};

// Check if the JavaScript engine is using some sort of
// optimization where it does not always call our comparision
// function. If that is the case, discard the hasDuplicate value.
//   Thus far that includes Google Chrome.
[0, 0].sort(function() {
	return (baseHasDuplicate = 0);
});


if ( docElem.compareDocumentPosition ) {
	sortOrder = function( a, b ) {
		if ( a === b ) {
			hasDuplicate = true;
			return 0;
		}

		return ( !a.compareDocumentPosition || !b.compareDocumentPosition ?
			a.compareDocumentPosition :
			a.compareDocumentPosition(b) & 4
		) ? -1 : 1;
	};

} else {
	sortOrder = function( a, b ) {
		// The nodes are identical, we can exit early
		if ( a === b ) {
			hasDuplicate = true;
			return 0;

		// Fallback to using sourceIndex (in IE) if it's available on both nodes
		} else if ( a.sourceIndex && b.sourceIndex ) {
			return a.sourceIndex - b.sourceIndex;
		}

		var al, bl,
			ap = [],
			bp = [],
			aup = a.parentNode,
			bup = b.parentNode,
			cur = aup;

		// If the nodes are siblings (or identical) we can do a quick check
		if ( aup === bup ) {
			return siblingCheck( a, b );

		// If no parents were found then the nodes are disconnected
		} else if ( !aup ) {
			return -1;

		} else if ( !bup ) {
			return 1;
		}

		// Otherwise they're somewhere else in the tree so we need
		// to build up a full list of the parentNodes for comparison
		while ( cur ) {
			ap.unshift( cur );
			cur = cur.parentNode;
		}

		cur = bup;

		while ( cur ) {
			bp.unshift( cur );
			cur = cur.parentNode;
		}

		al = ap.length;
		bl = bp.length;

		// Start walking down the tree looking for a discrepancy
		for ( var i = 0; i < al && i < bl; i++ ) {
			if ( ap[i] !== bp[i] ) {
				return siblingCheck( ap[i], bp[i] );
			}
		}

		// We ended someplace up the tree so do a sibling check
		return i === al ?
			siblingCheck( a, bp[i], -1 ) :
			siblingCheck( ap[i], b, 1 );
	};

	siblingCheck = function( a, b, ret ) {
		if ( a === b ) {
			return ret;
		}

		var cur = a.nextSibling;

		while ( cur ) {
			if ( cur === b ) {
				return -1;
			}

			cur = cur.nextSibling;
		}

		return 1;
	};
}

// Document sorting and removing duplicates
Sizzle.uniqueSort = function( results ) {
	var elem,
		i = 1;

	if ( sortOrder ) {
		hasDuplicate = baseHasDuplicate;
		results.sort( sortOrder );

		if ( hasDuplicate ) {
			for ( ; (elem = results[i]); i++ ) {
				if ( elem === results[ i - 1 ] ) {
					results.splice( i--, 1 );
				}
			}
		}
	}

	return results;
};

function multipleContexts( selector, contexts, results, seed ) {
	var i = 0,
		len = contexts.length;
	for ( ; i < len; i++ ) {
		Sizzle( selector, contexts[i], results, seed );
	}
}

function handlePOSGroup( selector, posfilter, argument, contexts, seed, not ) {
	var results,
		fn = Expr.setFilters[ posfilter.toLowerCase() ];

	if ( !fn ) {
		Sizzle.error( posfilter );
	}

	if ( selector || !(results = seed) ) {
		multipleContexts( selector || "*", contexts, (results = []), seed );
	}

	return results.length > 0 ? fn( results, argument, not ) : [];
}

function handlePOS( selector, context, results, seed, groups ) {
	var match, not, anchor, ret, elements, currentContexts, part, lastIndex,
		i = 0,
		len = groups.length,
		rpos = matchExpr["POS"],
		// This is generated here in case matchExpr["POS"] is extended
		rposgroups = new RegExp( "^" + rpos.source + "(?!" + whitespace + ")", "i" ),
		// This is for making sure non-participating
		// matching groups are represented cross-browser (IE6-8)
		setUndefined = function() {
			var i = 1,
				len = arguments.length - 2;
			for ( ; i < len; i++ ) {
				if ( arguments[i] === undefined ) {
					match[i] = undefined;
				}
			}
		};

	for ( ; i < len; i++ ) {
		// Reset regex index to 0
		rpos.exec("");
		selector = groups[i];
		ret = [];
		anchor = 0;
		elements = seed;
		while ( (match = rpos.exec( selector )) ) {
			lastIndex = rpos.lastIndex = match.index + match[0].length;
			if ( lastIndex > anchor ) {
				part = selector.slice( anchor, match.index );
				anchor = lastIndex;
				currentContexts = [ context ];

				if ( rcombinators.test(part) ) {
					if ( elements ) {
						currentContexts = elements;
					}
					elements = seed;
				}

				if ( (not = rendsWithNot.test( part )) ) {
					part = part.slice( 0, -5 ).replace( rcombinators, "$&*" );
				}

				if ( match.length > 1 ) {
					match[0].replace( rposgroups, setUndefined );
				}
				elements = handlePOSGroup( part, match[1], match[2], currentContexts, elements, not );
			}
		}

		if ( elements ) {
			ret = ret.concat( elements );

			if ( (part = selector.slice( anchor )) && part !== ")" ) {
				multipleContexts( part, ret, results, seed );
			} else {
				push.apply( results, ret );
			}
		} else {
			Sizzle( selector, context, results, seed );
		}
	}

	// Do not sort if this is a single filter
	return len === 1 ? results : Sizzle.uniqueSort( results );
}

function tokenize( selector, context, xml ) {
	var tokens, soFar, type,
		groups = [],
		i = 0,

		// Catch obvious selector issues: terminal ")"; nonempty fallback match
		// rselector never fails to match *something*
		match = rselector.exec( selector ),
		matched = !match.pop() && !match.pop(),
		selectorGroups = matched && selector.match( rgroups ) || [""],

		preFilters = Expr.preFilter,
		filters = Expr.filter,
		checkContext = !xml && context !== document;

	for ( ; (soFar = selectorGroups[i]) != null && matched; i++ ) {
		groups.push( tokens = [] );

		// Need to make sure we're within a narrower context if necessary
		// Adding a descendant combinator will generate what is needed
		if ( checkContext ) {
			soFar = " " + soFar;
		}

		while ( soFar ) {
			matched = false;

			// Combinators
			if ( (match = rcombinators.exec( soFar )) ) {
				soFar = soFar.slice( match[0].length );

				// Cast descendant combinators to space
				matched = tokens.push({ part: match.pop().replace( rtrim, " " ), captures: match });
			}

			// Filters
			for ( type in filters ) {
				if ( (match = matchExpr[ type ].exec( soFar )) && (!preFilters[ type ] ||
					(match = preFilters[ type ]( match, context, xml )) ) ) {

					soFar = soFar.slice( match.shift().length );
					matched = tokens.push({ part: type, captures: match });
				}
			}

			if ( !matched ) {
				break;
			}
		}
	}

	if ( !matched ) {
		Sizzle.error( selector );
	}

	return groups;
}

function addCombinator( matcher, combinator, context ) {
	var dir = combinator.dir,
		doneName = done++;

	if ( !matcher ) {
		// If there is no matcher to check, check against the context
		matcher = function( elem ) {
			return elem === context;
		};
	}
	return combinator.first ?
		function( elem, context ) {
			while ( (elem = elem[ dir ]) ) {
				if ( elem.nodeType === 1 ) {
					return matcher( elem, context ) && elem;
				}
			}
		} :
		function( elem, context ) {
			var cache,
				dirkey = doneName + "." + dirruns,
				cachedkey = dirkey + "." + cachedruns;
			while ( (elem = elem[ dir ]) ) {
				if ( elem.nodeType === 1 ) {
					if ( (cache = elem[ expando ]) === cachedkey ) {
						return false;
					} else if ( typeof cache === "string" && cache.indexOf(dirkey) === 0 ) {
						if ( elem.sizset ) {
							return elem;
						}
					} else {
						elem[ expando ] = cachedkey;
						if ( matcher( elem, context ) ) {
							elem.sizset = true;
							return elem;
						}
						elem.sizset = false;
					}
				}
			}
		};
}

function addMatcher( higher, deeper ) {
	return higher ?
		function( elem, context ) {
			var result = deeper( elem, context );
			return result && higher( result === true ? elem : result, context );
		} :
		deeper;
}

// ["TAG", ">", "ID", " ", "CLASS"]
function matcherFromTokens( tokens, context, xml ) {
	var token, matcher,
		i = 0;

	for ( ; (token = tokens[i]); i++ ) {
		if ( Expr.relative[ token.part ] ) {
			matcher = addCombinator( matcher, Expr.relative[ token.part ], context );
		} else {
			token.captures.push( context, xml );
			matcher = addMatcher( matcher, Expr.filter[ token.part ].apply( null, token.captures ) );
		}
	}

	return matcher;
}

function matcherFromGroupMatchers( matchers ) {
	return function( elem, context ) {
		var matcher,
			j = 0;
		for ( ; (matcher = matchers[j]); j++ ) {
			if ( matcher(elem, context) ) {
				return true;
			}
		}
		return false;
	};
}

var compile = Sizzle.compile = function( selector, context, xml ) {
	var tokens, group, i,
		cached = compilerCache[ selector ];

	// Return a cached group function if already generated (context dependent)
	if ( cached && cached.context === context ) {
		cached.dirruns++;
		return cached;
	}

	// Generate a function of recursive functions that can be used to check each element
	group = tokenize( selector, context, xml );
	for ( i = 0; (tokens = group[i]); i++ ) {
		group[i] = matcherFromTokens( tokens, context, xml );
	}

	// Cache the compiled function
	cached = compilerCache[ selector ] = matcherFromGroupMatchers( group );
	cached.context = context;
	cached.runs = cached.dirruns = 0;
	cachedSelectors.push( selector );
	// Ensure only the most recent are cached
	if ( cachedSelectors.length > Expr.cacheLength ) {
		delete compilerCache[ cachedSelectors.shift() ];
	}
	return cached;
};

Sizzle.matches = function( expr, elements ) {
	return Sizzle( expr, null, null, elements );
};

Sizzle.matchesSelector = function( elem, expr ) {
	return Sizzle( expr, null, null, [ elem ] ).length > 0;
};

var select = function( selector, context, results, seed, xml ) {
	// Remove excessive whitespace
	selector = selector.replace( rtrim, "$1" );
	var elements, matcher, i, len, elem, token,
		type, findContext, notTokens,
		match = selector.match( rgroups ),
		tokens = selector.match( rtokens ),
		contextNodeType = context.nodeType;

	// POS handling
	if ( matchExpr["POS"].test(selector) ) {
		return handlePOS( selector, context, results, seed, match );
	}

	if ( seed ) {
		elements = slice.call( seed, 0 );

	// To maintain document order, only narrow the
	// set if there is one group
	} else if ( match && match.length === 1 ) {

		// Take a shortcut and set the context if the root selector is an ID
		if ( tokens.length > 1 && contextNodeType === 9 && !xml &&
				(match = matchExpr["ID"].exec( tokens[0] )) ) {

			context = Expr.find["ID"]( match[1], context, xml )[0];
			if ( !context ) {
				return results;
			}

			selector = selector.slice( tokens.shift().length );
		}

		findContext = ( (match = rsibling.exec( tokens[0] )) && !match.index && context.parentNode ) || context;

		// Get the last token, excluding :not
		notTokens = tokens.pop();
		token = notTokens.split(":not")[0];

		for ( i = 0, len = Expr.order.length; i < len; i++ ) {
			type = Expr.order[i];

			if ( (match = matchExpr[ type ].exec( token )) ) {
				elements = Expr.find[ type ]( (match[1] || "").replace( rbackslash, "" ), findContext, xml );

				if ( elements == null ) {
					continue;
				}

				if ( token === notTokens ) {
					selector = selector.slice( 0, selector.length - notTokens.length ) +
						token.replace( matchExpr[ type ], "" );

					if ( !selector ) {
						push.apply( results, slice.call(elements, 0) );
					}
				}
				break;
			}
		}
	}

	// Only loop over the given elements once
	// If selector is empty, we're already done
	if ( selector ) {
		matcher = compile( selector, context, xml );
		dirruns = matcher.dirruns;

		if ( elements == null ) {
			elements = Expr.find["TAG"]( "*", (rsibling.test( selector ) && context.parentNode) || context );
		}
		for ( i = 0; (elem = elements[i]); i++ ) {
			cachedruns = matcher.runs++;
			if ( matcher(elem, context) ) {
				results.push( elem );
			}
		}
	}

	return results;
};

if ( document.querySelectorAll ) {
	(function() {
		var disconnectedMatch,
			oldSelect = select,
			rescape = /'|\\/g,
			rattributeQuotes = /\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,
			rbuggyQSA = [],
			// matchesSelector(:active) reports false when true (IE9/Opera 11.5)
			// A support test would require too much code (would include document ready)
			// just skip matchesSelector for :active
			rbuggyMatches = [":active"],
			matches = docElem.matchesSelector ||
				docElem.mozMatchesSelector ||
				docElem.webkitMatchesSelector ||
				docElem.oMatchesSelector ||
				docElem.msMatchesSelector;

		// Build QSA regex
		// Regex strategy adopted from Diego Perini
		assert(function( div ) {
			div.innerHTML = "<select><option selected></option></select>";

			// IE8 - Some boolean attributes are not treated correctly
			if ( !div.querySelectorAll("[selected]").length ) {
				rbuggyQSA.push( "\\[" + whitespace + "*(?:checked|disabled|ismap|multiple|readonly|selected|value)" );
			}

			// Webkit/Opera - :checked should return selected option elements
			// http://www.w3.org/TR/2011/REC-css3-selectors-20110929/#checked
			// IE8 throws error here (do not put tests after this one)
			if ( !div.querySelectorAll(":checked").length ) {
				rbuggyQSA.push(":checked");
			}
		});

		assert(function( div ) {

			// Opera 10-12/IE9 - ^= $= *= and empty values
			// Should not select anything
			div.innerHTML = "<p test=''></p>";
			if ( div.querySelectorAll("[test^='']").length ) {
				rbuggyQSA.push( "[*^$]=" + whitespace + "*(?:\"\"|'')" );
			}

			// FF 3.5 - :enabled/:disabled and hidden elements (hidden elements are still enabled)
			// IE8 throws error here (do not put tests after this one)
			div.innerHTML = "<input type='hidden'>";
			if ( !div.querySelectorAll(":enabled").length ) {
				rbuggyQSA.push(":enabled", ":disabled");
			}
		});

		rbuggyQSA = rbuggyQSA.length && new RegExp( rbuggyQSA.join("|") );

		select = function( selector, context, results, seed, xml ) {
			// Only use querySelectorAll when not filtering,
			// when this is not xml,
			// and when no QSA bugs apply
			if ( !seed && !xml && (!rbuggyQSA || !rbuggyQSA.test( selector )) ) {
				if ( context.nodeType === 9 ) {
					try {
						push.apply( results, slice.call(context.querySelectorAll( selector ), 0) );
						return results;
					} catch(qsaError) {}
				// qSA works strangely on Element-rooted queries
				// We can work around this by specifying an extra ID on the root
				// and working up from there (Thanks to Andrew Dupont for the technique)
				// IE 8 doesn't work on object elements
				} else if ( context.nodeType === 1 && context.nodeName.toLowerCase() !== "object" ) {
					var old = context.getAttribute("id"),
						nid = old || expando,
						newContext = rsibling.test( selector ) && context.parentNode || context;

					if ( old ) {
						nid = nid.replace( rescape, "\\$&" );
					} else {
						context.setAttribute( "id", nid );
					}

					try {
						push.apply( results, slice.call( newContext.querySelectorAll(
							selector.replace( rgroups, "[id='" + nid + "'] $&" )
						), 0 ) );
						return results;
					} catch(qsaError) {
					} finally {
						if ( !old ) {
							context.removeAttribute("id");
						}
					}
				}
			}

			return oldSelect( selector, context, results, seed, xml );
		};

		if ( matches ) {
			assert(function( div ) {
				// Check to see if it's possible to do matchesSelector
				// on a disconnected node (IE 9)
				disconnectedMatch = matches.call( div, "div" );

				// This should fail with an exception
				// Gecko does not error, returns false instead
				try {
					matches.call( div, "[test!='']:sizzle" );
					rbuggyMatches.push( Expr.match.PSEUDO );
				} catch ( e ) {}
			});

			// rbuggyMatches always contains :active, so no need for a length check
			rbuggyMatches = /* rbuggyMatches.length && */ new RegExp( rbuggyMatches.join("|") );

			Sizzle.matchesSelector = function( elem, expr ) {
				// Make sure that attribute selectors are quoted
				expr = expr.replace( rattributeQuotes, "='$1']" );

				// rbuggyMatches always contains :active, so no need for an existence check
				if ( !isXML( elem ) && !rbuggyMatches.test( expr ) && (!rbuggyQSA || !rbuggyQSA.test( expr )) ) {
					try {
						var ret = matches.call( elem, expr );

						// IE 9's matchesSelector returns false on disconnected nodes
						if ( ret || disconnectedMatch ||
								// As well, disconnected nodes are said to be in a document
								// fragment in IE 9
								elem.document && elem.document.nodeType !== 11 ) {
							return ret;
						}
					} catch(e) {}
				}

				return Sizzle( expr, null, null, [ elem ] ).length > 0;
			};
		}
	})();
}

// EXPOSE

if (typeof module === 'object' && module.exports) {
    module.exports = Sizzle;
} else {
	window.Sizzle = Sizzle;
}
// EXPOSE

})( window );

},{}],49:[function(require,module,exports){
'use strict';

var BrowserData = require('./ac-browser/BrowserData');
var webkitRegExp = /applewebkit/i;
var IE = require('./ac-browser/IE');

/**
 * Reports information about the user's browser and device
 * based on the userAgent string and feature detection.
 * @reference http://www.quirksmode.org/js/detect.html
 * @name module:ac-browser
 * @kind namespace
 */
var browser = BrowserData.create();

/**
 * Returns true/false whether the browser is WebKit based
 * @param  {String}  userAgentString
 * @return {Boolean}
 * @name module:ac-browser.isWebKit
 * @kind function
 */
browser.isWebKit = function(userAgentString) {
	var userAgent = userAgentString || window.navigator.userAgent;
	return userAgent ? !! webkitRegExp.test(userAgent) : false;
};

/**
 * @type {String}
 * @name module:ac-browser.lowerCaseUserAgent
 */
browser.lowerCaseUserAgent = navigator.userAgent.toLowerCase();

if (browser.name === 'IE') {
	/**
	 * Only available in Internet Explorer
	 * @name module:ac-browser.IE
	 * @kind namespace
	 */
	browser.IE = {
		/**
		 * The emulated Internet Explorer version, which may not match actual version
		 * @name module:ac-browser.IE.documentMode
		 * @type {Number}
		 */
		documentMode: IE.getDocumentMode()
	};
}

module.exports = browser;

},{"./ac-browser/BrowserData":50,"./ac-browser/IE":51}],50:[function(require,module,exports){
'use strict';

var _data = require('./data');

function BrowserData() { }

BrowserData.prototype = {
	/**
	 * Parses string (such as userAgent) and returns the browser version
	 * @param  {String} stringToSearch
	 * @return {Number}
	 */
	__getBrowserVersion: function(stringToSearch, identity) {
		var version;

		if (!stringToSearch || !identity) {
			return;
		}

		// Filters data.browser for the members with identities equal to identity
		var filteredData = _data.browser.filter(function(item) {
			return item.identity === identity;
		});

		filteredData.some(function (item) {
			var versionSearchString = item.versionSearch || identity;
			var index = stringToSearch.indexOf(versionSearchString);

			if (index > -1) {
				version = parseFloat(stringToSearch.substring(index + versionSearchString.length + 1));
				return true;
			}
		});

		return version;
	},

	/**
	 * Alias for __getIdentityStringFromArray
	 * @param  {Array} browserData | Expects data.browser
	 * @return {String}
	 */
	__getName: function(dataBrowser) {
		return this.__getIdentityStringFromArray(dataBrowser);
	},

	/**
	 * Expects single member of data.browser or data.os
	 * and returns a string to be used in os or name.
	 * @param  {Object} item
	 * @return {String}
	 */
	__getIdentity: function(item) {
		if (item.string) {
			return this.__matchSubString(item);
		} else if (item.prop) {
			return item.identity;
		}
	},

	/**
	 * Iterates through data.browser or data.os returning the correct
	 * browser or os identity
	 * @param  {Array} dataArray
	 * @return {String}
	 */
	__getIdentityStringFromArray: function(dataArray) {
		for (var i = 0, l = dataArray.length, identity; i < l; i++) {
			identity = this.__getIdentity(dataArray[i]);
			if (identity) {
				return identity;
			}
		}
	},

	/**
	 * Alias for __getIdentityStringFromArray
	 * @param  {Array} OSData | Expects data.os
	 * @return {String}
	 */
	__getOS: function(dataOS) {
		return this.__getIdentityStringFromArray(dataOS);
	},

	/**
	 * Parses string (such as userAgent) and returns the operating system version
	 * @param {String} stringToSearch
	 * @param {String} osIdentity
	 * @return {String|Number} int if not a decimal delimited version
	 */
	__getOSVersion: function(stringToSearch, osIdentity) {

		if (!stringToSearch || !osIdentity) {
			return;
		}

		// Filters data.os returning the member with an identity equal to osIdentity
		var filteredData = _data.os.filter(function(item) {
			return item.identity === osIdentity;
		})[0];

		var versionSearchString = filteredData.versionSearch || osIdentity;
		var regex = new RegExp(versionSearchString + ' ([\\d_\\.]+)', 'i');
		var version = stringToSearch.match(regex);

		if (version !== null) {
			return version[1].replace(/_/g, '.');
		}
	},

	/**
	 * Regular expression and indexOf against item.string using item.subString as the pattern
	 * @param  {Object} item
	 * @return {String}
	 */
	__matchSubString: function(item) {
		var subString = item.subString;
		if (subString) {
			var matches = subString.test ? !!subString.test(item.string) : item.string.indexOf(subString) > -1;
			if (matches) {
				return item.identity;
			}
		}
	}
};

BrowserData.create = function () {
	var instance = new BrowserData();
	var out = {};
	/**
	 * @type {String}
	 * @name module:ac-browser.name
	 */
	out.name      = instance.__getName(_data.browser);
	/**
	 * @type {String}
	 * @name module:ac-browser.version
	 */
	out.version   = instance.__getBrowserVersion(_data.versionString, out.name);
	/**
	 * @type {String}
	 * @name module:ac-browser.os
	 */
	out.os        = instance.__getOS(_data.os);
	/**
	 * @type {String}
	 * @name module:ac-browser.osVersion
	 */
	out.osVersion = instance.__getOSVersion(_data.versionString, out.os);
	return out;
};

module.exports = BrowserData;

},{"./data":52}],51:[function(require,module,exports){
'use strict';

module.exports = {
	/**
	 * Detect what version or document/standards mode IE is rendering the page as.
	 * Accounts for later versions of IE rendering pages in earlier standards modes. E.G. it is
	 * possible to set the X-UA-Compatible tag to tell IE9 to render pages in IE7 standards mode.//
	 * Based on Microsoft test
	 * @see http://msdn.microsoft.com/en-us/library/jj676915(v=vs.85).aspx
	 */
	getDocumentMode: function () {
		var ie;

		// IE8 or later
		if (document.documentMode) {
			ie = parseInt(document.documentMode, 10);
		// IE 5-7
		} else {
			// Assume quirks mode unless proven otherwise
			ie = 5;
			if (document.compatMode) {
				// standards mode
				if (document.compatMode === "CSS1Compat") {
					ie = 7;
				}
			}
			// There is no test for IE6 standards mode because that mode
			// was replaced by IE7 standards mode; there is no emulation.
		}
		return ie;
	}
};

},{}],52:[function(require,module,exports){
arguments[4][22][0].apply(exports,arguments)
},{"dup":22}],53:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var classNameAdd = require('./className/add');

/**
 * @name module:ac-classlist.add
 *
 * @function
 *
 * @desc Adds one or more tokens to an Element's classList.
 *       Accounts for browsers without classList support.
 *
 * @param {Element} el
 *        The target Element
 *
 * @param {...String} token
 *        One or more classes to be added
 */
module.exports = function add() {
	var tokens = Array.prototype.slice.call(arguments);
	var el = tokens.shift(tokens);

	if (el.classList && el.classList.add) {
		el.classList.add.apply(el.classList, tokens);
	} else {
		tokens.forEach(classNameAdd.bind(this, el));
	}
};

},{"./className/add":55}],54:[function(require,module,exports){
/**
 * @module ac-classlist/className
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

module.exports = {
	add: require('./className/add'),
	contains: require('./className/contains'),
	remove: require('./className/remove')
};

},{"./className/add":55,"./className/contains":56,"./className/remove":58}],55:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var classNameContains = require('./contains');

/**
 * @name module:ac-classlist/className.add
 *
 * @function
 *
 * @desc Adds a token to an Element's className
 *
 * @param {Element} el
 *        The target Element
 *
 * @param {String} token
 *        The class to be added
 */
module.exports = function add(el, token) {
	if (!classNameContains(el, token)) {
		el.className += ' ' + token;
	}
};

},{"./contains":56}],56:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var getTokenRegExp = require('./getTokenRegExp');

/**
 * @name module:ac-classlist/className.contains
 *
 * @function
 *
 * @desc Checks if an Element's className contains a specific token
 *
 * @param {Element} el
 *        The target Element
 *
 * @param {String} token
 *        The token to be checked
 *
 * @returns {Boolean} `true` if className contains token, otherwise `false`
 */
module.exports = function classNameAdd(el, token) {
	return getTokenRegExp(token).test(el.className);
};


},{"./getTokenRegExp":57}],57:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name getTokenRegExp
 * @memberOf module:ac-classlist/className
 *
 * @function
 * @private
 *
 * @desc Creates a RegExp that matches the token within a className.
 *
 * @returns {RegExp}
 */
module.exports = function getTokenRegExp(token) {
	return new RegExp('(\\s|^)' + token + '(\\s|$)');
};

},{}],58:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var classNameContains = require('./contains');
var getTokenRegExp = require('./getTokenRegExp');

/**
 * @name module:ac-classlist/className.remove
 *
 * @function
 *
 * @desc Removes a token from an Element's className
 *
 * @param {Element} el
 *        The target Element
 *
 * @param {String} token
 *        The class to be removed
 */
module.exports = function remove(el, token) {
	if (classNameContains(el, token)) {
		el.className = el.className.replace(getTokenRegExp(token), '$1').trim();
	}
};


},{"./contains":56,"./getTokenRegExp":57}],59:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var classNameContains = require('./className/contains');

/**
 * @name module:ac-classlist.contains
 *
 * @function
 *
 * @desc Checks if an Element's classList contains a specific token.
 *       Accounts for browsers without classList support.
 *
 * @param {Element} el
 *        The target Element
 *
 * @param {String} token
 *        The token to be checked
 *
 * @returns {Boolean} `true` if classList contains token, otherwise `false`
 */
module.exports = function contains(el, token) {
	if (el.classList && el.classList.contains) {
		return el.classList.contains(token);
	}

	return classNameContains(el, token);
};

},{"./className/contains":56}],60:[function(require,module,exports){
/**
 * @module ac-classlist
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

module.exports = {
	add: require('./add'),
	contains: require('./contains'),
	remove: require('./remove'),
	toggle: require('./toggle')
};

},{"./add":53,"./contains":59,"./remove":61,"./toggle":62}],61:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var classNameRemove = require('./className/remove');

/**
 * @name module:ac-classlist.remove
 *
 * @function
 *
 * @desc Remove one or more tokens from an Element's classList.
 *       Accounts for browsers without classList support.
 *
 * @param {Element} el
 *        The target Element
 *
 * @param {...String} token
 *        One or more classes to be removed
 */
module.exports = function remove() {
	var tokens = Array.prototype.slice.call(arguments);
	var el = tokens.shift(tokens);

	if (el.classList && el.classList.remove) {
		el.classList.remove.apply(el.classList, tokens);
	} else {
		tokens.forEach(classNameRemove.bind(this, el));
	}
};

},{"./className/remove":58}],62:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var className = require('./className');

/**
 * @name module:ac-classlist.toggle
 *
 * @function
 *
 * @desc Toggles a token in an Element's classList.
 *       Accounts for browsers without classList support.
 *
 * @param {Element} el
 *        The target Element
 *
 * @param {String} token
 *        The token to be toggled
 *
 * @param {Boolean} [force]
 *        Optionally forces add with `true` and remove with `false`
 *
 * @returns {Boolean} `true` if classList contains token after the toggle, otherwise `false`
 */
module.exports = function toggle(el, token, force) {
	var hasForce = (typeof force !== 'undefined');
	var addToken;

	if (el.classList && el.classList.toggle) {
		if (hasForce) {
			return el.classList.toggle(token, force);
		}

		return el.classList.toggle(token);
	}

	if (hasForce) {
		addToken = !!force;
	} else {
		addToken = !className.contains(el, token);
	}

	if (addToken) {
		className.add(el, token);
	} else {
		className.remove(el, token);
	}

	return addToken;
};

},{"./className":54}],63:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var addEventListenerUtil = require('./utils/addEventListener');
var getEventType = require('./shared/getEventType');

/**
 * @name module:ac-dom-events.addEventListener
 *
 * @function
 *
 * @desc Register the specified listener on a target.
 *       Automatically handles vendor prefixed and camel-cased event types.
 *
 * @param {Object} target
 *        The event target to listen to.
 *        Usually an Element, document, or window.
 *
 * @param {String} type
 *        A lowercase string representing the event type.
 *        e.g., "click", "transitionend"
 *
 * @param {Function} listener
 *        A Function to be called when the event type is triggered.
 *
 * @param {Boolean} [useCapture=false]
 *        `true` listens for the event in the capture phase.
 *        `false` (default) listens for the event in the bubbling phases.
 *        IE < 9 does not support useCapture
 *
 * @returns {Object} target
 */
module.exports = function addEventListener(target, type, listener, useCapture) {
	type = getEventType(target, type);
	return addEventListenerUtil(target, type, listener, useCapture);
};

},{"./shared/getEventType":72,"./utils/addEventListener":76}],64:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var dispatchEventUtil = require('./utils/dispatchEvent');
var getEventType = require('./shared/getEventType');

/**
 * @name module:ac-dom-events.dispatchEvent
 *
 * @function
 *
 * @desc Creates and dispatches an Event on a target.
 *
 * @param {Object} target
 *        The event target.
 *        Usually an Element, document, or window.
 *
 * @param {String} type
 *        A lowercase string representing the event type to dispatch.
 *        Automatically handles vendor prefixed and camel-cased event types.
 *
 * @param {Object} [options]
 *
 * @param {Boolean} [options.bubbles=false]
 *        Whether or not the event bubbles up through the DOM.
 *        IE < 9 ignores this options, using the `true` behavior.
 *
 * @param {Boolean} [options.cancelable=false]
 *        Whether or not the event can be cancelled.
 *        IE < 9 ignores this options, using the `false` behavior.
 *
 * @param {*} [options.detail]
 *        The data passed to event listeners.
 *
 * @returns {Object} target
 */
module.exports = function dispatchEvent(target, type, options) {
	type = getEventType(target, type);
	return dispatchEventUtil(target, type, options);
};

},{"./shared/getEventType":72,"./utils/dispatchEvent":77}],65:[function(require,module,exports){
/**
 * Helper methods for handling DOM events with cross-browser compatibility.
 * @module ac-dom-events
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

module.exports = {
	addEventListener: require('./addEventListener'),
	dispatchEvent: require('./dispatchEvent'),
	preventDefault: require('./preventDefault'),
	removeEventListener: require('./removeEventListener'),
	stop: require('./stop'),
	stopPropagation: require('./stopPropagation'),
	target: require('./target')
};

},{"./addEventListener":63,"./dispatchEvent":64,"./preventDefault":70,"./removeEventListener":71,"./stop":73,"./stopPropagation":74,"./target":75}],66:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var eventTypeAvailable = require('./utils/eventTypeAvailable');
var camelCasedEventTypes = require('./shared/camelCasedEventTypes');
var prefixHelper = require('./shared/prefixHelper');
var cache = {};

/**
 * @name module:ac-prefixer.getEventType
 *
 * @function
 *
 * @desc Get an Event type with appropriate vendor prefix and casing.
 *
 * @param {String} type
 *        A lowercase string representing the Event type.
 *        e.g., "click", "transitionend"
 *
 * @param {String} [tagName="div"]
 *        The Element tag name to test, or "window", or "document"
 *        e.g., "div", "video", "input"
 *
 * @returns {String|Boolean} The properly prefixed Event type, or `false` if not available.
 */
module.exports = function getEventType(type, tagName) {
	var prefixedType;
	var tagNameCache;
	var i;

	tagName = tagName || 'div';

	type = type.toLowerCase();

	// prepare cache
	if (!(tagName in cache)) {
		cache[tagName] = {};
	}

	tagNameCache = cache[tagName];

	// memoized?
	if (type in tagNameCache) {
		return tagNameCache[type];
	}

	// unprefixed?
	if (eventTypeAvailable(type, tagName)) {
		return tagNameCache[type] = type;
	}

	// camelCased vendor prefix?
	if (type in camelCasedEventTypes) {
		for (i = 0; i < camelCasedEventTypes[type].length; i++) {
			prefixedType = camelCasedEventTypes[type][i];
			if (eventTypeAvailable(prefixedType.toLowerCase(), tagName)) {
				return tagNameCache[type] = prefixedType;
			}
		}
	}

	// lowercase vendor prefix?
	for (i = 0; i < prefixHelper.evt.length; i++) {
		prefixedType = prefixHelper.evt[i] + type;
		if (eventTypeAvailable(prefixedType, tagName)) {
			prefixHelper.reduce(i);
			return tagNameCache[type] = prefixedType;
		}
	}

	// invalid event type
	return tagNameCache[type] = false;
};

},{"./shared/camelCasedEventTypes":67,"./shared/prefixHelper":68,"./utils/eventTypeAvailable":69}],67:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
module.exports = {
	transitionend: [
		'webkitTransitionEnd',
		'MSTransitionEnd'
	],
	animationstart: [
		'webkitAnimationStart',
		'MSAnimationStart'
	],
	animationend: [
		'webkitAnimationEnd',
		'MSAnimationEnd'
	],
	animationiteration: [
		'webkitAnimationIteration',
		'MSAnimationIteration'
	],
	fullscreenchange: [
		'MSFullscreenChange'
	],
	fullscreenerror: [
		'MSFullscreenError'
	]
};

},{}],68:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

var CSS_PREFIXES = ['-webkit-', '-moz-', '-ms-'];
var DOM_PREFIXES = ['Webkit', 'Moz', 'ms'];
var EVT_PREFIXES = ['webkit', 'moz', 'ms'];

var PrefixeHelper = function () {
	this.initialize();
};

var proto = PrefixeHelper.prototype;

proto.initialize = function () {
	this.reduced = false;
	this.css = CSS_PREFIXES;
	this.dom = DOM_PREFIXES;
	this.evt = EVT_PREFIXES;
};

proto.reduce = function (index) {
	if (!this.reduced) {
		this.reduced = true;
		this.css = [this.css[index]];
		this.dom = [this.dom[index]];
		this.evt = [this.evt[index]];
	}
};

module.exports = new PrefixeHelper();

},{}],69:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var testElements = {
	'window': window,
	'document': document
};

/**
 * @name eventTypeAvailable
 * @memberOf module:ac-prefixer/utils
 *
 * @function
 *
 * @desc Check if an Event type is available.
 *
 * @param {String} type
 *        A DOM-style string representing the Event type.
 *        e.g., "click", "transitionend", "webkittransitionend"
 *
 * @param {String} tagName
 *        The Element tag name to test, or "window", or "document"
 *        e.g., "div", "video", "input"
 *
 * @returns {Boolean} `true` if the Event type is available, otherwise `false`
 */
module.exports = function eventTypeAvailable(type, tagName) {
	var el;

	type = 'on' + type;

	if (!(tagName in testElements)) {
		testElements[tagName] = document.createElement(tagName);
	}

	el = testElements[tagName];

	// easy check first
	if (type in el) {
		return true;
	}

	// more robust check
	if ('setAttribute' in el) {
		el.setAttribute(type, 'return;');
		return (typeof el[type] === 'function');
	}

	// not available by default
	return false;
};

},{}],70:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name module:ac-dom-events.preventDefault
 *
 * @function
 *
 * @desc Cancels the event if it is cancelable.
 *
 * @param {Event} evt
 */
module.exports = function preventDefault(evt) {
	evt = evt || window.event;

	if (evt.preventDefault) {
		evt.preventDefault();
	} else {
		evt.returnValue = false;
	}
};

},{}],71:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var removeEventListenerUtil = require('./utils/removeEventListener');
var getEventType = require('./shared/getEventType');

/**
 * @name module:ac-dom-events.removeEventListener
 *
 * @function
 *
 * @desc Removes a previously added event listener.
 *       Automatically handles vendor prefixed and camel-cased event types.
 *
 * @param {Object} target
 *        The event target.
 *        Usually an Element, document, or window.
 *
 * @param {String} type
 *        A lowercase string representing the event type.
 *        e.g., "click", "transitionend"
 *
 * @param {Function} listener
 *        The listener Function to be removed.
 *
 * @param {Boolean} [useCapture=false]
 *        `true` for the a listener on the capture phase.
 *        `false` (default) for a listener on the bubbling phases.
 *
 * @returns {Object} target
 */
module.exports = function removeEventListener(target, type, listener, useCapture) {
	type = getEventType(target, type);
	return removeEventListenerUtil(target, type, listener, useCapture);
};

},{"./shared/getEventType":72,"./utils/removeEventListener":78}],72:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var getPrefixedEventType = require('ac-prefixer/getEventType');

/**
 * @name getEventType
 * @memberOf module:ac-dom-events/shared
 *
 * @function
 * @private
 *
 * @desc Get an Event type with appropriate vendor prefix and casing.
 *
 * @param {Object} target
 *        The event target, usually an Element, document, or window.
 *
 * @param {String} type
 *        A lowercase string representing the Event type.
 *        e.g., "click", "transitionend"
 *
 * @returns {String|Boolean} The properly prefixed Event type
 */
module.exports = function getEventType(target, type) {
	var tagName;
	var prefixed;

	if ('tagName' in target) {
		tagName = target.tagName;
	} else if (target === window) {
		tagName = 'window';
	} else {
		tagName = 'document';
	}

	prefixed = getPrefixedEventType(type, tagName);

	if (prefixed) {
		return prefixed;
	}

	return type;
};

},{"ac-prefixer/getEventType":66}],73:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var stopPropagation = require('./stopPropagation');
var preventDefault = require('./preventDefault');

/**
 * @name module:ac-dom-events.stop
 *
 * @function
 *
 * @deprecated since version 1.1.
 *             Use [stopPropagation]{@link module:ac-dom-events.stopPropagation}
 *             and [preventDefault]{@link module:ac-dom-events.preventDefault} instead.
 *
 */
module.exports = function stop(evt) {
	evt = evt || window.event;

	stopPropagation(evt);
	preventDefault(evt);

	evt.stopped = true;
	evt.returnValue = false;
};

},{"./preventDefault":70,"./stopPropagation":74}],74:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name module:ac-dom-events.stopPropagation
 *
 * @function
 *
 * @desc Prevents further propagation of the current event.
 *
 * @param {Event} evt
 */
module.exports = function stopPropagation(evt) {
	evt = evt || window.event;

	if (evt.stopPropagation) {
		evt.stopPropagation();
	} else {
		evt.cancelBubble = true;
	}
};

},{}],75:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name module:ac-dom-events.target
 *
 * @function
 *
 * @desc Get the target of an Event.
 *
 * @param {Event} evt
 *
 * @returns {Object} target
 */
module.exports = function target(evt) {
	evt = evt || window.event;
	return (typeof evt.target !== 'undefined') ? evt.target : evt.srcElement;
};

},{}],76:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name addEventListener
 * @memberOf module:ac-dom-events/utils
 *
 * @function
 *
 * @desc Register the specified listener on a target.
 *       Automatically handles vendor prefixed and camel-cased event types.
 *
 * @param {Object} target
 *        The event target to listen to.
 *        Usually an Element, document, or window.
 *
 * @param {String} type
 *        A lowercase string representing the event type.
 *        e.g., "click", "transitionend"
 *
 * @param {Function} listener
 *        A Function to be called when the event type is triggered.
 *
 * @param {Boolean} [useCapture=false]
 *        `true` listens for the event in the capture phase.
 *        `false` (default) listens for the event in the bubbling phases.
 *        IE < 9 does not support useCapture
 *
 * @returns {Object} target
 */
module.exports = function addEventListener(target, type, listener, useCapture) {
	if (target.addEventListener) {
		target.addEventListener(type, listener, !!useCapture);
	} else {
		target.attachEvent('on' + type, listener);
	}

	return target;
};

},{}],77:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name dispatchEvent
 * @memberOf module:ac-dom-events/utils
 *
 * @function
 *
 * @desc Creates and dispatches an Event on a target.
 *
 * @param {Object} target
 *        The event target.
 *        Usually an Element, document, or window.
 *
 * @param {String} type
 *        A String representing the event type to dispatch.
 *
 * @param {Object} [options]
 *
 * @param {Boolean} [options.bubbles=false]
 *        Whether or not the event bubbles up through the DOM.
 *        IE < 9 ignores this options, using the `true` behavior.
 *
 * @param {Boolean} [options.cancelable=false]
 *        Whether or not the event can be cancelled.
 *        IE < 9 ignores this options, using the `false` behavior.
 *
 * @param {*} [options.detail]
 *        The data passed to event listeners.
 *
 * @returns {Object} target
 */
module.exports = function dispatchEvent(target, type, options) {
	var evt;

	if (target.dispatchEvent) {
		// Expects polyfill for CustomEvent constructor
		if (options) {
			evt = new CustomEvent(type, options);
		} else {
			evt = new CustomEvent(type);
		}

		target.dispatchEvent(evt);

	} else {
		evt = document.createEventObject();

		if (options && 'detail' in options) {
			evt.detail = options.detail;
		}

		target.fireEvent('on' + type, evt);
	}

	return target;
};

},{}],78:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name removeEventListener
 * @memberOf module:ac-dom-events/utils
 *
 * @function
 *
 * @desc Removes a previously added event listener.
 *
 * @param {Object} target
 *        The event target.
 *        Usually an Element, document, or window.
 *
 * @param {String} type
 *        A String representing the event type.
 *        e.g., "click", "transitionend"
 *
 * @param {Function} listener
 *        The listener Function to be removed.
 *
 * @param {Boolean} [useCapture=false]
 *        `true` for the a listener on the capture phase.
 *        `false` (default) for a listener on the bubbling phases.
 *
 * @returns {Object} target
 */
module.exports = function removeEventListener(target, type, listener, useCapture) {
	if (target.removeEventListener) {
		target.removeEventListener(type, listener, !!useCapture);
	} else {
		target.detachEvent('on' + type, listener);
	}

	return target;
};

},{}],79:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var getBoundingClientRect = require('./utils/getBoundingClientRect');

/**
 * @name module:ac-dom-metrics.getContentDimensions
 *
 * @function
 *
 * @desc Get the width and height of an Element's content.
 *
 * @param {Element} el
 *
 * @param {Boolean} [rendered=false]
 *        `false` for layout values (before transforms).
 *        `true` for rendered values (after transforms).
 *
 * @returns {Dimensions} The scrollWidth/Height of an Element.
 */
module.exports = function getContentDimensions(el, rendered) {
	var scale = 1;

	if (rendered) {
		scale = getBoundingClientRect(el).width / el.offsetWidth;
	}

	return {
		width: el.scrollWidth * scale,
		height: el.scrollHeight * scale
	};
};

},{"./utils/getBoundingClientRect":158}],80:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var getBoundingClientRect = require('./utils/getBoundingClientRect');

/**
 * @name module:ac-dom-metrics.getDimensions
 *
 * @function
 *
 * @desc Get the width and height of an Element.
 *
 * @param {Element} el
 *
 * @param {Boolean} [rendered=false]
 *        `false` for layout values (before transforms).
 *        `true` for rendered values (after transforms).
 *
 * @returns {Dimensions} The Element dimensions.
 */
module.exports = function getDimensions(el, rendered) {
	var rect;

	if (rendered) {
		rect = getBoundingClientRect(el);

		return {
			width: rect.width,
			height: rect.height
		};
	}

	return {
		width: el.offsetWidth,
		height: el.offsetHeight
	};
};

},{"./utils/getBoundingClientRect":158}],81:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var windowDelegate = require('ac-window-delegate').WindowDelegate;
var getDimensions = require('./getDimensions');
var getBoundingClientRect = require('./utils/getBoundingClientRect');

/**
 * @name module:ac-dom-metrics.getPagePosition
 *
 * @function
 *
 * @desc Get the position of an Element, relative to the page (0,0).
 *
 * @param {Element} el
 *
 * @param {Boolean} [rendered=false]
 *        `false` for layout values (before transforms).
 *        `true` for rendered values (after transforms).
 *
 * @returns {Position} The Element position.
 */
module.exports = function getPagePosition(el, rendered) {
	var rect;
	var scrollY;
	var scrollX;
	var dimensions;
	var parentPosition;

	if (rendered) {
		rect = getBoundingClientRect(el);
		scrollY = windowDelegate.scrollY();
		scrollX = windowDelegate.scrollX();

		return {
			top: rect.top + scrollY,
			right: rect.right + scrollX,
			bottom: rect.bottom + scrollY,
			left: rect.left + scrollX
		};
	}

	dimensions = getDimensions(el, rendered);

	rect = {
		top: el.offsetTop,
		left: el.offsetLeft,
		width: dimensions.width,
		height: dimensions.height
	};

	while (el = el.offsetParent) {
		rect.top += el.offsetTop;
		rect.left += el.offsetLeft;
	}

	return {
		top: rect.top,
		right: rect.left + rect.width,
		bottom: rect.top + rect.height,
		left: rect.left
	};
};

},{"./getDimensions":80,"./utils/getBoundingClientRect":158,"ac-window-delegate":139}],82:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var getDimensions = require('./getDimensions');
var getPixelsInViewport = require('./getPixelsInViewport');

/**
 * @name module:ac-dom-metrics.getPercentInViewport
 *
 * @function
 *
 * @desc Get the percentage of the Element height in the current viewport.
 *
 * @param {Element} el
 *
 * @param {Boolean} [rendered=false]
 *        `false` for layout values (before transforms).
 *        `true` for rendered values (after transforms).
 *
 * @returns {Number} Amount in the current viewport, as a percentage from 0-1.
 */
module.exports = function getPercentInViewport(el, rendered) {
	var inViewport = getPixelsInViewport(el, rendered);
	var height = getDimensions(el, rendered).height;

	return (inViewport / height);
};

},{"./getDimensions":80,"./getPixelsInViewport":83}],83:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var windowDelegate = require('ac-window-delegate').WindowDelegate;
var getViewportPosition = require('./getViewportPosition');

/**
 * @name module:ac-dom-metrics.getPixelsInViewport
 *
 * @function
 *
 * @desc Get the vertical pixels of the Element in the current viewport.
 *
 * @param {Element} el
 *
 * @param {Boolean} [rendered=false]
 *        `false` for layout values (before transforms).
 *        `true` for rendered values (after transforms).
 *
 * @returns {Number} Amount in the current viewport, in pixels without 'px' units.
 */
module.exports = function getPixelsInViewport(el, rendered) {
	var vh = windowDelegate.clientHeight();
	var position = getViewportPosition(el, rendered);
	var pixels;

	if (position.top >= vh || position.bottom <= 0) {
		return 0;
	}

	pixels = (position.bottom - position.top);

	if (position.top < 0) {
		pixels += position.top;
	}

	if (position.bottom > vh) {
		pixels -= position.bottom - vh;
	}

	return pixels;
};

},{"./getViewportPosition":85,"ac-window-delegate":139}],84:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var getDimensions = require('./getDimensions');
var getBoundingClientRect = require('./utils/getBoundingClientRect');

/**
 * @name module:ac-dom-metrics.getPosition
 *
 * @function
 *
 * @desc Get the layout position of an Element, relative to it's offset parent.
 *
 * @param {Element} el
 *
 * @param {Boolean} [rendered=false]
 *        `false` for layout values (before transforms).
 *        `true` for rendered values (after transforms).
 *
 * @returns {Position} The Element position.
 */
module.exports = function getPosition(el, rendered) {
	var rect;
	var parentRect;
	var dimensions;

	if (rendered) {
		rect = getBoundingClientRect(el);

		if (el.offsetParent) {
			// Fixed position Elements don't have an offsetParent in WebKit
			parentRect = getBoundingClientRect(el.offsetParent);
			rect.top -= parentRect.top;
			rect.left -= parentRect.left;
		}
	} else {
		dimensions = getDimensions(el, rendered);

		rect = {
			top: el.offsetTop,
			left: el.offsetLeft,
			width: dimensions.width,
			height: dimensions.height
		};
	}

	return {
		top: rect.top,
		right: rect.left + rect.width,
		bottom: rect.top + rect.height,
		left: rect.left
	};
};

},{"./getDimensions":80,"./utils/getBoundingClientRect":158}],85:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var windowDelegate = require('ac-window-delegate').WindowDelegate;
var getPagePosition = require('./getPagePosition');
var getBoundingClientRect = require('./utils/getBoundingClientRect');

/**
 * @name module:ac-dom-metrics.getViewportPosition
 *
 * @function
 *
 * @desc Get the layout position of an Element, relative to the current viewport/scroll.
 *       Note: Fixed position Elements are only accounted for with rendered set to `true`
 *
 * @param {Element} el
 *
 * @param {Boolean} [rendered=false]
 *        `false` for layout values (before transforms).
 *        `true` for rendered values (after transforms).
 *
 * @returns {Position} The Element position.
 */
module.exports = function getViewportPosition(el, rendered) {
	var position;
	var scrollY;
	var scrollX;

	if (rendered) {
		position = getBoundingClientRect(el);

		return {
			top: position.top,
			right: position.right,
			bottom: position.bottom,
			left: position.left
		};
	}

	position = getPagePosition(el);
	scrollY = windowDelegate.scrollY();
	scrollX = windowDelegate.scrollX();

	return {
		top: position.top - scrollY,
		right: position.right - scrollX,
		bottom: position.bottom - scrollY,
		left: position.left - scrollX
	};
};

},{"./getPagePosition":81,"./utils/getBoundingClientRect":158,"ac-window-delegate":139}],86:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @module ac-dom-metrics
 */
module.exports = {
	getContentDimensions: require('./getContentDimensions'),
	getDimensions: require('./getDimensions'),
	getPagePosition: require('./getPagePosition'),
	getPercentInViewport: require('./getPercentInViewport'),
	getPixelsInViewport: require('./getPixelsInViewport'),
	getPosition: require('./getPosition'),
	getViewportPosition: require('./getViewportPosition'),
	isInViewport: require('./isInViewport')
};

/**
 * @class
 * @name Dimensions
 * @desc Just for documentation purposes. Not an actual class.
 * @property {Number} width
 * @property {Number} height
 */

/**
 * @class
 * @name Position
 * @desc Just for documentation purposes. Not an actual class.
 * @property {Number} top
 * @property {Number} right
 * @property {Number} bottom
 * @property {Number} left
 */

},{"./getContentDimensions":79,"./getDimensions":80,"./getPagePosition":81,"./getPercentInViewport":82,"./getPixelsInViewport":83,"./getPosition":84,"./getViewportPosition":85,"./isInViewport":87}],87:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var getPixelsInViewport = require('./getPixelsInViewport');
var getPercentInViewport = require('./getPercentInViewport');

/**
 * @name module:ac-dom-metrics.isInViewport
 *
 * @function
 *
 * @desc Determine whether or not an Element is in the current viewport, past a specified threshold
 *
 * @param {Element} el
 *
 * @param {Boolean} [rendered=false]
 *        `false` for layout values (before transforms).
 *        `true` for rendered values (after transforms).
 *
 * @param {Number|String} [threshold=0]
 *        The minimum amount an Element must be in view.
 *        Accepts a percentage from 0-1, or a string with 'px' units (e.g., '50px').
 *        Defaults to any visibility above 0.
 *
 * @returns {Boolean} `true` if the Element is in view, `false` otherwise.
 */
module.exports = function isInViewport(el, rendered, threshold) {
	var inViewport;

	threshold = threshold || 0;

	if (typeof threshold === 'string' && threshold.slice(-2) === 'px') {
		threshold = parseInt(threshold, 10);
		inViewport = getPixelsInViewport(el, rendered);
	} else {
		inViewport = getPercentInViewport(el, rendered);
	}

	return (inViewport > 0 && inViewport >= threshold);
};

},{"./getPercentInViewport":82,"./getPixelsInViewport":83}],88:[function(require,module,exports){
'use strict';

/**
 * @module ac-dom-events
 */
var events = {};

/**
 * Cross-browser event handling
 * @param {Element} target Element to listen for event on
 * @param {String} type
 * @param {Function} listener
 * @param {Boolean} [useCapture=false]
 * @returns target
 * @name module:ac-dom-events.addEventListener
 * @kind function
 */
events.addEventListener = function (target, type, listener, useCapture) {
	if (target.addEventListener) {
		target.addEventListener(type, listener, useCapture);
	} else if (target.attachEvent) {
		target.attachEvent('on' + type, listener);
	} else {
		target['on' + type] = listener;
	}
	return target;
};

/**
 * Cross-browser event dispatch
 * @param  {Element} target Element that will dispatch the event
 * @param  {String} type   The name of the event to fire
 * @returns {Element}       target
 * @name module:ac-dom-events.dispatchEvent
 * @kind function
 */
events.dispatchEvent = function (target, type) {
	// Expects polyfill for CustomEvent constructor
	if (document.createEvent) {
		target.dispatchEvent(new CustomEvent(type));
	} else {
		target.fireEvent('on' + type, document.createEventObject());
	}
	return target;
};

/**
 * Cross-browser event removing
 * @param {Element} target Element to listen for event on
 * @param {String} type
 * @param {Function} listener
 * @param {Boolean} [useCapture=false]
 * @returns target
 * @name module:ac-dom-events.removeEventListener
 * @kind function
 */
events.removeEventListener = function (target, type, listener, useCapture) {
	if (target.removeEventListener) {
		target.removeEventListener(type, listener, useCapture);
	} else {
		target.detachEvent('on' + type, listener);
	}
	return target;
};

var prefixMatch = /^(webkit|moz|ms|o)/i;

/**
 * Sets all the vendor event listeners of type on element.
 * @param {Element} target Element for which to set the listener upon
 * @param {String} type String representing the event type to listen for, e.g. animationEnd, webkitAnimationEnd, etc... IMPORTANT: This value is expected to be a string in camelCase.
 * @param {Function} listener Object that receives a notification when an event of the specified type occurs.
 * @param {Boolean} [useCapture=false] If true, useCapture indicates that the user wishes to initiate capture.
 * @returns target
 * @name module:ac-dom-events.addVendorPrefixEventListener
 * @kind function
 */
events.addVendorPrefixEventListener = function (target, type, listener, useCapture) {
	if (prefixMatch.test(type)) {
		type = type.replace(prefixMatch, '');
	} else {
		type = type.charAt(0).toUpperCase() + type.slice(1);
	}

	// To avoid adding the same event twice, we need to sniff the user agent.
	// Once we've confirmed a browser supports the generic event name, we'll
	// change this if to be < that build.
	if (/WebKit/i.test(window.navigator.userAgent)) {
		return events.addEventListener(target, 'webkit' + type, listener, useCapture);
	} else if (/Opera/i.test(window.navigator.userAgent)) {
		return events.addEventListener(target, 'O' + type, listener, useCapture);
	} else if (/Gecko/i.test(window.navigator.userAgent)) {
		return events.addEventListener(target, type.toLowerCase(), listener, useCapture);
	} else {
		type = type.charAt(0).toLowerCase() + type.slice(1);
		return events.addEventListener(target, type, listener, useCapture);
	}
};

/**
 * Removes all the vendor event listeners of type on an element.
 * @param {Element} target Element for which to remove the listener from
 * @param {String} type String representing the event type to listen for, e.g. animationEnd, webkitAnimationEnd, etc... IMPORTANT: This value is expected to be a string in camelCase.
 * @param {Function} listener Object that receives a notification when an event of the specified type occurs.
 * @param {Boolean} [useCapture=false] If true, useCapture indicates that the user wishes to initiate capture.
 * @returns target
 * @name module:ac-dom-events.removeVendorPrefixEventListener
 * @kind function
 */
events.removeVendorPrefixEventListener = function (target, type, listener, useCapture) {
	if (prefixMatch.test(type)) {
		type = type.replace(prefixMatch, '');
	} else {
		type = type.charAt(0).toUpperCase() + type.slice(1);
	}

	events.removeEventListener(target, 'webkit' + type, listener, useCapture);
	events.removeEventListener(target, 'O' + type, listener, useCapture);
	events.removeEventListener(target, type.toLowerCase(), listener, useCapture);

	type = type.charAt(0).toLowerCase() + type.slice(1);
	return events.removeEventListener(target, type, listener, useCapture);
};

/**
 * Stop propagation of event and prevent default behavior.
 * @param {Event} evt The event to stop
 * @name module:ac-dom-events.stop
 * @kind function
 */
events.stop = function (evt) {
	if (!evt) {
		evt = window.event;
	}

	if (evt.stopPropagation) {
		evt.stopPropagation();
	} else {
		evt.cancelBubble = true;
	}

	if (evt.preventDefault) {
		evt.preventDefault();
	}

	evt.stopped = true;
	evt.returnValue = false;
};

/**
 * Cross-browser event target getter
 * @param {Event} evt
 * @name module:ac-dom-events.target
 * @kind function
 */
events.target = function (evt) {
	return (typeof evt.target !== 'undefined') ? evt.target : evt.srcElement;
};

module.exports = events;

},{}],89:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name module:ac-dom-nodes.COMMENT_NODE
 *
 * @constant
 *
 * @desc nodeType value for Comment
 */
module.exports = 8;

},{}],90:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name module:ac-dom-nodes.DOCUMENT_FRAGMENT_NODE
 *
 * @constant
 *
 * @desc nodeType value for DocumentFragment
 */
module.exports = 11;

},{}],91:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name module:ac-dom-nodes.DOCUMENT_NODE
 *
 * @constant
 *
 * @desc nodeType value for Document
 */
module.exports = 9;

},{}],92:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name module:ac-dom-nodes.DOCUMENT_TYPE_NODE
 *
 * @constant
 *
 * @desc nodeType value for DocumentType
 */
module.exports = 10;

},{}],93:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name module:ac-dom-nodes.ELEMENT_NODE
 *
 * @constant
 *
 * @desc nodeType value for Element
 */
module.exports = 1;

},{}],94:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name module:ac-dom-nodes.TEXT_NODE
 *
 * @constant
 *
 * @desc nodeType value for TextNode
 */
module.exports = 3;

},{}],95:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name module:ac-dom-nodes.createDocumentFragment
 *
 * @function
 *
 * @desc Create a DocumentFragment with optional HTML contents
 *
 * @param {String} [html]
 *        Optional inner HTML of the DocumentFragment
 *
 * @returns {DocumentFragment} A new DocumentFragment
 */
module.exports = function createDocumentFragment(html) {
	var fragment = document.createDocumentFragment();
	var div;

	if (html) {
		div = document.createElement('div');
		div.innerHTML = html;

		while (div.firstChild) {
			fragment.appendChild(div.firstChild);
		}
	}

	return fragment;
};

},{}],96:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

require('ac-polyfills/Array/prototype.slice');
require('ac-polyfills/Array/prototype.filter');

/** @ignore */
var isNodeType = require('./internal/isNodeType');
var ELEMENT_NODE = require('./ELEMENT_NODE');

/**
 * @name module:ac-dom-nodes.filterByNodeType
 *
 * @function
 *
 * @desc Filters an Array of Nodes by nodeType.
 *
 * @param {Array|NodeList} nodes
 *
 * @param {Integer} [nodeType={@link module:ac-dom-nodes.ELEMENT_NODE ELEMENT_NODE}]
 *
 * @returns {Array} An new Array of Nodes of the specified nodeType
 */
module.exports = function filterByNodeType(nodes, nodeType) {
	nodeType = nodeType || ELEMENT_NODE;
	nodes = Array.prototype.slice.call(nodes);

	return nodes.filter(function (node) {
		return isNodeType(node, nodeType);
	});
};

},{"./ELEMENT_NODE":93,"./internal/isNodeType":102,"ac-polyfills/Array/prototype.filter":797,"ac-polyfills/Array/prototype.slice":799}],97:[function(require,module,exports){
/**
 * Utility methods dealing with the DOM
 * @module ac-dom-nodes
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

module.exports = {
	createDocumentFragment: require('./createDocumentFragment'),
	filterByNodeType: require('./filterByNodeType'),
	insertAfter: require('./insertAfter'),
	insertBefore: require('./insertBefore'),
	insertFirstChild: require('./insertFirstChild'),
	insertLastChild: require('./insertLastChild'),
	isComment: require('./isComment'),
	isDocument: require('./isDocument'),
	isDocumentFragment: require('./isDocumentFragment'),
	isDocumentType: require('./isDocumentType'),
	isElement: require('./isElement'),
	isNode: require('./isNode'),
	isNodeList: require('./isNodeList'),
	isTextNode: require('./isTextNode'),
	remove: require('./remove'),
	replace: require('./replace'),

	COMMENT_NODE: require('./COMMENT_NODE'),
	DOCUMENT_FRAGMENT_NODE: require('./DOCUMENT_FRAGMENT_NODE'),
	DOCUMENT_NODE: require('./DOCUMENT_NODE'),
	DOCUMENT_TYPE_NODE: require('./DOCUMENT_TYPE_NODE'),
	ELEMENT_NODE: require('./ELEMENT_NODE'),
	TEXT_NODE: require('./TEXT_NODE')
};

},{"./COMMENT_NODE":89,"./DOCUMENT_FRAGMENT_NODE":90,"./DOCUMENT_NODE":91,"./DOCUMENT_TYPE_NODE":92,"./ELEMENT_NODE":93,"./TEXT_NODE":94,"./createDocumentFragment":95,"./filterByNodeType":96,"./insertAfter":98,"./insertBefore":99,"./insertFirstChild":100,"./insertLastChild":101,"./isComment":104,"./isDocument":105,"./isDocumentFragment":106,"./isDocumentType":107,"./isElement":108,"./isNode":109,"./isNodeList":110,"./isTextNode":111,"./remove":112,"./replace":113}],98:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var validate = require('./internal/validate');

/**
 * @name module:ac-dom-nodes.insertAfter
 *
 * @function
 *
 * @desc Insert a Node after a specified target
 *
 * @param {Node} node
 *        The Node to insert
 *
 * @param {Node} target
 *        The target Node
 *
 * @returns {Node} The inserted Node
 */
module.exports = function insertAfter(node, target) {
	validate.insertNode(node, true, 'insertAfter');
	validate.childNode(target, true, 'insertAfter');
	validate.hasParentNode(target, 'insertAfter');

	if (!target.nextSibling) {
		return target.parentNode.appendChild(node);
	}

	return target.parentNode.insertBefore(node, target.nextSibling);
};

},{"./internal/validate":103}],99:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var validate = require('./internal/validate');

/**
 * @name module:ac-dom-nodes.insertBefore
 *
 * @function
 *
 * @desc Insert a Node before a specified target
 *
 * @param {Node} node
 *        The Node to insert
 *
 * @param {Node} target
 *        The target Node
 *
 * @returns {Node} The inserted Node
 */
module.exports = function insertBefore(node, target) {
	validate.insertNode(node, true, 'insertBefore');
	validate.childNode(target, true, 'insertBefore');
	validate.hasParentNode(target, 'insertBefore');

	return target.parentNode.insertBefore(node, target);
};

},{"./internal/validate":103}],100:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var validate = require('./internal/validate');

/**
 * @name module:ac-dom-nodes.insertFirstChild
 *
 * @function
 *
 * @desc Insert a Node as the first child of a specified target
 *
 * @param {Node} node
 *        The Node to insert
 *
 * @param {Node} target
 *        The target Node
 *
 * @returns {Node} The inserted Node
 */
module.exports = function insertFirstChild(node, target) {
	validate.insertNode(node, true, 'insertFirstChild');
	validate.parentNode(target, true, 'insertFirstChild');

	if (!target.firstChild) {
		return target.appendChild(node);
	}

	return target.insertBefore(node, target.firstChild);
};

},{"./internal/validate":103}],101:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var validate = require('./internal/validate');

/**
 * @name module:ac-dom-nodes.insertLastChild
 *
 * @function
 *
 * @desc Insert a Node as the last child of a specified target
 *
 * @param {Node} node
 *        The Node to insert
 *
 * @param {Node} target
 *        The target Node
 *
 * @returns {Node} The inserted Node
 */
module.exports = function insertLastChild(node, target) {
	validate.insertNode(node, true, 'insertLastChild');
	validate.parentNode(target, true, 'insertLastChild');

	return target.appendChild(node);
};

},{"./internal/validate":103}],102:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var isNode = require('../isNode');

module.exports = function isNodeType(node, nodeType) {
	if (!isNode(node)) {
		return false;
	}

	if (typeof nodeType === 'number') {
		return (node.nodeType === nodeType);
	}

	return (nodeType.indexOf(node.nodeType) !== -1);
};

},{"../isNode":109}],103:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var isNodeType = require('./isNodeType');
var COMMENT_NODE = require('../COMMENT_NODE');
var DOCUMENT_FRAGMENT_NODE = require('../DOCUMENT_FRAGMENT_NODE');
var ELEMENT_NODE = require('../ELEMENT_NODE');
var TEXT_NODE = require('../TEXT_NODE');

/** @ignore */
var VALID_INSERT_NODE = [
	ELEMENT_NODE,
	TEXT_NODE,
	COMMENT_NODE,
	DOCUMENT_FRAGMENT_NODE
];

/** @ignore */
var ERR_INVALID_INSERT_NODE = ' must be an Element, TextNode, Comment, or Document Fragment';

/** @ignore */
var VALID_CHILD_NODE = [
	ELEMENT_NODE,
	TEXT_NODE,
	COMMENT_NODE
];

/** @ignore */
var ERR_INVALID_CHILD_NODE = ' must be an Element, TextNode, or Comment';

/** @ignore */
var VALID_PARENT_NODE = [
	ELEMENT_NODE,
	DOCUMENT_FRAGMENT_NODE
];

/** @ignore */
var ERR_INVALID_PARENT_NODE = ' must be an Element, or Document Fragment';

/** @ignore */
var ERR_NO_PARENT_NODE = ' must have a parentNode';

module.exports = {

	/** @ignore */
	parentNode: function (node, required, funcName, paramName) {
		paramName = paramName || 'target';

		if ((node || required) && !isNodeType(node, VALID_PARENT_NODE)) {
			throw new TypeError(funcName + ': ' + paramName + ERR_INVALID_PARENT_NODE);
		}
	},

	/** @ignore */
	childNode: function (node, required, funcName, paramName) {
		paramName = paramName || 'target';

		if (!node && !required) {
			return;
		}

		if (!isNodeType(node, VALID_CHILD_NODE)) {
			throw new TypeError(funcName + ': ' + paramName + ERR_INVALID_CHILD_NODE);
		}
	},

	/** @ignore */
	insertNode: function (node, required, funcName, paramName) {
		paramName = paramName || 'node';

		if (!node && !required) {
			return;
		}

		if (!isNodeType(node, VALID_INSERT_NODE)) {
			throw new TypeError(funcName + ': ' + paramName + ERR_INVALID_INSERT_NODE);
		}
	},

	/** @ignore */
	hasParentNode: function (node, funcName, paramName) {
		paramName = paramName || 'target';

		if (!node.parentNode) {
			throw new TypeError(funcName + ': ' + paramName + ERR_NO_PARENT_NODE);
		}
	}

};

},{"../COMMENT_NODE":89,"../DOCUMENT_FRAGMENT_NODE":90,"../ELEMENT_NODE":93,"../TEXT_NODE":94,"./isNodeType":102}],104:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var isNodeType = require('./internal/isNodeType');
var COMMENT_NODE = require('./COMMENT_NODE');

/**
 * @name module:ac-dom-nodes.isComment
 *
 * @function
 *
 * @desc Test whether or not an Object is a Comment.
 *
 * @param {Object} obj
 *
 * @returns {Boolean}
 */
module.exports = function isComment(obj) {
 	return isNodeType(obj, COMMENT_NODE);
};

},{"./COMMENT_NODE":89,"./internal/isNodeType":102}],105:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var isNodeType = require('./internal/isNodeType');
var DOCUMENT_NODE = require('./DOCUMENT_NODE');

/**
 * @name module:ac-dom-nodes.isDocument
 *
 * @function
 *
 * @desc Test whether or not an Object is a Document.
 *
 * @param {Object} obj
 *
 * @returns {Boolean}
 */
module.exports = function isDocument(obj) {
 	return isNodeType(obj, DOCUMENT_NODE);
};

},{"./DOCUMENT_NODE":91,"./internal/isNodeType":102}],106:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var isNodeType = require('./internal/isNodeType');
var DOCUMENT_FRAGMENT_NODE = require('./DOCUMENT_FRAGMENT_NODE');

/**
 * @name module:ac-dom-nodes.isDocumentFragment
 *
 * @function
 *
 * @desc Test whether or not an Object is a DocumentFragment.
 *
 * @param {Object} obj
 *
 * @returns {Boolean}
 */
module.exports = function isDocumentFragment(obj) {
 	return isNodeType(obj, DOCUMENT_FRAGMENT_NODE);
};

},{"./DOCUMENT_FRAGMENT_NODE":90,"./internal/isNodeType":102}],107:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var isNodeType = require('./internal/isNodeType');
var DOCUMENT_TYPE_NODE = require('./DOCUMENT_TYPE_NODE');

/**
 * @name module:ac-dom-nodes.isDocumentType
 *
 * @function
 *
 * @desc Test whether or not an Object is a DocumentType.
 *
 * @param {Object} obj
 *
 * @returns {Boolean}
 */
module.exports = function isDocumentType (obj) {
 	return isNodeType(obj, DOCUMENT_TYPE_NODE);
};

},{"./DOCUMENT_TYPE_NODE":92,"./internal/isNodeType":102}],108:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var isNodeType = require('./internal/isNodeType');
var ELEMENT_NODE = require('./ELEMENT_NODE');

/**
 * @name module:ac-dom-nodes.isElement
 *
 * @function
 *
 * @desc Test whether or not an Object is an Element.
 *
 * @param {Object} obj
 *
 * @returns {Boolean}
 */
module.exports = function isElement (obj) {
 	return isNodeType(obj, ELEMENT_NODE);
};

},{"./ELEMENT_NODE":93,"./internal/isNodeType":102}],109:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name module:ac-dom-nodes.isNode
 *
 * @function
 *
 * @desc Test whether or not an Object is a Node.
 *
 * @param {Object} obj
 *
 * @returns {Boolean}
 */
module.exports = function isNode (obj) {
 	return !!(obj && obj.nodeType);
};

},{}],110:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var nodeListToStringPattern = /^\[object (HTMLCollection|NodeList|Object)\]$/;

/**
 * @name module:ac-dom-nodes.isNodeList
 *
 * @function
 *
 * @desc Test whether or not an Object is a NodeList.
 *
 * @param {Object} obj
 *
 * @returns {Boolean}
 */
module.exports = function isNodeList (obj) {
 	if (!obj) {
 		return false;
 	}

 	// not Array-like
 	if (typeof obj.length !== 'number') {
 		return false;
 	}

 	// Array-like, but not a NodeList
 	if (typeof obj[0] === 'object' && (!obj[0] || !obj[0].nodeType)) {
 		return false;
 	}

 	return nodeListToStringPattern.test(Object.prototype.toString.call(obj));
};

},{}],111:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var isNodeType = require('./internal/isNodeType');
var TEXT_NODE = require('./TEXT_NODE');

/**
 * @name module:ac-dom-nodes.isTextNode
 *
 * @function
 *
 * @desc Test whether or not an Object is a TextNode.
 *
 * @param {Object} obj
 *
 * @returns {Boolean}
 */
module.exports = function isTextNode (obj) {
 	return isNodeType(obj, TEXT_NODE);
};

},{"./TEXT_NODE":94,"./internal/isNodeType":102}],112:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var validate = require('./internal/validate');

/**
 * @name module:ac-dom-nodes.remove
 *
 * @function
 *
 * @desc Remove a Node from it's parentNode
 *
 * @param {Node} node
 *        The Node to remove
 *
 * @returns {Node} The removed Node
 */
module.exports = function remove (node) {
	validate.childNode(node, true, 'remove');

	if (!node.parentNode) {
		return node;
	}

	return node.parentNode.removeChild(node);
};

},{"./internal/validate":103}],113:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var validate = require('./internal/validate');

/**
 * @name module:ac-dom-nodes.replace
 *
 * @function
 *
 * @desc Replace one Node with another
 *
 * @param {Node} newNode
 *        The Node to be inserted
 *
 * @param {Node} oldNode
 *        The Node to be replaced
 *
 * @returns {Node} The replaced Node
 */
module.exports = function replace (newNode, oldNode) {
	validate.insertNode(newNode, true, 'insertFirstChild', 'newNode');
	validate.childNode(oldNode, true, 'insertFirstChild', 'oldNode');
	validate.hasParentNode(oldNode, 'insertFirstChild', 'oldNode');

	return oldNode.parentNode.replaceChild(newNode, oldNode);
};

},{"./internal/validate":103}],114:[function(require,module,exports){
/**
 * @module ac-dom-traversal
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

var ac_dom_traversal = {
	querySelector: require('./ac-dom-traversal/querySelector'),
	querySelectorAll: require('./ac-dom-traversal/querySelectorAll'),
	ancestor: require('./ac-dom-traversal/ancestor'),
	ancestors: require('./ac-dom-traversal/ancestors'),
	children: require('./ac-dom-traversal/children'),
	firstChild: require('./ac-dom-traversal/firstChild'),
	lastChild: require('./ac-dom-traversal/lastChild'),
	siblings: require('./ac-dom-traversal/siblings'),
	nextSibling: require('./ac-dom-traversal/nextSibling'),
	nextSiblings: require('./ac-dom-traversal/nextSiblings'),
	previousSibling: require('./ac-dom-traversal/previousSibling'),
	previousSiblings: require('./ac-dom-traversal/previousSiblings'),
	filterBySelector: require('./ac-dom-traversal/filterBySelector'),
	matchesSelector: require('./ac-dom-traversal/matchesSelector')
};

// IE compatibility
require('./ac-dom-traversal/shims/ie')(ac_dom_traversal);

module.exports = ac_dom_traversal;

},{"./ac-dom-traversal/ancestor":115,"./ac-dom-traversal/ancestors":116,"./ac-dom-traversal/children":117,"./ac-dom-traversal/filterBySelector":118,"./ac-dom-traversal/firstChild":119,"./ac-dom-traversal/lastChild":122,"./ac-dom-traversal/matchesSelector":123,"./ac-dom-traversal/nextSibling":124,"./ac-dom-traversal/nextSiblings":125,"./ac-dom-traversal/previousSibling":126,"./ac-dom-traversal/previousSiblings":127,"./ac-dom-traversal/querySelector":128,"./ac-dom-traversal/querySelectorAll":129,"./ac-dom-traversal/shims/ie":130,"./ac-dom-traversal/siblings":131}],115:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var ac_dom_nodes = require('ac-dom-nodes');
var matchesSelector = require('./matchesSelector');
var validate = require('./helpers/validate');

/**
 * @name module:ac-dom-traversal.ancestor
 *
 * @function
 *
 * @desc Returns the closest Element that is an ancestor of the specified Node, matching an optional CSS selector, up to and including the body.
 *
 * @param {Node} node
 *        The child Element, TextNode, or Comment.
 *
 * @param {String} [selector]
 *        Optional CSS selectors, separated by commas, to filter ancestor Elements by.
 *
 * @returns {Element|null} Closest matching ancestor Element, or `null` if no matches are found.
 */
module.exports = function ancestor(node, selector) {
 	validate.childNode(node, true, 'ancestors');
 	validate.selector(selector, false, 'ancestors');

 	if (node !== document.body) {
 		while ((node = node.parentNode) && ac_dom_nodes.isElement(node)) {
 			if (!selector || matchesSelector(node, selector)) {
 				return node;
 			}

 			if (node === document.body) {
 				break;
 			}
 		}
 	}

 	return null;
};

},{"./helpers/validate":121,"./matchesSelector":123,"ac-dom-nodes":97}],116:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var ac_dom_nodes = require('ac-dom-nodes');
var matchesSelector = require('./matchesSelector');
var validate = require('./helpers/validate');

/**
 * @name module:ac-dom-traversal.ancestors
 *
 * @function
 *
 * @desc Returns an Array of Elements that are ancestors of the specified Node, matching an optional CSS selector, up to and including the body.
 *
 * @param {Node} node
 *        The child Element, TextNode, or Comment.
 *
 * @param {String} [selector]
 *        Optional CSS selectors, separated by commas, to filter ancestor Elements by.
 *
 * @returns {Element[]} Array of matching ancestor Elements, with the closest ancestor first.
 */
module.exports = function ancestors(node, selector) {
 	var els = [];

 	validate.childNode(node, true, 'ancestors');
 	validate.selector(selector, false, 'ancestors');

 	if (node !== document.body) {
	 	while ((node = node.parentNode) && ac_dom_nodes.isElement(node)) {
	 		if (!selector || matchesSelector(node, selector)) {
	 			els.push(node);
	 		}

	 		if (node === document.body) {
	 			break;
	 		}
	 	}
	}

 	return els;
};

},{"./helpers/validate":121,"./matchesSelector":123,"ac-dom-nodes":97}],117:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var ac_dom_nodes = require('ac-dom-nodes');
var filterBySelector = require('./filterBySelector');
var validate = require('./helpers/validate');

/**
 * @name module:ac-dom-traversal.children
 *
 * @function
 *
 * @desc Returns an Array of Elements that are direct children of the specified Node, matching an optional CSS selector.
 *
 * @param {Node} node
 *        The parent Element, Document, or Document Fragment.
 *
 * @param {String} [selector]
 *        Optional CSS selectors, separated by commas, to filter children Elements by.
 *
 * @returns {Element[]} Array of matching child Elements, in DOM order.
 */
module.exports = function children(node, selector) {
	var els;

	validate.parentNode(node, true, 'children');
	validate.selector(selector, false, 'children');

	els = node.children || node.childNodes;
	els = ac_dom_nodes.filterByNodeType(els);

	if (selector) {
		els = filterBySelector(els, selector);
	}

	return els;
};

},{"./filterBySelector":118,"./helpers/validate":121,"ac-dom-nodes":97}],118:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var matchesSelector = require('./matchesSelector');
var validate = require('./helpers/validate');

/**
 * @name module:ac-dom-traversal.filterBySelector
 *
 * @function
 *
 * @desc Filter an Array of Elements by a given CSS selector.
 *
 * @param {Node[]|NodeList} nodes
 *        The Elements to be filtered.
 *
 * @param {String} selector
 *        CSS selectors, separated by commas, to check Elements against.
 *
 * @returns {Element[]} A new Array of matching Elements.
 */
module.exports = function filterBySelector(nodes, selector) {
	validate.selector(selector, true, 'filterBySelector');

	nodes = Array.prototype.slice.call(nodes);

	return nodes.filter(function (el) {
		return matchesSelector(el, selector);
	});
};

},{"./helpers/validate":121,"./matchesSelector":123}],119:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var children = require('./children');
var validate = require('./helpers/validate');

/**
 * @name module:ac-dom-traversal.firstChild
 *
 * @function
 *
 * @desc Returns the first Element that is a direct child of the specified Node, matching an optional CSS selector.
 *
 * @param {Node} node
 *        The parent Element, Document, or Document Fragment.
 *
 * @param {String} [selector]
 *        Optional CSS selectors, separated by commas, to filter children Elements by.
 *
 * @returns {Element|null} First matching child Element, or `null` if no matches are found.
 */
module.exports = function firstChild(node, selector) {
	var els;

	validate.parentNode(node, true, 'firstChild');
	validate.selector(selector, false, 'firstChild');

	if (node.firstElementChild && !selector) {
		return node.firstElementChild;
	}

	els = children(node, selector);

	if (els.length) {
		return els[0];
	}

	return null;
};

},{"./children":117,"./helpers/validate":121}],120:[function(require,module,exports){
'use strict';

/** @ignore */
module.exports = window.Element ? (function (proto) {
	return proto.matches ||
		proto.matchesSelector ||
		proto.webkitMatchesSelector ||
		proto.mozMatchesSelector ||
		proto.msMatchesSelector ||
		proto.oMatchesSelector;
}(Element.prototype)) : null;

},{}],121:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var ac_dom_nodes = require('ac-dom-nodes');

/** @ignore */
var isNodeType = function (node, nodeType) {
	if (!ac_dom_nodes.isNode(node)) {
		return false;
	}

	if (typeof nodeType === 'number') {
		return (node.nodeType === nodeType);
	}

	return (nodeType.indexOf(node.nodeType) !== -1);
};

/** @ignore */
var VALID_PARENT_NODE = [
	ac_dom_nodes.ELEMENT_NODE,
	ac_dom_nodes.DOCUMENT_NODE,
	ac_dom_nodes.DOCUMENT_FRAGMENT_NODE
];

/** @ignore */
var ERR_INVALID_PARENT_NODE = ' must be an Element, Document, or Document Fragment';

/** @ignore */
var VALID_CHILD_NODE = [
	ac_dom_nodes.ELEMENT_NODE,
	ac_dom_nodes.TEXT_NODE,
	ac_dom_nodes.COMMENT_NODE
];

/** @ignore */
var ERR_INVALID_CHILD_NODE = ' must be an Element, TextNode, or Comment';

/** @ignore */
var ERR_INVALID_SELECTOR = ' must be a string';

module.exports = {

	/** @ignore */
	parentNode: function (node, required, funcName, paramName) {
		paramName = paramName || 'node';

		if ((node || required) && !isNodeType(node, VALID_PARENT_NODE)) {
			throw new TypeError(funcName + ': ' + paramName + ERR_INVALID_PARENT_NODE);
		}
	},

	/** @ignore */
	childNode: function (node, required, funcName, paramName) {
		paramName = paramName || 'node';

		if (!node && !required) {
			return;
		}

		if (!isNodeType(node, VALID_CHILD_NODE)) {
			throw new TypeError(funcName + ': ' + paramName + ERR_INVALID_CHILD_NODE);
		}
	},

	/** @ignore */
	selector: function (selector, required, funcName, paramName) {
		paramName = paramName || 'selector';

		if ((selector || required) && typeof selector !== 'string') {
			throw new TypeError(funcName + ': ' + paramName + ERR_INVALID_SELECTOR);
		}
	}

};

},{"ac-dom-nodes":97}],122:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var children = require('./children');
var validate = require('./helpers/validate');

/**
 * @name module:ac-dom-traversal.lastChild
 *
 * @function
 *
 * @desc Returns the last Element that is a direct child of the specified Node, matching an optional CSS selector.
 *
 * @param {Node} node
 *        The parent Element, Document, or Document Fragment.
 *
 * @param {String} [selector]
 *        Optional CSS selectors, separated by commas, to filter children Elements by.
 *
 * @returns {Element|null} Last matching child Element, or `null` if no matches are found.
 */
module.exports = function lastChild(node, selector) {
	var els;

	validate.parentNode(node, true, 'lastChild');
	validate.selector(selector, false, 'lastChild');

	if (node.lastElementChild && !selector) {
		return node.lastElementChild;
	}

	els = children(node, selector);

	if (els.length) {
		return els[els.length - 1];
	}

	return null;
};

},{"./children":117,"./helpers/validate":121}],123:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var ac_dom_nodes = require('ac-dom-nodes');
var nativeMatches = require('./helpers/nativeMatches');
var validate = require('./helpers/validate');

/**
 * @name module:ac-dom-traversal.matchesSelector
 *
 * @function
 *
 * @desc Returns whether or not an Element matches a given CSS selector.
 *
 * @param {Node} node
 *        The Element to be checked.
 *
 * @param {String} selector
 *        CSS selectors, separated by commas, to check Element against.
 *
 * @returns {Boolean} `true` if the Element matches the selector, otherwise `false`
 */
module.exports = function matchesSelector(node, selector) {
 	validate.selector(selector, true, 'matchesSelector');
	return ac_dom_nodes.isElement(node) ? nativeMatches.call(node, selector) : false;
};

},{"./helpers/nativeMatches":120,"./helpers/validate":121,"ac-dom-nodes":97}],124:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var ac_dom_nodes = require('ac-dom-nodes');
var matchesSelector = require('./matchesSelector');
var validate = require('./helpers/validate');

/**
 * @name module:ac-dom-traversal.nextSibling
 *
 * @function
 *
 * @desc Returns the closest sibling Element that follows the specified Node, matching an optional CSS selector.
 *
 * @param {Node} node
 *        The Element, TextNode, or Comment.
 *
 * @param {String} [selector]
 *        Optional CSS selectors, separated by commas, to filter sibling Elements by.
 *
 * @returns {Element|null} Closest matching sibling Element, or `null` if no matches are found.
 */
module.exports = function nextSibling(node, selector) {
 	validate.childNode(node, true, 'nextSibling');
 	validate.selector(selector, false, 'nextSibling');

	if (node.nextElementSibling && !selector) {
		return node.nextElementSibling;
	}

	while (node = node.nextSibling) {
		if (ac_dom_nodes.isElement(node)) {
			if (!selector || matchesSelector(node, selector)) {
				return node;
			}
		}
	}

	return null;
};

},{"./helpers/validate":121,"./matchesSelector":123,"ac-dom-nodes":97}],125:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var ac_dom_nodes = require('ac-dom-nodes');
var matchesSelector = require('./matchesSelector');
var validate = require('./helpers/validate');

/**
 * @name module:ac-dom-traversal.nextSiblings
 *
 * @function
 *
 * @desc Returns an Array of sibling Elements that follow the specified Node, matching an optional CSS selector.
 *
 * @param {Node} node
 *        The Element, TextNode, or Comment.
 *
 * @param {String} [selector]
 *        Optional CSS selectors, separated by commas, to filter sibling Elements by.
 *
 * @returns {Element[]} Array of matching sibling Elements, in DOM order.
 */
module.exports = function nextSiblings(node, selector) {
 	var els = [];

 	validate.childNode(node, true, 'nextSiblings');
 	validate.selector(selector, false, 'nextSiblings');

 	while (node = node.nextSibling) {
 		if (ac_dom_nodes.isElement(node)) {
 			if (!selector || matchesSelector(node, selector)) {
 				els.push(node);
 			}
 		}
 	}

 	return els;
};

},{"./helpers/validate":121,"./matchesSelector":123,"ac-dom-nodes":97}],126:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var ac_dom_nodes = require('ac-dom-nodes');
var matchesSelector = require('./matchesSelector');
var validate = require('./helpers/validate');

/**
 * @name module:ac-dom-traversal.previousSibling
 *
 * @function
 *
 * @desc Returns the closest sibling Element that preceeds the specified Node, matching an optional CSS selector.
 *
 * @param {Node} node
 *        The Element, TextNode, or Comment.
 *
 * @param {String} [selector]
 *        Optional CSS selectors, separated by commas, to filter sibling Elements by.
 *
 * @returns {Element|null} Closest matching sibling Element, or `null` if no matches are found.
 */
module.exports = function previousSibling(node, selector) {
 	validate.childNode(node, true, 'previousSibling');
 	validate.selector(selector, false, 'previousSibling');

	if (node.previousElementSibling && !selector) {
		return node.previousElementSibling;
	}

	while (node = node.previousSibling) {
		if (ac_dom_nodes.isElement(node)) {
			if (!selector || matchesSelector(node, selector)) {
				return node;
			}
		}
	}

	return null;
};

},{"./helpers/validate":121,"./matchesSelector":123,"ac-dom-nodes":97}],127:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var ac_dom_nodes = require('ac-dom-nodes');
var matchesSelector = require('./matchesSelector');
var validate = require('./helpers/validate');

/**
 * @name module:ac-dom-traversal.previousSiblings
 *
 * @function
 *
 * @desc Returns an Array of sibling Elements that preceed the specified Node, matching an optional CSS selector.
 *
 * @param {Node} node
 *        The Element, TextNode, or Comment.
 *
 * @param {String} [selector]
 *        Optional CSS selectors, separated by commas, to filter sibling Elements by.
 *
 * @returns {Element[]} Array of matching sibling Elements, in DOM order.
 */
module.exports = function previousSiblings(node, selector) {
 	var els = [];

 	validate.childNode(node, true, 'previousSiblings');
 	validate.selector(selector, false, 'previousSiblings');

 	while (node = node.previousSibling) {
 		if (ac_dom_nodes.isElement(node)) {
 			if (!selector || matchesSelector(node, selector)) {
 				els.push(node);
 			}
 		}
 	}

 	return els.reverse();
};

},{"./helpers/validate":121,"./matchesSelector":123,"ac-dom-nodes":97}],128:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var validate = require('./helpers/validate');

/**
 * @name module:ac-dom-traversal.querySelector
 *
 * @function
 *
 * @desc Returns the first Element within the specified context that match given CSS selector(s).
 *
 * @param {String} selector
 *        One or more CSS selectors separated by commas.
 *
 * @param {Node} [context=document]
 *        An optional ParentNode to scope the selector to. Defaults to `document`.
 *
 * @returns {Element|null} First matching Element, or `null` if no matches are found.
 */
module.exports = function querySelector(selector, context) {
	context = context || document;

	validate.parentNode(context, true, 'querySelector', 'context');
	validate.selector(selector, true, 'querySelector');

	return context.querySelector(selector);
};

},{"./helpers/validate":121}],129:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var validate = require('./helpers/validate');

/**
 * @name module:ac-dom-traversal.querySelectorAll
 *
 * @function
 *
 * @desc Returns an Array of Elements within the specified context that match given CSS selector(s).
 *
 * @param {String} selector
 *        One or more CSS selectors separated by commas.
 *
 * @param {Node} [context=document]
 *        An optional ParentNode to scope the selector to. Defaults to `document`.
 *
 * @returns {Element[]} Array of matching Elements
 */
module.exports = function querySelectorAll(selector, context) {
	context = context || document;

	validate.parentNode(context, true, 'querySelectorAll', 'context');
	validate.selector(selector, true, 'querySelectorAll');

	return Array.prototype.slice.call(context.querySelectorAll(selector));
};

},{"./helpers/validate":121}],130:[function(require,module,exports){
'use strict';

/** @ignore */
var sizzle = require('../vendor/sizzle/sizzle');
var ac_dom_nodes = require('ac-dom-nodes');
var nativeMatches = require('../helpers/nativeMatches');
var validate = require('../helpers/validate');

module.exports = function(ac_dom_traversal, forceShim) {
	if (forceShim || !('querySelectorAll' in document)) {
		/**
		 * module:ac-dom-traversal.selectAll shim for IE < 8
		 * Fallback to sizzle needed due to lack of native querySelectorAll
		 */
		ac_dom_traversal.querySelectorAll = function (selector, context) {
			var children;
			var matches;

			context = context || document;

			validate.parentNode(context, true, 'querySelectorAll', 'context');
			validate.selector(selector, true, 'querySelectorAll');

			if (ac_dom_nodes.isDocumentFragment(context)) {
				children = ac_dom_traversal.children(context);
				matches = [];

				children.forEach(function (node) {
					var childMatches;

					// check the child node
					if (sizzle.matchesSelector(node, selector)) {
						matches.push(node);
					}

					// check the child node's children
					childMatches = sizzle(selector, node);
					if (childMatches.length) {
						matches = matches.concat(childMatches);
					}
				});

				return matches;
			}

			return sizzle(selector, context);
		};

		/**
		 * module:ac-dom-traversal.querySelector shim for IE < 8
		 * Fallback to sizzle needed due to lack of native querySelector
		 */
		ac_dom_traversal.querySelector = function (selector, context) {
			var allResults;

			context = context || document;

			validate.parentNode(context, true, 'querySelector', 'context');
			validate.selector(selector, true, 'querySelector');

			allResults = ac_dom_traversal.querySelectorAll(selector, context);

			return allResults.length ? allResults[0] : null;
		};
	}

	if (forceShim || !nativeMatches) {
		/**
		 * module:ac-dom-traversal.matchesSelector shim for IE < 10
		 * Fallback to sizzle needed due to lack of native matches or msMatchesSelector
		 */
		ac_dom_traversal.matchesSelector = function (node, selector) {
			return sizzle.matchesSelector(node, selector);
		};
	}
};

},{"../helpers/nativeMatches":120,"../helpers/validate":121,"../vendor/sizzle/sizzle":132,"ac-dom-nodes":97}],131:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var children = require('./children');
var validate = require('./helpers/validate');

/**
 * @name module:ac-dom-traversal.siblings
 *
 * @function
 *
 * @desc Returns an Array of Elements that are siblings of the specified Node, matching an optional CSS selector.
 *
 * @param {Node} node
 *        The Element, TextNode, or Comment.
 *
 * @param {String} [selector]
 *        Optional CSS selectors, separated by commas, to filter sibling Elements by.
 *
 * @returns {Element[]} Array of matching sibling Elements, in DOM order.
 */
module.exports = function siblings(node, selector) {
 	var els = [];

 	validate.childNode(node, true, 'siblings');
 	validate.selector(selector, false, 'siblings');

 	if (node.parentNode) {
 		els = children(node.parentNode, selector);
 		els = els.filter(function (el) {
 			return (el !== node);
 		});
 	}

 	return els;
};

},{"./children":117,"./helpers/validate":121}],132:[function(require,module,exports){
/*!
 * Sizzle CSS Selector Engine
 *  Copyright 2012, The Dojo Foundation
 *  Released under the MIT, BSD, and GPL Licenses.
 *  More information: http://sizzlejs.com/
 */
/**
 * Finally found the exact commit for this version of Sizzle
 * commit: 683924fb73bafc5447b86cc5a38a4d99108e1196
 * @see https://github.com/jquery/sizzle/tree/683924fb73bafc5447b86cc5a38a4d99108e1196
 *
 * This is an unreleased version in between 1.7.2 and 1.8.0 committed 2012-07-23
 * It was basic tag: 1.8.0~9
 *
 * Since then this has been modified with:
 * - 2014-05-13 jisaacs: This comment block (cut a fork of the above mentioned commit)
 * - 2014-01-14 glan: CommonJS module.exports at the bottom of the file (ac-base)
 */
(function( window, undefined ) {

var cachedruns,
	dirruns,
	sortOrder,
	siblingCheck,
	assertGetIdNotName,

	document = window.document,
	docElem = document.documentElement,

	strundefined = "undefined",
	hasDuplicate = false,
	baseHasDuplicate = true,
	done = 0,
	slice = [].slice,
	push = [].push,

	expando = ( "sizcache" + Math.random() ).replace( ".", "" ),

	// Regex

	// Whitespace characters http://www.w3.org/TR/css3-selectors/#whitespace
	whitespace = "[\\x20\\t\\r\\n\\f]",
	// http://www.w3.org/TR/css3-syntax/#characters
	characterEncoding = "(?:\\\\.|[-\\w]|[^\\x00-\\xa0])",

	// Loosely modeled on Javascript identifier characters
	identifier = "(?:[\\w#_-]|[^\\x00-\\xa0]|\\\\.)",
	// Acceptable operators http://www.w3.org/TR/selectors/#attribute-selectors
	operators = "([*^$|!~]?=)",
	attributes = "\\[" + whitespace + "*(" + characterEncoding + "+)" + whitespace +
		"*(?:" + operators + whitespace + "*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|(" + identifier + "+)|)|)" + whitespace + "*\\]",
	pseudos = ":(" + characterEncoding + "+)(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|(.*))\\)|)",
	pos = ":(nth|eq|gt|lt|first|last|even|odd)(?:\\((\\d*)\\)|)(?=[^-]|$)",
	combinators = whitespace + "*([\\x20\\t\\r\\n\\f>+~])" + whitespace + "*",
	groups = "(?=[^\\x20\\t\\r\\n\\f])(?:\\\\.|" + attributes + "|" + pseudos.replace( 2, 7 ) + "|[^\\\\(),])+",

	// Leading and non-escaped trailing whitespace, capturing some non-whitespace characters preceding the latter
	rtrim = new RegExp( "^" + whitespace + "+|((?:^|[^\\\\])(?:\\\\.)*)" + whitespace + "+$", "g" ),

	rcombinators = new RegExp( "^" + combinators ),

	// All simple (non-comma) selectors, excluding insignifant trailing whitespace
	rgroups = new RegExp( groups + "?(?=" + whitespace + "*,|$)", "g" ),

	// A selector, or everything after leading whitespace
	// Optionally followed in either case by a ")" for terminating sub-selectors
	rselector = new RegExp( "^(?:(?!,)(?:(?:^|,)" + whitespace + "*" + groups + ")*?|" + whitespace + "*(.*?))(\\)|$)" ),

	// All combinators and selector components (attribute test, tag, pseudo, etc.), the latter appearing together when consecutive
	rtokens = new RegExp( groups.slice( 19, -6 ) + "\\x20\\t\\r\\n\\f>+~])+|" + combinators, "g" ),

	// Easily-parseable/retrievable ID or TAG or CLASS selectors
	rquickExpr = /^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,

	rsibling = /[\x20\t\r\n\f]*[+~]/,
	rendsWithNot = /:not\($/,

	rheader = /h\d/i,
	rinputs = /input|select|textarea|button/i,

	rbackslash = /\\(?!\\)/g,

	matchExpr = {
		"ID": new RegExp( "^#(" + characterEncoding + "+)" ),
		"CLASS": new RegExp( "^\\.(" + characterEncoding + "+)" ),
		"NAME": new RegExp( "^\\[name=['\"]?(" + characterEncoding + "+)['\"]?\\]" ),
		"TAG": new RegExp( "^(" + characterEncoding.replace( "[-", "[-\\*" ) + "+)" ),
		"ATTR": new RegExp( "^" + attributes ),
		"PSEUDO": new RegExp( "^" + pseudos ),
		"CHILD": new RegExp( "^:(only|nth|last|first)-child(?:\\(" + whitespace +
			"*(even|odd|(([+-]|)(\\d*)n|)" + whitespace + "*(?:([+-]|)" + whitespace +
			"*(\\d+)|))" + whitespace + "*\\)|)", "i" ),
		"POS": new RegExp( pos, "ig" ),
		// For use in libraries implementing .is()
		"needsContext": new RegExp( "^" + whitespace + "*[>+~]|" + pos, "i" )
	},

	classCache = {},
	cachedClasses = [],
	compilerCache = {},
	cachedSelectors = [],

	// Mark a function for use in filtering
	markFunction = function( fn ) {
		fn.sizzleFilter = true;
		return fn;
	},

	// Returns a function to use in pseudos for input types
	createInputFunction = function( type ) {
		return function( elem ) {
			// Check the input's nodeName and type
			return elem.nodeName.toLowerCase() === "input" && elem.type === type;
		};
	},

	// Returns a function to use in pseudos for buttons
	createButtonFunction = function( type ) {
		return function( elem ) {
			var name = elem.nodeName.toLowerCase();
			return (name === "input" || name === "button") && elem.type === type;
		};
	},

	// Used for testing something on an element
	assert = function( fn ) {
		var pass = false,
			div = document.createElement("div");
		try {
			pass = fn( div );
		} catch (e) {}
		// release memory in IE
		div = null;
		return pass;
	},

	// Check if attributes should be retrieved by attribute nodes
	assertAttributes = assert(function( div ) {
		div.innerHTML = "<select></select>";
		var type = typeof div.lastChild.getAttribute("multiple");
		// IE8 returns a string for some attributes even when not present
		return type !== "boolean" && type !== "string";
	}),

	// Check if getElementById returns elements by name
	// Check if getElementsByName privileges form controls or returns elements by ID
	assertUsableName = assert(function( div ) {
		// Inject content
		div.id = expando + 0;
		div.innerHTML = "<a name='" + expando + "'></a><div name='" + expando + "'></div>";
		docElem.insertBefore( div, docElem.firstChild );

		// Test
		var pass = document.getElementsByName &&
			// buggy browsers will return fewer than the correct 2
			document.getElementsByName( expando ).length ===
			// buggy browsers will return more than the correct 0
			2 + document.getElementsByName( expando + 0 ).length;
		assertGetIdNotName = !document.getElementById( expando );

		// Cleanup
		docElem.removeChild( div );

		return pass;
	}),

	// Check if the browser returns only elements
	// when doing getElementsByTagName("*")
	assertTagNameNoComments = assert(function( div ) {
		div.appendChild( document.createComment("") );
		return div.getElementsByTagName("*").length === 0;
	}),

	// Check if getAttribute returns normalized href attributes
	assertHrefNotNormalized = assert(function( div ) {
		div.innerHTML = "<a href='#'></a>";
		return div.firstChild && typeof div.firstChild.getAttribute !== strundefined &&
			div.firstChild.getAttribute("href") === "#";
	}),

	// Check if getElementsByClassName can be trusted
	assertUsableClassName = assert(function( div ) {
		// Opera can't find a second classname (in 9.6)
		div.innerHTML = "<div class='hidden e'></div><div class='hidden'></div>";
		if ( !div.getElementsByClassName || div.getElementsByClassName("e").length === 0 ) {
			return false;
		}

		// Safari caches class attributes, doesn't catch changes (in 3.2)
		div.lastChild.className = "e";
		return div.getElementsByClassName("e").length !== 1;
	});

var Sizzle = function( selector, context, results, seed ) {
	results = results || [];
	context = context || document;
	var match, elem, xml, m,
		nodeType = context.nodeType;

	if ( nodeType !== 1 && nodeType !== 9 ) {
		return [];
	}

	if ( !selector || typeof selector !== "string" ) {
		return results;
	}

	xml = isXML( context );

	if ( !xml && !seed ) {
		if ( (match = rquickExpr.exec( selector )) ) {
			// Speed-up: Sizzle("#ID")
			if ( (m = match[1]) ) {
				if ( nodeType === 9 ) {
					elem = context.getElementById( m );
					// Check parentNode to catch when Blackberry 4.6 returns
					// nodes that are no longer in the document #6963
					if ( elem && elem.parentNode ) {
						// Handle the case where IE, Opera, and Webkit return items
						// by name instead of ID
						if ( elem.id === m ) {
							results.push( elem );
							return results;
						}
					} else {
						return results;
					}
				} else {
					// Context is not a document
					if ( context.ownerDocument && (elem = context.ownerDocument.getElementById( m )) &&
						contains( context, elem ) && elem.id === m ) {
						results.push( elem );
						return results;
					}
				}

			// Speed-up: Sizzle("TAG")
			} else if ( match[2] ) {
				push.apply( results, slice.call(context.getElementsByTagName( selector ), 0) );
				return results;

			// Speed-up: Sizzle(".CLASS")
			} else if ( (m = match[3]) && assertUsableClassName && context.getElementsByClassName ) {
				push.apply( results, slice.call(context.getElementsByClassName( m ), 0) );
				return results;
			}
		}
	}

	// All others
	return select( selector, context, results, seed, xml );
};

var Expr = Sizzle.selectors = {

	// Can be adjusted by the user
	cacheLength: 50,

	match: matchExpr,

	order: [ "ID", "TAG" ],

	attrHandle: {},

	createPseudo: markFunction,

	find: {
		"ID": assertGetIdNotName ?
			function( id, context, xml ) {
				if ( typeof context.getElementById !== strundefined && !xml ) {
					var m = context.getElementById( id );
					// Check parentNode to catch when Blackberry 4.6 returns
					// nodes that are no longer in the document #6963
					return m && m.parentNode ? [m] : [];
				}
			} :
			function( id, context, xml ) {
				if ( typeof context.getElementById !== strundefined && !xml ) {
					var m = context.getElementById( id );

					return m ?
						m.id === id || typeof m.getAttributeNode !== strundefined && m.getAttributeNode("id").value === id ?
							[m] :
							undefined :
						[];
				}
			},

		"TAG": assertTagNameNoComments ?
			function( tag, context ) {
				if ( typeof context.getElementsByTagName !== strundefined ) {
					return context.getElementsByTagName( tag );
				}
			} :
			function( tag, context ) {
				var results = context.getElementsByTagName( tag );

				// Filter out possible comments
				if ( tag === "*" ) {
					var elem,
						tmp = [],
						i = 0;

					for ( ; (elem = results[i]); i++ ) {
						if ( elem.nodeType === 1 ) {
							tmp.push( elem );
						}
					}

					return tmp;
				}
				return results;
			}
	},

	relative: {
		">": { dir: "parentNode", first: true },
		" ": { dir: "parentNode" },
		"+": { dir: "previousSibling", first: true },
		"~": { dir: "previousSibling" }
	},

	preFilter: {
		"ATTR": function( match ) {
			match[1] = match[1].replace( rbackslash, "" );

			// Move the given value to match[3] whether quoted or unquoted
			match[3] = ( match[4] || match[5] || "" ).replace( rbackslash, "" );

			if ( match[2] === "~=" ) {
				match[3] = " " + match[3] + " ";
			}

			return match.slice( 0, 4 );
		},

		"CHILD": function( match ) {
			/* matches from matchExpr.CHILD
				1 type (only|nth|...)
				2 argument (even|odd|\d*|\d*n([+-]\d+)?|...)
				3 xn-component of xn+y argument ([+-]?\d*n|)
				4 sign of xn-component
				5 x of xn-component
				6 sign of y-component
				7 y of y-component
			*/
			match[1] = match[1].toLowerCase();

			if ( match[1] === "nth" ) {
				// nth-child requires argument
				if ( !match[2] ) {
					Sizzle.error( match[0] );
				}

				// numeric x and y parameters for Expr.filter.CHILD
				// remember that false/true cast respectively to 0/1
				match[3] = +( match[3] ? match[4] + (match[5] || 1) : 2 * ( match[2] === "even" || match[2] === "odd" ) );
				match[4] = +( ( match[6] + match[7] ) || match[2] === "odd" );

			// other types prohibit arguments
			} else if ( match[2] ) {
				Sizzle.error( match[0] );
			}

			return match;
		},

		"PSEUDO": function( match ) {
			var argument,
				unquoted = match[4];

			if ( matchExpr["CHILD"].test( match[0] ) ) {
				return null;
			}

			// Relinquish our claim on characters in `unquoted` from a closing parenthesis on
			if ( unquoted && (argument = rselector.exec( unquoted )) && argument.pop() ) {

				match[0] = match[0].slice( 0, argument[0].length - unquoted.length - 1 );
				unquoted = argument[0].slice( 0, -1 );
			}

			// Quoted or unquoted, we have the full argument
			// Return only captures needed by the pseudo filter method (type and argument)
			match.splice( 2, 3, unquoted || match[3] );
			return match;
		}
	},

	filter: {
		"ID": assertGetIdNotName ?
			function( id ) {
				id = id.replace( rbackslash, "" );
				return function( elem ) {
					return elem.getAttribute("id") === id;
				};
			} :
			function( id ) {
				id = id.replace( rbackslash, "" );
				return function( elem ) {
					var node = typeof elem.getAttributeNode !== strundefined && elem.getAttributeNode("id");
					return node && node.value === id;
				};
			},

		"TAG": function( nodeName ) {
			if ( nodeName === "*" ) {
				return function() { return true; };
			}
			nodeName = nodeName.replace( rbackslash, "" ).toLowerCase();

			return function( elem ) {
				return elem.nodeName && elem.nodeName.toLowerCase() === nodeName;
			};
		},

		"CLASS": function( className ) {
			var pattern = classCache[ className ];
			if ( !pattern ) {
				pattern = classCache[ className ] = new RegExp( "(^|" + whitespace + ")" + className + "(" + whitespace + "|$)" );
				cachedClasses.push( className );
				// Avoid too large of a cache
				if ( cachedClasses.length > Expr.cacheLength ) {
					delete classCache[ cachedClasses.shift() ];
				}
			}
			return function( elem ) {
				return pattern.test( elem.className || (typeof elem.getAttribute !== strundefined && elem.getAttribute("class")) || "" );
			};
		},

		"ATTR": function( name, operator, check ) {
			if ( !operator ) {
				return function( elem ) {
					return Sizzle.attr( elem, name ) != null;
				};
			}

			return function( elem ) {
				var result = Sizzle.attr( elem, name ),
					value = result + "";

				if ( result == null ) {
					return operator === "!=";
				}

				switch ( operator ) {
					case "=":
						return value === check;
					case "!=":
						return value !== check;
					case "^=":
						return check && value.indexOf( check ) === 0;
					case "*=":
						return check && value.indexOf( check ) > -1;
					case "$=":
						return check && value.substr( value.length - check.length ) === check;
					case "~=":
						return ( " " + value + " " ).indexOf( check ) > -1;
					case "|=":
						return value === check || value.substr( 0, check.length + 1 ) === check + "-";
				}
			};
		},

		"CHILD": function( type, argument, first, last ) {

			if ( type === "nth" ) {
				var doneName = done++;

				return function( elem ) {
					var parent, diff,
						count = 0,
						node = elem;

					if ( first === 1 && last === 0 ) {
						return true;
					}

					parent = elem.parentNode;

					if ( parent && (parent[ expando ] !== doneName || !elem.sizset) ) {
						for ( node = parent.firstChild; node; node = node.nextSibling ) {
							if ( node.nodeType === 1 ) {
								node.sizset = ++count;
								if ( node === elem ) {
									break;
								}
							}
						}

						parent[ expando ] = doneName;
					}

					diff = elem.sizset - last;

					if ( first === 0 ) {
						return diff === 0;

					} else {
						return ( diff % first === 0 && diff / first >= 0 );
					}
				};
			}

			return function( elem ) {
				var node = elem;

				switch ( type ) {
					case "only":
					case "first":
						while ( (node = node.previousSibling) ) {
							if ( node.nodeType === 1 ) {
								return false;
							}
						}

						if ( type === "first" ) {
							return true;
						}

						node = elem;

						/* falls through */
					case "last":
						while ( (node = node.nextSibling) ) {
							if ( node.nodeType === 1 ) {
								return false;
							}
						}

						return true;
				}
			};
		},

		"PSEUDO": function( pseudo, argument, context, xml ) {
			// pseudo-class names are case-insensitive
			// http://www.w3.org/TR/selectors/#pseudo-classes
			// Prioritize by case sensitivity in case custom pseudos are added with uppercase letters
			var fn = Expr.pseudos[ pseudo ] || Expr.pseudos[ pseudo.toLowerCase() ];

			if ( !fn ) {
				Sizzle.error( "unsupported pseudo: " + pseudo );
			}

			// The user may set fn.sizzleFilter to indicate
			// that arguments are needed to create the filter function
			// just as Sizzle does
			if ( !fn.sizzleFilter ) {
				return fn;
			}

			return fn( argument, context, xml );
		}
	},

	pseudos: {
		"not": markFunction(function( selector, context, xml ) {
			// Trim the selector passed to compile
			// to avoid treating leading and trailing
			// spaces as combinators
			var matcher = compile( selector.replace( rtrim, "$1" ), context, xml );
			return function( elem ) {
				return !matcher( elem );
			};
		}),

		"enabled": function( elem ) {
			return elem.disabled === false;
		},

		"disabled": function( elem ) {
			return elem.disabled === true;
		},

		"checked": function( elem ) {
			// In CSS3, :checked should return both checked and selected elements
			// http://www.w3.org/TR/2011/REC-css3-selectors-20110929/#checked
			var nodeName = elem.nodeName.toLowerCase();
			return (nodeName === "input" && !!elem.checked) || (nodeName === "option" && !!elem.selected);
		},

		"selected": function( elem ) {
			// Accessing this property makes selected-by-default
			// options in Safari work properly
			if ( elem.parentNode ) {
				elem.parentNode.selectedIndex;
			}

			return elem.selected === true;
		},

		"parent": function( elem ) {
			return !!elem.firstChild;
		},

		"empty": function( elem ) {
			return !elem.firstChild;
		},

		"contains": markFunction(function( text ) {
			return function( elem ) {
				return ( elem.textContent || elem.innerText || getText( elem ) ).indexOf( text ) > -1;
			};
		}),

		"has": markFunction(function( selector ) {
			return function( elem ) {
				return Sizzle( selector, elem ).length > 0;
			};
		}),

		"header": function( elem ) {
			return rheader.test( elem.nodeName );
		},

		"text": function( elem ) {
			var type, attr;
			// IE6 and 7 will map elem.type to 'text' for new HTML5 types (search, etc)
			// use getAttribute instead to test this case
			return elem.nodeName.toLowerCase() === "input" &&
				(type = elem.type) === "text" &&
				( (attr = elem.getAttribute("type")) == null || attr.toLowerCase() === type );
		},

		// Input types
		"radio": createInputFunction("radio"),
		"checkbox": createInputFunction("checkbox"),
		"file": createInputFunction("file"),
		"password": createInputFunction("password"),
		"image": createInputFunction("image"),

		"submit": createButtonFunction("submit"),
		"reset": createButtonFunction("reset"),

		"button": function( elem ) {
			var name = elem.nodeName.toLowerCase();
			return name === "input" && elem.type === "button" || name === "button";
		},

		"input": function( elem ) {
			return rinputs.test( elem.nodeName );
		},

		"focus": function( elem ) {
			var doc = elem.ownerDocument;
			return elem === doc.activeElement && (!doc.hasFocus || doc.hasFocus()) && !!(elem.type || elem.href);
		},

		"active": function( elem ) {
			return elem === elem.ownerDocument.activeElement;
		}
	},

	setFilters: {
		"first": function( elements, argument, not ) {
			return not ? elements.slice( 1 ) : [ elements[0] ];
		},

		"last": function( elements, argument, not ) {
			var elem = elements.pop();
			return not ? elements : [ elem ];
		},

		"even": function( elements, argument, not ) {
			var results = [],
				i = not ? 1 : 0,
				len = elements.length;
			for ( ; i < len; i = i + 2 ) {
				results.push( elements[i] );
			}
			return results;
		},

		"odd": function( elements, argument, not ) {
			var results = [],
				i = not ? 0 : 1,
				len = elements.length;
			for ( ; i < len; i = i + 2 ) {
				results.push( elements[i] );
			}
			return results;
		},

		"lt": function( elements, argument, not ) {
			return not ? elements.slice( +argument ) : elements.slice( 0, +argument );
		},

		"gt": function( elements, argument, not ) {
			return not ? elements.slice( 0, +argument + 1 ) : elements.slice( +argument + 1 );
		},

		"eq": function( elements, argument, not ) {
			var elem = elements.splice( +argument, 1 );
			return not ? elements : elem;
		}
	}
};

// Deprecated
Expr.setFilters["nth"] = Expr.setFilters["eq"];

// Back-compat
Expr.filters = Expr.pseudos;

// IE6/7 return a modified href
if ( !assertHrefNotNormalized ) {
	Expr.attrHandle = {
		"href": function( elem ) {
			return elem.getAttribute( "href", 2 );
		},
		"type": function( elem ) {
			return elem.getAttribute("type");
		}
	};
}

// Add getElementsByName if usable
if ( assertUsableName ) {
	Expr.order.push("NAME");
	Expr.find["NAME"] = function( name, context ) {
		if ( typeof context.getElementsByName !== strundefined ) {
			return context.getElementsByName( name );
		}
	};
}

// Add getElementsByClassName if usable
if ( assertUsableClassName ) {
	Expr.order.splice( 1, 0, "CLASS" );
	Expr.find["CLASS"] = function( className, context, xml ) {
		if ( typeof context.getElementsByClassName !== strundefined && !xml ) {
			return context.getElementsByClassName( className );
		}
	};
}

// If slice is not available, provide a backup
try {
	slice.call( docElem.childNodes, 0 )[0].nodeType;
} catch ( e ) {
	slice = function( i ) {
		var elem, results = [];
		for ( ; (elem = this[i]); i++ ) {
			results.push( elem );
		}
		return results;
	};
}

var isXML = Sizzle.isXML = function( elem ) {
	// documentElement is verified for cases where it doesn't yet exist
	// (such as loading iframes in IE - #4833)
	var documentElement = elem && (elem.ownerDocument || elem).documentElement;
	return documentElement ? documentElement.nodeName !== "HTML" : false;
};

// Element contains another
var contains = Sizzle.contains = docElem.compareDocumentPosition ?
	function( a, b ) {
		return !!( a.compareDocumentPosition( b ) & 16 );
	} :
	docElem.contains ?
	function( a, b ) {
		var adown = a.nodeType === 9 ? a.documentElement : a,
			bup = b.parentNode;
		return a === bup || !!( bup && bup.nodeType === 1 && adown.contains && adown.contains(bup) );
	} :
	function( a, b ) {
		while ( (b = b.parentNode) ) {
			if ( b === a ) {
				return true;
			}
		}
		return false;
	};

/**
 * Utility function for retrieving the text value of an array of DOM nodes
 * @param {Array|Element} elem
 */
var getText = Sizzle.getText = function( elem ) {
	var node,
		ret = "",
		i = 0,
		nodeType = elem.nodeType;

	if ( nodeType ) {
		if ( nodeType === 1 || nodeType === 9 || nodeType === 11 ) {
			// Use textContent for elements
			// innerText usage removed for consistency of new lines (see #11153)
			if ( typeof elem.textContent === "string" ) {
				return elem.textContent;
			} else {
				// Traverse its children
				for ( elem = elem.firstChild; elem; elem = elem.nextSibling ) {
					ret += getText( elem );
				}
			}
		} else if ( nodeType === 3 || nodeType === 4 ) {
			return elem.nodeValue;
		}
		// Do not include comment or processing instruction nodes
	} else {

		// If no nodeType, this is expected to be an array
		for ( ; (node = elem[i]); i++ ) {
			// Do not traverse comment nodes
			ret += getText( node );
		}
	}
	return ret;
};

Sizzle.attr = function( elem, name ) {
	var attr,
		xml = isXML( elem );

	if ( !xml ) {
		name = name.toLowerCase();
	}
	if ( Expr.attrHandle[ name ] ) {
		return Expr.attrHandle[ name ]( elem );
	}
	if ( assertAttributes || xml ) {
		return elem.getAttribute( name );
	}
	attr = elem.getAttributeNode( name );
	return attr ?
		typeof elem[ name ] === "boolean" ?
			elem[ name ] ? name : null :
			attr.specified ? attr.value : null :
		null;
};

Sizzle.error = function( msg ) {
	throw new Error( "Syntax error, unrecognized expression: " + msg );
};

// Check if the JavaScript engine is using some sort of
// optimization where it does not always call our comparision
// function. If that is the case, discard the hasDuplicate value.
//   Thus far that includes Google Chrome.
[0, 0].sort(function() {
	return (baseHasDuplicate = 0);
});


if ( docElem.compareDocumentPosition ) {
	sortOrder = function( a, b ) {
		if ( a === b ) {
			hasDuplicate = true;
			return 0;
		}

		return ( !a.compareDocumentPosition || !b.compareDocumentPosition ?
			a.compareDocumentPosition :
			a.compareDocumentPosition(b) & 4
		) ? -1 : 1;
	};

} else {
	sortOrder = function( a, b ) {
		// The nodes are identical, we can exit early
		if ( a === b ) {
			hasDuplicate = true;
			return 0;

		// Fallback to using sourceIndex (in IE) if it's available on both nodes
		} else if ( a.sourceIndex && b.sourceIndex ) {
			return a.sourceIndex - b.sourceIndex;
		}

		var al, bl,
			ap = [],
			bp = [],
			aup = a.parentNode,
			bup = b.parentNode,
			cur = aup;

		// If the nodes are siblings (or identical) we can do a quick check
		if ( aup === bup ) {
			return siblingCheck( a, b );

		// If no parents were found then the nodes are disconnected
		} else if ( !aup ) {
			return -1;

		} else if ( !bup ) {
			return 1;
		}

		// Otherwise they're somewhere else in the tree so we need
		// to build up a full list of the parentNodes for comparison
		while ( cur ) {
			ap.unshift( cur );
			cur = cur.parentNode;
		}

		cur = bup;

		while ( cur ) {
			bp.unshift( cur );
			cur = cur.parentNode;
		}

		al = ap.length;
		bl = bp.length;

		// Start walking down the tree looking for a discrepancy
		for ( var i = 0; i < al && i < bl; i++ ) {
			if ( ap[i] !== bp[i] ) {
				return siblingCheck( ap[i], bp[i] );
			}
		}

		// We ended someplace up the tree so do a sibling check
		return i === al ?
			siblingCheck( a, bp[i], -1 ) :
			siblingCheck( ap[i], b, 1 );
	};

	siblingCheck = function( a, b, ret ) {
		if ( a === b ) {
			return ret;
		}

		var cur = a.nextSibling;

		while ( cur ) {
			if ( cur === b ) {
				return -1;
			}

			cur = cur.nextSibling;
		}

		return 1;
	};
}

// Document sorting and removing duplicates
Sizzle.uniqueSort = function( results ) {
	var elem,
		i = 1;

	if ( sortOrder ) {
		hasDuplicate = baseHasDuplicate;
		results.sort( sortOrder );

		if ( hasDuplicate ) {
			for ( ; (elem = results[i]); i++ ) {
				if ( elem === results[ i - 1 ] ) {
					results.splice( i--, 1 );
				}
			}
		}
	}

	return results;
};

function multipleContexts( selector, contexts, results, seed ) {
	var i = 0,
		len = contexts.length;
	for ( ; i < len; i++ ) {
		Sizzle( selector, contexts[i], results, seed );
	}
}

function handlePOSGroup( selector, posfilter, argument, contexts, seed, not ) {
	var results,
		fn = Expr.setFilters[ posfilter.toLowerCase() ];

	if ( !fn ) {
		Sizzle.error( posfilter );
	}

	if ( selector || !(results = seed) ) {
		multipleContexts( selector || "*", contexts, (results = []), seed );
	}

	return results.length > 0 ? fn( results, argument, not ) : [];
}

function handlePOS( selector, context, results, seed, groups ) {
	var match, not, anchor, ret, elements, currentContexts, part, lastIndex,
		i = 0,
		len = groups.length,
		rpos = matchExpr["POS"],
		// This is generated here in case matchExpr["POS"] is extended
		rposgroups = new RegExp( "^" + rpos.source + "(?!" + whitespace + ")", "i" ),
		// This is for making sure non-participating
		// matching groups are represented cross-browser (IE6-8)
		setUndefined = function() {
			var i = 1,
				len = arguments.length - 2;
			for ( ; i < len; i++ ) {
				if ( arguments[i] === undefined ) {
					match[i] = undefined;
				}
			}
		};

	for ( ; i < len; i++ ) {
		// Reset regex index to 0
		rpos.exec("");
		selector = groups[i];
		ret = [];
		anchor = 0;
		elements = seed;
		while ( (match = rpos.exec( selector )) ) {
			lastIndex = rpos.lastIndex = match.index + match[0].length;
			if ( lastIndex > anchor ) {
				part = selector.slice( anchor, match.index );
				anchor = lastIndex;
				currentContexts = [ context ];

				if ( rcombinators.test(part) ) {
					if ( elements ) {
						currentContexts = elements;
					}
					elements = seed;
				}

				if ( (not = rendsWithNot.test( part )) ) {
					part = part.slice( 0, -5 ).replace( rcombinators, "$&*" );
				}

				if ( match.length > 1 ) {
					match[0].replace( rposgroups, setUndefined );
				}
				elements = handlePOSGroup( part, match[1], match[2], currentContexts, elements, not );
			}
		}

		if ( elements ) {
			ret = ret.concat( elements );

			if ( (part = selector.slice( anchor )) && part !== ")" ) {
				multipleContexts( part, ret, results, seed );
			} else {
				push.apply( results, ret );
			}
		} else {
			Sizzle( selector, context, results, seed );
		}
	}

	// Do not sort if this is a single filter
	return len === 1 ? results : Sizzle.uniqueSort( results );
}

function tokenize( selector, context, xml ) {
	var tokens, soFar, type,
		groups = [],
		i = 0,

		// Catch obvious selector issues: terminal ")"; nonempty fallback match
		// rselector never fails to match *something*
		match = rselector.exec( selector ),
		matched = !match.pop() && !match.pop(),
		selectorGroups = matched && selector.match( rgroups ) || [""],

		preFilters = Expr.preFilter,
		filters = Expr.filter,
		checkContext = !xml && context !== document;

	for ( ; (soFar = selectorGroups[i]) != null && matched; i++ ) {
		groups.push( tokens = [] );

		// Need to make sure we're within a narrower context if necessary
		// Adding a descendant combinator will generate what is needed
		if ( checkContext ) {
			soFar = " " + soFar;
		}

		while ( soFar ) {
			matched = false;

			// Combinators
			if ( (match = rcombinators.exec( soFar )) ) {
				soFar = soFar.slice( match[0].length );

				// Cast descendant combinators to space
				matched = tokens.push({ part: match.pop().replace( rtrim, " " ), captures: match });
			}

			// Filters
			for ( type in filters ) {
				if ( (match = matchExpr[ type ].exec( soFar )) && (!preFilters[ type ] ||
					(match = preFilters[ type ]( match, context, xml )) ) ) {

					soFar = soFar.slice( match.shift().length );
					matched = tokens.push({ part: type, captures: match });
				}
			}

			if ( !matched ) {
				break;
			}
		}
	}

	if ( !matched ) {
		Sizzle.error( selector );
	}

	return groups;
}

function addCombinator( matcher, combinator, context ) {
	var dir = combinator.dir,
		doneName = done++;

	if ( !matcher ) {
		// If there is no matcher to check, check against the context
		matcher = function( elem ) {
			return elem === context;
		};
	}
	return combinator.first ?
		function( elem, context ) {
			while ( (elem = elem[ dir ]) ) {
				if ( elem.nodeType === 1 ) {
					return matcher( elem, context ) && elem;
				}
			}
		} :
		function( elem, context ) {
			var cache,
				dirkey = doneName + "." + dirruns,
				cachedkey = dirkey + "." + cachedruns;
			while ( (elem = elem[ dir ]) ) {
				if ( elem.nodeType === 1 ) {
					if ( (cache = elem[ expando ]) === cachedkey ) {
						return false;
					} else if ( typeof cache === "string" && cache.indexOf(dirkey) === 0 ) {
						if ( elem.sizset ) {
							return elem;
						}
					} else {
						elem[ expando ] = cachedkey;
						if ( matcher( elem, context ) ) {
							elem.sizset = true;
							return elem;
						}
						elem.sizset = false;
					}
				}
			}
		};
}

function addMatcher( higher, deeper ) {
	return higher ?
		function( elem, context ) {
			var result = deeper( elem, context );
			return result && higher( result === true ? elem : result, context );
		} :
		deeper;
}

// ["TAG", ">", "ID", " ", "CLASS"]
function matcherFromTokens( tokens, context, xml ) {
	var token, matcher,
		i = 0;

	for ( ; (token = tokens[i]); i++ ) {
		if ( Expr.relative[ token.part ] ) {
			matcher = addCombinator( matcher, Expr.relative[ token.part ], context );
		} else {
			token.captures.push( context, xml );
			matcher = addMatcher( matcher, Expr.filter[ token.part ].apply( null, token.captures ) );
		}
	}

	return matcher;
}

function matcherFromGroupMatchers( matchers ) {
	return function( elem, context ) {
		var matcher,
			j = 0;
		for ( ; (matcher = matchers[j]); j++ ) {
			if ( matcher(elem, context) ) {
				return true;
			}
		}
		return false;
	};
}

var compile = Sizzle.compile = function( selector, context, xml ) {
	var tokens, group, i,
		cached = compilerCache[ selector ];

	// Return a cached group function if already generated (context dependent)
	if ( cached && cached.context === context ) {
		cached.dirruns++;
		return cached;
	}

	// Generate a function of recursive functions that can be used to check each element
	group = tokenize( selector, context, xml );
	for ( i = 0; (tokens = group[i]); i++ ) {
		group[i] = matcherFromTokens( tokens, context, xml );
	}

	// Cache the compiled function
	cached = compilerCache[ selector ] = matcherFromGroupMatchers( group );
	cached.context = context;
	cached.runs = cached.dirruns = 0;
	cachedSelectors.push( selector );
	// Ensure only the most recent are cached
	if ( cachedSelectors.length > Expr.cacheLength ) {
		delete compilerCache[ cachedSelectors.shift() ];
	}
	return cached;
};

Sizzle.matches = function( expr, elements ) {
	return Sizzle( expr, null, null, elements );
};

Sizzle.matchesSelector = function( elem, expr ) {
	return Sizzle( expr, null, null, [ elem ] ).length > 0;
};

var select = function( selector, context, results, seed, xml ) {
	// Remove excessive whitespace
	selector = selector.replace( rtrim, "$1" );
	var elements, matcher, i, len, elem, token,
		type, findContext, notTokens,
		match = selector.match( rgroups ),
		tokens = selector.match( rtokens ),
		contextNodeType = context.nodeType;

	// POS handling
	if ( matchExpr["POS"].test(selector) ) {
		return handlePOS( selector, context, results, seed, match );
	}

	if ( seed ) {
		elements = slice.call( seed, 0 );

	// To maintain document order, only narrow the
	// set if there is one group
	} else if ( match && match.length === 1 ) {

		// Take a shortcut and set the context if the root selector is an ID
		if ( tokens.length > 1 && contextNodeType === 9 && !xml &&
				(match = matchExpr["ID"].exec( tokens[0] )) ) {

			context = Expr.find["ID"]( match[1], context, xml )[0];
			if ( !context ) {
				return results;
			}

			selector = selector.slice( tokens.shift().length );
		}

		findContext = ( (match = rsibling.exec( tokens[0] )) && !match.index && context.parentNode ) || context;

		// Get the last token, excluding :not
		notTokens = tokens.pop();
		token = notTokens.split(":not")[0];

		for ( i = 0, len = Expr.order.length; i < len; i++ ) {
			type = Expr.order[i];

			if ( (match = matchExpr[ type ].exec( token )) ) {
				elements = Expr.find[ type ]( (match[1] || "").replace( rbackslash, "" ), findContext, xml );

				if ( elements == null ) {
					continue;
				}

				if ( token === notTokens ) {
					selector = selector.slice( 0, selector.length - notTokens.length ) +
						token.replace( matchExpr[ type ], "" );

					if ( !selector ) {
						push.apply( results, slice.call(elements, 0) );
					}
				}
				break;
			}
		}
	}

	// Only loop over the given elements once
	// If selector is empty, we're already done
	if ( selector ) {
		matcher = compile( selector, context, xml );
		dirruns = matcher.dirruns;

		if ( elements == null ) {
			elements = Expr.find["TAG"]( "*", (rsibling.test( selector ) && context.parentNode) || context );
		}
		for ( i = 0; (elem = elements[i]); i++ ) {
			cachedruns = matcher.runs++;
			if ( matcher(elem, context) ) {
				results.push( elem );
			}
		}
	}

	return results;
};

if ( document.querySelectorAll ) {
	(function() {
		var disconnectedMatch,
			oldSelect = select,
			rescape = /'|\\/g,
			rattributeQuotes = /\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,
			rbuggyQSA = [],
			// matchesSelector(:active) reports false when true (IE9/Opera 11.5)
			// A support test would require too much code (would include document ready)
			// just skip matchesSelector for :active
			rbuggyMatches = [":active"],
			matches = docElem.matchesSelector ||
				docElem.mozMatchesSelector ||
				docElem.webkitMatchesSelector ||
				docElem.oMatchesSelector ||
				docElem.msMatchesSelector;

		// Build QSA regex
		// Regex strategy adopted from Diego Perini
		assert(function( div ) {
			div.innerHTML = "<select><option selected></option></select>";

			// IE8 - Some boolean attributes are not treated correctly
			if ( !div.querySelectorAll("[selected]").length ) {
				rbuggyQSA.push( "\\[" + whitespace + "*(?:checked|disabled|ismap|multiple|readonly|selected|value)" );
			}

			// Webkit/Opera - :checked should return selected option elements
			// http://www.w3.org/TR/2011/REC-css3-selectors-20110929/#checked
			// IE8 throws error here (do not put tests after this one)
			if ( !div.querySelectorAll(":checked").length ) {
				rbuggyQSA.push(":checked");
			}
		});

		assert(function( div ) {

			// Opera 10-12/IE9 - ^= $= *= and empty values
			// Should not select anything
			div.innerHTML = "<p test=''></p>";
			if ( div.querySelectorAll("[test^='']").length ) {
				rbuggyQSA.push( "[*^$]=" + whitespace + "*(?:\"\"|'')" );
			}

			// FF 3.5 - :enabled/:disabled and hidden elements (hidden elements are still enabled)
			// IE8 throws error here (do not put tests after this one)
			div.innerHTML = "<input type='hidden'>";
			if ( !div.querySelectorAll(":enabled").length ) {
				rbuggyQSA.push(":enabled", ":disabled");
			}
		});

		rbuggyQSA = rbuggyQSA.length && new RegExp( rbuggyQSA.join("|") );

		select = function( selector, context, results, seed, xml ) {
			// Only use querySelectorAll when not filtering,
			// when this is not xml,
			// and when no QSA bugs apply
			if ( !seed && !xml && (!rbuggyQSA || !rbuggyQSA.test( selector )) ) {
				if ( context.nodeType === 9 ) {
					try {
						push.apply( results, slice.call(context.querySelectorAll( selector ), 0) );
						return results;
					} catch(qsaError) {}
				// qSA works strangely on Element-rooted queries
				// We can work around this by specifying an extra ID on the root
				// and working up from there (Thanks to Andrew Dupont for the technique)
				// IE 8 doesn't work on object elements
				} else if ( context.nodeType === 1 && context.nodeName.toLowerCase() !== "object" ) {
					var old = context.getAttribute("id"),
						nid = old || expando,
						newContext = rsibling.test( selector ) && context.parentNode || context;

					if ( old ) {
						nid = nid.replace( rescape, "\\$&" );
					} else {
						context.setAttribute( "id", nid );
					}

					try {
						push.apply( results, slice.call( newContext.querySelectorAll(
							selector.replace( rgroups, "[id='" + nid + "'] $&" )
						), 0 ) );
						return results;
					} catch(qsaError) {
					} finally {
						if ( !old ) {
							context.removeAttribute("id");
						}
					}
				}
			}

			return oldSelect( selector, context, results, seed, xml );
		};

		if ( matches ) {
			assert(function( div ) {
				// Check to see if it's possible to do matchesSelector
				// on a disconnected node (IE 9)
				disconnectedMatch = matches.call( div, "div" );

				// This should fail with an exception
				// Gecko does not error, returns false instead
				try {
					matches.call( div, "[test!='']:sizzle" );
					rbuggyMatches.push( Expr.match.PSEUDO );
				} catch ( e ) {}
			});

			// rbuggyMatches always contains :active, so no need for a length check
			rbuggyMatches = /* rbuggyMatches.length && */ new RegExp( rbuggyMatches.join("|") );

			Sizzle.matchesSelector = function( elem, expr ) {
				// Make sure that attribute selectors are quoted
				expr = expr.replace( rattributeQuotes, "='$1']" );

				// rbuggyMatches always contains :active, so no need for an existence check
				if ( !isXML( elem ) && !rbuggyMatches.test( expr ) && (!rbuggyQSA || !rbuggyQSA.test( expr )) ) {
					try {
						var ret = matches.call( elem, expr );

						// IE 9's matchesSelector returns false on disconnected nodes
						if ( ret || disconnectedMatch ||
								// As well, disconnected nodes are said to be in a document
								// fragment in IE 9
								elem.document && elem.document.nodeType !== 11 ) {
							return ret;
						}
					} catch(e) {}
				}

				return Sizzle( expr, null, null, [ elem ] ).length > 0;
			};
		}
	})();
}

// EXPOSE

if (typeof module === 'object' && module.exports) {
    module.exports = Sizzle;
} else {
	window.Sizzle = Sizzle;
}
// EXPOSE

})( window );

},{}],133:[function(require,module,exports){
/** 
 * @module ac-dom-emitter
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

module.exports = {
	DOMEmitter: require('./ac-dom-emitter/DOMEmitter')
};

},{"./ac-dom-emitter/DOMEmitter":134}],134:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';
var proto;

var EventEmitter = require('ac-event-emitter').EventEmitter,
    ac_dom_events = require('ac-dom-events'),
    ac_dom_traversal = require('ac-dom-traversal');

/**
 * @name .DOMEmitter
 * @class DOMEmitter
 * <pre>DOMEmitter = require('/DOMEmitter');</pre>
 */

var internalEventPrefix = 'dom-emitter';

function DOMEmitter( el ) {
    if ( el === null ) {
        return;
    }
    this.el = el;
    this._bindings = {};
    this._delegateFuncs = {};
    this._eventEmitter = new EventEmitter();
}

proto = DOMEmitter.prototype;

proto._parseEventNames = function( evt ) {
    // handle any undefined/nulls and send em back
    if ( !evt ) {
        return [ evt ];
    }
    // remove empty string events
    return evt.split(' ');
};

proto._onListenerEvent = function( evtName, e ) {
    this.trigger( evtName, e, false );
};

proto._setListener = function( evt ) {
    this._bindings[ evt ] = this._onListenerEvent.bind( this, evt );
    ac_dom_events.addEventListener( this.el, evt, this._bindings[ evt ] );
};

proto._removeListener = function( evt ) {
    ac_dom_events.removeEventListener( this.el, evt, this._bindings[ evt ] );
    this._bindings[ evt ] = null;
};

proto._triggerInternalEvent = function( evt, data ) {
    this.trigger( internalEventPrefix + ':' + evt, data );
};

proto._normalizeArgumentsAndCall = function( argsArr, func ) {
    /**
     * We use this method to normalize these options:
     *  // Sans-delegation
     *  domEmitter.on( 'click touchend', myFunc ); // 2-arg; string, function
     *  domEmitter.on( 'click touchend', myFunc, ctx ); // 3-arg; string, function, object
     *   
     *  // With Delegation
     *  domEmitter.on( 'click touchend', '.delegate query', myFunc ); // 3-arg; string, string, function
     *  domEmitter.on( 'click touchend', '.delegate query', myFunc, ctx ); // 4-arg; string, string, function, object
     *   
     *  // Object syntax
     *  domEmitter.on({
     *      'click touchend' : myFunc, // Sans-delegation
     *      'click touchend: .delegate query' : myFunc // With delegation
     *  }); // 1-arg; object
     *   
     *  domEmitter.on({
     *      'click' : myFunc,
     *      'click: .delegate query' : myFunc // With delegation
     *  }, ctx ); // 2-arg; object, object
     *
     * domEmitter.off(); // no args
     *
    **/

    var binding = {};

    // handle no-arg situation
    if ( argsArr.length === 0 ) {
        func.call( this, binding );
        return;
    }

    // handle non-object based syntax first
    if ( typeof argsArr[ 0 ] === 'string' || argsArr[ 0 ] === null ) {
        argsArr = this._cleanStringData( argsArr );
        binding.events = argsArr[ 0 ];

        // handle delegate query
        if ( typeof argsArr[ 1 ] === 'string' ) {
            binding.delegateQuery = argsArr[ 1 ];
            binding.callback = argsArr[ 2 ];
            binding.context = argsArr[ 3 ];
        } else {
             // handle non-delegate query
            binding.callback = argsArr[ 1 ];
            binding.context = argsArr[ 2 ];
        }

       func.call( this, binding );
       return;
    }

    // assume type is object here
    var i,
        splits,
        splitChar = ':',
        obj = argsArr[ 0 ];
    for ( i in obj ) {
        if ( obj.hasOwnProperty( i ) ) {
            binding = {};
            // if a colon exists, which will split delegate queries and event names
            splits = this._cleanStringData( i.split( splitChar ) );
            
            // save both. if splits[ 1 ] DNE then it will simply be undefined anyway
            binding.events = splits[ 0 ];
            binding.delegateQuery = splits[ 1 ];

            // set callback and context
            binding.callback = obj[ i ];
            binding.context = argsArr[ 1 ];

            func.call( this, binding );
        }
    }
};

proto._registerDelegateFunc = function( evt, delegateQuery, callback, unboundCallback, context ) {
    // bind a new delegateFunc
    var delegateFunc = this._delegateFunc.bind( this, evt, delegateQuery, callback, context );
    // create an array for delegate funcs with this key if DNE
    this._delegateFuncs[ delegateQuery ] = this._delegateFuncs[ delegateQuery ] || {};
    this._delegateFuncs[ delegateQuery ][ evt ] = this._delegateFuncs[ delegateQuery ][ evt ] || [];
    this._delegateFuncs[ delegateQuery ][ evt ].push({
        func : unboundCallback,
        context : context,
        delegateFunc : delegateFunc
    });

    return delegateFunc;
};

// remove whitespace before/after strings, as well as any empty strings in arrays
proto._cleanStringData = function( arr ) {
    // force it into an array if just a string is passed
    var isString = false;
    if ( typeof arr === 'string' ) {
        arr = [ arr ];
        isString = true; 
    }

    var result = [],
        i,
        val,
        valLen,
        spaceIdx,
        len = arr.length;

    for ( i = 0; i < len; i++ ) {
        val = arr[ i ];

        // if it's a string, check to see if we want it
        if ( typeof val === 'string' ) {
            // if it's an empty string or space, we don't want it. continue
            if ( val === '' || val === ' ' ) {
                continue;
            }

            // we'll remove whitespace in the beginning recursively
            valLen = val.length;
            while( val[ 0 ] === ' ' ) {
                val = val.slice( 1, valLen );
                valLen--;
            }

            // recursively remove whitespace in the end of the string
            while( val[ valLen - 1 ] === ' ' ) {
                val = val.slice( 0, valLen - 1 );
                valLen--;
            }
        }

        result.push( val );
    }

    if ( isString ) {
        return result[ 0 ];
    }

    return result;
};

proto._unregisterDelegateFunc = function( evt, delegateQuery, unboundCallback, context ) {
    // if no delegate functions exist, return
    if ( !this._delegateFuncs[ delegateQuery ] || !this._delegateFuncs[ delegateQuery ][ evt ] ) {
        return;
    }

    // find the index where the binding exists at
    var matchIdx = this._getDelegateFuncBindingIdx( evt, delegateQuery, unboundCallback, context ),
        delegateFunc;

    // if an index was found, remove it from the delegateFunc array
    if ( matchIdx > -1 ) {
        // save the delegate function so it can be unbound via EventEmitter later
        delegateFunc = this._delegateFuncs[ delegateQuery ][ evt ][ matchIdx ].delegateFunc;
        // remove this registry in the array
        this._delegateFuncs[ delegateQuery ][ evt ].splice( matchIdx, 1 );
        // if there aren't any left in the array, nullify this._delegateFuncs[ delegateQuery ][ evt ]
        if ( this._delegateFuncs[ delegateQuery ][ evt ].length === 0 ) {
            this._delegateFuncs[ delegateQuery ][ evt ] = null;
        }
    }

    return delegateFunc;

};

proto._unregisterDelegateFuncs = function( evt, delegateQuery ) {
    // only continue if there are events that need to be removed
    if ( !this._delegateFuncs[ delegateQuery ] ) {
        return;
    }

    if ( evt !== null && !this._delegateFuncs[ delegateQuery ][ evt ] ) {
        return;
    }

    // if the event is null, we just want to iterate over all and unbind
    if ( evt === null ) {
        var i;
        for ( i in this._delegateFuncs[ delegateQuery ] ) {
            if ( this._delegateFuncs[ delegateQuery ].hasOwnProperty( i ) ) {
                this._unbindDelegateFunc( i, delegateQuery );
            }
        }
        return;
    }

    // unbind callbacks just for that event
    this._unbindDelegateFunc( evt, delegateQuery );
};

proto._unbindDelegateFunc = function( evt, delegateQuery ) {
    var binding,
        preRemoveLen,
        i = 0;

    while( this._delegateFuncs[ delegateQuery ][ evt ] && this._delegateFuncs[ delegateQuery ][ evt ][ i ] ) {
        binding = this._delegateFuncs[ delegateQuery ][ evt ][ i ];
        
        // save the length of the events for the delegateQuery stack
        preRemoveLen = this._delegateFuncs[ delegateQuery ][ evt ][ i ].length;
        this._off({
            events : evt,
            delegateQuery : delegateQuery,
            callback : binding.func,
            context : binding.context
        });
        
        // test if an unbind did occur, and if not, we'll add one to 'i' to continue looking for new events
        // if it has changed, we want to keep the current idx because the array has already shifted
        if ( this._delegateFuncs[ delegateQuery ][ evt ] && preRemoveLen === this._delegateFuncs[ delegateQuery ][ evt ].length ) {
            i++;
        }
    }

     binding = preRemoveLen = null;
};

proto._unregisterDelegateFuncsByEvent = function( evt ) {
    var i;
    // for each delegate query
    for ( i in this._delegateFuncs ) {
        if ( this._delegateFuncs.hasOwnProperty( i ) ) {
             this._unregisterDelegateFuncs( evt, i );
        }
    }
};

proto._delegateFunc = function( evt, delegateQuery, callback, context, e ) {
    if ( ac_dom_traversal.matchesSelector( ac_dom_events.target( e ), delegateQuery ) ) {

        var args = Array.prototype.slice.call( arguments, 0 ),
            // remove the four arguments we added ourselves
            unboundArgs = args.slice( 4, args.length );

        context = context || window;
        // if it was a CustomEvent, just get the event data and ignore the rest from the DOM
        if ( typeof e.detail === 'object' ) {
            unboundArgs[ 0 ] = e.detail;
        }
        // call the callback with the natural arguments, minus the three we added ourselves
        callback.call( context, unboundArgs );
    }
};

proto.on = function() {
    this._normalizeArgumentsAndCall( Array.prototype.slice.call( arguments, 0 ), this._on );
    return this;
};

proto.once = function() {
    this._normalizeArgumentsAndCall( Array.prototype.slice.call( arguments, 0 ), this._once );
    return this;
};

proto.off = function() {
    this._normalizeArgumentsAndCall( Array.prototype.slice.call( arguments, 0 ), this._off );
    return this;
};

proto._on = function( binding ) {
    var evts = binding.events,
        callback = binding.callback,
        delegateQuery = binding.delegateQuery,
        context = binding.context,
        unboundCallback = binding.unboundCallback || callback;

    evts = this._parseEventNames( evts );
    evts.forEach( function( callback, unboundCallback, context, delegateQuery, evt ) {

        if ( !this.has( evt ) ) {
            this._setListener( evt );
        }

        // if this should be delegated, register a delegationFunc for it
        if ( typeof delegateQuery === 'string' ) {
            callback = this._registerDelegateFunc( evt, delegateQuery, callback, unboundCallback, context );
        }

         this._triggerInternalEvent( 'willon', {
            evt : evt,
            callback : callback,
            context : context,
            delegateQuery : delegateQuery
        });

        this._eventEmitter.on( evt, callback, context );
       
        this._triggerInternalEvent( 'didon', {
            evt : evt,
            callback : callback,
            context : context,
            delegateQuery : delegateQuery
        });

    }.bind( this, callback, unboundCallback, context, delegateQuery ));

    evts = callback = unboundCallback = delegateQuery = context = null;
};

proto._off = function( binding ) {
    var evts = binding.events,
        callback = binding.callback,
        delegateQuery = binding.delegateQuery,
        context = binding.context,
        unboundCallback = binding.unboundCallback || callback;

     // Handle unbinding all events ( this.off(); )
    if ( typeof evts === 'undefined' ) {
        this._eventEmitter.off();

        // for each event, unbind it
        var i;
        for ( i in this._bindings ) {
            if ( this._bindings.hasOwnProperty( i ) ) {
                this._removeListener( i );
            }
        }

        // for each event in the _delegateFuncs, remove them
        for ( i in this._delegateFuncs ) {
            if ( this._delegateFuncs.hasOwnProperty( i ) ) {
                this._delegateFuncs[ i ] = null;
            }
        }
        return;
    }

    evts = this._parseEventNames( evts );
    evts.forEach( function( callback, unboundCallback, context, delegateQuery, evt ) {

        // if this should be delegated, register a delegationFunc for it
        if ( typeof delegateQuery === 'string' && typeof unboundCallback === 'function' ) {
            callback = this._unregisterDelegateFunc( evt, delegateQuery, unboundCallback, context );
            // if a callback isn't found here, it means that the query was incorrect.
            // this could cause some issues if we let it continue, so we'll return false here
            if ( !callback ) {
                return;
            }
        }

        // if a delegate string was added, but no callback was given, it's essentially .off() just for that query
        if ( typeof delegateQuery === 'string' && typeof callback === 'undefined' ) {
            // we'll iterate over each one and unbind them seperately
            this._unregisterDelegateFuncs( evt, delegateQuery );
            return;
        }

        // if an event was called, with no other params, we want to make sure we remove related delegateBindings from memory too
        if ( typeof evt === 'string' && typeof callback === 'undefined' ) {
            this._unregisterDelegateFuncsByEvent( evt );
            // don't continue here if we had a delegate query, since it will run through this again with correct params
            if ( typeof delegateQuery === 'string' ) {
                return;
            }
        }

        this._triggerInternalEvent( 'willoff', {
            evt : evt,
            callback : callback,
            context : context,
            delegateQuery : delegateQuery
        });

        this._eventEmitter.off( evt, callback, context );
        
        this._triggerInternalEvent( 'didoff', {
            evt : evt,
            callback : callback,
            context : context,
            delegateQuery : delegateQuery
        });

        // for specific events
        if ( !this.has( evt ) ) {
            this._removeListener( evt );
        }
            
    }.bind( this, callback, unboundCallback, context, delegateQuery ));

    evts = callback = unboundCallback = delegateQuery = context = null;
};

proto._once = function( binding ) {
    var evts = binding.events,
        callback = binding.callback,
        delegateQuery = binding.delegateQuery,
        context = binding.context;

    evts = this._parseEventNames( evts );
    evts.forEach( function( callback, context, delegateQuery, evt ) {

        // .once() on a delegate is tricky, because it needs to stay bound until it triggers the callback on the delegate, not this.el
        if ( typeof delegateQuery === 'string' ) {
            // to handle this, it's easiest to polyfill a delegate's .once() on our own
            return this._handleDelegateOnce( evt, callback, context, delegateQuery );
        }
        
        if ( !this.has( evt ) ) {
            this._setListener( evt );
        }

        this._triggerInternalEvent( 'willonce', {
            evt : evt,
            callback : callback,
            context : context,
            delegateQuery : delegateQuery
        });

        // we can trick EventEmitter with .call here, where when it calls .on() internally, it call this.on() instead
        this._eventEmitter.once.call( this, evt, callback, context );
        
        this._triggerInternalEvent( 'didonce', {
            evt : evt,
            callback : callback,
            context : context,
            delegateQuery : delegateQuery
        });

    }.bind( this, callback, context, delegateQuery ));

    evts = callback = delegateQuery = context = null;
};

proto._handleDelegateOnce = function( evt, callback, context, delegateQuery ) {
    this._triggerInternalEvent( 'willonce', {
        evt : evt,
        callback : callback,
        context : context,
        delegateQuery : delegateQuery
    });

    // bind the event with a naturalCallback so we can match correctly
    this._on({
        events: evt,
        context : context,
        delegateQuery: delegateQuery,
        callback: this._getDelegateOnceCallback.bind( this, evt, callback, context, delegateQuery ),
        unboundCallback: callback
    });

    this._triggerInternalEvent( 'didonce', {
        evt : evt,
        callback : callback,
        context : context,
        delegateQuery : delegateQuery
    });

    return this;
};

proto._getDelegateOnceCallback = function( evt, callback, context, delegateQuery ) {
    // there could be any number of arguments, so we'll get them all
    var args = Array.prototype.slice.call( arguments, 0 ),
        // strip the args we added ourselves
        passedArgs = args.slice( 4, args.length );
    // if context, call the callback with the context given and the args
    callback.apply( context, passedArgs );
    // unbind the event after it was called with this.off();
    this._off({
        events : evt,
        delegateQuery : delegateQuery,
        callback : callback,
        context : context 
    });
};

proto._getDelegateFuncBindingIdx = function( evt, delegateQuery, unboundCallback, context, ignoreFuncMatch ) {
    var idx = -1;

    if ( this._delegateFuncs[ delegateQuery ] && this._delegateFuncs[ delegateQuery ][ evt ] ) {
        var i,
            bindingObj,
            len = this._delegateFuncs[ delegateQuery ][ evt ].length;
        for ( i = 0; i < len; i++ ) {
            bindingObj = this._delegateFuncs[ delegateQuery ][ evt ][ i ];

            // sometimes we want to match on whether or not the callback is defined, specifically for .has()
            if ( ignoreFuncMatch && typeof unboundCallback === 'undefined' ) {
                unboundCallback = bindingObj.func;
            }

            if ( bindingObj.func === unboundCallback && bindingObj.context === context ) {
                idx = i;
                break;
            }
        }
    }

    return idx;
};

proto._triggerDelegateEvents = function( evt, delegateQuery, data ) {
    var targets = ac_dom_traversal.querySelectorAll( delegateQuery, this.el );

    var i,
        target,
        len = targets.length;
    for ( i = 0; i < len; i++ ) {
        target = targets[ i ];
        // Expects polyfill for CustomEvent constructor
        if ( document.createEvent ) {
            target.dispatchEvent( new CustomEvent( evt, {
                bubbles : true,
                cancelable : false,
                detail : data
            }));
        } else {
            var eventObject = document.createEventObject();
            eventObject.detail = data;
            target.fireEvent( 'on' + evt, eventObject );
        }
        return target;
    }
};

proto.has = function( evt, callbackOrDelegateQuery, callbackOrContext, context ) {
    // normalize input a bit here
    var delegateQuery,
        callback;

    if ( typeof callbackOrDelegateQuery === 'string' ) {
        delegateQuery = callbackOrDelegateQuery;
        callback = callbackOrContext;
    } else {
        callback = callbackOrDelegateQuery;
        context = callbackOrContext;
    }

    // if a delegateQuery exists, we check inside of this._delegateFuncs for binding info
    if ( delegateQuery ) {
        var matchIdx = this._getDelegateFuncBindingIdx( evt, delegateQuery, callback, context, true );
        if ( matchIdx > -1 ) {
            return true;
        }
        return false;
    }

    if ( this._eventEmitter && this._eventEmitter.has.apply( this._eventEmitter, arguments ) ) {
        return true;
    }
    return false;
};

proto.trigger = function( evts, dataOrDelegateQuery, doNotPropogateOrData, doNotPropogate ) {
    evts = this._parseEventNames( evts );

    var delegateQuery,
        data;

    if ( typeof dataOrDelegateQuery === 'string' ) {
        delegateQuery = this._cleanStringData( dataOrDelegateQuery );
        data = doNotPropogateOrData;
    } else {
        data = dataOrDelegateQuery;
        doNotPropogate = doNotPropogateOrData;
    }

    // clean strings for matching
    evts = this._cleanStringData( evts );

    evts.forEach( function( delegateQuery, data, doNotPropogate, evt ) {
        // if a delegateQuery exists, we have to trigger DOM events to properly catch all of the matches
        if ( delegateQuery ) {
            this._triggerDelegateEvents( evt, delegateQuery, data );
            return;
        }
        this._eventEmitter.trigger( evt, data, doNotPropogate );
    }.bind( this, delegateQuery, data, doNotPropogate ));

    return this;
    
};

proto.propagateTo = function( eventEmitter, prefix ) {
    this._eventEmitter.propagateTo( eventEmitter, prefix );
    return this;
};

proto.stopPropagatingTo = function( eventEmitter ) {
    this._eventEmitter.stopPropagatingTo( eventEmitter );
    return this;
};

proto.destroy = function() {
    this._triggerInternalEvent( 'willdestroy' );
    this.off();
    this.el = this._eventEmitter = this._bindings = this._delegateFuncs = null;
};

module.exports = DOMEmitter;
},{"ac-dom-events":88,"ac-dom-traversal":114,"ac-event-emitter":135}],135:[function(require,module,exports){
/** 
 * @module ac-event-emitter
 * @author Ronald "Doctor" Jett <rjett@apple.com>
 * @copyright 2014 Apple Inc. All rights reserved.
 */
module.exports.EventEmitter = require('./ac-event-emitter/EventEmitter');
},{"./ac-event-emitter/EventEmitter":136}],136:[function(require,module,exports){
/** 
 * @module ac-event-emitter/EventEmitter
 * @classdesc An object that provides an event system
 */
'use strict';

var propagationName = 'EventEmitter:propagation';

/**
 * @constructor
 */
var EventEmitter = function(context) {
    // we should only create a context property if
    // the user is using EventEmitter through composition
    // and not using it as a part of their prototype chain
    if (context) {
        this.context = context;
    }
};

// shorthand to the prototype 
var proto = EventEmitter.prototype;

// test to see if the instant has an object
// that as been allocated to store events
var getEvents = function() {
    if (!this.hasOwnProperty('_events') && typeof this._events !== 'object') {
        this._events = {};
    }
    return this._events;
};

// @arguments arguments Could be:
//  event Single string event, space seperated string, or map of events/callbacks
//  callback Callback function for space seperated or single events
//  context Context to apply to callbacks when invoked
// @argument register The function that will get called for each event/callback/context
var parseEvents = function(args, register) {
    var event = args[0];
    var callback = args[1];
    var context = args[2];

    // event should be a string or an plain object (not an array or null)
    if ((typeof event !== 'string' && typeof event !== 'object') || event === null || Array.isArray(event)) {
        throw new TypeError('Expecting event name to be a string or object.');
    }

    // ensure that calls to on/once with a string for event names
    // also come with a callback function
    if ((typeof event === 'string') && !callback) {
        throw new Error('Expecting a callback function to be provided.');
    }

    // callback should be a function
    if (callback && (typeof callback !== 'function')) {
        // unless we have a map of events/callbacks, then it could actually
        // be a context object
        if (typeof event === 'object' && typeof callback === 'object') {
            context = callback;
        }
        else {
            throw new TypeError('Expecting callback to be a function.');
        }
    }

    // we have a map of events/callbacks
    if (typeof event === 'object') {
        for (var evt in event) {
            register.call(this, evt, event[evt], context);
        }
    }

    // we have a string of events
    if (typeof event === 'string') {
        event = event.split(' ');
        event.forEach(function(evt) {
            register.call(this, evt, callback, context);
        }, this);
    }
};

// Finds the array of callback objects for 
// a given event name, then executes the provided
// callback for each one of them. Passing the callback
// object and the index.
var each = function(event, callback) {
    var eventsArray;
    var i;
    var length;

    eventsArray = getEvents.call(this)[event];

    if (!eventsArray || eventsArray.length === 0) { 
        return; 
    }

    // copy it in case anything we call tries to modify it
    eventsArray = eventsArray.slice();
    
    // reset this._stoppedImmediatePropagation for the run loop
    this._stoppedImmediatePropagation = false;
    
    for (i = 0, length = eventsArray.length; i < length; i++) {
        // if the event has been stopped via the run loop, break early
        if (this._stoppedImmediatePropagation || callback(eventsArray[i], i)) {
            break;
        }
    }
};

// Remove a callback for a given event
var removeSpecificCallback = function(events, event, callback) {
    // looking for a specific callback
    var i = -1;
    each.call(this, event, function(callbackObject, index) {
        if (callbackObject.callback === callback) {
            i = index;
            return true;
        }
    });

    if(i === -1) {
        return;
    }

    events[event].splice(i, 1);
};


/**
 * A method for adding a callback for a given event
 * @method
 * @param {string} event Event name
 * @param {function} callback A function to invoke when an event is triggered
 * @param {object} [context] A context to bind to the callback
 */
proto.on = function() {
    var events = getEvents.call(this);

    parseEvents.call(this, arguments, function(event, callback, context) {
        events[event] = events[event] || (events[event] = []);
        events[event].push({
            callback: callback,
            context: context
        });
    });

    return this;
};

/**
 * A method for adding a callback for an event that will only execute once
 * and then be removed.
 * @method
 * @param {string} event Event name
 * @param {function} callback A function to invoke when an event is triggered
 * @param {object} [context] A context to bind to the callback
 */
proto.once = function() {
    parseEvents.call(this, arguments, function(event, callback, context) {
        var wrapper = function(data) {
            callback.call(context || this, data);
            this.off(event, wrapper);
        };
        this.on(event, wrapper, this);
    });

    return this;
};

/**
 * A method for removing a callback for a given event
 * If no arguments are specified, all handlers are removed.
 * @method
 * @param {string} [event] Event name
 * @param {function} [callback] A function to remove
 */
proto.off = function(event, callback) {
    var events = getEvents.call(this);

    // if no arguments are specified
    // we will drop all callbacks
    if (arguments.length === 0) {
        this._events = {};
    }
    // event names should be a string
    else if (!event || (typeof event !== 'string' && typeof event !== 'object') || Array.isArray(event)) {
        throw new TypeError('Expecting event name to be a string or object.');
    }

    if (typeof event === 'object') {
        for (var e in event) {
            removeSpecificCallback.call(this, events, e, event[e]);
        }
    }

    // one or more events passed as string
    if (typeof event === 'string') {
        var split = event.split(' ');

        // only one event passed
        if (split.length === 1) {
            // if a callback was specified remove that callback
            if (callback) {
                removeSpecificCallback.call(this, events, event, callback);
            }
            // otherwise, remove all the callbacks for that event
            else {
                events[event] = [];
            }
        }
        // space seperated events passed
        else {
            split.forEach(function(event) {
                events[event] = [];
            });
        }
    }

    return this;
};

/**
 * A method for firing/triggering an event
 * @method
 * @param {string} event Event name
 * @param {object} [data] Data to pass to the listening callbacks
 * @param {boolean} [doNotPropagate] Flag to silence propagation
 */
proto.trigger = function(event, data, doNotPropagate) {
    // you need at least an event
    if (!event) {
        throw new Error('trigger method requires an event name');
    }

    // event names should be a string
    if (typeof event !== 'string') {
        throw new TypeError('Expecting event names to be a string.');
    }

    // doNotPropagate flag should be a boolean
    if (doNotPropagate && typeof doNotPropagate !== 'boolean') {
        throw new TypeError('Expecting doNotPropagate to be a boolean.');
    }

    // split events incase we are trigger multiples with a space delimiter
    event = event.split(' ');

    // loop through the events
    event.forEach(function(evt) {

        // call all the callbacks for the given event
        each.call(this, evt, function(callbackObject) {
            callbackObject.callback.call(callbackObject.context || this.context || this, data);
        }.bind(this));

        // propagate event if anyone else is listening, unless told not to
        if (!doNotPropagate) {
            each.call(this, propagationName, function(propagation) {
                var eventName = evt;

                if (propagation.prefix) {
                    eventName = propagation.prefix + eventName;
                }

                propagation.emitter.trigger(eventName, data);
            });
        }

    }, this);

    return this;
};

/**
 * A method for propagating events to another EventEmitter
 * @method
 * @param {object} eventEmitter An event emitting object to propagate events to
 * @param {string} [prefix] A prefix to be appended to the name of a propagating event
 */
proto.propagateTo = function(eventEmitter, prefix) {
    var events = getEvents.call(this);

    if (!events[propagationName]) {
        this._events[propagationName] = [];
    }

    events[propagationName].push({
        emitter: eventEmitter,
        prefix: prefix
    });
};

/**
 * A method for removing propagation
 * @method
 * @param {object} [eventEmitter] The event emitter to stop propagating to
 */
proto.stopPropagatingTo = function(eventEmitter) {
    var events = getEvents.call(this);

    // If an argument was not specified,
    // all propagations will be removed.
    if (!eventEmitter) {
        events[propagationName] = [];
        return;
    }

    // If an event emitter was passed in,
    // just removed propagation to that object
    var propagationTargets = events[propagationName];
    var length = propagationTargets.length;
    var i;

    for(i = 0; i < length; i++) {
        if (propagationTargets[i].emitter === eventEmitter) {
            propagationTargets.splice(i, 1);
            break;
        }
    }
};

/**
 * A method for cancelling future callbacks from firing in a event trigger loop
 * @method
 */
proto.stopImmediatePropagation = function() {
    this._stoppedImmediatePropagation = true;
};

/**
 * A method for checking whether or not there are callbacks for a given event
 * @method
 * @param {string} evt An event name to check
 * @param {function} [callback] A callback to check for 
 * @parma {object} [context] A particular context
 */
proto.has = function(evt, callback, context) {
    var events = getEvents.call(this);
    var eventsArray = events[evt];

    // return an array of all events if no arguments specified
    if (arguments.length === 0) {
        return Object.keys(events);
    }
    
    // If there's no events, exit.
    if (!eventsArray) {
        return false;
    }

    // If we are not looking for a particular callback,
    // check the length of the events array
    if (!callback) {
        return (eventsArray.length > 0) ? true : false;
    }

    // If we are looking for a particular callback/context, loop through 
    // the array of callbacks for the given event name
    for (var i = 0, length = eventsArray.length; i < length; i++) {
        var callbackContainer = eventsArray[i];

        // looking for both a callback and a context
        if (context && callback && callbackContainer.context === context && callbackContainer.callback === callback) {
            return true;
        }
        // just looking for a callback
        else if (callback && !context && callbackContainer.callback === callback) {
            return true;
        }
    }

    return false;
};

module.exports = EventEmitter;

},{}],137:[function(require,module,exports){
/** 
 * @module ac-shared-instance
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

module.exports = {
	SharedInstance: require('./ac-shared-instance/SharedInstance')
};

},{"./ac-shared-instance/SharedInstance":138}],138:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

var instanceScope = window,
	instanceSharedInstanceNamespace = 'AC',
	instanceExportKey = 'SharedInstance',
	instanceTarget = instanceScope[ instanceSharedInstanceNamespace ];

var SharedInstance = (function() {

	var registry = {};

	return {

		get : function( name, version ) {
			var module = null;

			// See if a version currently exists for the defined module
			if ( registry[ name ] && registry[ name ][ version ] ) {
				module = registry[ name ][ version ];
			}

			return module;
		},

		set : function( name, version, Module ) {
			// Ensure that a namespace for this module name exists
			if ( !registry[ name ] ) {
				registry[ name ] = {};
			}

			// Test whether or not the Module is a function (constructor) or not
			if ( typeof Module === 'function' ) {
				// If it is, construct away...
				registry[ name ][ version ] = new Module();
			} else {
				// Otherwise, we can assume that this is something we should exec
				registry[ name ][ version ] = Module;
			}

			return registry[ name ][ version ];
		},

		share : function( name, version, Module ) {
			var module = this.get( name, version );

			if ( !module ) {
				module = this.set( name, version, Module );
			}

			return module;
		},

		remove : function( name, version ) {
			// This can do two things. Remove all instances under "name" without a version arg
			// Or remove name + version combo with both arguments
			var versionType = typeof version;
			if ( versionType === 'string' || versionType === 'number' ) {

				if ( !registry[ name ] || !registry[ name ][ version ] ) {
					return;
				}
				
				registry[ name ][ version ] = null;
				return;
			}

			// If no version exists, we're asking to remove all references under "name"
			if ( registry[ name ] ) {
				registry[ name ] = null;
			}
		}
	};

}());

// Ensure an AC namespace exists
if ( !instanceTarget ) {
	instanceTarget = instanceScope[ instanceSharedInstanceNamespace ] = {};
}

// Move SharedInstance to the namespace if it does not yet exist there
if ( !instanceTarget[ instanceExportKey ] ) {
	instanceTarget[ instanceExportKey ] = SharedInstance;
}


// Export the instance of SharedInstance that should be used
module.exports = instanceTarget[ instanceExportKey ];

},{}],139:[function(require,module,exports){
/** 
 * @module ac-window-delegate
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

module.exports = {
	WindowDelegate: require('./ac-window-delegate/WindowDelegate'),
	WindowDelegateOptimizer: require('./ac-window-delegate/WindowDelegateOptimizer'),
	WindowDelegateCustomEvent: require('./ac-window-delegate/WindowDelegateCustomEvent')
};

},{"./ac-window-delegate/WindowDelegate":142,"./ac-window-delegate/WindowDelegateCustomEvent":143,"./ac-window-delegate/WindowDelegateOptimizer":144}],140:[function(require,module,exports){
'use strict';

var EventEmitter = require('ac-event-emitter').EventEmitter;

var CustomEventController = function() {
	this._emitter = new EventEmitter();
	this._customEvents = {};
};

var proto = CustomEventController.prototype;

proto.on = function( evts, callback, context ) {
	this._activateCustomEvents( evts );
	this._emitterOn.apply( this, arguments );
	return this;
};

proto.once = function( evts, callback, context ) {
	this._emitterOnce.apply( this, arguments );
	return this;
};

proto.off = function( evts, callback, context ) {
	this._emitterOff.apply( this, arguments );
	this._deactivateCustomEvents( evts );
	return this;
};

proto.has = function( evt, callback, context ) {
	return this._emitter.has.apply( this._emitter, arguments );
};

proto.trigger = function() {
	this._emitter.trigger.apply( this._emitter, arguments );
	return this;
};

proto.propagateTo = function() {
	this._emitter.propagateTo.apply( this._emitter, arguments );
	return this;
};

proto.stopPropagatingTo = function() {
	this._emitter.stopPropagatingTo.apply( this._emitter, arguments );
	return this;
};

proto.add = function( customEvent ) {
	this._customEvents[ customEvent.name ] = customEvent;
};

proto.canHandleCustomEvent = function( evt ) {
	return this._customEvents.hasOwnProperty( evt );
};

proto.isHandlingCustomEvent = function( evt ) {
	if ( this._customEvents[ evt ] && this._customEvents[ evt ].active ) {
		return true;
	}
	return false;
};

proto._activateCustomEvents = function( evts ) {
	var evtsArr = evts.split(' '),
		evt,
		i,
		len = evtsArr.length;

	for ( i = 0; i < len; i++ ) {
		evt = evtsArr[ i ];
		if( this._customEvents[ evt ] && !this._customEvents[ evt ].active ) {
			this._customEvents[ evt ].initialize();
			this._customEvents[ evt ].active = true;
		}
	}
};

proto._deactivateCustomEvents = function( evts ) {
	var i;
	
	// handle .off() (no args) scenario
	if ( !evts || evts.length === 0 ) {
		for ( i in this._customEvents ) {
			if ( this._customEvents.hasOwnProperty( i ) ) {
				this._deactivateCustomEvent( i );
			}
		}
		return;
	}

	var evtsArr = evts.split(' '),
		len = evtsArr.length;

	for ( i = 0; i < len; i++ ) {
		this._deactivateCustomEvent( evtsArr[ i ] );
	}
};

proto._deactivateCustomEvent = function( evt ) {
	if( !this.has( evt ) && this._customEvents[ evt ] && this._customEvents[ evt ].active ) {
		this._customEvents[ evt ].deinitialize();
		this._customEvents[ evt ].active = false;
	}
};

proto._emitterOn = function() {
	this._emitter.on.apply( this._emitter, arguments );
};

proto._emitterOnce = function() {
	this._emitter.once.apply( this._emitter, arguments );
};

proto._emitterOff = function() {
	this._emitter.off.apply( this._emitter, arguments );
};


module.exports = CustomEventController;
},{"ac-event-emitter":135}],141:[function(require,module,exports){
'use strict';

var EventEmitter = require('ac-event-emitter').EventEmitter;

var proto;

var OptimizerController = function( optimizers ) {
	EventEmitter.call( this );

	this.optimizers = optimizers;
	
	this._events = {};
	this._properties = {};

	this._initialize();
};

proto = OptimizerController.prototype = new EventEmitter( null );

proto.canOptimizeEvent = function( evt ) {
	return this._events.hasOwnProperty( evt );
};

proto.canOptimizeProperty = function( prop ) {
	return this._properties.hasOwnProperty( prop );
};

proto.isOptimizingEvent = function( evt ) {
	if ( this._events[ evt ] && this._events[ evt ].active ) {
		return true;
	}
	return false;
};

proto.isOptimizingProperty = function( prop ) {
	if ( this._properties[ prop ] && this._properties[ prop ].active ) {
		return true;
	}
	return false;
};

proto.add = function( optimizer ) {
	this._setOptimizerEvents( optimizer );
	this._setOptimizerProperties( optimizer );

	optimizer.on( 'update', this._onUpdate, this );
	optimizer.on( 'activate', this._onActivate, this );
	optimizer.on( 'deactivate', this._onDeactivate, this );
};

proto.get = function( prop ) {
	if ( this.isOptimizingProperty( prop ) ) {
		return this._properties[ prop ].value;
	}
	return null;
};

proto.set = function( prop, val ) {
	if ( !this._properties[ prop ] ) {
		return false;
	}
	this._properties[ prop ].value = val;
	return this;
};

proto.getOptimizerByEvent = function( evt ) {
	if ( this._events[ evt ] ) {
		return this._events[ evt ];
	}
	return null;
};

proto._initialize = function() {
	var i,
		optimizer;
	for ( i in this.optimizers ) {
		if ( this.optimizers.hasOwnProperty( i ) ) {
			this.add( this.optimizers[ i ] );
		}
	}
};

proto._onUpdate = function( e ) {
	this.set( e.prop, e.val );
};

proto._onActivate = function( optimizer ) {
	var propertyNames = optimizer.propertyNames,
		i,
		len = propertyNames.length;

	for ( i = 0; i < len; i++ ) {
		this._properties[ propertyNames[ i ] ].active = true;
	}
};

proto._onDeactivate = function( optimizer ) {
	var propertyNames = optimizer.propertyNames,
		i,
		len = propertyNames.length;

	for ( i = 0; i < len; i++ ) {
		this._properties[ propertyNames[ i ] ].active = false;
	}
};

proto._setOptimizerEvents = function( optimizer ) {
	var i,
		optimizerEvents = optimizer.eventNames,
		len = optimizerEvents.length;

	for ( i = 0; i < len; i++ ) {
		this._setOptimizerEvent( optimizerEvents[ i ], optimizer );
	}
};

proto._setOptimizerEvent = function( evt, optimizer ) {
	// Currently, only one optimizer per event is supported 
	if ( this._events[ evt ] ) {
		return;
	}
	this._events[ evt ] = optimizer;
};

proto._setOptimizerProperties = function( optimizer ) {
	var i,
		optimizeProperties = optimizer.propertyNames,
		len = optimizeProperties.length;

	for ( i = 0; i < len; i++ ) {
		this._setOptimizerProperty( optimizeProperties[ i ] );
	}
};

proto._setOptimizerProperty = function( prop ) {
	if ( this._properties.hasOwnProperty( prop ) ) {
		return;
	}

	this._properties[ prop ] = {};
	this._properties[ prop ].active = false;
	this._properties[ prop ].value = null;
};

module.exports = OptimizerController;
},{"ac-event-emitter":135}],142:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

var proto;

var SharedInstance = require('ac-shared-instance').SharedInstance,
	DOMEmitter = require('ac-dom-emitter').DOMEmitter,
	OptimizerController = require('./OptimizerController'),
	CustomEventController = require('./CustomEventController'),
	queries = require('./queries/queries'),
	optimizers = require('./optimizers/optimizers');

var sharedInstanceName = 'ac-window-delegate:WindowDelegate',
	sharedInstanceVersion = '2.0.1';

/**
 * @name .WindowDelegate
 * @class WindowDelegate
 * <pre>WindowDelegate = require('/WindowDelegate');</pre>
 */
function WindowDelegate() {

	this._emitter = new DOMEmitter( window );
	this._controllers = {
		optimizer : new OptimizerController( optimizers ),
		customEvent : new CustomEventController()
	};

	// Set property queries dynamically
	var i;
	for ( i in queries ) {
		if ( queries.hasOwnProperty( i ) ) {
			// Set instance functions for getting each poperty
			this[ i ] = this._getProperty.bind( this, i ); 
			// Override query functions to bind to WindowDelegate
			queries[ i ] = queries[ i ].bind( this );
		}
	}

	this._bindEvents();
}

proto = WindowDelegate.prototype;

/* Event Emitter Delegation */

proto.on = function( evts, callback, context ) {
	var evtsObj = this._seperateCustomEvents( evts );
	this._optimizeEvents( evtsObj.standardEvents );
	this._customEventOn( evtsObj.customEvents, callback, context );
	this._emitterOn.apply( this, arguments );
	return this;
};

proto.once = function( evts, callback, context ) {
	var evtsObj = this._seperateCustomEvents( evts );
	this._optimizeEvents( evtsObj.standardEvents );
	this._customEventOnce( evtsObj.customEvents, callback, context );
	this._emitterOnce.apply( this, arguments );
	return this;
};

proto.off = function( evts, callback, context ) {
	var evtsObj = this._seperateCustomEvents( evts ),
		force = false;

	if ( !evts ) {
		force = true;
	}

	this._customEventOff( evtsObj.customEvents, callback, context, force );
	this._emitterOff.apply( this, arguments );

	/* If no arguments are passed, we have to assume that all events from windowEmitter have been removed.
	 * In this case, we have to rebind our internal events after this fact and assume they didn't fire.
	 * A try/catch makes sense here in case .destroy() was called, in which case it would fail.
	 */
	if ( force ) {
		try {

			// Deoptimize all events
			var evt;
			for ( evt in this._controllers.optimizer._events ) {
				if ( this._controllers.optimizer._events.hasOwnProperty( evt ) && this._shouldDeoptimizeEvent( evt, true ) ) {
					this._deoptimizeEvent( evt );
				}
			}

			// Rebind internal events
			this._bindEvents();
		} catch( e ) {}
	}

	return this;
};

proto.has = function( evt, callback, context ) {
	return this._emitter.has.apply( this._emitter, arguments );
};

proto.trigger = function() {
	this._emitter.trigger.apply( this._emitter, arguments );
	return this;
};

proto.propagateTo = function() {
	this._emitter.propagateTo.apply( this._emitter, arguments );
	return this;
};

proto.stopPropagatingTo = function() {
	this._emitter.stopPropagatingTo.apply( this._emitter, arguments );
	return this;
};

proto.addOptimizer = function( optimizer ) {
	this._controllers.optimizer.add( optimizer );
	return this;
};

proto.addCustomEvent = function( customEvent ) {
	this._controllers.customEvent.add( customEvent );
	return this;
};

proto._emitterOn = function() {
	this._emitter.on.apply( this._emitter, arguments );
};

proto._emitterOnce = function() {
	this._emitter.once.apply( this._emitter, arguments );
};

proto._emitterOff = function() {
	this._emitter.off.apply( this._emitter, arguments );
};

proto._onEventUnbound = function( e ) {
	var evt = e.evt;
	if ( this._shouldDeoptimizeEvent( evt ) ) {
		this._deoptimizeEvent( evt );
	}
};

proto._customEventOn = function( evtsArr, callback, context ) {
	if ( evtsArr.length === 0 ) {
		return;
	}
	this._controllers.customEvent.on( evtsArr.join(' '), callback, context );
};

proto._customEventOnce = function( evtsArr, callback, context ) {
	if ( evtsArr.length === 0 ) {
		return;
	}
	this._controllers.customEvent.once( evtsArr.join(' '), callback, context );
};

proto._customEventOff = function( evtsArr, callback, context, force ) {
	if ( !force && evtsArr.length === 0 ) {
		return;
	}

	// handle the WindowDelegate.off() (no args) scenario
	if ( force && evtsArr.length === 0 ) {
		this._controllers.customEvent.off();
		return;
	}

	this._controllers.customEvent.off( evtsArr.join(' '), callback, context );
};

/* WindowDelegate specific functionality */

proto._getProperty = function( prop, forceQuery ) {
	var value = null;

	if ( !forceQuery ) {
		value = this._getOptimizedValue( prop );
	}

	if ( value === null ) {
		value = queries[ prop ].call( this, forceQuery );
	}

	return value;
};

proto._optimizeEvents = function( evts ) {
	var evt,
		i,
		len = evts.length;
	for ( i = 0; i < len; i++ ) {
		evt = evts[ i ];
		if ( this._shouldOptimizeEvent( evt ) ) {
			this._optimizeEvent( evt );
		}
	}
};

proto._shouldOptimizeEvent = function( evt ) {
	if ( this._controllers.optimizer.canOptimizeEvent( evt ) && !this._controllers.optimizer.isOptimizingEvent( evt ) ) {
		return true;
	}
	return false;
};

proto._shouldDeoptimizeEvent = function( evt, force ) {
	// if we know we have one event bound (the optimization) and that's all that's left to be fired, we'll remove it
	if ( this._controllers.optimizer.isOptimizingEvent( evt ) && ( force || this._emitter._eventEmitter._events[ evt ].length <= 1 ) ) {
		return true;
	}
	return false;
};

proto._optimizeEvent = function( evt ) {
	var optimizer = this._controllers.optimizer.getOptimizerByEvent( evt );
	optimizer.activate();
	this._emitterOn( evt, optimizer.callback, optimizer );
};

proto._deoptimizeEvent = function( evt ) {
	var optimizer = this._controllers.optimizer.getOptimizerByEvent( evt );
	optimizer.deactivate();
	this._emitterOff( evt, optimizer.callback, optimizer );
};

proto._getOptimizedValue = function( prop ) {
	return this._controllers.optimizer.get( prop );
};

proto._seperateCustomEvents = function( evtString ) {

	var result = {
		customEvents : [],
		standardEvents : []
	};

	if( typeof evtString === 'string' ) {
		var evtsArray = evtString.split(' '),
			evt,
			i,
			len = evtsArray.length;
		for ( i = 0; i < len; i++ ) {
			evt = evtsArray[ i ];
			if ( this._controllers.customEvent.canHandleCustomEvent( evt ) ) {
				result.customEvents.push( evt );
			} else {
				result.standardEvents.push( evt );
			}
		}
	}

	return result;
};

proto._bindEvents = function() {
	// Bind to DOMEmitter's internal 'off' event to help us determine if we should remove optimizations
	this._emitter.on( 'dom-emitter:didoff', this._onEventUnbound, this );
};

module.exports = SharedInstance.share( sharedInstanceName, sharedInstanceVersion, WindowDelegate );
},{"./CustomEventController":140,"./OptimizerController":141,"./optimizers/optimizers":147,"./queries/queries":156,"ac-dom-emitter":133,"ac-shared-instance":137}],143:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

var EventEmitter = require('ac-event-emitter').EventEmitter;

/**
 * @name module:ac-window-delegate-custom-event.WindowDelegateCustomEvent
 * @class
 * 
 * @desc Custom event pattern for WindowDelegate plugins
 * 
 * @param {Object} [options]
 *        Options to initialize the instance with
 */
function WindowDelegateCustomEvent( name, initializeFunc, deinitializeFunc ) {
	// constructor code goes here
	EventEmitter.call( this );
	this.name = name;
	this.active = false;
	this._initializeFunc = initializeFunc;
	this._deinitializeFunc = deinitializeFunc; 
}

var proto = WindowDelegateCustomEvent.prototype = new EventEmitter( null );

proto.initialize = function () {
	if ( this._initializeFunc ) {
		this._initializeFunc();
	}
	return this;
};

proto.deinitialize = function () {
	if ( this._deinitializeFunc ) {
		this._deinitializeFunc();
	}
	return this;
};

module.exports = WindowDelegateCustomEvent;

},{"ac-event-emitter":135}],144:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

var EventEmitter = require('ac-event-emitter').EventEmitter;

/**
 * @name module:ac-window-delegate-optimizer.WindowDelegateOptimizer
 * @class
 * 
 * @desc Optimizer constructor pattern used to create optimizations for WindowDelegate events
 * 
 * @param {Object} [options]
 *        Options to initialize the instance with
 */
function WindowDelegateOptimizer( config, callback ) {
	EventEmitter.call( this );

	this.active = false;
	this.eventNames = config.eventNames;
	this.propertyNames = config.propertyNames;
	this.options = config.options || {};
	this.callback = callback;
}

var proto = WindowDelegateOptimizer.prototype = new EventEmitter( null );

proto.update = function( prop, val ) {
	this.trigger( 'update', {
		prop : prop,
		val : val
	});
};

proto.activate = function() {
	this.active = true;
	this.trigger( 'activate', this );
};

proto.deactivate = function() {
	this.active = false;
	this.trigger( 'deactivate', this );
};

module.exports = WindowDelegateOptimizer;

},{"ac-event-emitter":135}],145:[function(require,module,exports){
'use strict';

var Optimizer = require('../../WindowDelegateOptimizer'),
	queries = require('../../queries/queries');

/* TOFO: What happens on orientationchange? We should try to make sure both are bound */
var config = {
	eventNames : [ 'resize' ],
	propertyNames : [ 'clientWidth', 'clientHeight', 'innerWidth', 'innerHeight' ]
};

var resizeOptimizer = new Optimizer( config, function( e ) {

	var i,
		propertyNames = config.propertyNames,
		len = propertyNames.length;

	for ( i = 0; i < len; i++ ) {
		this.update( propertyNames[ i ], queries[ propertyNames[ i ] ]( true ) );
	} 

});

module.exports = resizeOptimizer;
},{"../../WindowDelegateOptimizer":144,"../../queries/queries":156}],146:[function(require,module,exports){
'use strict';

var Optimizer = require('../../WindowDelegateOptimizer'),
	queries = require('../../queries/queries');

var config = {
	eventNames : [ 'scroll' ],
	propertyNames : [ 'scrollX', 'scrollY', 'maxScrollX', 'maxScrollY' ]
};

var scrollOptimizer = new Optimizer( config, function( e ) {

	var i,
		propertyNames = config.propertyNames,
		len = propertyNames.length;

	for ( i = 0; i < len; i++ ) {
		this.update( propertyNames[ i ], queries[ propertyNames[ i ] ]( true ) );
	} 

});

module.exports = scrollOptimizer;
},{"../../WindowDelegateOptimizer":144,"../../queries/queries":156}],147:[function(require,module,exports){
'use strict';

var resizeEvt = require('./events/resize'),
	scrollEvt = require('./events/scroll');

module.exports = [
	resizeEvt,
	scrollEvt
];
},{"./events/resize":145,"./events/scroll":146}],148:[function(require,module,exports){
'use strict';

var queryClientHeight = function( forceQuery ) {
	return document.documentElement.clientHeight;
};

module.exports = queryClientHeight;
},{}],149:[function(require,module,exports){
'use strict';

var queryClientWidth = function( forceQuery ) {
	return document.documentElement.clientWidth;
};

module.exports = queryClientWidth;
},{}],150:[function(require,module,exports){
'use strict';

var queryInnerHeight = function( forceQuery ) {
	return window.innerHeight || this.clientHeight( forceQuery );
};

module.exports = queryInnerHeight;
},{}],151:[function(require,module,exports){
'use strict';

var queryInnerWidth = function( forceQuery ) {
	return window.innerWidth || this.clientWidth( forceQuery );
};

module.exports = queryInnerWidth;
},{}],152:[function(require,module,exports){
'use strict';

var queryMaxScrollX = function( forceQuery ) {
	// innerWidth is updated from other queries, so we shouldn't force it
	return document.body.scrollWidth - this.innerWidth();
};

module.exports = queryMaxScrollX;
},{}],153:[function(require,module,exports){
'use strict';

var queryMaxScrollY = function( forceQuery ) {
	// innerHeight is updated from other queries, so we shouldn't force it
	return document.body.scrollHeight - this.innerHeight();
};

module.exports = queryMaxScrollY;
},{}],154:[function(require,module,exports){
'use strict';

var queryScrollX = function( forceQuery ) {
	var offset = window.pageXOffset;

	if ( !offset ) {
		var target = document.documentElement || document.body.parentNode || document.body;
		offset = target.scrollLeft;
	}

	return offset;
};

module.exports = queryScrollX;
},{}],155:[function(require,module,exports){
'use strict';

var queryScrollY = function( forceQuery ) {
	var offset = window.pageYOffset;

	if ( !offset ) {
		var target = document.documentElement || document.body.parentNode || document.body;
		offset = target.scrollTop;
	}

	return offset;
};

module.exports = queryScrollY;
},{}],156:[function(require,module,exports){
'use strict';

var queryInnerWidth = require('./methods/innerWidth'),
	queryInnerHeight = require('./methods/innerHeight'),
	queryClientWidth = require('./methods/clientWidth'),
	queryClientHeight = require('./methods/clientHeight'),
	queryScrollX = require('./methods/scrollX'),
	queryScrollY = require('./methods/scrollY'),
	queryMaxScrollX = require('./methods/maxScrollX'),
	queryMaxScrollY = require('./methods/maxScrollY');

module.exports = {

	innerWidth : queryInnerWidth,
	innerHeight : queryInnerHeight,
	clientWidth : queryClientWidth,
	clientHeight : queryClientHeight,
	scrollX : queryScrollX,
	scrollY : queryScrollY,
	maxScrollX : queryMaxScrollX,
	maxScrollY : queryMaxScrollY

};
},{"./methods/clientHeight":148,"./methods/clientWidth":149,"./methods/innerHeight":150,"./methods/innerWidth":151,"./methods/maxScrollX":152,"./methods/maxScrollY":153,"./methods/scrollX":154,"./methods/scrollY":155}],157:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @module ac-dom-metrics/utils
 */
module.exports = {
	getBoundingClientRect: require('./utils/getBoundingClientRect')
};

},{"./utils/getBoundingClientRect":158}],158:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name module:ac-dom-metrics/utils.getBoundingClientRect
 *
 * @function
 *
 * @desc Normalized version of `Element.getBoundingClientRect()`
 *
 * @param {Element} el
 *
 * @returns {Object} Rendered Dimensions and Position of an Element
 */
module.exports = function getBoundingClientRect(el) {
	var rect = el.getBoundingClientRect();

	return {
		top: rect.top,
		right: rect.right,
		bottom: rect.bottom,
		left: rect.left,
		width: rect.width || rect.right - rect.left,
		height: rect.height || rect.bottom - rect.top
	};
};

},{}],159:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var getStyleProperty = require('ac-prefixer/getStyleProperty');
var stripPrefixes = require('ac-prefixer/stripPrefixes');

/**
 * @name module:ac-dom-styles.getStyle
 *
 * @function
 *
 * @desc Get one or more CSS styles on an Element.
 *       Uses `window.getComputedStyle` to get styles set in CSS and/or inline.
 *       Automatically handles vendor prefixed properties and values.
 *
 * @param {Element} target
 *        The DOM element to get the style(s) on.
 *
 * @param {...String|String[]} properties
 *        One or more properties as multiple arguments, or an Array.
 *
 * @returns {Object} An Object with multiple domProperty:value pairs.
 */
module.exports = function getStyle() {
	var properties = Array.prototype.slice.call(arguments);
	var target = properties.shift(properties);
	var computed = window.getComputedStyle(target);
	var styles = {};
	var property;
	var prefixed;
	var value;
	var i;

	if (typeof properties[0] !== 'string') {
		properties = properties[0];
	}

	for (i = 0; i < properties.length; i++) {
		property = properties[i];
		prefixed = getStyleProperty(property);

		if (prefixed) {
			property = stripPrefixes(prefixed);
			value = computed[prefixed];

			if (!value || value === 'auto') {
				value = null;
			}

			if (value) {
				value = stripPrefixes(value);
			}
		} else {
			value = null;
		}

		styles[property] = value;
	}

	return styles;
};

},{"ac-prefixer/getStyleProperty":163,"ac-prefixer/stripPrefixes":169}],160:[function(require,module,exports){
/**
 * Utility methods for setting and getting Element styles
 * @module ac-dom-styles
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

module.exports = {
	getStyle: require('./getStyle'),
	setStyle: require('./setStyle')
};

},{"./getStyle":159,"./setStyle":172}],161:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name normalizeValue
 *
 * @function
 * @private
 *
 * @desc Normalize a CSS value, as follows:
 *       - converts falsey values other than `0` to an empty String
 *       - converts an Array to a String
 *       - combines Object keys as CSS functions
 *       - returns `value` otherwise
 *
 * @param {*} value
 *        The CSS property's value
 *
 * @returns {String|Number} The normalized value
 */
module.exports = function normalizeValue(value) {
	var combined;
	var partials;
	var i;

	if (!value && value !== 0) {
		return '';
	}

	if (Array.isArray(value)) {
		return value + '';
	}

	if (typeof value === 'object') {
		combined = '';
		partials = Object.keys(value);

		for (i = 0; i < partials.length; i++) {
			combined += partials[i] + '(' + value[partials[i]] + ') ';
		}

		return combined.trim();
	}

	return value;
};

},{}],162:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

var cache = require('./shared/stylePropertyCache');
var getStyleProperty = require('./getStyleProperty');
var getStyleValue = require('./getStyleValue');

/**
 * @name module:ac-prefixer.getStyleCSS
 *
 * @function
 *
 * @desc Returns a CSS property or full CSS rule with vendor prefixes, as needed.
 *
 * @param {String} property
 *        The unprefixed property name in CSS or DOM form.
 *
 * @param {String} [value]
 *        The unprefixed property's value.
 *
 * @returns {String|Boolean}
 *          The property in CSS form if no value is provided.
 *          The full CSS rule if a value is provided.
 *          `false` if the property and/or value are not avialable.
 */
module.exports = function getStyleCSS(property, value) {
	var css;

	property = getStyleProperty(property);

	if (!property) {
		return false;
	}

	css = cache[property].css;

	if (typeof value !== 'undefined') {
		value = getStyleValue(property, value);

		if (value === false) {
			return false;
		}

		css += ':' + value + ';';
	}

	return css;
};
},{"./getStyleProperty":163,"./getStyleValue":164,"./shared/stylePropertyCache":167}],163:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

var cache = require('./shared/stylePropertyCache');
var getStyleTestElement = require('./shared/getStyleTestElement');
var toCSS = require('./utils/toCSS');
var toDOM = require('./utils/toDOM');
var prefixHelper = require('./shared/prefixHelper');

/**
 * @name memoizeStyleProperty
 *
 * @function
 * @private
 *
 * @desc Memoize the results of getStyleProperty
 *
 * @param {String} property
 *        The unprefixed property name in DOM form.
 *
 * @param {String} prefixed
 *        The properly prefixed property name in DOM form.
 */
var memoizeStyleProperty = function (property, prefixed) {
	var cssProperty = toCSS(property);
	var cssPrefixed = (prefixed === false) ? false : toCSS(prefixed);

	cache[property] =
	cache[prefixed] =
	cache[cssProperty] =
	cache[cssPrefixed] = {
		dom: prefixed,
		css: cssPrefixed
	};

	return prefixed;
};

/**
 * @name module:ac-prefixer.getStyleProperty
 *
 * @function
 *
 * @desc Returns the property in DOM form with vendor prefix, as needed.
 *
 * @param {String} property
 *        The unprefixed property name in CSS or DOM form.
 *
 * @returns {String|Boolean} The property in DOM form, or `false` if not available.
 */
module.exports = function getStyleProperty(property) {
	var properties;
	var ucProperty;
	var el;
	var i;

	property += '';

	if (property in cache) {
		return cache[property].dom;
	}

	el = getStyleTestElement();

	property = toDOM(property);
	ucProperty = property.charAt(0).toUpperCase() + property.substring(1);

	if (property === 'filter') {
		// Chrome has both prefixed and unprefixed `filter`
		// but only the prefixed version is fully implemented.
		// Firefox isn't prefixed, so we drop it here.
		properties = ['WebkitFilter', 'filter'];
	} else {
		properties = (property + ' ' + prefixHelper.dom.join(ucProperty + ' ') + ucProperty).split(' ');
	}

	for (i = 0; i < properties.length; i++) {
		if (typeof el.style[properties[i]] !== 'undefined') {

			if (i !== 0) {
				prefixHelper.reduce(i - 1);
			}

			return memoizeStyleProperty(property, properties[i]);
		}
	}

	return memoizeStyleProperty(property, false);
};

},{"./shared/getStyleTestElement":165,"./shared/prefixHelper":166,"./shared/stylePropertyCache":167,"./utils/toCSS":170,"./utils/toDOM":171}],164:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var getStyleProperty = require('./getStyleProperty');
var styleValueAvailable = require('./shared/styleValueAvailable');
var prefixHelper = require('./shared/prefixHelper');

var stylePropertyCache = require('./shared/stylePropertyCache');
var styleValueCache = {};

var RE_CSS_FUNCTION_PARAMS = /(\([^\)]+\))/gi;
var RE_CSS_VALUES = /([^ ,;\(]+(\([^\)]+\))?)/gi;

/**
 * @name module:ac-prefixer.getStyleValue
 *
 * @function
 *
 * @desc Returns the value for a specific property with vendor prefix(es), as needed.
 *
 * @param {String} property
 *        The unprefixed property name in CSS or DOM form.
 *
 * @param {String} value
 *        The unprefixed property value.
 *
 * @returns {String|Boolean} The value, or `false` if not available.
 */
module.exports = function getStyleValue(property, value) {
	var cssProperty;

	value += '';
	property = getStyleProperty(property);

	if (!property) {
		return false;
	}

	if (styleValueAvailable(property, value)) {
		return value;
	}

	cssProperty = stylePropertyCache[property].css;

	value = value.replace(RE_CSS_VALUES, function (match) {
		var values;
		var valueKey;
		var key;
		var i;

		// ignore colors and numbers
		if (match[0] === '#' || !isNaN(match[0])) {
			return match;
		}

		// check memoized value
		valueKey = match.replace(RE_CSS_FUNCTION_PARAMS, '');
		key = cssProperty + ':' + valueKey;
		if (key in styleValueCache) {
			if (styleValueCache[key] === false) {
				// value not supported, stripped
				return '';
			}

			return match.replace(valueKey, styleValueCache[key]);
		}

		// prepare potential prefixes
		values = prefixHelper.css.map(function (prefix) {
			return prefix + match;
		});
		values = [match].concat(values);

		// check potential prefixes
		for (i = 0; i < values.length; i++) {
			if (styleValueAvailable(property, values[i])) {
				// valid prefix found

				if (i !== 0) {
					prefixHelper.reduce(i - 1);
				}

				styleValueCache[key] = values[i].replace(RE_CSS_FUNCTION_PARAMS, '');
				return values[i];
			}
		}

		// value not supported, stripped
		styleValueCache[key] = false;
		return '';
	});

	value = value.trim();
	return (value === '') ? false : value;
};

},{"./getStyleProperty":163,"./shared/prefixHelper":166,"./shared/stylePropertyCache":167,"./shared/styleValueAvailable":168}],165:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var el;

/**
 * @name getStyleTestElement
 * @memberOf module:ac-prefixer/shared
 *
 * @function
 * @private
 *
 * @desc Creates the test Element and/or resets it's style properties.
 */
 module.exports = function getStyleTestElement() {
	if (!el) {
		el = document.createElement('_');
	} else {
		el.style.cssText = '';
		el.removeAttribute('style');
	}

	return el;
};

/*
 * @name getStyleTestElement.resetElement
 *
 * @function
 * @private
 *
 * @desc Reset the test Element. Exposed for testing.
 */
module.exports.resetElement = function () {
	el = null;
};

},{}],166:[function(require,module,exports){
arguments[4][68][0].apply(exports,arguments)
},{"dup":68}],167:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
module.exports = {};

},{}],168:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var cache = require('./stylePropertyCache');
var getStyleTestElement = require('./getStyleTestElement');
var flagsSet = false;
var supportsAvailable;
var invalidStyleThrowsError;

var prepareFlags = function () {
	var el;

	if (!flagsSet) {
		flagsSet = true;
		supportsAvailable = ('CSS' in window && 'supports' in window.CSS);
		invalidStyleThrowsError = false;

		el = getStyleTestElement();
		try {
			el.style.width = 'invalid';
		} catch (e) {
			// Old IE throws an error for invalid values
			invalidStyleThrowsError = true;
		}
	}
};

/**
 * @name styleValueAvailable
 * @memberOf module:ac-prefixer/shared
 *
 * @function
 * @private
 *
 * @desc Determine whether or not a CSS value is valid
 *
 * @param {String} property
 *        The property name in DOM form, prefixed as needed.
 *
 * @param {String} value
 *        The value to test.
 *
 * @returns {Boolean} `true` if the value is valid, otherwise `false`.
 */
module.exports = function styleValueAvailable(property, value) {
	var before;
	var el;

	prepareFlags();

	if (supportsAvailable) {
		property = cache[property].css;
		return CSS.supports(property, value);
	}

	el = getStyleTestElement();
	before = el.style[property];

	if (invalidStyleThrowsError) {
		try {
			el.style[property] = value;
		} catch (e) {
			// Old IE throws an error for invalid values
			return false;
		}
	} else {
		el.style[property] = value;
	}

	return (el.style[property] && el.style[property] !== before);
};

/*
 * @name styleValueAvailable.resetFlags
 *
 * @function
 * @private
 *
 * @desc Reset CSS.support and try/catch flags. Exposed for testing.
 */
module.exports.resetFlags = function () {
	flagsSet = false;
};

},{"./getStyleTestElement":165,"./stylePropertyCache":167}],169:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

var RE_PREFIXES = /(-webkit-|-moz-|-ms-)|^(webkit|moz|ms)/gi;

/**
 * @name module:ac-prefixer.stripPrefixes
 *
 * @function
 *
 * @desc Strips vendor prefixes from a property or value.
 *
 * @param {String} str
 *        The property or value in CSS or DOM form.
 *
 * @returns {String} String in original form with vendor prefixes removed.
 */
module.exports = function stripPrefixes(str) {
	str = String.prototype.replace.call(str, RE_PREFIXES, '');
	return str.charAt(0).toLowerCase() + str.substring(1);
};

},{}],170:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var RE_DOM_PREFIXES = /^(webkit|moz|ms)/gi;

/**
 * @name toCSS
 * @memberOf module:ac-prefixer/utils
 *
 * @function
 *
 * @desc Converts a property or value to CSS form (i.e., "-webkit-property-name").
 *
 * @param {String} str
 *        The property or value in CSS or DOM form.
 *
 * @returns {String} String in CSS form.
 */
module.exports = function toCSS(str) {
	var i;

	if (str.toLowerCase() === 'cssfloat') {
		return 'float';
	}

	if (RE_DOM_PREFIXES.test(str)) {
		str = '-' + str;
	}

	return str.replace(/([A-Z]+)([A-Z][a-z])/g, '$1-$2').replace(/([a-z\d])([A-Z])/g, '$1-$2').toLowerCase();
};

},{}],171:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var RE_CSS_WORD = /-([a-z])/g;

/**
 * @name toDOM
 * @memberOf module:ac-prefixer/utils
 *
 * @function
 *
 * @desc Converts a property to DOM form (i.e., "WebkitPropertyName").
 *
 * @param {String} str
 *        The property in CSS or DOM form.
 *
 * @returns {String} String in DOM form.
 */
module.exports = function toDOM(str) {
	var i;

	if (str.toLowerCase() === 'float') {
		return 'cssFloat';
	}

	str = str.replace(RE_CSS_WORD, function (str, m1) {
		return m1.toUpperCase();
	});

	if (str.substr(0, 2) === 'Ms') {
		str = 'ms' + str.substring(2);
	}

	return str;
};

},{}],172:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var getStyleCSS = require('ac-prefixer/getStyleCSS');
var getStyleProperty = require('ac-prefixer/getStyleProperty');
var normalizeValue = require('./internal/normalizeValue');

/**
 * @name module:ac-dom-styles.setStyle
 *
 * @function
 *
 * @desc Set one or more inline styles on an Element.
 *       Automatically handles vendor prefixed properties and values.
 *
 * @param {Element} target
 *        The DOM element to set the style(s) on.
 *
 * @param {Object} styles
 *        One or more styles as an Object with property/value pairs.
 *        A value of `null` or an empty String will remove that inline style.
 *
 * @returns {Element} target
 */
module.exports = function setStyle(target, styles) {
	var cssText = '';
	var cssRule;
	var property;
	var domProperty;
	var value;
	var targetCSSText;

	if (typeof styles !== 'object') {
		throw new TypeError('setStyle: styles must be an Object');
	}

	for (property in styles) {
		value = normalizeValue(styles[property]);

		if (!value && value !== 0) {
			// remove properties with blank values

			domProperty = getStyleProperty(property);

			if ('removeAttribute' in target.style) {
				// IE < 9
				target.style.removeAttribute(domProperty);
			} else {
				target.style[domProperty] = '';
			}

		} else {
			// get the CSS rule
			cssRule = getStyleCSS(property, value);

			if (cssRule !== false) {
				cssText += ' ' + cssRule;
			}
		}
	}

	if (cssText.length) {
		targetCSSText = target.style.cssText;
		if (targetCSSText.charAt(targetCSSText.length - 1) !== ';') {
			targetCSSText += ';';
		}

		targetCSSText += cssText;

		target.style.cssText = targetCSSText;
	}

	return target;
};

},{"./internal/normalizeValue":161,"ac-prefixer/getStyleCSS":162,"ac-prefixer/getStyleProperty":163}],173:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var isElement = require('ac-dom-nodes/isElement');
var matchesSelector = require('./matchesSelector');
var validate = require('./internal/validate');

/**
 * @name module:ac-dom-traversal.ancestor
 *
 * @function
 *
 * @desc Returns the closest Element that is an ancestor of the specified Node, matching an optional CSS selector, up to and including the body.
 *
 * @param {Node} node
 *        The child Element, TextNode, or Comment.
 *
 * @param {String} [selector]
 *        Optional CSS selectors, separated by commas, to filter ancestor Elements by.
 *
 * @param {Boolean} [inclusive=false]
 *        `true` to include the target node in the potential results, otherwise `false`
 *
 * @returns {Element|null} Closest matching ancestor Element, or `null` if no matches are found.
 */
module.exports = function ancestor(node, selector, inclusive) {
 	validate.childNode(node, true, 'ancestors');
 	validate.selector(selector, false, 'ancestors');

 	if (inclusive && isElement(node) && (!selector || matchesSelector(node, selector))) {
 		return node;
 	}

 	if (node !== document.body) {
 		while ((node = node.parentNode) && isElement(node)) {
 			if (!selector || matchesSelector(node, selector)) {
 				return node;
 			}

 			if (node === document.body) {
 				break;
 			}
 		}
 	}

 	return null;
};

},{"./internal/validate":180,"./matchesSelector":182,"ac-dom-nodes/isElement":193}],174:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var isElement = require('ac-dom-nodes/isElement');
var matchesSelector = require('./matchesSelector');
var validate = require('./internal/validate');

/**
 * @name module:ac-dom-traversal.ancestors
 *
 * @function
 *
 * @desc Returns an Array of Elements that are ancestors of the specified Node, matching an optional CSS selector, up to and including the body.
 *
 * @param {Node} node
 *        The child Element, TextNode, or Comment.
 *
 * @param {String} [selector]
 *        Optional CSS selectors, separated by commas, to filter ancestor Elements by.
 *
 * @param {Boolean} [inclusive=false]
 *        `true` to include the target node in the potential results, otherwise `false`
 *
 * @returns {Element[]} Array of matching ancestor Elements, with the closest ancestor first.
 */
module.exports = function ancestors(node, selector, inclusive) {
 	var els = [];

 	validate.childNode(node, true, 'ancestors');
 	validate.selector(selector, false, 'ancestors');

 	if (inclusive && isElement(node) && (!selector || matchesSelector(node, selector))) {
 		els.push(node);
 	}

 	if (node !== document.body) {
	 	while ((node = node.parentNode) && isElement(node)) {
	 		if (!selector || matchesSelector(node, selector)) {
	 			els.push(node);
	 		}

	 		if (node === document.body) {
	 			break;
	 		}
	 	}
	}

 	return els;
};

},{"./internal/validate":180,"./matchesSelector":182,"ac-dom-nodes/isElement":193}],175:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var filterByNodeType = require('ac-dom-nodes/filterByNodeType');
var filterBySelector = require('./filterBySelector');
var validate = require('./internal/validate');

/**
 * @name module:ac-dom-traversal.children
 *
 * @function
 *
 * @desc Returns an Array of Elements that are direct children of the specified Node, matching an optional CSS selector.
 *
 * @param {Node} node
 *        The parent Element, Document, or Document Fragment.
 *
 * @param {String} [selector]
 *        Optional CSS selectors, separated by commas, to filter children Elements by.
 *
 * @returns {Element[]} Array of matching child Elements, in DOM order.
 */
module.exports = function children(node, selector) {
	var els;

	validate.parentNode(node, true, 'children');
	validate.selector(selector, false, 'children');

	els = node.children || node.childNodes;
	els = filterByNodeType(els);

	if (selector) {
		els = filterBySelector(els, selector);
	}

	return els;
};

},{"./filterBySelector":176,"./internal/validate":180,"ac-dom-nodes/filterByNodeType":190}],176:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var matchesSelector = require('./matchesSelector');
var validate = require('./internal/validate');

/**
 * @name module:ac-dom-traversal.filterBySelector
 *
 * @function
 *
 * @desc Filter an Array of Elements by a given CSS selector.
 *
 * @param {Node[]|NodeList} nodes
 *        The Elements to be filtered.
 *
 * @param {String} selector
 *        CSS selectors, separated by commas, to check Elements against.
 *
 * @returns {Element[]} A new Array of matching Elements.
 */
module.exports = function filterBySelector(nodes, selector) {
	validate.selector(selector, true, 'filterBySelector');

	nodes = Array.prototype.slice.call(nodes);

	return nodes.filter(function (el) {
		return matchesSelector(el, selector);
	});
};

},{"./internal/validate":180,"./matchesSelector":182}],177:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var children = require('./children');
var validate = require('./internal/validate');

/**
 * @name module:ac-dom-traversal.firstChild
 *
 * @function
 *
 * @desc Returns the first Element that is a direct child of the specified Node, matching an optional CSS selector.
 *
 * @param {Node} node
 *        The parent Element, Document, or Document Fragment.
 *
 * @param {String} [selector]
 *        Optional CSS selectors, separated by commas, to filter children Elements by.
 *
 * @returns {Element|null} First matching child Element, or `null` if no matches are found.
 */
module.exports = function firstChild(node, selector) {
	var els;

	validate.parentNode(node, true, 'firstChild');
	validate.selector(selector, false, 'firstChild');

	if (node.firstElementChild && !selector) {
		return node.firstElementChild;
	}

	els = children(node, selector);

	if (els.length) {
		return els[0];
	}

	return null;
};

},{"./children":175,"./internal/validate":180}],178:[function(require,module,exports){
/**
 * @module ac-dom-traversal
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

module.exports = {
	ancestor: require('./ancestor'),
	ancestors: require('./ancestors'),
	children: require('./children'),
	filterBySelector: require('./filterBySelector'),
	firstChild: require('./firstChild'),
	lastChild: require('./lastChild'),
	matchesSelector: require('./matchesSelector'),
	nextSibling: require('./nextSibling'),
	nextSiblings: require('./nextSiblings'),
	previousSibling: require('./previousSibling'),
	previousSiblings: require('./previousSiblings'),
	querySelector: require('./querySelector'),
	querySelectorAll: require('./querySelectorAll'),
	siblings: require('./siblings')
};

},{"./ancestor":173,"./ancestors":174,"./children":175,"./filterBySelector":176,"./firstChild":177,"./lastChild":181,"./matchesSelector":182,"./nextSibling":183,"./nextSiblings":184,"./previousSibling":195,"./previousSiblings":196,"./querySelector":197,"./querySelectorAll":198,"./siblings":201}],179:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
module.exports = window.Element ? (function (proto) {
	return proto.matches ||
		proto.matchesSelector ||
		proto.webkitMatchesSelector ||
		proto.mozMatchesSelector ||
		proto.msMatchesSelector ||
		proto.oMatchesSelector;
}(Element.prototype)) : null;

},{}],180:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var isNode = require('ac-dom-nodes/isNode');
var COMMENT_NODE = require('ac-dom-nodes/COMMENT_NODE');
var DOCUMENT_FRAGMENT_NODE = require('ac-dom-nodes/DOCUMENT_FRAGMENT_NODE');
var DOCUMENT_NODE = require('ac-dom-nodes/DOCUMENT_NODE');
var ELEMENT_NODE = require('ac-dom-nodes/ELEMENT_NODE');
var TEXT_NODE = require('ac-dom-nodes/TEXT_NODE');

/** @ignore */
var isNodeType = function (node, nodeType) {
	if (!isNode(node)) {
		return false;
	}

	if (typeof nodeType === 'number') {
		return (node.nodeType === nodeType);
	}

	return (nodeType.indexOf(node.nodeType) !== -1);
};

/** @ignore */
var VALID_PARENT_NODE = [
	ELEMENT_NODE,
	DOCUMENT_NODE,
	DOCUMENT_FRAGMENT_NODE
];

/** @ignore */
var ERR_INVALID_PARENT_NODE = ' must be an Element, Document, or Document Fragment';

/** @ignore */
var VALID_CHILD_NODE = [
	ELEMENT_NODE,
	TEXT_NODE,
	COMMENT_NODE
];

/** @ignore */
var ERR_INVALID_CHILD_NODE = ' must be an Element, TextNode, or Comment';

/** @ignore */
var ERR_INVALID_SELECTOR = ' must be a string';

module.exports = {

	/** @ignore */
	parentNode: function (node, required, funcName, paramName) {
		paramName = paramName || 'node';

		if ((node || required) && !isNodeType(node, VALID_PARENT_NODE)) {
			throw new TypeError(funcName + ': ' + paramName + ERR_INVALID_PARENT_NODE);
		}
	},

	/** @ignore */
	childNode: function (node, required, funcName, paramName) {
		paramName = paramName || 'node';

		if (!node && !required) {
			return;
		}

		if (!isNodeType(node, VALID_CHILD_NODE)) {
			throw new TypeError(funcName + ': ' + paramName + ERR_INVALID_CHILD_NODE);
		}
	},

	/** @ignore */
	selector: function (selector, required, funcName, paramName) {
		paramName = paramName || 'selector';

		if ((selector || required) && typeof selector !== 'string') {
			throw new TypeError(funcName + ': ' + paramName + ERR_INVALID_SELECTOR);
		}
	}

};

},{"ac-dom-nodes/COMMENT_NODE":185,"ac-dom-nodes/DOCUMENT_FRAGMENT_NODE":186,"ac-dom-nodes/DOCUMENT_NODE":187,"ac-dom-nodes/ELEMENT_NODE":188,"ac-dom-nodes/TEXT_NODE":189,"ac-dom-nodes/isNode":194}],181:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var children = require('./children');
var validate = require('./internal/validate');

/**
 * @name module:ac-dom-traversal.lastChild
 *
 * @function
 *
 * @desc Returns the last Element that is a direct child of the specified Node, matching an optional CSS selector.
 *
 * @param {Node} node
 *        The parent Element, Document, or Document Fragment.
 *
 * @param {String} [selector]
 *        Optional CSS selectors, separated by commas, to filter children Elements by.
 *
 * @returns {Element|null} Last matching child Element, or `null` if no matches are found.
 */
module.exports = function lastChild(node, selector) {
	var els;

	validate.parentNode(node, true, 'lastChild');
	validate.selector(selector, false, 'lastChild');

	if (node.lastElementChild && !selector) {
		return node.lastElementChild;
	}

	els = children(node, selector);

	if (els.length) {
		return els[els.length - 1];
	}

	return null;
};

},{"./children":175,"./internal/validate":180}],182:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var isElement = require('ac-dom-nodes/isElement');
var nativeMatches = require('./internal/nativeMatches');
var validate = require('./internal/validate');
var sizzle = require('./vendor/sizzle/sizzle');

/**
 * @name module:ac-dom-traversal.matchesSelector
 *
 * @function
 *
 * @desc Returns whether or not an Element matches a given CSS selector.
 *
 * @param {Node} node
 *        The Element to be checked.
 *
 * @param {String} selector
 *        CSS selectors, separated by commas, to check Element against.
 *
 * @returns {Boolean} `true` if the Element matches the selector, otherwise `false`
 */
module.exports = function matchesSelector(node, selector) {
 	validate.selector(selector, true, 'matchesSelector');

 	if (!isElement(node)) {
 		return false;
 	}

 	if (!nativeMatches) {
 		return sizzle.matchesSelector(node, selector);
 	}

	return nativeMatches.call(node, selector);
};

},{"./internal/nativeMatches":179,"./internal/validate":180,"./vendor/sizzle/sizzle":202,"ac-dom-nodes/isElement":193}],183:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var isElement = require('ac-dom-nodes/isElement');
var matchesSelector = require('./matchesSelector');
var validate = require('./internal/validate');

/**
 * @name module:ac-dom-traversal.nextSibling
 *
 * @function
 *
 * @desc Returns the closest sibling Element that follows the specified Node, matching an optional CSS selector.
 *
 * @param {Node} node
 *        The Element, TextNode, or Comment.
 *
 * @param {String} [selector]
 *        Optional CSS selectors, separated by commas, to filter sibling Elements by.
 *
 * @returns {Element|null} Closest matching sibling Element, or `null` if no matches are found.
 */
module.exports = function nextSibling(node, selector) {
 	validate.childNode(node, true, 'nextSibling');
 	validate.selector(selector, false, 'nextSibling');

	if (node.nextElementSibling && !selector) {
		return node.nextElementSibling;
	}

	while (node = node.nextSibling) {
		if (isElement(node)) {
			if (!selector || matchesSelector(node, selector)) {
				return node;
			}
		}
	}

	return null;
};

},{"./internal/validate":180,"./matchesSelector":182,"ac-dom-nodes/isElement":193}],184:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var isElement = require('ac-dom-nodes/isElement');
var matchesSelector = require('./matchesSelector');
var validate = require('./internal/validate');

/**
 * @name module:ac-dom-traversal.nextSiblings
 *
 * @function
 *
 * @desc Returns an Array of sibling Elements that follow the specified Node, matching an optional CSS selector.
 *
 * @param {Node} node
 *        The Element, TextNode, or Comment.
 *
 * @param {String} [selector]
 *        Optional CSS selectors, separated by commas, to filter sibling Elements by.
 *
 * @returns {Element[]} Array of matching sibling Elements, in DOM order.
 */
module.exports = function nextSiblings(node, selector) {
 	var els = [];

 	validate.childNode(node, true, 'nextSiblings');
 	validate.selector(selector, false, 'nextSiblings');

 	while (node = node.nextSibling) {
 		if (isElement(node)) {
 			if (!selector || matchesSelector(node, selector)) {
 				els.push(node);
 			}
 		}
 	}

 	return els;
};

},{"./internal/validate":180,"./matchesSelector":182,"ac-dom-nodes/isElement":193}],185:[function(require,module,exports){
arguments[4][89][0].apply(exports,arguments)
},{"dup":89}],186:[function(require,module,exports){
arguments[4][90][0].apply(exports,arguments)
},{"dup":90}],187:[function(require,module,exports){
arguments[4][91][0].apply(exports,arguments)
},{"dup":91}],188:[function(require,module,exports){
arguments[4][93][0].apply(exports,arguments)
},{"dup":93}],189:[function(require,module,exports){
arguments[4][94][0].apply(exports,arguments)
},{"dup":94}],190:[function(require,module,exports){
arguments[4][96][0].apply(exports,arguments)
},{"./ELEMENT_NODE":188,"./internal/isNodeType":191,"ac-polyfills/Array/prototype.filter":797,"ac-polyfills/Array/prototype.slice":799,"dup":96}],191:[function(require,module,exports){
arguments[4][102][0].apply(exports,arguments)
},{"../isNode":194,"dup":102}],192:[function(require,module,exports){
arguments[4][106][0].apply(exports,arguments)
},{"./DOCUMENT_FRAGMENT_NODE":186,"./internal/isNodeType":191,"dup":106}],193:[function(require,module,exports){
arguments[4][108][0].apply(exports,arguments)
},{"./ELEMENT_NODE":188,"./internal/isNodeType":191,"dup":108}],194:[function(require,module,exports){
arguments[4][109][0].apply(exports,arguments)
},{"dup":109}],195:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var isElement = require('ac-dom-nodes/isElement');
var matchesSelector = require('./matchesSelector');
var validate = require('./internal/validate');

/**
 * @name module:ac-dom-traversal.previousSibling
 *
 * @function
 *
 * @desc Returns the closest sibling Element that preceeds the specified Node, matching an optional CSS selector.
 *
 * @param {Node} node
 *        The Element, TextNode, or Comment.
 *
 * @param {String} [selector]
 *        Optional CSS selectors, separated by commas, to filter sibling Elements by.
 *
 * @returns {Element|null} Closest matching sibling Element, or `null` if no matches are found.
 */
module.exports = function previousSibling(node, selector) {
 	validate.childNode(node, true, 'previousSibling');
 	validate.selector(selector, false, 'previousSibling');

	if (node.previousElementSibling && !selector) {
		return node.previousElementSibling;
	}

	while (node = node.previousSibling) {
		if (isElement(node)) {
			if (!selector || matchesSelector(node, selector)) {
				return node;
			}
		}
	}

	return null;
};

},{"./internal/validate":180,"./matchesSelector":182,"ac-dom-nodes/isElement":193}],196:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var isElement = require('ac-dom-nodes/isElement');
var matchesSelector = require('./matchesSelector');
var validate = require('./internal/validate');

/**
 * @name module:ac-dom-traversal.previousSiblings
 *
 * @function
 *
 * @desc Returns an Array of sibling Elements that preceed the specified Node, matching an optional CSS selector.
 *
 * @param {Node} node
 *        The Element, TextNode, or Comment.
 *
 * @param {String} [selector]
 *        Optional CSS selectors, separated by commas, to filter sibling Elements by.
 *
 * @returns {Element[]} Array of matching sibling Elements, in DOM order.
 */
module.exports = function previousSiblings(node, selector) {
 	var els = [];

 	validate.childNode(node, true, 'previousSiblings');
 	validate.selector(selector, false, 'previousSiblings');

 	while (node = node.previousSibling) {
 		if (isElement(node)) {
 			if (!selector || matchesSelector(node, selector)) {
 				els.push(node);
 			}
 		}
 	}

 	return els.reverse();
};

},{"./internal/validate":180,"./matchesSelector":182,"ac-dom-nodes/isElement":193}],197:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var validate = require('./internal/validate');
var querySelectorShim = require('./shims/querySelector');

/**
 * @name module:ac-dom-traversal.querySelector
 *
 * @function
 *
 * @desc Returns the first Element within the specified context that match given CSS selector(s).
 *
 * @param {String} selector
 *        One or more CSS selectors separated by commas.
 *
 * @param {Node} [context=document]
 *        An optional ParentNode to scope the selector to. Defaults to `document`.
 *
 * @returns {Element|null} First matching Element, or `null` if no matches are found.
 */
module.exports = function querySelector(selector, context) {
	context = context || document;

	validate.parentNode(context, true, 'querySelector', 'context');
	validate.selector(selector, true, 'querySelector');

	if (!context.querySelector) {
		return querySelectorShim(selector, context);
	}

	return context.querySelector(selector);
};

},{"./internal/validate":180,"./shims/querySelector":199}],198:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var validate = require('./internal/validate');
var querySelectorAllShim = require('./shims/querySelectorAll');

/**
 * @name module:ac-dom-traversal.querySelectorAll
 *
 * @function
 *
 * @desc Returns an Array of Elements within the specified context that match given CSS selector(s).
 *
 * @param {String} selector
 *        One or more CSS selectors separated by commas.
 *
 * @param {Node} [context=document]
 *        An optional ParentNode to scope the selector to. Defaults to `document`.
 *
 * @returns {Element[]} Array of matching Elements
 */
module.exports = function querySelectorAll(selector, context) {
	context = context || document;

	validate.parentNode(context, true, 'querySelectorAll', 'context');
	validate.selector(selector, true, 'querySelectorAll');

	if (!context.querySelectorAll) {
		return querySelectorAllShim(selector, context);
	}

	return Array.prototype.slice.call(context.querySelectorAll(selector));
};

},{"./internal/validate":180,"./shims/querySelectorAll":200}],199:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var querySelectorAll = require('./querySelectorAll');

/**
 * module:ac-dom-traversal.querySelector shim for IE < 8
 * Fallback to sizzle needed due to lack of native querySelector
 */
module.exports = function querySelector(selector, context) {
	var allResults = querySelectorAll(selector, context);

	return allResults.length ? allResults[0] : null;
};

},{"./querySelectorAll":200}],200:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var sizzle = require('../vendor/sizzle/sizzle');
var getChildren = require('../children');
var isDocumentFragment = require('ac-dom-nodes/isDocumentFragment');

/**
 * module:ac-dom-traversal.querySelectorAll shim for IE < 8
 * Fallback to sizzle needed due to lack of native querySelectorAll
 */
module.exports = function querySelectorAll(selector, context) {
	var children;
	var matches;

	if (isDocumentFragment(context)) {
		children = getChildren(context);
		matches = [];

		children.forEach(function (node) {
			var childMatches;

			// check the child node
			if (sizzle.matchesSelector(node, selector)) {
				matches.push(node);
			}

			// check the child node's children
			childMatches = sizzle(selector, node);
			if (childMatches.length) {
				matches = matches.concat(childMatches);
			}
		});

		return matches;
	}

	return sizzle(selector, context);
};

},{"../children":175,"../vendor/sizzle/sizzle":202,"ac-dom-nodes/isDocumentFragment":192}],201:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var children = require('./children');
var validate = require('./internal/validate');

/**
 * @name module:ac-dom-traversal.siblings
 *
 * @function
 *
 * @desc Returns an Array of Elements that are siblings of the specified Node, matching an optional CSS selector.
 *
 * @param {Node} node
 *        The Element, TextNode, or Comment.
 *
 * @param {String} [selector]
 *        Optional CSS selectors, separated by commas, to filter sibling Elements by.
 *
 * @returns {Element[]} Array of matching sibling Elements, in DOM order.
 */
module.exports = function siblings(node, selector) {
 	var els = [];

 	validate.childNode(node, true, 'siblings');
 	validate.selector(selector, false, 'siblings');

 	if (node.parentNode) {
 		els = children(node.parentNode, selector);
 		els = els.filter(function (el) {
 			return (el !== node);
 		});
 	}

 	return els;
};

},{"./children":175,"./internal/validate":180}],202:[function(require,module,exports){
arguments[4][132][0].apply(exports,arguments)
},{"dup":132}],203:[function(require,module,exports){
var Clock = require("./ac-clock/Clock"),
	ThrottledClock = require("./ac-clock/ThrottledClock"),
	sharedClockInstance = require("./ac-clock/sharedClockInstance");

// expose parent constructor on global instance (in case we want to create private versions of this later)
sharedClockInstance.Clock = Clock;
sharedClockInstance.ThrottledClock = ThrottledClock;

module.exports = sharedClockInstance;

},{"./ac-clock/Clock":204,"./ac-clock/ThrottledClock":205,"./ac-clock/sharedClockInstance":206}],204:[function(require,module,exports){
/*global module */
"use strict";
var proto;

var EventEmitter = require('ac-event-emitter').EventEmitter;
var pageLoadTime = new Date().getTime();

/**
 * @name .Clock
 * @class Clock
 * <pre>Clock = require('/Clock');</pre>
 */
function Clock() {
	// initialize EventEmitter scope on this object
	EventEmitter.call( this );

	// create variables to house state information and animationFrame location
	this.lastFrameTime = null;
	this._animationFrame = null;
	this._active = false;
	this._startTime = null;
	this._boundOnAnimationFrame = this._onAnimationFrame.bind( this );
	this._getTime = Date.now || function() { return new Date().getTime(); };
}

// force EventEmitter prototype on Clock
proto = Clock.prototype = new EventEmitter( null );

// start running the animationFrame loop
proto.start = function() {
	// prevent the clock from running more than once
	if ( this._active ) {
		return;
	}
	this._tick();
};

// stop running the animationFrame loop
proto.stop = function() {
	if ( this._active ) {
		// cancel a previous animation frame if we're catching it off its refresh cycle
		window.cancelAnimationFrame( this._animationFrame );
	}

	// set the animationFrame to null and remove active state
	this._animationFrame = null;
	this.lastFrameTime = null;
	this._active = false;
};

// stop running the Clock and ensure that the object can be garbage collected
proto.destroy = function() {
	this.stop();
	this.off();

	var i;
	for ( i in this ) {
		if ( this.hasOwnProperty( i ) ) {
			this[ i ] = null;
		}
	}
};

// API to determine whether or not the clock is currently running
proto.isRunning = function() {
	return this._active;
};

// internally called start method to allow it to run continuously without triggering a new run cycle
proto._tick = function() {
	if ( !this._active ) {
		this._active = true;
	}

	// request the next animation frame to run
	this._animationFrame = window.requestAnimationFrame( this._boundOnAnimationFrame );
};

// method that gets called on each animationFrame render
proto._onAnimationFrame = function( e ) {
	var delta = 0;
	var timeNow = this._getTime();

	// push event object into a new object
	// TODO: Is this required? Maybe we'll want to add more date to each event object later?
	if ( this.lastFrameTime === null ) {
		this.lastFrameTime = timeNow - pageLoadTime;
	}
	else {
		delta = e - this.lastFrameTime;
	}

	// calculate delta and default fps
	var fps = 0,
		data;

	// if we can actually determine the FPS, calcaluate that here
	if ( delta !== 0 ) {
		fps = 1000 / delta;
	}

	// set data object
	data = {
		time : e,
		delta : delta,
		fps : fps,
		naturalFps : fps,
		timeNow : timeNow
	};

	// trigger the 'update' event, which modules should bind to if they have values that should be synced before 'draw'
	this.trigger( 'update', data );
	// trigger the 'draw' event, which modules should call when drawing to the page
	this.trigger( 'draw', data );

	// remove reference for this._animationFrame
	this._animationFrame = null;
	// set lastFrameTime
	this.lastFrameTime = e;
	// restart the animation frame loop

	// If the clock wasn't stopped in the update or draw cycles
	if (this._active !== false) {
		this._tick();
	} else {
		this.lastFrameTime = null;
	}
};


module.exports = Clock;

},{"ac-event-emitter":230}],205:[function(require,module,exports){
/*global module */
"use strict";
var proto;

var sharedClockInstance = require('./sharedClockInstance'),
	EventEmitter = require('ac-event-emitter').EventEmitter;

/**
 * @name .ThrottledClock
 * @class ThrottledClock
 * <pre>ThrottledClock = require('/ThrottledClock');</pre>
 */
function ThrottledClock( fps, options ) {
	// if being extended by another module, return false here;
	if ( fps === null ) {
		return;
	}

	EventEmitter.call( this );
	options = options || {};

	this._fps = fps || null;
	this._clock = options.clock || sharedClockInstance;
	this._lastThrottledTime = null;
	this._clockEvent = null;

	this._clock.on( 'update', this._onClockUpdate, this );
}

proto = ThrottledClock.prototype = new EventEmitter( null );

proto.setFps = function( fps ) {
	this._fps = fps;
	return this;
};

proto.getFps = function() {
	return this._fps;
};

proto.start = function() {
	this._clock.start();
	return this;
};

proto.stop = function() {
	this._clock.stop();
	return this;
};

proto.isRunning = function() {
	return this._clock.isRunning();
};

proto.destroy = function() {
	this._clock.off( 'update', this._onClockUpdate, this );
	this._clock.destroy.call( this );
};

proto._onClockUpdate = function( e ) {
	// get the last throttled time if DNE
	if ( this._lastThrottledTime === null ) {
		this._lastThrottledTime = this._clock.lastFrameTime;
	}

	var delta = e.time - this._lastThrottledTime;

	if ( !this._fps ) {
		throw new TypeError('FPS is not defined.');
	}

	// if the delta is less than the lastThrottledTime, return early
	if ( delta < ( 1000 / this._fps ) )  {
		return;
	}

	// pass the updated delta to object
	this._clockEvent = e;

	// set new delta and fps values
	this._clockEvent.delta = delta;
	this._clockEvent.fps = 1000 / delta;

	// set the lastThrottledTime to the current time
	this._lastThrottledTime = this._clockEvent.time;

	// ensure that _onClockDraw gets called on the next draw event from this._clock
	this._clock.once( 'draw', this._onClockDraw, this );

	this.trigger( 'update', this._clockEvent );
};

proto._onClockDraw = function() {
	this.trigger( 'draw', this._clockEvent );
};

module.exports = ThrottledClock;

},{"./sharedClockInstance":206,"ac-event-emitter":230}],206:[function(require,module,exports){
'use strict';

var Clock = require('./Clock');

module.exports = new Clock();
},{"./Clock":204}],207:[function(require,module,exports){
/** 
 * @module ac-clip
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

module.exports = {
	Clip: require('./ac-clip/Clip')
};

},{"./ac-clip/Clip":208}],208:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var create = require('ac-object').create;
var createPredefined = require('ac-easing').createPredefined;

/** @ignore */
var Clock = require('ac-clock');
var Ease = require('ac-easing').Ease;
var EventEmitter = require('ac-event-emitter').EventEmitter;

/** @ignore */
var DEFAULT_EASE = 'ease';
var EVENT_COMPLETE = 'complete';
var EVENT_PAUSE = 'pause';
var EVENT_PLAY = 'play';

/**
 * @name module:ac-clip.Clip
 * @class
 *
 * @param {Object} target
 *        The `Object` whose properties Clip will transition / modify.
 *
 * @param {Number} duration
 *        The duration of the transition in seconds.
 *
 * @param {Object} propsTo
 *        An `Object` containing the end state of the properties you wish to
 *        transition on target.
 *
 * @param {Number} [options.delay=0]
 *        Delay in seconds before a clip will start after play has been called.
 *
 * @param {String|Function} [options.ease='ease']
 *        The ease used for transitions.
 *
 * @param {Clock} [options.clock=Clock]
 *        An instance of `ac-clock.Clock` to be used. Defaults to global singleton.
 *
 * @param {Object} [options.propsFrom={}]
 *        An `Object` containing the start state of the properties you wish to
 *        transition on target.
 *
 * @param {Boolean} [options.destroyOnComplete=null]
 *        When true the clip will self destruct - call destroy on itself upon
 *        completion.
 *
 * @param {Function} [options.onStart=null]
 *        A callback `Function` called when the clip starts to play.
 *
 * @param {Function} [options.onUpdate=null]
 *        A callback `Function` called when the clip has updated properties.
 *        This should be used if you require to do further calculations with the
 *        properties and not for rendering. Use `onDraw` for rendering.
 *
 * @param {Function} [options.onDraw=null]
 *        A callback `Function` called when the clip has updated properties.
 *        This should be used for rendering, e.g. drawing something to a `canvas`
 *        element.
 *
 * @param {Function} [options.onComplete=null]
 *        A callback `Function` called when the clip has finished playing.
 */
function Clip(target, duration, propsTo, options) {

	// options
	options = options || {};
	this._options = options;

	// object / timing
	this._target = target;
	this._duration = duration * 1000;
	this._delay = (options.delay || 0) * 1000;
	this._remainingDelay = this._delay;
	this._progress = 0;
	this._clock = options.clock || Clock;
	this._playing = false;
	this._getTime = Date.now || function() { return new Date().getTime(); };

	// features
	this._isYoyo = options.yoyo;
	this._direction = 1;
	this._loop = options.loop || 0;
	this._loopCount = 0;

	// properties
	this._propsTo = propsTo || {};
	this._propsFrom = options.propsFrom || {};

	// callbacks
	this._onStart = options.onStart || null;
	this._onUpdate = options.onUpdate || null;
	this._onDraw = options.onDraw || null;
	this._onComplete = options.onComplete || null;

	// easing
	var ease = options.ease || DEFAULT_EASE;
	this._ease = (typeof ease === 'function') ? new Ease(ease) : createPredefined(ease);

	//bind
	this._start = this._start.bind(this);
	this._update = this._update.bind(this);
	this._draw = this._draw.bind(this);

	// further prep work to be done in _prepareProperties
	this._isPrepared = false;

	Clip._add(this);
}

var proto = Clip.prototype = create(EventEmitter.prototype);


////////////////////////////////////////
//////////  PUBLIC METHODS   ///////////
////////////////////////////////////////

/**
 * @name module:ac-clip.Clip#play
 * @function
 *
 * @desc Starts the clip.
 *
 * @returns {Clip} A reference to this clip.
 */
proto.play = function () {
	if (!this._playing) {
		this._playing = true;

		if (this._delay === 0 || this._remainingDelay === 0) {
			this._start();
		}
		else {
			if (!this._isPrepared) {
				this._setDiff();
				this._updateProps();
			}
			this._startTimeout = setTimeout(this._start, this._remainingDelay);
			this._delayStart = this._getTime();
		}
	}
	return this;
};

/**
 * @name module:ac-clip.Clip#pause
 * @function
 *
 * @desc Pauses the clip.
 *
 * @fires Clip#pause
 *
 * @returns {Clip} A reference to this clip.
 */
proto.pause = function () {
	if (this._playing) {
		if (this._startTimeout) {
			this._remainingDelay = this._getTime() - this._delayStart;
			clearTimeout(this._startTimeout);
		}

		this._stop();

		/**
		 * Pause event.
		 * @event Clip#pause
		 */
		this.trigger(EVENT_PAUSE, this._getDetails());
	}
	return this;
};

/**
 * @name module:ac-clip.Clip#destroy
 * @function
 *
 * @desc Immediately stop the clip and make it eligible for garbage collection.
 *       A clip can not be reused after it has been destroyed.
 *
 * @returns {Clip} A reference to this clip.
 */
proto.destroy = function () {
	this.pause();

	this._options = null;
	this._target = null;
	this._storeTarget = null;
	this._ease = null;
	this._clock = null;
	this._propsTo = null;
	this._propsFrom = null;
	this._storePropsTo = null;
	this._storePropsFrom = null;
	this._propsDiff = null;
	this._propsEase = null;
	this._onStart = null;
	this._onUpdate = null;
	this._onDraw = null;
	this._onComplete = null;

	Clip._remove(this);

	return this;
};

/**
 * @name module:ac-clip.Clip#reset
 * @function
 *
 * @desc Resets the clip and target properties.
 *
 * @returns {Clip} A reference to this clip.
 */
proto.reset = function () {
	if (!this._isPrepared) {
		// nothing to reset
		return;
	}

	this._stop();
	
	var loop = function (target, stored) {
		var prop;
		for (prop in stored) {
			if (stored.hasOwnProperty(prop)) {
				if (stored[prop] !== null) {
					if (typeof stored[prop] === 'object') {
						loop(target[prop], stored[prop]);
					}
					else {
						target[prop] = stored[prop];
					}
				}
			}
		}
	};
	loop(this._target, this._storeTarget);
	
	this._direction = 1;
	this._loop = this._options.loop || 0;
	this._loopCount = 0;
	this._propsFrom = this._storePropsFrom;
	this._propsTo = this._storePropsTo;
	
	this._progress = 0;
	this._setStartTime();

	if (this._onUpdate) {
		this._onUpdate.call(this, this._getDetails());
	}
	if (this._onDraw) {
		this._onDraw.call(this, this._getDetails());
	}

	return this;
};

/**
 * @name module:ac-clip.Clip#isPlaying
 * @function
 *
 * @desc Returns the clips current play stat as a `Boolean` true / false.
 *
 * @returns {Boolean} The current play stat.
 */
proto.isPlaying = function () {
	return this._playing;
};

/**
 * @name module:ac-clip.Clip#getTarget
 * @function
 *
 * @desc Returns the target `Object`.
 *
 * @returns {Object} The target.
 */
proto.getTarget = function () {
	return this._target;
};

/**
 * @name module:ac-clip.Clip#setCurrentTime
 * @function
 *
 * @desc Sets the current playing time of the clip to the specified `Number`.
 *
 * @param {Number} time
 *        Sets the current playing time of the clip to the specified Number.
 *
 * @returns {Number} The current time.
 */
proto.setCurrentTime = function (time) {
	this.setProgress(time * 1000 / this._duration);
	return this.getCurrentTime();
};

/**
 * @name module:ac-clip.Clip#getCurrentTime
 * @function
 *
 * @desc Returns the current playing time of the clip as a `Number`.
 *
 * @returns {Number} The current time.
 */
proto.getCurrentTime = function () {
	return (this.getProgress() * this._duration) / 1000;
};

/**
 * @name module:ac-clip.Clip#setProgress
 * @function
 *
 * @desc Accepts a `Number` between 0 and 1 and will change the position of the clip.
 *
 * @param {Number} progress
 *        Accepts a Number between 0 and 1 and will change the position of the clip.
 *
 * @returns {Number} The current progress.
 */
proto.setProgress = function (progress) {
	this._progress = Math.min(1, Math.max(0, progress));
	this._setStartTime();
	
	if (!this._isPrepared) {
		this._setDiff();
	}
	
	if (this._playing && progress === 1) {
		this._completeProps();
		if (this._onUpdate) {
			this._onUpdate.call(this, this._getDetails());
		}
		if (this._onDraw) {
			this._onDraw.call(this, this._getDetails());
		}
		this._complete();
	}
	else {
		this._updateProps();
		if (this._onUpdate) {
			this._onUpdate.call(this, this._getDetails());
		}
		if (this._onDraw) {
			this._onDraw.call(this, this._getDetails());
		}
	}

	return this.getProgress();
};

/**
 * @name module:ac-clip.Clip#getProgress
 * @function
 *
 * @desc Returns the current progress as a `Number` between 0 and 1.
 *
 * @returns {Number} The current progress.
 */
proto.getProgress = function () {
	return this._progress;
};


////////////////////////////////////////
/////////  PRIVATE METHODS   ///////////
////////////////////////////////////////

/**
 * @name module:ac-clip.Clip#_addPropsFrom
 * @function
 * @private
 *
 * @desc Loops through propsFrom and if there isn't a matching propsTo
 *       adds propsTo property to match the current state of target
 */
/** @ignore */
proto._addPropsFrom = function () {
	var prop;
	for (prop in this._propsFrom) {
		if (this._propsFrom.hasOwnProperty(prop) && this._propsTo[prop] === undefined && this._target[prop] !== undefined) {
			this._propsTo[prop] = this._target[prop];
		}
	}
};

/**
 * @name module:ac-clip.Clip#_cloneTarget
 * @function
 * @private
 *
 * @returns {Object}
 */
/** @ignore */
proto._cloneTarget = function () {
	var storeTarget = {};
	var loop = function (to, target, store) {
		var prop;
		for (prop in to) {
			if (target.hasOwnProperty(prop)) {
				if (target[prop] !== null && typeof target[prop] === 'object') {
					store[prop] = {};
					loop(to[prop], target[prop], store[prop]);
				}
				else if (to[prop] && typeof target[prop] === 'number') {
					store[prop] = target[prop];
				}
			}
		}
	};
	loop(this._propsTo, this._target, storeTarget);
	return storeTarget;
};

/**
 * @name module:ac-clip.Clip#_prepareProperties
 * @function
 * @private
 */
/** @ignore */
proto._prepareProperties = function () {
	if (!this._isPrepared) {
		// adds any propsFrom that are not specified in propsTo
		this._addPropsFrom();

		// store for yoyo, loop and reset
		this._storeTarget = this._cloneTarget();
		this._storePropsTo = this._propsTo;
		this._storePropsFrom = this._propsFrom;

		this._isPrepared = true;
	}
};

/**
 * @name module:ac-clip.Clip#_setStartTime
 * @function
 * @private
 */
/** @ignore */
proto._setStartTime = function () {
	this._startTime = this._getTime() - (this.getProgress() * this._duration);
};

/**
 * @name module:ac-clip.Clip#_setDiff
 * @function
 * @private
 */
/** @ignore */
proto._setDiff = function () {

	// this is the last moment to prep any props
	if (!this._isPrepared) {
		this._prepareProperties();
	}

	this._propsDiff = {};
	var loop = function (to, from, target, diff) {
		var prop;
		for (prop in to) {
			if (to.hasOwnProperty(prop)) {
				if (to[prop] !== null && typeof to[prop] === 'object') {
					from[prop] = from[prop] || {};
					diff[prop] = diff[prop] || {};
					loop(to[prop], from[prop], target[prop], diff[prop]);
				}
				else if (typeof target[prop] === 'number') {
					if (from[prop] !== undefined) {
						target[prop] = from[prop];
					}
					else {
						from[prop] = target[prop];
					}
					diff[prop] = to[prop] - target[prop];
				}
				else {
					to[prop] = null;
				}
			}
		}
	};
	loop(this._propsTo, this._propsFrom, this._target, this._propsDiff);
};

/**
 * @name module:ac-clip.Clip#_getDetails
 * @function
 * @private
 *
 * @returns {Object}
 */
/** @ignore */
proto._getDetails = function () {
	return {
		target: this.getTarget(),
		progress: this.getProgress(),
		clip: this
	};
};

/**
 * @name module:ac-clip.Clip#_start
 * @function
 * @private
 *
 * @fires Clip#play
 */
/** @ignore */
proto._start = function () {
	this._startTimeout = null;
	this._remainingDelay = 0;

	this._setStartTime();

	this._clock.on('update', this._update);
	this._clock.on('draw', this._draw);

	if (!this._clock.isRunning()) {
		this._clock.start();
	}

	this._setDiff();

	this._playing = true;
	this._running = true;

	if (this._onStart) {
		this._onStart.call(this, this._getDetails());
	}

	/**
     * Play event.
     * @event Clip#play
     */
	this.trigger(EVENT_PLAY, this._getDetails());
};

/**
 * @name module:ac-clip.Clip#_stop
 * @function
 * @private
 */
/** @ignore */
proto._stop = function () {
	this._playing = false;
	this._running = false;
	this._clock.off('update', this._update);
	this._clock.off('draw', this._draw);
};

/**
 * @name module:ac-clip.Clip#_updateProps
 * @function
 * @private
 */
/** @ignore */
proto._updateProps = function () {
	var eased;
	if (this._direction === 1) {
		eased = this._ease.getValue(this._progress);
	}
	else {
		eased = 1 - this._ease.getValue(1 - this._progress);
	}

	var loop = function (to, from, target, diff) {
		var prop;
		for (prop in to) {
			if (to.hasOwnProperty(prop)) {
				if (typeof to[prop] !== 'number') {
					loop(to[prop], from[prop], target[prop], diff[prop]);
				}
				else {
					target[prop] = from[prop] + (diff[prop] * eased);
				}
			}
		}
	};
	loop(this._propsTo, this._propsFrom, this._target, this._propsDiff);
};

/**
 * @name module:ac-clip.Clip#_completeProps
 * @function
 * @private
 *
 * @fires Clip#complete
 */
/** @ignore */
proto._completeProps = function () {
	var loop = function (to, target) {
		var prop;
		for (prop in to) {
			if (to.hasOwnProperty(prop)) {
				if (typeof to[prop] !== 'number') {
					loop(to[prop], target[prop]);
				}
				else {
					target[prop] = to[prop];
				}
			}
		}
	};
	loop(this._propsTo, this._target);
};

/**
 * @name module:ac-clip.Clip#_complete
 * @function
 * @private
 *
 * @fires Clip#complete
 */
/** @ignore */
proto._complete = function () {
	if (this._isYoyo && ((this._loop > 0 && this._loopCount <= this._loop) || (this._loop === 0 && this._loopCount === 0))) {
		this._propsFrom = (this._direction === 1) ? this._storePropsTo : this._storePropsFrom;
		this._propsTo = (this._direction === 1) ? this._storePropsFrom : this._storePropsTo;
		this._direction *= -1;
		if (this._direction === -1) {
			++this._loopCount;
		}
		this.setProgress(0);
		this._start();
	}
	else if (this._loopCount < this._loop) {
		++this._loopCount;
		this.setProgress(0);
		this._start();
	}
	else {
		if (this._onComplete) {
			this._onComplete.call(this, this._getDetails());
		}

		/**
		 * Complete event.
		 * @event Clip#complete
		 */
		this.trigger(EVENT_COMPLETE, this._getDetails());

		if (this._options && this._options.destroyOnComplete) {
			this.destroy();
		}
	}
};

/**
 * @name module:ac-clip.Clip#_update
 * @function
 * @private
 *
 * @param {Object} [evt=undefined]
 */
/** @ignore */
proto._update = function (evt) {
	if (this._running) {
		this._progress = (evt.timeNow - this._startTime) / this._duration;

		if (this._progress >= 1) {
			this._progress = 1;
			this._running = false;
			this._completeProps();
		}
		else {
			this._updateProps();
		}

		if (this._onUpdate) {
			this._onUpdate.call(this, this._getDetails());
		}
	}
};

/**
 * @name module:ac-clip.Clip#_draw
 * @function
 * @private
 *
 * @param {Object} [evt=undefined]
 */
/** @ignore */
proto._draw = function (evt) {
	if (this._onDraw) {
		this._onDraw.call(this, this._getDetails());
	}

	if (!this._running) {
		this._stop();

		if (this._progress === 1) {
			this._complete();
		}
	}
};


////////////////////////////////////////
//////////  STATIC METHODS   ///////////
////////////////////////////////////////

/**
 * @name module:ac-clip.Clip#_instantiate
 * @function
 * @private
 * @static
 */
/** @ignore */
Clip._instantiate = function () {
	this._clips = [];
	return this;
};

/**
 * @name module:ac-clip.Clip#_add
 * @function
 * @private
 * @static
 *
 * @param {Clip} clip
 */
/** @ignore */
Clip._add = function (clip) {
	this._clips.push(clip);
};

/**
 * @name module:ac-clip.Clip#_remove
 * @function
 * @private
 * @static
 *
 * @param {Clip} clip
 */
/** @ignore */
Clip._remove = function (clip) {
	var index = this._clips.indexOf(clip);
	if (index > -1) {
		this._clips.splice(index, 1);
	}
};

/**
 * @name module:ac-clip.Clip#getAll
 * @function
 * @static
 *
 * @desc Returns an Array of all Clip instances. Will filter to only
 *       instances using target param when supplied.
 *
 * @param {Object} [target=null]
 *        An optional target options. If supplied this function will
 *        return only Clip instances who use this target.
 *
 * @returns {Array} An array of Clip instances.
 */
Clip.getAll = function (target) {
	if (target !== undefined) {
		var clips = [];
		var i = this._clips.length;
		while (i--) {
			if (this._clips[i].getTarget() === target) {
				clips.push(this._clips[i]);
			}
		}
		return clips;
	}
	return Array.prototype.slice.call(this._clips);
};

/**
 * @name module:ac-clip.Clip#destroyAll
 * @function
 * @static
 *
 * @desc Destroys all Clip instances. Will filter to only
 *       instances using target param when supplied.
 *
 * @param {Object} [target=null]
 *        An optional target options. If supplied this function will
 *        destroy only Clip instances who use this target.
 *
 * @returns {Array} An array of all Clips destroyed.
 */
Clip.destroyAll = function (target) {
	var clips = this.getAll(target);
	if (this._clips.length === clips.length) {
		// if all clips then empty array to prevent splice
		this._clips = [];
	}
	var i = clips.length;
	while (i--) {
		clips[i].destroy();
	}
	return clips;
};

/**
 * @name module:ac-clip.Clip#to
 * @function
 * @static
 *
 * @desc Creates and returns an instance of a Clip that will autostart and destroy
 *       itself upon completetion. Ideal for creating throw away instances of Clip
 *       and not having to worry about memory / destroying them.
 *
 * @param {Object} target
 *        The `Object` whose properties Clip will transition / modify.
 *
 * @param {Number} duration
 *        The duration of the transition in seconds.
 *
 * @param {Object} propsTo
 *        An `Object` containing the end state of the properties you wish to
 *        transition on target.
 *
 * @param {Object} options
 *        See Clip instantiation docs for full list of options.
 *
 * @returns {Clip} An new instance of Clip.
 */
Clip.to = function (target, duration, propsTo, options) {
	options = options || {};
	if (options.destroyOnComplete === undefined) {
		options.destroyOnComplete = true;
	}
	return new Clip(target, duration, propsTo, options).play();
};

/**
 * @name module:ac-clip.Clip#from
 * @function
 * @static
 *
 * @desc Creates and returns an instance of a Clip that will autostart and destroy
 *       itself upon completetion. Ideal for creating throw away instances of Clip
 *       and not having to worry about memory / destroying them. Unlike the static
 *       `to` method this method takes propsFrom as the third argument and will
 *       transition an Object back to it's original state.
 *
 * @param {Object} target
 *        The `Object` whose properties Clip will transition / modify.
 *
 * @param {Number} duration
 *        The duration of the transition in seconds.
 *
 * @param {Object} propsFrom
 *        An `Object` containing the start state of the properties you wish to
 *        transition on target.
 *
 * @param {Object} options
 *        See Clip instantiation docs for full list of options. The one difference
 *        here is no `propsFrom` object can be passed in options but instead a `propsTo`
 *        option is accepted that works in a similar way - listing end states for props.
 *
 * @returns {Clip} An new instance of Clip.
 */
Clip.from = function (target, duration, propsFrom, options) {
	options = options || {};
	options.propsFrom = propsFrom;
	if (options.destroyOnComplete === undefined) {
		options.destroyOnComplete = true;
	}
	return new Clip(target, duration, options.propsTo, options).play();
};


module.exports = Clip._instantiate();

},{"ac-clock":203,"ac-easing":222,"ac-event-emitter":230,"ac-object":790}],209:[function(require,module,exports){
/** 
 * @module ac-color
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

module.exports = {
	decimalToHex: require('./ac-color/decimalToHex'),
	hexToDecimal: require('./ac-color/hexToDecimal'),
	hexToRgb: require('./ac-color/hexToRgb'),
	isColor: require('./ac-color/isColor'),
	isHex: require('./ac-color/isHex'),
	isRgb: require('./ac-color/isRgb'),
	mixColors: require('./ac-color/mixColors'),
	rgbToArray: require('./ac-color/rgbToArray'),
	rgbToDecimal: require('./ac-color/rgbToDecimal'),
	rgbToHex: require('./ac-color/rgbToHex'),
	rgbToObject: require('./ac-color/rgbToObject'),
	shortToLongHex: require('./ac-color/shortToLongHex')
};

},{"./ac-color/decimalToHex":210,"./ac-color/hexToDecimal":211,"./ac-color/hexToRgb":212,"./ac-color/isColor":213,"./ac-color/isHex":214,"./ac-color/isRgb":215,"./ac-color/mixColors":216,"./ac-color/rgbToArray":217,"./ac-color/rgbToDecimal":218,"./ac-color/rgbToHex":219,"./ac-color/rgbToObject":220,"./ac-color/shortToLongHex":221}],210:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name module:ac-color.decimalToHex
 *
 * @function
 *
 * @param {Number} decimal
 *
 * @returns {String}
 */
module.exports = function decimalToHex (decimal) {
	return '#' + (decimal).toString(16);
};

},{}],211:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name module:ac-color.hexToDecimal
 *
 * @function
 *
 * @param {String} hex
 *
 * @returns {Number}
 */
module.exports = function hexToDecimal (hex) {
	return parseInt(hex.substr(1), 16);
};

},{}],212:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var shortToLongHex = require('./shortToLongHex');

/**
 * @name module:ac-color.hexToRgb
 *
 * @function
 *
 * @param {String} hex
 *
 * @returns {String}
 */
module.exports = function hexToRgb (hex) {
	hex = shortToLongHex(hex);
	var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
	return result ? 'rgb(' + parseInt(result[1], 16) + ', ' + parseInt(result[2], 16) + ', ' + parseInt(result[3], 16) + ')' : null;
};

},{"./shortToLongHex":221}],213:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var isRgb = require('./isRgb');
var isHex = require('./isHex');

/**
 * @name module:ac-color.isColor
 *
 * @function
 *
 * @param {String} str
 *
 * @returns {Boolean}
 */
module.exports = function isColor (str) {
	return isRgb(str) || isHex(str);
};

},{"./isHex":214,"./isRgb":215}],214:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name module:ac-color.isHex
 *
 * @function
 *
 * @param {String} str
 *
 * @returns {Boolean}
 */
module.exports = function isHex (str) {
	var regex = /(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i;
	return regex.test(str);
};

},{}],215:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name module:ac-color.isRgb
 *
 * @function
 *
 * @param {String} str
 *
 * @returns {Boolean}
 */
module.exports = function isRgb (str) {
	return typeof str === 'string' && str.indexOf('rgb(') === 0;
};

},{}],216:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var isHex = require('./isHex');
var hexToRgb = require('./hexToRgb');
var rgbToObject = require('./rgbToObject');

/**
 * @name module:ac-color.hexToDecimal
 *
 * @function
 *
 * @param {String} from
 * @param {String} to
 * @param {Number} percent
 *
 * @returns {String}
 */
module.exports = function mixColors (from, to, percent) {
	// ensure rgb
	from = isHex(from) ? hexToRgb(from) : from;
	to = isHex(to) ? hexToRgb(to) : to;
	
	// convert to object
	from = rgbToObject(from);
	to = rgbToObject(to);
	
	// set rgb
	var r = from.r + ((to.r - from.r) * percent);
	var g = from.g + ((to.g - from.g) * percent);
	var b = from.b + ((to.b - from.b) * percent);

	return 'rgb(' + r + ', ' + g + ', ' + b + ')';
};

},{"./hexToRgb":212,"./isHex":214,"./rgbToObject":220}],217:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var rgbToObject = require('./rgbToObject');

/**
 * @name module:ac-color.rgbToArray
 *
 * @function
 *
 * @param {String} rgb
 *
 * @returns {Array}
 */
module.exports = function rgbToArray (rgb) {
	var o = rgbToObject(rgb);
	return [o.r, o.g, o.b];
};

},{"./rgbToObject":220}],218:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var hexToDecimal = require('./hexToDecimal');
var rgbToArray = require('./rgbToArray');
var rgbToHex = require('./rgbToHex');

/**
 * @name module:ac-color.rgbToDecimal
 *
 * @function
 *
 * @param {String} rgb
 *
 * @returns {Number}
 */
module.exports = function rgbToDecimal (rgb) {
	var hex = rgbToHex.apply(this, rgbToArray(rgb));
	return hexToDecimal(hex);
};

},{"./hexToDecimal":211,"./rgbToArray":217,"./rgbToHex":219}],219:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name module:ac-color.hexToDecimal
 *
 * @function
 *
 * @param {Number} r
 * @param {Number} g
 * @param {Number} b
 *
 * @returns {String}
 */
module.exports = function rgbToHex (r, g, b) {
	return '#' + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
};

},{}],220:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name module:ac-color.rgbToObject
 *
 * @function
 *
 * @param {String} rgb
 *
 * @returns {Object}
 */
module.exports = function rgbToObject (rgb) {
	var regex = /rgb\((\d{1,3}), (\d{1,3}), (\d{1,3})\)/;
	var match = regex.exec(rgb);
	return {
		r: Number(match[1]),
		g: Number(match[2]),
		b: Number(match[3])
	};
};

},{}],221:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name module:ac-color.shortToLongHex
 *
 * @function
 *
 * @param {String} hex
 *
 * @returns {String}
 */
module.exports = function shortToLongHex (hex) {
	var shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
	hex = hex.replace(shorthandRegex, function(m, r, g, b) {
		return '#' + r + r + g + g + b + b;
	});
	return hex;
};

},{}],222:[function(require,module,exports){
/** 
 * @module ac-easing
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

module.exports = {
	createBezier: require('./ac-easing/createBezier'),
	createPredefined: require('./ac-easing/createPredefined'),
	createStep: require('./ac-easing/createStep'),
	Ease: require('./ac-easing/Ease')
};

},{"./ac-easing/Ease":223,"./ac-easing/createBezier":224,"./ac-easing/createPredefined":225,"./ac-easing/createStep":226}],223:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var ERR_FUNCTION_REQUIRE = 'Ease expects an easing function.';

/**
 * @name module:ac-easing.Ease
 * @class
 *
 * @param {Function} func
 *        An easing function.
 *
 * @param {String} [cssString=null]
 *        The CSS equivelant of the easing function.
 *        e.g. ease-in would be 'cubic-bezier(0.42, 0.0, 1.00, 1.0)'
 */
function Ease(func, cssString) {
	if (typeof func !== 'function') {
		throw new TypeError(ERR_FUNCTION_REQUIRE);
	}

	/**
	 * @name module:ac-easing.Ease#easingFunction
	 * @type {Function}
	 *
	 * @desc The easing function.
	 */
	this.easingFunction = func;

	/**
	 * @name module:ac-easing.Ease#cssString
	 * @type {String}
	 * 
	 * @desc The CSS equivilant of the easing function.
	 */
	this.cssString = cssString || null;
}

var proto = Ease.prototype;

/**
 * @name module:ac-easing.Ease#getValue
 * @function
 *
 * @desc Returns the eased equivilant of the number passed.
 *
 * @param {Number} value
 *        A number between 0-1.
 *
 * @returns {Number} The eased equivilant of the number passed.
 */
proto.getValue = function (value) {
	return this.easingFunction(value, 0, 1, 1);
};

module.exports = Ease;

},{}],224:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var Ease = require('./Ease');
var KeySpline = require('./helpers/KeySpline');

/** @ignore */
var ERR_BEZIER_VALUES = 'Bezier curve expects exactly four (4) numbers. Given: ';

/**
 * @name module:ac-easing.createBezier
 *
 * @function
 * 
 * @desc Create an easing function from a set of bezier curve points.
 *
 * @param {Number} x1
 *        The x-coordinate of the first Bézier control point.
 *
 * @param {Number} y1
 *        The y-coordinate of the first Bézier control point.
 *
 * @param {Number} x2
 *        The x-coordinate of the second Bézier control point.
 *
 * @param {Number} y2
 *        The y-coordinate of the second Bézier control point.
 *
 * @returns {Ease} A new instance of an Ease object.
 */
module.exports = function createBezier (x1, y1, x2, y2) {
	var pts = Array.prototype.slice.call(arguments);
	var allNums = pts.every(function (pt) {
		return (typeof pt === 'number');
	});

	if (pts.length !== 4 || !allNums) {
		throw new TypeError(ERR_BEZIER_VALUES + pts);
	}

	var keySpline = new KeySpline(x1, y1, x2, y2);

	var easingFn = function(time, begin, change, duration) {
		return keySpline.get(time / duration) * change + begin;
	};

	var cssString = 'cubic-bezier(' + pts.join(', ') + ')';

	return new Ease(easingFn, cssString);
};

},{"./Ease":223,"./helpers/KeySpline":227}],225:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var createStep = require('./createStep');
var cssAliases = require('./helpers/cssAliases');
var easingFunctions = require('./helpers/easingFunctions');

/** @ignore */
var Ease = require('./Ease');

/** @ignore */
var ERR_PREDEFINED = 'Easing function "%TYPE%" not recognized among the following: ' + Object.keys(easingFunctions).join(', ');

/**
 * @name module:ac-easing.createPredefined
 *
 * @function
 * 
 * @desc Create an easing function from a set of predefined.
 *
 * @param {String} type
 *        The name of the ease, e.g. 'easeIn'.
 *
 * @returns {Ease} A new instance of an Ease object.
 */
module.exports = function createPredefined (type) {
	var easingFn;

	if (type === 'step-start') {
		return createStep(1, 'start');
	}
	else if (type === 'step-end') {
		return createStep(1, 'end');
	}
	else {
		easingFn = easingFunctions[type];
	}

	if (!easingFn) {
		throw new Error(ERR_PREDEFINED.replace('%TYPE%', type));
	}

	return new Ease(easingFn, cssAliases[type]);
};

},{"./Ease":223,"./createStep":226,"./helpers/cssAliases":228,"./helpers/easingFunctions":229}],226:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var Ease = require('./Ease');

/** @ignore */
var ERR_STEP_TYPE = 'Step function expects a numeric value greater than zero. Given: ';
var ERR_STEP_DIRECTION = 'Step function direction must be either "start" or "end" (default). Given: ';

/**
 * @name module:ac-easing.createStep
 *
 * @function
 * 
 * @desc Create a step easing function.
 *
 * @param {Number} steps
 *        Amount of steps.
 *
 * @param {String} [direction='end']
 *        Direction of ease.
 *
 * @returns {Ease} A new instance of an Ease object.
 */
module.exports = function createStep (steps, direction) {
	direction = direction || 'end';

	if (typeof steps !== 'number' || steps < 1) {
		throw new TypeError(ERR_STEP_TYPE + steps);
	}

	if (direction !== 'start' && direction !== 'end') {
		throw new TypeError(ERR_STEP_DIRECTION + direction);
	}

	var easingFn = function (time, begin, change, duration) {
		var length = change / steps;
		var step = Math[(direction === 'start') ? 'floor' : 'ceil'](time / duration * steps);
		return begin + length * step;
	};

	var cssString = 'steps(' + steps + ', ' + direction + ')';

	return new Ease(easingFn, cssString);
};

},{"./Ease":223}],227:[function(require,module,exports){
/*! MIT License
 *
 * KeySpline - use bezier curve for transition easing function
 * Copyright (c) 2012 Gaetan Renaudeau <renaudeau.gaetan@gmail.com>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a
 * copy of this software and associated documentation files (the "Software"),
 * to deal in the Software without restriction, including without limitation
 * the rights to use, copy, modify, merge, publish, distribute, sublicense,
 * and/or sell copies of the Software, and to permit persons to whom the
 * Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
 * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
 * DEALINGS IN THE SOFTWARE.
 */
/**
* KeySpline - use bezier curve for transition easing function
* is inspired from Firefox's nsSMILKeySpline.cpp
* Usage:
* var spline = new KeySpline(0.25, 0.1, 0.25, 1.0)
* spline.get(x) => returns the easing value | x must be in [0, 1] range
*/

/* jshint newcap:false */


function KeySpline (mX1, mY1, mX2, mY2) {

  this.get = function(aX) {
    if (mX1 === mY1 && mX2 === mY2) { return aX; } // linear
    return CalcBezier(GetTForX(aX), mY1, mY2);
  };

  function A(aA1, aA2) { return 1.0 - 3.0 * aA2 + 3.0 * aA1; }
  function B(aA1, aA2) { return 3.0 * aA2 - 6.0 * aA1; }
  function C(aA1)      { return 3.0 * aA1; }

  // Returns x(t) given t, x1, and x2, or y(t) given t, y1, and y2.
  function CalcBezier(aT, aA1, aA2) {
    return ((A(aA1, aA2)*aT + B(aA1, aA2))*aT + C(aA1))*aT;
  }

  // Returns dx/dt given t, x1, and x2, or dy/dt given t, y1, and y2.
  function GetSlope(aT, aA1, aA2) {
    return 3.0 * A(aA1, aA2)*aT*aT + 2.0 * B(aA1, aA2) * aT + C(aA1);
  }

  function GetTForX(aX) {
    // Newton raphson iteration
    var aGuessT = aX;
    for (var i = 0; i < 4; ++i) {
      var currentSlope = GetSlope(aGuessT, mX1, mX2);
      if (currentSlope === 0.0) { return aGuessT; }
      var currentX = CalcBezier(aGuessT, mX1, mX2) - aX;
      aGuessT -= currentX / currentSlope;
    }
    return aGuessT;
  }
}

module.exports = KeySpline;

},{}],228:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

var aliases = {

	'linear': 'cubic-bezier(0, 0, 1, 1)',
	
	// ease
	'ease':        'cubic-bezier(0.25, 0.1, 0.25, 1)',
	'ease-in':     'cubic-bezier(0.42, 0, 1, 1)',
	'ease-out':    'cubic-bezier(0, 0, 0.58, 1)',
	'ease-in-out': 'cubic-bezier(0.42, 0, 0.58, 1)',
	
	// cubic
	'ease-in-cubic':     'cubic-bezier(0.55, 0.055, 0.675, 0.19)',
	'ease-out-cubic':    'cubic-bezier(0.215, 0.61, 0.355, 1)',
	'ease-in-out-cubic': 'cubic-bezier(0.645, 0.045, 0.355, 1)',

	// quad
	'ease-in-quad':     'cubic-bezier(0.55, 0.085, 0.68, 0.53)',
	'ease-out-quad':    'cubic-bezier(0.25, 0.46, 0.45, 0.94)',
	'ease-in-out-quad': 'cubic-bezier(0.455, 0.03, 0.515, 0.955)',
	
	// quart
	'ease-in-quart':     'cubic-bezier(0.895, 0.03, 0.685, 0.22)',
	'ease-out-quart':    'cubic-bezier(0.165, 0.84, 0.44, 1)',
	'ease-in-out-quart': 'cubic-bezier(0.77, 0, 0.175, 1)',

	// quint
	'ease-in-quint':     'cubic-bezier(0.755, 0.05, 0.855, 0.06)',
	'ease-out-quint':    'cubic-bezier(0.23, 1, 0.32, 1)',
	'ease-in-out-quint': 'cubic-bezier(0.86, 0, 0.07, 1)',

	// sine
	'ease-in-sine':     'cubic-bezier(0.47, 0, 0.745, 0.715)',
	'ease-out-sine':    'cubic-bezier(0.39, 0.575, 0.565, 1)',
	'ease-in-out-sine': 'cubic-bezier(0.445, 0.05, 0.55, 0.95)',

	// expo
	'ease-in-expo':     'cubic-bezier(0.95, 0.05, 0.795, 0.035)',
	'ease-out-expo':    'cubic-bezier(0.19, 1, 0.22, 1)',
	'ease-in-out-expo': 'cubic-bezier(1, 0, 0, 1)',

	// circ
	'ease-in-circ':     'cubic-bezier(0.6, 0.04, 0.98, 0.335)',
	'ease-out-circ':    'cubic-bezier(0.075, 0.82, 0.165, 1)',
	'ease-in-out-circ': 'cubic-bezier(0.785, 0.135, 0.15, 0.86)',

	// back
	'ease-in-back':     'cubic-bezier(0.6, -0.28, 0.735, 0.045)',
	'ease-out-back':    'cubic-bezier(0.175, 0.885, 0.32, 1.275)',
	'ease-in-out-back': 'cubic-bezier(0.68, -0.55, 0.265, 1.55)'
	
};

// ease
aliases['easeIn'] = aliases['ease-in'];
aliases['easeOut'] = aliases['ease-out'];
aliases['easeInOut'] = aliases['ease-in-out'];

// cubic
aliases['easeInCubic'] = aliases['ease-in-cubic'];
aliases['easeOutCubic'] = aliases['ease-out-cubic'];
aliases['easeInOutCubic'] = aliases['ease-in-out-cubic'];

// quad
aliases['easeInQuad'] = aliases['ease-in-quad'];
aliases['easeOutQuad'] = aliases['ease-out-quad'];
aliases['easeInOutQuad'] = aliases['ease-in-out-quad'];

// quart
aliases['easeInQuart'] = aliases['ease-in-quart'];
aliases['easeOutQuart'] = aliases['ease-out-quart'];
aliases['easeInOutQuart'] = aliases['ease-in-out-quart'];

// quint
aliases['easeInQuint'] = aliases['ease-in-quint'];
aliases['easeOutQuint'] = aliases['ease-out-quint'];
aliases['easeInOutQuint'] = aliases['ease-in-out-quint'];

// sine
aliases['easeInSine'] = aliases['ease-in-sine'];
aliases['easeOutSine'] = aliases['ease-out-sine'];
aliases['easeInOutSine'] = aliases['ease-in-out-sine'];

// expo
aliases['easeInExpo'] = aliases['ease-in-expo'];
aliases['easeOutExpo'] = aliases['ease-out-expo'];
aliases['easeInOutExpo'] = aliases['ease-in-out-expo'];

// circ
aliases['easeInCirc'] = aliases['ease-in-circ'];
aliases['easeOutCirc'] = aliases['ease-out-circ'];
aliases['easeInOutCirc'] = aliases['ease-in-out-circ'];

// back
aliases['easeInBack'] = aliases['ease-in-back'];
aliases['easeOutBack'] = aliases['ease-out-back'];
aliases['easeInOutBack'] = aliases['ease-in-out-back'];

module.exports = aliases;

},{}],229:[function(require,module,exports){
'use strict';

/** @ignore */
var createBezier = require('../createBezier');

var ease = createBezier(0.25, 0.1, 0.25, 1.0).easingFunction;
var easeIn = createBezier(0.42, 0.0, 1.00, 1.0).easingFunction;
var easeOut = createBezier(0.00, 0.0, 0.58, 1.0).easingFunction;
var easeInOut = createBezier(0.42, 0.0, 0.58, 1.0).easingFunction;

var linear = function (time, begin, change, duration) {
	return change * time / duration + begin;
};

var easeInQuad = function (time, begin, change, duration) {
	return change * (time /= duration) * time + begin;
};

var easeOutQuad = function (time, begin, change, duration) {
	return -change * (time /= duration) * (time - 2) + begin;
};

var easeInOutQuad = function (time, begin, change, duration) {
	if ((time /= duration / 2) < 1) {
		return change / 2 * time * time + begin;
	}
	return -change / 2 * ((--time) * (time - 2) - 1) + begin;
};

var easeInCubic = function (time, begin, change, duration) {
	return change * (time /= duration) * time * time + begin;
};

var easeOutCubic = function (time, begin, change, duration) {
	return change * ((time = time / duration - 1) * time * time + 1) + begin;
};

var easeInOutCubic = function (time, begin, change, duration) {
	if ((time /= duration / 2) < 1) {
		return change / 2 * time * time * time + begin;
	}
	return change / 2 * ((time -= 2) * time * time + 2) + begin;
};

var easeInQuart = function (time, begin, change, duration) {
	return change * (time /= duration) * time * time * time + begin;
};

var easeOutQuart = function (time, begin, change, duration) {
	return -change * ((time = time / duration - 1) * time * time * time - 1) + begin;
};

var easeInOutQuart = function (time, begin, change, duration) {
	if ((time /= duration / 2) < 1) {
		return change / 2 * time * time * time * time + begin;
	}
	return -change / 2 * ((time -= 2) * time * time * time - 2) + begin;
};

var easeInQuint = function (time, begin, change, duration) {
	return change * (time /= duration) * time * time * time * time + begin;
};

var easeOutQuint = function (time, begin, change, duration) {
	return change * ((time = time / duration - 1) * time * time * time * time + 1) + begin;
};

var easeInOutQuint = function (time, begin, change, duration) {
	if ((time /= duration / 2) < 1) {
		return change / 2 * time * time * time * time * time + begin;
	}
	return change / 2 * ((time -= 2) * time * time * time * time + 2) + begin;
};

var easeInSine = function (time, begin, change, duration) {
	return -change * Math.cos(time / duration * (Math.PI / 2)) + change + begin;
};

var easeOutSine = function (time, begin, change, duration) {
	return change * Math.sin(time / duration * (Math.PI / 2)) + begin;
};

var easeInOutSine = function (time, begin, change, duration) {
	return -change / 2 * (Math.cos(Math.PI * time / duration) - 1) + begin;
};

var easeInExpo = function (time, begin, change, duration) {
	return (time === 0) ? begin : change * Math.pow(2, 10 * (time / duration - 1)) + begin;
};

var easeOutExpo = function (time, begin, change, duration) {
	return (time === duration) ? begin + change : change * (-Math.pow(2, -10 * time / duration) + 1) + begin;
};

var easeInOutExpo = function (time, begin, change, duration) {
	if (time === 0) {
		return begin;
	}
	else if (time === duration) {
		return begin + change;
	}
	else if ((time /= duration / 2) < 1) {
		return change / 2 * Math.pow(2, 10 * (time - 1)) + begin;
	}
	return change / 2 * (-Math.pow(2, -10 * --time) + 2) + begin;
};

var easeInCirc = function (time, begin, change, duration) {
	return -change * (Math.sqrt(1 - (time /= duration) * time) - 1) + begin;
};

var easeOutCirc = function (time, begin, change, duration) {
	return change * Math.sqrt(1 - (time = time / duration - 1) * time) + begin;
};

var easeInOutCirc = function (time, begin, change, duration) {
	if ((time /= duration / 2) < 1) {
		return -change / 2 * (Math.sqrt(1 - time * time) - 1) + begin;
	}
	return change / 2 * (Math.sqrt(1 - (time -= 2) * time) + 1) + begin;
};

var easeInElastic = function (time, begin, change, duration) {
	var shootover = 1.70158;
	var period = 0;
	var amplitude = change;
	if (time === 0) {
		return begin;
	}
	else if ((time /= duration) === 1) {
		return begin + change;
	}
	if (!period) {
		period = duration * 0.3;
	}
	if (amplitude < Math.abs(change)) {
		amplitude = change;
		shootover = period / 4;
	}
	else {
		shootover = period / (2 * Math.PI) * Math.asin(change / amplitude);
	}
	return -(amplitude * Math.pow(2, 10 * (time -= 1)) * Math.sin((time * duration - shootover) * (2 * Math.PI) / period)) + begin;
};

var easeOutElastic = function (time, begin, change, duration) {
	var shootover = 1.70158;
	var period = 0;
	var amplitude = change;
	if (time === 0) {
		return begin;
	}
	else if ((time /= duration) === 1) {
		return begin + change;
	}
	if (!period) {
		period = duration * 0.3;
	}
	if (amplitude < Math.abs(change)) {
		amplitude = change;
		shootover = period / 4;
	}
	else {
		shootover = period / (2 * Math.PI) * Math.asin(change / amplitude);
	}
	return amplitude * Math.pow(2, -10 * time) * Math.sin((time * duration - shootover) * (2 * Math.PI) / period) + change + begin;
};

var easeInOutElastic = function (time, begin, change, duration) {
	var shootover = 1.70158;
	var period = 0;
	var amplitude = change;
	if (time === 0) {
		return begin;
	}
	else if ((time /= duration / 2) === 2) {
		return begin + change;
	}
	if (!period) {
		period = duration * (0.3 * 1.5);
	}
	if (amplitude < Math.abs(change)) {
		amplitude = change;
		shootover = period / 4;
	}
	else {
		shootover = period / (2 * Math.PI) * Math.asin(change / amplitude);
	}
	if (time < 1) {
		return -0.5 * (amplitude * Math.pow(2, 10 * (time -= 1)) * Math.sin((time * duration - shootover) * (2 * Math.PI) / period)) + begin;
	}
	return amplitude * Math.pow(2, -10 * (time -= 1)) * Math.sin((time * duration - shootover) * (2 * Math.PI) / period) * 0.5 + change + begin;
};


var easeInBack = function (time, begin, change, duration, shootover) {
	if (shootover === undefined) {
		shootover = 1.70158;
	}
	return change * (time /= duration) * time * ((shootover + 1) * time - shootover) + begin;
};

var easeOutBack = function (time, begin, change, duration, shootover) {
	if (shootover === undefined) {
		shootover = 1.70158;
	}
	return change * ((time = time / duration - 1) * time * ((shootover + 1) * time + shootover) + 1) + begin;
};

var easeInOutBack = function (time, begin, change, duration, shootover) {
	if (shootover === undefined) {
		shootover = 1.70158;
	}
	if ((time /= duration / 2) < 1) {
		return change / 2 * (time * time * (((shootover *= (1.525)) + 1) * time - shootover)) + begin;
	}
	return change / 2 * ((time -= 2) * time * (((shootover *= (1.525)) + 1) * time + shootover) + 2) + begin;
};

var easeOutBounce = function (time, begin, change, duration) {
	if ((time /= duration) < (1 / 2.75)) {
		return change * (7.5625 * time * time) + begin;
	}
	else if (time < (2 / 2.75)) {
		return change * (7.5625 * (time -= (1.5 / 2.75)) * time + 0.75) + begin;
	}
	else if (time < (2.5 / 2.75)) {
		return change * (7.5625 * (time -= (2.25 / 2.75)) * time + 0.9375) + begin;
	}
	return change * (7.5625 * (time -= (2.625 / 2.75)) * time + 0.984375) + begin;
};

var easeInBounce = function (time, begin, change, duration) {
	return change - easeOutBounce(duration - time, 0, change, duration) + begin;
};

var easeInOutBounce = function (time, begin, change, duration) {
	if (time < duration / 2) {
		return easeInBounce(time * 2, 0, change, duration) * 0.5 + begin;
	}
	return easeOutBounce(time * 2 - duration, 0, change, duration) * 0.5 + change * 0.5 + begin;
};

/**
 * @name module:ac-easing.easingFunctions
 * @function
 * @param {Float} time 
 *        Current position in time. Can be frames/seconds/milliseconds. ('t' in original Penner functions)
 * @param {Float} begin
 *        Start value. ('b' in original Penner functions)
 * @param {Float} change
 *        Change in value. ('c' in original Penner functions)
 * @param {Float} duration
 *        Duration. Can be frames/seconds/milliseconds. ('d' in original Penner functions)
 * @param {Float} [shootover=1.70158]
 *        Functions with 'Back' in their names take an additional optional parameter 'shootover', which
 *        controls the amount of overshoot. A higher value means greater overshoot. 'shootover' has a default
 *        value of 1.70158, which produces an overshoot of 10 percent. shootover==0 produces cubic easing with
 *        no overshoot. ('s' in original Penner functions)
 * @returns {Function}
 */
module.exports = {
	
	'linear': linear,

	// ease
	'ease':        ease,
	'easeIn':      easeIn,
	'ease-in':     easeIn,
	'easeOut':     easeOut,
	'ease-out':    easeOut,
	'easeInOut':   easeInOut,
	'ease-in-out': easeInOut,

	// cubic
	'easeInCubic':       easeInCubic,
	'ease-in-cubic':     easeInCubic,
	'easeOutCubic':      easeOutCubic,
	'ease-out-cubic':    easeOutCubic,
	'easeInOutCubic':    easeInOutCubic,
	'ease-in-out-cubic': easeInOutCubic,

	// quad
	'easeInQuad':       easeInQuad,
	'ease-in-quad':     easeInQuad,
	'easeOutQuad':      easeOutQuad,
	'ease-out-quad':    easeOutQuad,
	'easeInOutQuad':    easeInOutQuad,
	'ease-in-out-quad': easeInOutQuad,

	// quart
	'easeInQuart':       easeInQuart,
	'ease-in-quart':     easeInQuart,
	'easeOutQuart':      easeOutQuart,
	'ease-out-quart':    easeOutQuart,
	'easeInOutQuart':    easeInOutQuart,
	'ease-in-out-quart': easeInOutQuart,

	// quint
	'easeInQuint':       easeInQuint,
	'ease-in-quint':     easeInQuint,
	'easeOutQuint':      easeOutQuint,
	'ease-out-quint':    easeOutQuint,
	'easeInOutQuint':    easeInOutQuint,
	'ease-in-out-quint': easeInOutQuint,

	// sine
	'easeInSine':       easeInSine,
	'ease-in-sine':     easeInSine,
	'easeOutSine':      easeOutSine,
	'ease-out-sine':    easeOutSine,
	'easeInOutSine':    easeInOutSine,
	'ease-in-out-sine': easeInOutSine,

	// expo
	'easeInExpo':       easeInExpo,
	'ease-in-expo':     easeInExpo,
	'easeOutExpo':      easeOutExpo,
	'ease-out-expo':    easeOutExpo,
	'easeInOutExpo':    easeInOutExpo,
	'ease-in-out-expo': easeInOutExpo,

	// circ
	'easeInCirc':       easeInCirc,
	'ease-in-circ':     easeInCirc,
	'easeOutCirc':      easeOutCirc,
	'ease-out-circ':    easeOutCirc,
	'easeInOutCirc':    easeInOutCirc,
	'ease-in-out-circ': easeInOutCirc,

	// back
	'easeInBack':       easeInBack,
	'ease-in-back':     easeInBack,
	'easeOutBack':      easeOutBack,
	'ease-out-back':    easeOutBack,
	'easeInOutBack':    easeInOutBack,
	'ease-in-out-back': easeInOutBack,
	
	// elastic
	'easeInElastic':       easeInElastic,
	'ease-in-elastic':     easeInElastic,
	'easeOutElastic':      easeOutElastic,
	'ease-out-elastic':    easeOutElastic,
	'easeInOutElastic':    easeInOutElastic,
	'ease-in-out-elastic': easeInOutElastic,

	// bounce
	'easeInBounce':       easeInBounce,
	'ease-in-bounce':     easeInBounce,
	'easeOutBounce':      easeOutBounce,
	'ease-out-bounce':    easeOutBounce,
	'easeInOutBounce':    easeInOutBounce,
	'ease-in-out-bounce': easeInOutBounce
	
};

},{"../createBezier":224}],230:[function(require,module,exports){
arguments[4][135][0].apply(exports,arguments)
},{"./ac-event-emitter/EventEmitter":231,"dup":135}],231:[function(require,module,exports){
arguments[4][136][0].apply(exports,arguments)
},{"dup":136}],232:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var globalsHelper = require('./helpers/globals');
var once = require('ac-function/once');

/**
 * @name module:ac-feature.canvasAvailable
 *
 * @function
 *
 * @desc Returns the availability of the HTML5 Canvas API.
 *
 * @returns {Boolean} `true` if the browser supports canvas, otherwise `false`.
 */
var canvasAvailable = function () {
	var documentObj = globalsHelper.getDocument();
	var canvas = documentObj.createElement('canvas');

	return !!(typeof canvas.getContext === 'function' && canvas.getContext('2d'));
};

module.exports = once(canvasAvailable);
module.exports.original = canvasAvailable;

},{"./helpers/globals":240,"ac-function/once":249}],233:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var ac_browser = require('ac-browser');
var touchAvailable = require('./touchAvailable').original;
var once = require('ac-function/once');

/**
 * @name module:ac-feature.continuousScrollEventsAvailable
 *
 * @function
 *
 * @desc Returns the availability of continuous scroll events.
 *       iOS < 8 pauses painting and does not fire scroll events during scroll (only at the start and end).
 *
 * @returns {Boolean} `true` if scroll events are fired during scrolling, otherwise `false`.
 */
function continuousScrollEventsAvailable() {
	return (!touchAvailable() || (ac_browser.os === 'iOS' && ac_browser.version >= 8) || ac_browser.name === 'Chrome');
}

module.exports = once(continuousScrollEventsAvailable);
module.exports.original = continuousScrollEventsAvailable;

},{"./touchAvailable":264,"ac-browser":49,"ac-function/once":249}],234:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var globalsHelper = require('./helpers/globals');
var once = require('ac-function/once');

/**
 * @name module:ac-feature.cookiesAvailable
 *
 * @function
 *
 * @desc Returns the availability of cookies.
 *
 * @returns {Boolean} `true` if cookies are enabled, otherwise `false`.
 */
function cookiesAvailable() {
	var available = false;
	var documentObj = globalsHelper.getDocument();
	var navigatorObj = globalsHelper.getNavigator();

	try {
		if ('cookie' in documentObj && !!navigatorObj.cookieEnabled) {
			documentObj.cookie = 'ac_feature_cookie=1';
			available = (documentObj.cookie.indexOf('ac_feature_cookie') !== -1);
			documentObj.cookie = 'ac_feature_cookie=; expires=Thu, 01 Jan 1970 00:00:01 GMT;';
		}
	} catch (err) {}

	return available;
}

module.exports = once(cookiesAvailable);
module.exports.original = cookiesAvailable;

},{"./helpers/globals":240,"ac-function/once":249}],235:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var getStyleValue = require('ac-prefixer/getStyleValue');
var once = require('ac-function/once');

/**
 * @name module:ac-feature.cssLinearGradientAvailable
 *
 * @function
 *
 * @desc Returns the availability of linear-gradient() in CSS, including vendor-prefixed flavors.
 *
 * @returns {Boolean} `true` if linear-gradient() is available, otherwise `false`.
 */
function cssLinearGradientAvailable() {
	var values = [
		'linear-gradient(to bottom right, #9f9, white)',
		'linear-gradient(top left, #9f9, white)',
		'gradient(linear, left top, right bottom, from(#9f9), to(white))'
	];

	return values.some(function (value) {
		return !!getStyleValue('background-image', value);
	});
}

module.exports = once(cssLinearGradientAvailable);
module.exports.original = cssLinearGradientAvailable;

},{"ac-function/once":249,"ac-prefixer/getStyleValue":252}],236:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var getStyleValue = require('ac-prefixer/getStyleValue');
var getStyleProperty = require('ac-prefixer/getStyleProperty');
var memoize = require('ac-function/memoize');

/**
 * @name module:ac-feature.cssPropertyAvailable
 *
 * @function
 *
 * @desc Returns the availability of a CSS property including vendor-prefixed flavors, along with an optional value.
 *
 * @param {String} property
 *        The CSS property to test.
 *        Can be in DOM (borderRadius) or CSS (border-radius) form.
 *
 * @param {String} [value]
 *        An optional value to test.
 *
 * @returns {Boolean} `true` if the browser supports the given CSS property/value, otherwise `false`.
 */
function cssPropertyAvailable(property, value) {
	if (typeof value !== 'undefined') {
		return !!getStyleValue(property, value);
	} else {
		return !!getStyleProperty(property);
	}
}

module.exports = memoize(cssPropertyAvailable);
module.exports.original = cssPropertyAvailable;

},{"ac-function/memoize":248,"ac-prefixer/getStyleProperty":251,"ac-prefixer/getStyleValue":252}],237:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var getStyleValue = require('ac-prefixer/getStyleValue');
var once = require('ac-function/once');

/**
 * @name module:ac-feature.cssViewportUnitsAvailable
 *
 * @function
 *
 * @desc Returns the availability of `vw` and `vh` units in CSS.
 *
 * @returns {Boolean} `true` if the browser supports viewports units, otherwise `false`.
 */
function cssViewportUnitsAvailable() {
	return !!getStyleValue('margin', '1vw 1vh');
}

module.exports = once(cssViewportUnitsAvailable);
module.exports.original = cssViewportUnitsAvailable;

},{"ac-function/once":249,"ac-prefixer/getStyleValue":252}],238:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var globalsHelper = require('./helpers/globals');
var memoize = require('ac-function/memoize');

/**
 * @name module:ac-feature.elementAttributeAvailable
 *
 * @function
 *
 * @desc Returns the availability of an attribute on a specific element type.
 *
 * @param {String} attr
 *        The attribute to test for.
 *
 * @param {String} [tagName='div']
 *        An optional Element tagName
 *
 * @returns {Boolean} `true` if the Element supports the given attribute, otherwise `false`.
 */
function elementAttributeAvailable(attr, tagName) {
	var documentObj = globalsHelper.getDocument();
	var el;

	tagName = tagName || 'div';
	el = documentObj.createElement(tagName);

	return (attr in el);
}

module.exports = memoize(elementAttributeAvailable);
module.exports.original = elementAttributeAvailable;

},{"./helpers/globals":240,"ac-function/memoize":248}],239:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var getEventType = require('ac-prefixer/getEventType');
var memoize = require('ac-function/memoize');

/**
 * @name module:ac-feature.eventTypeAvailable
 *
 * @function
 *
 * @desc Returns the availability of a CSS property including vendor-prefixed flavors, along with an optional value.
 *
 * @param {String} property
 *        The CSS property to test.
 *        Can be in DOM (borderRadius) or CSS (border-radius) form.
 *
 * @param {String} [tagName='div']
 *        An optional Element tagName
 *
 * @returns {Boolean} `true` if the browser supports the given CSS property/value, otherwise `false`.
 */
function eventTypeAvailable(type, tagName) {
	return !!getEventType(type, tagName);
}

module.exports = memoize(eventTypeAvailable);
module.exports.original = eventTypeAvailable;

},{"ac-function/memoize":248,"ac-prefixer/getEventType":250}],240:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name module:globals
 * @private
 */
module.exports = {
	/**
	 * @name module.globals.getWindow
	 *
	 * @function
	 *
	 * @desc Get the window object.
	 *
	 * @returns {Window}
	 */
	getWindow: function () {
		return window;
	},

	/**
	 * @name module.globals.getDocument
	 *
	 * @function
	 *
	 * @desc Get the document object.
	 *
	 * @returns {Document}
	 */
	getDocument: function () {
		return document;
	},

	/**
	 * @name module.globals.getNavigator
	 *
	 * @function
	 *
	 * @desc Get the navigator object.
	 *
	 * @returns {Navigator}
	 */
	getNavigator: function () {
		return navigator;
	}
};

},{}],241:[function(require,module,exports){
/**
 * Helper methods for detecting the availability of various browser features.
 * @module ac-feature
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

module.exports = {
	canvasAvailable: require('./canvasAvailable'),
	continuousScrollEventsAvailable: require('./continuousScrollEventsAvailable'),
	cookiesAvailable: require('./cookiesAvailable'),
	cssLinearGradientAvailable: require('./cssLinearGradientAvailable'),
	cssPropertyAvailable: require('./cssPropertyAvailable'),
	cssViewportUnitsAvailable: require('./cssViewportUnitsAvailable'),
	elementAttributeAvailable: require('./elementAttributeAvailable'),
	eventTypeAvailable: require('./eventTypeAvailable'),
	isDesktop: require('./isDesktop'),
	isHandheld: require('./isHandheld'),
	isRetina: require('./isRetina'),
	isTablet: require('./isTablet'),
	localStorageAvailable: require('./localStorageAvailable'),
	mediaElementsAvailable: require('./mediaElementsAvailable'),
	sessionStorageAvailable: require('./sessionStorageAvailable'),
	svgAvailable: require('./svgAvailable'),
	threeDTransformsAvailable: require('./threeDTransformsAvailable'),
	touchAvailable: require('./touchAvailable'),
	webGLAvailable: require('./webGLAvailable')
};

},{"./canvasAvailable":232,"./continuousScrollEventsAvailable":233,"./cookiesAvailable":234,"./cssLinearGradientAvailable":235,"./cssPropertyAvailable":236,"./cssViewportUnitsAvailable":237,"./elementAttributeAvailable":238,"./eventTypeAvailable":239,"./isDesktop":242,"./isHandheld":243,"./isRetina":244,"./isTablet":245,"./localStorageAvailable":246,"./mediaElementsAvailable":247,"./sessionStorageAvailable":261,"./svgAvailable":262,"./threeDTransformsAvailable":263,"./touchAvailable":264,"./webGLAvailable":265}],242:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var touchAvailable = require('./touchAvailable').original;
var globalsHelper = require('./helpers/globals');
var once = require('ac-function/once');

/**
 * @name module:ac-feature.isDesktop
 *
 * @function
 *
 * @desc Attempts to determine if device is a Desktop.
 *       The test is based on the assumptions that desktops don't support touch and aren't orientable.
 *
 * @returns {Boolean} `true` if device does not support touch and/or orientation, otherwise `false`.
 */
function isDesktop() {
	var windowObj = globalsHelper.getWindow();

	return (!touchAvailable() && !windowObj.orientation);
}

module.exports = once(isDesktop);
module.exports.original = isDesktop;

},{"./helpers/globals":240,"./touchAvailable":264,"ac-function/once":249}],243:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var isDesktop = require('./isDesktop').original;
var isTablet = require('./isTablet').original;
var once = require('ac-function/once');

/**
 * @name module:ac-feature.isHandheld
 *
 * @function
 *
 * @desc Attempts to determine if device is a Handheld (e.g., iPhone, iPod Touch, etc).
 *       The test is based on the value of [isDesktop()]{module:ac-feature.isDesktop()}
 *       and if the device screen width is < 600px.
 *
 * @returns {Boolean} `true` if device is not a Desktop or Tablet, otherwise `false`.
 */
function isHandheld() {
	return (!isDesktop() && !isTablet());
}

module.exports = once(isHandheld);
module.exports.original = isHandheld;

},{"./isDesktop":242,"./isTablet":245,"ac-function/once":249}],244:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var globalsHelper = require('./helpers/globals');

/**
 * @name module:ac-feature.isRetina
 *
 * @function
 *
 * @desc Determines whether or not the display is Retina.
 *       Note: This function is not memoized.
 *
 * @returns {Boolean} `true` if the DPR is >= 1.5, otherwise `false`.
 */
module.exports = function isRetina() {
	var windowObj = globalsHelper.getWindow();
	return ('devicePixelRatio' in windowObj && windowObj.devicePixelRatio >= 1.5);
};

},{"./helpers/globals":240}],245:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var isDesktop = require('./isDesktop').original;
var globalsHelper = require('./helpers/globals');
var once = require('ac-function/once');

/**
 * @name module:ac-feature.isTablet
 *
 * @function
 *
 * @desc Attempts to determine if device is a Tablet.
 *       The test is based on the values of [isDesktop()]{module:ac-feature.isDesktop()}
 *       and if the device screen width is >= 600px.
 *
 * @returns {Boolean} `true` if device is determined to be a Tablet otherwise `false`.
 */
function isTablet() {
	var windowObj = globalsHelper.getWindow();
	var width = windowObj.screen.width;

	if (windowObj.orientation && windowObj.screen.height < width) {
		// normalize screen width for orientable devices
		width = windowObj.screen.height;
	}

	return (!isDesktop() && width >= 600);
}

module.exports = once(isTablet);
module.exports.original = isTablet;

},{"./helpers/globals":240,"./isDesktop":242,"ac-function/once":249}],246:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var globalsHelper = require('./helpers/globals');
var once = require('ac-function/once');

/**
 * @name module:ac-feature.localStorageAvailable
 *
 * @function
 *
 * @desc Returns the availability of HTML5 localStorage.
 *       Privacy mode must be disabled and cookies must be enabled.
 *       NOTE: Does not support Firefox <= 13 because of a bug where Firefox
 *       interprets a nonexistent item as null instead of undefined
 *
 * @returns {Boolean} `true` if localStorage is available, otherwise `false`.
 */
function localStorageAvailable() {
	var windowObj = globalsHelper.getWindow();
	var available = false;

	try {
		available = !!(windowObj.localStorage && windowObj.localStorage.non_existent !== null);
	} catch (err) {}

	return available;
}

module.exports = once(localStorageAvailable);
module.exports.original = localStorageAvailable;

},{"./helpers/globals":240,"ac-function/once":249}],247:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var globalsHelper = require('./helpers/globals');
var once = require('ac-function/once');

/**
 * @name module:ac-feature.mediaElementsAvailable
 *
 * @function
 *
 * @desc Returns the availability of HTML5 video/audio tags
 *
 * @returns {Boolean} `true` if the browser supports video/audio tags, otherwise `false`.
 */
function mediaElementsAvailable() {
	var windowObj = globalsHelper.getWindow();

	return ('HTMLMediaElement' in windowObj);
}

module.exports = once(mediaElementsAvailable);
module.exports.original = mediaElementsAvailable;

},{"./helpers/globals":240,"ac-function/once":249}],248:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name defaultHashFunction
 *
 * @function
 * @private
 *
 * @desc Creates a cache key based on arguments
 *
 * @param {...*}
 *
 * @returns {String} Comma-separated string of arguments
 */
var defaultHashFunction = function () {
	var key = '';
	var i;

	for (i = 0; i < arguments.length; i++) {
		if (i > 0) {
			key += ',';
		}

		key += arguments[i];
	}

	return key;
};

/**
 * @name module:ac-function.memoize
 *
 * @function
 *
 * @desc Creates a function that memoizes the result of `func`
 *
 * @param {Function} func
 *        The function to be memoized
 *
 * @param {Function} [hashFunction]
 *        A function that returns a cache key based on arguments
 *        Creates a comma-separated string of arguments by default
 *
 * @returns {Function}
 */
module.exports = function memoize(func, hashFunction) {
	hashFunction = hashFunction || defaultHashFunction;

	var memoized = function () {
		var args = arguments;
		var key = hashFunction.apply(this, args);

		if (!(key in memoized.cache)) {
			memoized.cache[key] = func.apply(this, args);
		}

		return memoized.cache[key];
	};

	memoized.cache = {};

	return memoized;
};

},{}],249:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name module:ac-function.once
 *
 * @function
 *
 * @desc Creates a function that executes `func` only once
 *
 * @param {Function} func
 *        The function to be executed once
 *
 * @returns {Function}
 */
module.exports = function once(func) {
	var result;

	return function () {
		if (typeof result === 'undefined') {
			result = func.apply(this, arguments);
		}

		return result;
	};
};

},{}],250:[function(require,module,exports){
arguments[4][66][0].apply(exports,arguments)
},{"./shared/camelCasedEventTypes":253,"./shared/prefixHelper":255,"./utils/eventTypeAvailable":258,"dup":66}],251:[function(require,module,exports){
arguments[4][163][0].apply(exports,arguments)
},{"./shared/getStyleTestElement":254,"./shared/prefixHelper":255,"./shared/stylePropertyCache":256,"./utils/toCSS":259,"./utils/toDOM":260,"dup":163}],252:[function(require,module,exports){
arguments[4][164][0].apply(exports,arguments)
},{"./getStyleProperty":251,"./shared/prefixHelper":255,"./shared/stylePropertyCache":256,"./shared/styleValueAvailable":257,"dup":164}],253:[function(require,module,exports){
arguments[4][67][0].apply(exports,arguments)
},{"dup":67}],254:[function(require,module,exports){
arguments[4][165][0].apply(exports,arguments)
},{"dup":165}],255:[function(require,module,exports){
arguments[4][68][0].apply(exports,arguments)
},{"dup":68}],256:[function(require,module,exports){
arguments[4][167][0].apply(exports,arguments)
},{"dup":167}],257:[function(require,module,exports){
arguments[4][168][0].apply(exports,arguments)
},{"./getStyleTestElement":254,"./stylePropertyCache":256,"dup":168}],258:[function(require,module,exports){
arguments[4][69][0].apply(exports,arguments)
},{"dup":69}],259:[function(require,module,exports){
arguments[4][170][0].apply(exports,arguments)
},{"dup":170}],260:[function(require,module,exports){
arguments[4][171][0].apply(exports,arguments)
},{"dup":171}],261:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var globalsHelper = require('./helpers/globals');
var once = require('ac-function/once');

/**
 * @name module:ac-feature.sessionStorageAvailable
 *
 * @function
 *
 * @desc Returns the availability of HTML5 sessionStorage.
 *       Privacy mode must be disabled and cookies must be enabled.
 *
 * @returns {Boolean} `true` if sessionStorage is available, otherwise `false`.
 */
function sessionStorageAvailable() {
	var windowObj = globalsHelper.getWindow();
	var available = false;

	try {
		if ('sessionStorage' in windowObj && typeof windowObj.sessionStorage.setItem === 'function') {
			windowObj.sessionStorage.setItem('ac_feature', 'test');
			available = true;
			windowObj.sessionStorage.removeItem('ac_feature', 'test');
		}
	} catch (e) {}

	return available;
}

module.exports = once(sessionStorageAvailable);
module.exports.original = sessionStorageAvailable;

},{"./helpers/globals":240,"ac-function/once":249}],262:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var globalsHelper = require('./helpers/globals');
var once = require('ac-function/once');

/**
 * @name module:ac-feature.svgAvailable
 *
 * @function
 *
 * @desc Returns the availability of SVG for <img> tags and background images.
 *
 * @returns {Boolean} `true` if SVG is supported, otherwise `false`.
 */
function svgAvailable() {
	var documentObj = globalsHelper.getDocument();

	return !!documentObj.implementation.hasFeature('http://www.w3.org/TR/SVG11/feature#Image', '1.1');
}

module.exports = once(svgAvailable);
module.exports.original = svgAvailable;

},{"./helpers/globals":240,"ac-function/once":249}],263:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var getStyleValue = require('ac-prefixer/getStyleValue');
var once = require('ac-function/once');

/**
 * @name module:ac-feature.threeDTransformsAvailable
 *
 * @function
 *
 * @desc Returns the availability of 3D transforms (e.g., 'translateZ').
 *
 * @returns {Boolean} `true` if 3D transforms are supported, otherwise `false`.
 */
function threeDTransformsAvailable() {
	return !!(getStyleValue('perspective', '1px') && getStyleValue('transform', 'translateZ(0)'));
}

module.exports = once(threeDTransformsAvailable);
module.exports.original = threeDTransformsAvailable;

},{"ac-function/once":249,"ac-prefixer/getStyleValue":252}],264:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var globalsHelper = require('./helpers/globals');
var once = require('ac-function/once');

/**
 * @name module:ac-feature.touchAvailable
 *
 * @function
 *
 * @desc Returns the availability of touch events.
 *
 * @returns {Boolean} `true` if touch events are supported, otherwise `false`.
 */
function touchAvailable() {
	var windowObj = globalsHelper.getWindow();
	var documentObj = globalsHelper.getDocument();
	var navigatorObj = globalsHelper.getNavigator();

	// DocumentTouch is specific to Firefox <25 support.
	// navigator.maxTouchPoints and navigator.msMaxTouchPoints are specific to IE10 & 11
	return !!(('ontouchstart' in windowObj) ||
		(windowObj.DocumentTouch && documentObj instanceof windowObj.DocumentTouch) ||
		(navigatorObj.maxTouchPoints > 0) ||
		(navigatorObj.msMaxTouchPoints > 0));
}

module.exports = once(touchAvailable);
module.exports.original = touchAvailable;

},{"./helpers/globals":240,"ac-function/once":249}],265:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var globalsHelper = require('./helpers/globals');
var once = require('ac-function/once');

/**
 * @name module:ac-feature.webGLAvailable
 *
 * @function
 *
 * @desc Returns the availability of the HTML5 webGL API.
 *
 * @returns {Boolean} `true` if the browser supports webGL, otherwise `false`.
 */
function webGLAvailable() {
	var documentObj = globalsHelper.getDocument();
	var canvas = documentObj.createElement('canvas');

	return !!(typeof canvas.getContext === 'function' && canvas.getContext('webgl'));
}

module.exports = once(webGLAvailable);
module.exports.original = webGLAvailable;

},{"./helpers/globals":240,"ac-function/once":249}],266:[function(require,module,exports){
/**
 * @fileoverview gl-matrix - High performance matrix and vector operations
 * @author Brandon Jones
 * @author Colin MacKenzie IV
 * @version 2.1.0
 */

/* Copyright (c) 2013, Brandon Jones, Colin MacKenzie IV. All rights reserved.

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

  * Redistributions of source code must retain the above copyright notice, this
    list of conditions and the following disclaimer.
  * Redistributions in binary form must reproduce the above copyright notice,
    this list of conditions and the following disclaimer in the documentation 
    and/or other materials provided with the distribution.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE 
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. */


(function() {
  "use strict";

  var shim = {};
  if (typeof(exports) === 'undefined') {
    if(typeof define == 'function' && typeof define.amd == 'object' && define.amd) {
      shim.exports = {};
      define(function() {
        return shim.exports;
      });
    } else {
      // gl-matrix lives in a browser, define its namespaces in global
      shim.exports = window;
    }    
  }
  else {
    // gl-matrix lives in commonjs, define its namespaces in exports
    shim.exports = exports;
  }

  (function(exports) {
    /* Copyright (c) 2013, Brandon Jones, Colin MacKenzie IV. All rights reserved.

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

  * Redistributions of source code must retain the above copyright notice, this
    list of conditions and the following disclaimer.
  * Redistributions in binary form must reproduce the above copyright notice,
    this list of conditions and the following disclaimer in the documentation 
    and/or other materials provided with the distribution.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE 
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. */


if(!GLMAT_EPSILON) {
    var GLMAT_EPSILON = 0.000001;
}

if(!GLMAT_ARRAY_TYPE) {
    var GLMAT_ARRAY_TYPE = (typeof Float32Array !== 'undefined') ? Float32Array : Array;
}

/**
 * @class Common utilities
 * @name glMatrix
 */
var glMatrix = {};

/**
 * Sets the type of array used when creating new vectors and matricies
 *
 * @param {Type} type Array type, such as Float32Array or Array
 */
glMatrix.setMatrixArrayType = function(type) {
    GLMAT_ARRAY_TYPE = type;
}

if(typeof(exports) !== 'undefined') {
    exports.glMatrix = glMatrix;
}
;
/* Copyright (c) 2013, Brandon Jones, Colin MacKenzie IV. All rights reserved.

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

  * Redistributions of source code must retain the above copyright notice, this
    list of conditions and the following disclaimer.
  * Redistributions in binary form must reproduce the above copyright notice,
    this list of conditions and the following disclaimer in the documentation 
    and/or other materials provided with the distribution.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE 
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. */

/**
 * @class 2 Dimensional Vector
 * @name vec2
 */

var vec2 = {};

/**
 * Creates a new, empty vec2
 *
 * @returns {vec2} a new 2D vector
 */
vec2.create = function() {
    var out = new GLMAT_ARRAY_TYPE(2);
    out[0] = 0;
    out[1] = 0;
    return out;
};

/**
 * Creates a new vec2 initialized with values from an existing vector
 *
 * @param {vec2} a vector to clone
 * @returns {vec2} a new 2D vector
 */
vec2.clone = function(a) {
    var out = new GLMAT_ARRAY_TYPE(2);
    out[0] = a[0];
    out[1] = a[1];
    return out;
};

/**
 * Creates a new vec2 initialized with the given values
 *
 * @param {Number} x X component
 * @param {Number} y Y component
 * @returns {vec2} a new 2D vector
 */
vec2.fromValues = function(x, y) {
    var out = new GLMAT_ARRAY_TYPE(2);
    out[0] = x;
    out[1] = y;
    return out;
};

/**
 * Copy the values from one vec2 to another
 *
 * @param {vec2} out the receiving vector
 * @param {vec2} a the source vector
 * @returns {vec2} out
 */
vec2.copy = function(out, a) {
    out[0] = a[0];
    out[1] = a[1];
    return out;
};

/**
 * Set the components of a vec2 to the given values
 *
 * @param {vec2} out the receiving vector
 * @param {Number} x X component
 * @param {Number} y Y component
 * @returns {vec2} out
 */
vec2.set = function(out, x, y) {
    out[0] = x;
    out[1] = y;
    return out;
};

/**
 * Adds two vec2's
 *
 * @param {vec2} out the receiving vector
 * @param {vec2} a the first operand
 * @param {vec2} b the second operand
 * @returns {vec2} out
 */
vec2.add = function(out, a, b) {
    out[0] = a[0] + b[0];
    out[1] = a[1] + b[1];
    return out;
};

/**
 * Subtracts two vec2's
 *
 * @param {vec2} out the receiving vector
 * @param {vec2} a the first operand
 * @param {vec2} b the second operand
 * @returns {vec2} out
 */
vec2.subtract = function(out, a, b) {
    out[0] = a[0] - b[0];
    out[1] = a[1] - b[1];
    return out;
};

/**
 * Alias for {@link vec2.subtract}
 * @function
 */
vec2.sub = vec2.subtract;

/**
 * Multiplies two vec2's
 *
 * @param {vec2} out the receiving vector
 * @param {vec2} a the first operand
 * @param {vec2} b the second operand
 * @returns {vec2} out
 */
vec2.multiply = function(out, a, b) {
    out[0] = a[0] * b[0];
    out[1] = a[1] * b[1];
    return out;
};

/**
 * Alias for {@link vec2.multiply}
 * @function
 */
vec2.mul = vec2.multiply;

/**
 * Divides two vec2's
 *
 * @param {vec2} out the receiving vector
 * @param {vec2} a the first operand
 * @param {vec2} b the second operand
 * @returns {vec2} out
 */
vec2.divide = function(out, a, b) {
    out[0] = a[0] / b[0];
    out[1] = a[1] / b[1];
    return out;
};

/**
 * Alias for {@link vec2.divide}
 * @function
 */
vec2.div = vec2.divide;

/**
 * Returns the minimum of two vec2's
 *
 * @param {vec2} out the receiving vector
 * @param {vec2} a the first operand
 * @param {vec2} b the second operand
 * @returns {vec2} out
 */
vec2.min = function(out, a, b) {
    out[0] = Math.min(a[0], b[0]);
    out[1] = Math.min(a[1], b[1]);
    return out;
};

/**
 * Returns the maximum of two vec2's
 *
 * @param {vec2} out the receiving vector
 * @param {vec2} a the first operand
 * @param {vec2} b the second operand
 * @returns {vec2} out
 */
vec2.max = function(out, a, b) {
    out[0] = Math.max(a[0], b[0]);
    out[1] = Math.max(a[1], b[1]);
    return out;
};

/**
 * Scales a vec2 by a scalar number
 *
 * @param {vec2} out the receiving vector
 * @param {vec2} a the vector to scale
 * @param {Number} b amount to scale the vector by
 * @returns {vec2} out
 */
vec2.scale = function(out, a, b) {
    out[0] = a[0] * b;
    out[1] = a[1] * b;
    return out;
};

/**
 * Calculates the euclidian distance between two vec2's
 *
 * @param {vec2} a the first operand
 * @param {vec2} b the second operand
 * @returns {Number} distance between a and b
 */
vec2.distance = function(a, b) {
    var x = b[0] - a[0],
        y = b[1] - a[1];
    return Math.sqrt(x*x + y*y);
};

/**
 * Alias for {@link vec2.distance}
 * @function
 */
vec2.dist = vec2.distance;

/**
 * Calculates the squared euclidian distance between two vec2's
 *
 * @param {vec2} a the first operand
 * @param {vec2} b the second operand
 * @returns {Number} squared distance between a and b
 */
vec2.squaredDistance = function(a, b) {
    var x = b[0] - a[0],
        y = b[1] - a[1];
    return x*x + y*y;
};

/**
 * Alias for {@link vec2.squaredDistance}
 * @function
 */
vec2.sqrDist = vec2.squaredDistance;

/**
 * Calculates the length of a vec2
 *
 * @param {vec2} a vector to calculate length of
 * @returns {Number} length of a
 */
vec2.length = function (a) {
    var x = a[0],
        y = a[1];
    return Math.sqrt(x*x + y*y);
};

/**
 * Alias for {@link vec2.length}
 * @function
 */
vec2.len = vec2.length;

/**
 * Calculates the squared length of a vec2
 *
 * @param {vec2} a vector to calculate squared length of
 * @returns {Number} squared length of a
 */
vec2.squaredLength = function (a) {
    var x = a[0],
        y = a[1];
    return x*x + y*y;
};

/**
 * Alias for {@link vec2.squaredLength}
 * @function
 */
vec2.sqrLen = vec2.squaredLength;

/**
 * Negates the components of a vec2
 *
 * @param {vec2} out the receiving vector
 * @param {vec2} a vector to negate
 * @returns {vec2} out
 */
vec2.negate = function(out, a) {
    out[0] = -a[0];
    out[1] = -a[1];
    return out;
};

/**
 * Normalize a vec2
 *
 * @param {vec2} out the receiving vector
 * @param {vec2} a vector to normalize
 * @returns {vec2} out
 */
vec2.normalize = function(out, a) {
    var x = a[0],
        y = a[1];
    var len = x*x + y*y;
    if (len > 0) {
        //TODO: evaluate use of glm_invsqrt here?
        len = 1 / Math.sqrt(len);
        out[0] = a[0] * len;
        out[1] = a[1] * len;
    }
    return out;
};

/**
 * Calculates the dot product of two vec2's
 *
 * @param {vec2} a the first operand
 * @param {vec2} b the second operand
 * @returns {Number} dot product of a and b
 */
vec2.dot = function (a, b) {
    return a[0] * b[0] + a[1] * b[1];
};

/**
 * Computes the cross product of two vec2's
 * Note that the cross product must by definition produce a 3D vector
 *
 * @param {vec3} out the receiving vector
 * @param {vec2} a the first operand
 * @param {vec2} b the second operand
 * @returns {vec3} out
 */
vec2.cross = function(out, a, b) {
    var z = a[0] * b[1] - a[1] * b[0];
    out[0] = out[1] = 0;
    out[2] = z;
    return out;
};

/**
 * Performs a linear interpolation between two vec2's
 *
 * @param {vec2} out the receiving vector
 * @param {vec2} a the first operand
 * @param {vec2} b the second operand
 * @param {Number} t interpolation amount between the two inputs
 * @returns {vec2} out
 */
vec2.lerp = function (out, a, b, t) {
    var ax = a[0],
        ay = a[1];
    out[0] = ax + t * (b[0] - ax);
    out[1] = ay + t * (b[1] - ay);
    return out;
};

/**
 * Transforms the vec2 with a mat2
 *
 * @param {vec2} out the receiving vector
 * @param {vec2} a the vector to transform
 * @param {mat2} m matrix to transform with
 * @returns {vec2} out
 */
vec2.transformMat2 = function(out, a, m) {
    var x = a[0],
        y = a[1];
    out[0] = m[0] * x + m[2] * y;
    out[1] = m[1] * x + m[3] * y;
    return out;
};

/**
 * Transforms the vec2 with a mat2d
 *
 * @param {vec2} out the receiving vector
 * @param {vec2} a the vector to transform
 * @param {mat2d} m matrix to transform with
 * @returns {vec2} out
 */
vec2.transformMat2d = function(out, a, m) {
    var x = a[0],
        y = a[1];
    out[0] = m[0] * x + m[2] * y + m[4];
    out[1] = m[1] * x + m[3] * y + m[5];
    return out;
};

/**
 * Transforms the vec2 with a mat3
 * 3rd vector component is implicitly '1'
 *
 * @param {vec2} out the receiving vector
 * @param {vec2} a the vector to transform
 * @param {mat3} m matrix to transform with
 * @returns {vec2} out
 */
vec2.transformMat3 = function(out, a, m) {
    var x = a[0],
        y = a[1];
    out[0] = m[0] * x + m[3] * y + m[6];
    out[1] = m[1] * x + m[4] * y + m[7];
    return out;
};

/**
 * Transforms the vec2 with a mat4
 * 3rd vector component is implicitly '0'
 * 4th vector component is implicitly '1'
 *
 * @param {vec2} out the receiving vector
 * @param {vec2} a the vector to transform
 * @param {mat4} m matrix to transform with
 * @returns {vec2} out
 */
vec2.transformMat4 = function(out, a, m) {
    var x = a[0], 
        y = a[1];
    out[0] = m[0] * x + m[4] * y + m[12];
    out[1] = m[1] * x + m[5] * y + m[13];
    return out;
};

/**
 * Perform some operation over an array of vec2s.
 *
 * @param {Array} a the array of vectors to iterate over
 * @param {Number} stride Number of elements between the start of each vec2. If 0 assumes tightly packed
 * @param {Number} offset Number of elements to skip at the beginning of the array
 * @param {Number} count Number of vec2s to iterate over. If 0 iterates over entire array
 * @param {Function} fn Function to call for each vector in the array
 * @param {Object} [arg] additional argument to pass to fn
 * @returns {Array} a
 * @function
 */
vec2.forEach = (function() {
    var vec = vec2.create();

    return function(a, stride, offset, count, fn, arg) {
        var i, l;
        if(!stride) {
            stride = 2;
        }

        if(!offset) {
            offset = 0;
        }
        
        if(count) {
            l = Math.min((count * stride) + offset, a.length);
        } else {
            l = a.length;
        }

        for(i = offset; i < l; i += stride) {
            vec[0] = a[i]; vec[1] = a[i+1];
            fn(vec, vec, arg);
            a[i] = vec[0]; a[i+1] = vec[1];
        }
        
        return a;
    };
})();

/**
 * Returns a string representation of a vector
 *
 * @param {vec2} vec vector to represent as a string
 * @returns {String} string representation of the vector
 */
vec2.str = function (a) {
    return 'vec2(' + a[0] + ', ' + a[1] + ')';
};

if(typeof(exports) !== 'undefined') {
    exports.vec2 = vec2;
}
;
/* Copyright (c) 2013, Brandon Jones, Colin MacKenzie IV. All rights reserved.

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

  * Redistributions of source code must retain the above copyright notice, this
    list of conditions and the following disclaimer.
  * Redistributions in binary form must reproduce the above copyright notice,
    this list of conditions and the following disclaimer in the documentation 
    and/or other materials provided with the distribution.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE 
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. */

/**
 * @class 3 Dimensional Vector
 * @name vec3
 */

var vec3 = {};

/**
 * Creates a new, empty vec3
 *
 * @returns {vec3} a new 3D vector
 */
vec3.create = function() {
    var out = new GLMAT_ARRAY_TYPE(3);
    out[0] = 0;
    out[1] = 0;
    out[2] = 0;
    return out;
};

/**
 * Creates a new vec3 initialized with values from an existing vector
 *
 * @param {vec3} a vector to clone
 * @returns {vec3} a new 3D vector
 */
vec3.clone = function(a) {
    var out = new GLMAT_ARRAY_TYPE(3);
    out[0] = a[0];
    out[1] = a[1];
    out[2] = a[2];
    return out;
};

/**
 * Creates a new vec3 initialized with the given values
 *
 * @param {Number} x X component
 * @param {Number} y Y component
 * @param {Number} z Z component
 * @returns {vec3} a new 3D vector
 */
vec3.fromValues = function(x, y, z) {
    var out = new GLMAT_ARRAY_TYPE(3);
    out[0] = x;
    out[1] = y;
    out[2] = z;
    return out;
};

/**
 * Copy the values from one vec3 to another
 *
 * @param {vec3} out the receiving vector
 * @param {vec3} a the source vector
 * @returns {vec3} out
 */
vec3.copy = function(out, a) {
    out[0] = a[0];
    out[1] = a[1];
    out[2] = a[2];
    return out;
};

/**
 * Set the components of a vec3 to the given values
 *
 * @param {vec3} out the receiving vector
 * @param {Number} x X component
 * @param {Number} y Y component
 * @param {Number} z Z component
 * @returns {vec3} out
 */
vec3.set = function(out, x, y, z) {
    out[0] = x;
    out[1] = y;
    out[2] = z;
    return out;
};

/**
 * Adds two vec3's
 *
 * @param {vec3} out the receiving vector
 * @param {vec3} a the first operand
 * @param {vec3} b the second operand
 * @returns {vec3} out
 */
vec3.add = function(out, a, b) {
    out[0] = a[0] + b[0];
    out[1] = a[1] + b[1];
    out[2] = a[2] + b[2];
    return out;
};

/**
 * Subtracts two vec3's
 *
 * @param {vec3} out the receiving vector
 * @param {vec3} a the first operand
 * @param {vec3} b the second operand
 * @returns {vec3} out
 */
vec3.subtract = function(out, a, b) {
    out[0] = a[0] - b[0];
    out[1] = a[1] - b[1];
    out[2] = a[2] - b[2];
    return out;
};

/**
 * Alias for {@link vec3.subtract}
 * @function
 */
vec3.sub = vec3.subtract;

/**
 * Multiplies two vec3's
 *
 * @param {vec3} out the receiving vector
 * @param {vec3} a the first operand
 * @param {vec3} b the second operand
 * @returns {vec3} out
 */
vec3.multiply = function(out, a, b) {
    out[0] = a[0] * b[0];
    out[1] = a[1] * b[1];
    out[2] = a[2] * b[2];
    return out;
};

/**
 * Alias for {@link vec3.multiply}
 * @function
 */
vec3.mul = vec3.multiply;

/**
 * Divides two vec3's
 *
 * @param {vec3} out the receiving vector
 * @param {vec3} a the first operand
 * @param {vec3} b the second operand
 * @returns {vec3} out
 */
vec3.divide = function(out, a, b) {
    out[0] = a[0] / b[0];
    out[1] = a[1] / b[1];
    out[2] = a[2] / b[2];
    return out;
};

/**
 * Alias for {@link vec3.divide}
 * @function
 */
vec3.div = vec3.divide;

/**
 * Returns the minimum of two vec3's
 *
 * @param {vec3} out the receiving vector
 * @param {vec3} a the first operand
 * @param {vec3} b the second operand
 * @returns {vec3} out
 */
vec3.min = function(out, a, b) {
    out[0] = Math.min(a[0], b[0]);
    out[1] = Math.min(a[1], b[1]);
    out[2] = Math.min(a[2], b[2]);
    return out;
};

/**
 * Returns the maximum of two vec3's
 *
 * @param {vec3} out the receiving vector
 * @param {vec3} a the first operand
 * @param {vec3} b the second operand
 * @returns {vec3} out
 */
vec3.max = function(out, a, b) {
    out[0] = Math.max(a[0], b[0]);
    out[1] = Math.max(a[1], b[1]);
    out[2] = Math.max(a[2], b[2]);
    return out;
};

/**
 * Scales a vec3 by a scalar number
 *
 * @param {vec3} out the receiving vector
 * @param {vec3} a the vector to scale
 * @param {Number} b amount to scale the vector by
 * @returns {vec3} out
 */
vec3.scale = function(out, a, b) {
    out[0] = a[0] * b;
    out[1] = a[1] * b;
    out[2] = a[2] * b;
    return out;
};

/**
 * Calculates the euclidian distance between two vec3's
 *
 * @param {vec3} a the first operand
 * @param {vec3} b the second operand
 * @returns {Number} distance between a and b
 */
vec3.distance = function(a, b) {
    var x = b[0] - a[0],
        y = b[1] - a[1],
        z = b[2] - a[2];
    return Math.sqrt(x*x + y*y + z*z);
};

/**
 * Alias for {@link vec3.distance}
 * @function
 */
vec3.dist = vec3.distance;

/**
 * Calculates the squared euclidian distance between two vec3's
 *
 * @param {vec3} a the first operand
 * @param {vec3} b the second operand
 * @returns {Number} squared distance between a and b
 */
vec3.squaredDistance = function(a, b) {
    var x = b[0] - a[0],
        y = b[1] - a[1],
        z = b[2] - a[2];
    return x*x + y*y + z*z;
};

/**
 * Alias for {@link vec3.squaredDistance}
 * @function
 */
vec3.sqrDist = vec3.squaredDistance;

/**
 * Calculates the length of a vec3
 *
 * @param {vec3} a vector to calculate length of
 * @returns {Number} length of a
 */
vec3.length = function (a) {
    var x = a[0],
        y = a[1],
        z = a[2];
    return Math.sqrt(x*x + y*y + z*z);
};

/**
 * Alias for {@link vec3.length}
 * @function
 */
vec3.len = vec3.length;

/**
 * Calculates the squared length of a vec3
 *
 * @param {vec3} a vector to calculate squared length of
 * @returns {Number} squared length of a
 */
vec3.squaredLength = function (a) {
    var x = a[0],
        y = a[1],
        z = a[2];
    return x*x + y*y + z*z;
};

/**
 * Alias for {@link vec3.squaredLength}
 * @function
 */
vec3.sqrLen = vec3.squaredLength;

/**
 * Negates the components of a vec3
 *
 * @param {vec3} out the receiving vector
 * @param {vec3} a vector to negate
 * @returns {vec3} out
 */
vec3.negate = function(out, a) {
    out[0] = -a[0];
    out[1] = -a[1];
    out[2] = -a[2];
    return out;
};

/**
 * Normalize a vec3
 *
 * @param {vec3} out the receiving vector
 * @param {vec3} a vector to normalize
 * @returns {vec3} out
 */
vec3.normalize = function(out, a) {
    var x = a[0],
        y = a[1],
        z = a[2];
    var len = x*x + y*y + z*z;
    if (len > 0) {
        //TODO: evaluate use of glm_invsqrt here?
        len = 1 / Math.sqrt(len);
        out[0] = a[0] * len;
        out[1] = a[1] * len;
        out[2] = a[2] * len;
    }
    return out;
};

/**
 * Calculates the dot product of two vec3's
 *
 * @param {vec3} a the first operand
 * @param {vec3} b the second operand
 * @returns {Number} dot product of a and b
 */
vec3.dot = function (a, b) {
    return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];
};

/**
 * Computes the cross product of two vec3's
 *
 * @param {vec3} out the receiving vector
 * @param {vec3} a the first operand
 * @param {vec3} b the second operand
 * @returns {vec3} out
 */
vec3.cross = function(out, a, b) {
    var ax = a[0], ay = a[1], az = a[2],
        bx = b[0], by = b[1], bz = b[2];

    out[0] = ay * bz - az * by;
    out[1] = az * bx - ax * bz;
    out[2] = ax * by - ay * bx;
    return out;
};

/**
 * Performs a linear interpolation between two vec3's
 *
 * @param {vec3} out the receiving vector
 * @param {vec3} a the first operand
 * @param {vec3} b the second operand
 * @param {Number} t interpolation amount between the two inputs
 * @returns {vec3} out
 */
vec3.lerp = function (out, a, b, t) {
    var ax = a[0],
        ay = a[1],
        az = a[2];
    out[0] = ax + t * (b[0] - ax);
    out[1] = ay + t * (b[1] - ay);
    out[2] = az + t * (b[2] - az);
    return out;
};

/**
 * Transforms the vec3 with a mat4.
 * 4th vector component is implicitly '1'
 *
 * @param {vec3} out the receiving vector
 * @param {vec3} a the vector to transform
 * @param {mat4} m matrix to transform with
 * @returns {vec3} out
 */
vec3.transformMat4 = function(out, a, m) {
    var x = a[0], y = a[1], z = a[2];
    out[0] = m[0] * x + m[4] * y + m[8] * z + m[12];
    out[1] = m[1] * x + m[5] * y + m[9] * z + m[13];
    out[2] = m[2] * x + m[6] * y + m[10] * z + m[14];
    return out;
};

/**
 * Transforms the vec3 with a quat
 *
 * @param {vec3} out the receiving vector
 * @param {vec3} a the vector to transform
 * @param {quat} q quaternion to transform with
 * @returns {vec3} out
 */
vec3.transformQuat = function(out, a, q) {
    var x = a[0], y = a[1], z = a[2],
        qx = q[0], qy = q[1], qz = q[2], qw = q[3],

        // calculate quat * vec
        ix = qw * x + qy * z - qz * y,
        iy = qw * y + qz * x - qx * z,
        iz = qw * z + qx * y - qy * x,
        iw = -qx * x - qy * y - qz * z;

    // calculate result * inverse quat
    out[0] = ix * qw + iw * -qx + iy * -qz - iz * -qy;
    out[1] = iy * qw + iw * -qy + iz * -qx - ix * -qz;
    out[2] = iz * qw + iw * -qz + ix * -qy - iy * -qx;
    return out;
};

/**
 * Perform some operation over an array of vec3s.
 *
 * @param {Array} a the array of vectors to iterate over
 * @param {Number} stride Number of elements between the start of each vec3. If 0 assumes tightly packed
 * @param {Number} offset Number of elements to skip at the beginning of the array
 * @param {Number} count Number of vec3s to iterate over. If 0 iterates over entire array
 * @param {Function} fn Function to call for each vector in the array
 * @param {Object} [arg] additional argument to pass to fn
 * @returns {Array} a
 * @function
 */
vec3.forEach = (function() {
    var vec = vec3.create();

    return function(a, stride, offset, count, fn, arg) {
        var i, l;
        if(!stride) {
            stride = 3;
        }

        if(!offset) {
            offset = 0;
        }
        
        if(count) {
            l = Math.min((count * stride) + offset, a.length);
        } else {
            l = a.length;
        }

        for(i = offset; i < l; i += stride) {
            vec[0] = a[i]; vec[1] = a[i+1]; vec[2] = a[i+2];
            fn(vec, vec, arg);
            a[i] = vec[0]; a[i+1] = vec[1]; a[i+2] = vec[2];
        }
        
        return a;
    };
})();

/**
 * Returns a string representation of a vector
 *
 * @param {vec3} vec vector to represent as a string
 * @returns {String} string representation of the vector
 */
vec3.str = function (a) {
    return 'vec3(' + a[0] + ', ' + a[1] + ', ' + a[2] + ')';
};

if(typeof(exports) !== 'undefined') {
    exports.vec3 = vec3;
}
;
/* Copyright (c) 2013, Brandon Jones, Colin MacKenzie IV. All rights reserved.

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

  * Redistributions of source code must retain the above copyright notice, this
    list of conditions and the following disclaimer.
  * Redistributions in binary form must reproduce the above copyright notice,
    this list of conditions and the following disclaimer in the documentation 
    and/or other materials provided with the distribution.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE 
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. */

/**
 * @class 4 Dimensional Vector
 * @name vec4
 */

var vec4 = {};

/**
 * Creates a new, empty vec4
 *
 * @returns {vec4} a new 4D vector
 */
vec4.create = function() {
    var out = new GLMAT_ARRAY_TYPE(4);
    out[0] = 0;
    out[1] = 0;
    out[2] = 0;
    out[3] = 0;
    return out;
};

/**
 * Creates a new vec4 initialized with values from an existing vector
 *
 * @param {vec4} a vector to clone
 * @returns {vec4} a new 4D vector
 */
vec4.clone = function(a) {
    var out = new GLMAT_ARRAY_TYPE(4);
    out[0] = a[0];
    out[1] = a[1];
    out[2] = a[2];
    out[3] = a[3];
    return out;
};

/**
 * Creates a new vec4 initialized with the given values
 *
 * @param {Number} x X component
 * @param {Number} y Y component
 * @param {Number} z Z component
 * @param {Number} w W component
 * @returns {vec4} a new 4D vector
 */
vec4.fromValues = function(x, y, z, w) {
    var out = new GLMAT_ARRAY_TYPE(4);
    out[0] = x;
    out[1] = y;
    out[2] = z;
    out[3] = w;
    return out;
};

/**
 * Copy the values from one vec4 to another
 *
 * @param {vec4} out the receiving vector
 * @param {vec4} a the source vector
 * @returns {vec4} out
 */
vec4.copy = function(out, a) {
    out[0] = a[0];
    out[1] = a[1];
    out[2] = a[2];
    out[3] = a[3];
    return out;
};

/**
 * Set the components of a vec4 to the given values
 *
 * @param {vec4} out the receiving vector
 * @param {Number} x X component
 * @param {Number} y Y component
 * @param {Number} z Z component
 * @param {Number} w W component
 * @returns {vec4} out
 */
vec4.set = function(out, x, y, z, w) {
    out[0] = x;
    out[1] = y;
    out[2] = z;
    out[3] = w;
    return out;
};

/**
 * Adds two vec4's
 *
 * @param {vec4} out the receiving vector
 * @param {vec4} a the first operand
 * @param {vec4} b the second operand
 * @returns {vec4} out
 */
vec4.add = function(out, a, b) {
    out[0] = a[0] + b[0];
    out[1] = a[1] + b[1];
    out[2] = a[2] + b[2];
    out[3] = a[3] + b[3];
    return out;
};

/**
 * Subtracts two vec4's
 *
 * @param {vec4} out the receiving vector
 * @param {vec4} a the first operand
 * @param {vec4} b the second operand
 * @returns {vec4} out
 */
vec4.subtract = function(out, a, b) {
    out[0] = a[0] - b[0];
    out[1] = a[1] - b[1];
    out[2] = a[2] - b[2];
    out[3] = a[3] - b[3];
    return out;
};

/**
 * Alias for {@link vec4.subtract}
 * @function
 */
vec4.sub = vec4.subtract;

/**
 * Multiplies two vec4's
 *
 * @param {vec4} out the receiving vector
 * @param {vec4} a the first operand
 * @param {vec4} b the second operand
 * @returns {vec4} out
 */
vec4.multiply = function(out, a, b) {
    out[0] = a[0] * b[0];
    out[1] = a[1] * b[1];
    out[2] = a[2] * b[2];
    out[3] = a[3] * b[3];
    return out;
};

/**
 * Alias for {@link vec4.multiply}
 * @function
 */
vec4.mul = vec4.multiply;

/**
 * Divides two vec4's
 *
 * @param {vec4} out the receiving vector
 * @param {vec4} a the first operand
 * @param {vec4} b the second operand
 * @returns {vec4} out
 */
vec4.divide = function(out, a, b) {
    out[0] = a[0] / b[0];
    out[1] = a[1] / b[1];
    out[2] = a[2] / b[2];
    out[3] = a[3] / b[3];
    return out;
};

/**
 * Alias for {@link vec4.divide}
 * @function
 */
vec4.div = vec4.divide;

/**
 * Returns the minimum of two vec4's
 *
 * @param {vec4} out the receiving vector
 * @param {vec4} a the first operand
 * @param {vec4} b the second operand
 * @returns {vec4} out
 */
vec4.min = function(out, a, b) {
    out[0] = Math.min(a[0], b[0]);
    out[1] = Math.min(a[1], b[1]);
    out[2] = Math.min(a[2], b[2]);
    out[3] = Math.min(a[3], b[3]);
    return out;
};

/**
 * Returns the maximum of two vec4's
 *
 * @param {vec4} out the receiving vector
 * @param {vec4} a the first operand
 * @param {vec4} b the second operand
 * @returns {vec4} out
 */
vec4.max = function(out, a, b) {
    out[0] = Math.max(a[0], b[0]);
    out[1] = Math.max(a[1], b[1]);
    out[2] = Math.max(a[2], b[2]);
    out[3] = Math.max(a[3], b[3]);
    return out;
};

/**
 * Scales a vec4 by a scalar number
 *
 * @param {vec4} out the receiving vector
 * @param {vec4} a the vector to scale
 * @param {Number} b amount to scale the vector by
 * @returns {vec4} out
 */
vec4.scale = function(out, a, b) {
    out[0] = a[0] * b;
    out[1] = a[1] * b;
    out[2] = a[2] * b;
    out[3] = a[3] * b;
    return out;
};

/**
 * Calculates the euclidian distance between two vec4's
 *
 * @param {vec4} a the first operand
 * @param {vec4} b the second operand
 * @returns {Number} distance between a and b
 */
vec4.distance = function(a, b) {
    var x = b[0] - a[0],
        y = b[1] - a[1],
        z = b[2] - a[2],
        w = b[3] - a[3];
    return Math.sqrt(x*x + y*y + z*z + w*w);
};

/**
 * Alias for {@link vec4.distance}
 * @function
 */
vec4.dist = vec4.distance;

/**
 * Calculates the squared euclidian distance between two vec4's
 *
 * @param {vec4} a the first operand
 * @param {vec4} b the second operand
 * @returns {Number} squared distance between a and b
 */
vec4.squaredDistance = function(a, b) {
    var x = b[0] - a[0],
        y = b[1] - a[1],
        z = b[2] - a[2],
        w = b[3] - a[3];
    return x*x + y*y + z*z + w*w;
};

/**
 * Alias for {@link vec4.squaredDistance}
 * @function
 */
vec4.sqrDist = vec4.squaredDistance;

/**
 * Calculates the length of a vec4
 *
 * @param {vec4} a vector to calculate length of
 * @returns {Number} length of a
 */
vec4.length = function (a) {
    var x = a[0],
        y = a[1],
        z = a[2],
        w = a[3];
    return Math.sqrt(x*x + y*y + z*z + w*w);
};

/**
 * Alias for {@link vec4.length}
 * @function
 */
vec4.len = vec4.length;

/**
 * Calculates the squared length of a vec4
 *
 * @param {vec4} a vector to calculate squared length of
 * @returns {Number} squared length of a
 */
vec4.squaredLength = function (a) {
    var x = a[0],
        y = a[1],
        z = a[2],
        w = a[3];
    return x*x + y*y + z*z + w*w;
};

/**
 * Alias for {@link vec4.squaredLength}
 * @function
 */
vec4.sqrLen = vec4.squaredLength;

/**
 * Negates the components of a vec4
 *
 * @param {vec4} out the receiving vector
 * @param {vec4} a vector to negate
 * @returns {vec4} out
 */
vec4.negate = function(out, a) {
    out[0] = -a[0];
    out[1] = -a[1];
    out[2] = -a[2];
    out[3] = -a[3];
    return out;
};

/**
 * Normalize a vec4
 *
 * @param {vec4} out the receiving vector
 * @param {vec4} a vector to normalize
 * @returns {vec4} out
 */
vec4.normalize = function(out, a) {
    var x = a[0],
        y = a[1],
        z = a[2],
        w = a[3];
    var len = x*x + y*y + z*z + w*w;
    if (len > 0) {
        len = 1 / Math.sqrt(len);
        out[0] = a[0] * len;
        out[1] = a[1] * len;
        out[2] = a[2] * len;
        out[3] = a[3] * len;
    }
    return out;
};

/**
 * Calculates the dot product of two vec4's
 *
 * @param {vec4} a the first operand
 * @param {vec4} b the second operand
 * @returns {Number} dot product of a and b
 */
vec4.dot = function (a, b) {
    return a[0] * b[0] + a[1] * b[1] + a[2] * b[2] + a[3] * b[3];
};

/**
 * Performs a linear interpolation between two vec4's
 *
 * @param {vec4} out the receiving vector
 * @param {vec4} a the first operand
 * @param {vec4} b the second operand
 * @param {Number} t interpolation amount between the two inputs
 * @returns {vec4} out
 */
vec4.lerp = function (out, a, b, t) {
    var ax = a[0],
        ay = a[1],
        az = a[2],
        aw = a[3];
    out[0] = ax + t * (b[0] - ax);
    out[1] = ay + t * (b[1] - ay);
    out[2] = az + t * (b[2] - az);
    out[3] = aw + t * (b[3] - aw);
    return out;
};

/**
 * Transforms the vec4 with a mat4.
 *
 * @param {vec4} out the receiving vector
 * @param {vec4} a the vector to transform
 * @param {mat4} m matrix to transform with
 * @returns {vec4} out
 */
vec4.transformMat4 = function(out, a, m) {
    var x = a[0], y = a[1], z = a[2], w = a[3];
    out[0] = m[0] * x + m[4] * y + m[8] * z + m[12] * w;
    out[1] = m[1] * x + m[5] * y + m[9] * z + m[13] * w;
    out[2] = m[2] * x + m[6] * y + m[10] * z + m[14] * w;
    out[3] = m[3] * x + m[7] * y + m[11] * z + m[15] * w;
    return out;
};

/**
 * Transforms the vec4 with a quat
 *
 * @param {vec4} out the receiving vector
 * @param {vec4} a the vector to transform
 * @param {quat} q quaternion to transform with
 * @returns {vec4} out
 */
vec4.transformQuat = function(out, a, q) {
    var x = a[0], y = a[1], z = a[2],
        qx = q[0], qy = q[1], qz = q[2], qw = q[3],

        // calculate quat * vec
        ix = qw * x + qy * z - qz * y,
        iy = qw * y + qz * x - qx * z,
        iz = qw * z + qx * y - qy * x,
        iw = -qx * x - qy * y - qz * z;

    // calculate result * inverse quat
    out[0] = ix * qw + iw * -qx + iy * -qz - iz * -qy;
    out[1] = iy * qw + iw * -qy + iz * -qx - ix * -qz;
    out[2] = iz * qw + iw * -qz + ix * -qy - iy * -qx;
    return out;
};

/**
 * Perform some operation over an array of vec4s.
 *
 * @param {Array} a the array of vectors to iterate over
 * @param {Number} stride Number of elements between the start of each vec4. If 0 assumes tightly packed
 * @param {Number} offset Number of elements to skip at the beginning of the array
 * @param {Number} count Number of vec2s to iterate over. If 0 iterates over entire array
 * @param {Function} fn Function to call for each vector in the array
 * @param {Object} [arg] additional argument to pass to fn
 * @returns {Array} a
 * @function
 */
vec4.forEach = (function() {
    var vec = vec4.create();

    return function(a, stride, offset, count, fn, arg) {
        var i, l;
        if(!stride) {
            stride = 4;
        }

        if(!offset) {
            offset = 0;
        }
        
        if(count) {
            l = Math.min((count * stride) + offset, a.length);
        } else {
            l = a.length;
        }

        for(i = offset; i < l; i += stride) {
            vec[0] = a[i]; vec[1] = a[i+1]; vec[2] = a[i+2]; vec[3] = a[i+3];
            fn(vec, vec, arg);
            a[i] = vec[0]; a[i+1] = vec[1]; a[i+2] = vec[2]; a[i+3] = vec[3];
        }
        
        return a;
    };
})();

/**
 * Returns a string representation of a vector
 *
 * @param {vec4} vec vector to represent as a string
 * @returns {String} string representation of the vector
 */
vec4.str = function (a) {
    return 'vec4(' + a[0] + ', ' + a[1] + ', ' + a[2] + ', ' + a[3] + ')';
};

if(typeof(exports) !== 'undefined') {
    exports.vec4 = vec4;
}
;
/* Copyright (c) 2013, Brandon Jones, Colin MacKenzie IV. All rights reserved.

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

  * Redistributions of source code must retain the above copyright notice, this
    list of conditions and the following disclaimer.
  * Redistributions in binary form must reproduce the above copyright notice,
    this list of conditions and the following disclaimer in the documentation 
    and/or other materials provided with the distribution.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE 
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. */

/**
 * @class 2x2 Matrix
 * @name mat2
 */

var mat2 = {};

var mat2Identity = new Float32Array([
    1, 0,
    0, 1
]);

/**
 * Creates a new identity mat2
 *
 * @returns {mat2} a new 2x2 matrix
 */
mat2.create = function() {
    var out = new GLMAT_ARRAY_TYPE(4);
    out[0] = 1;
    out[1] = 0;
    out[2] = 0;
    out[3] = 1;
    return out;
};

/**
 * Creates a new mat2 initialized with values from an existing matrix
 *
 * @param {mat2} a matrix to clone
 * @returns {mat2} a new 2x2 matrix
 */
mat2.clone = function(a) {
    var out = new GLMAT_ARRAY_TYPE(4);
    out[0] = a[0];
    out[1] = a[1];
    out[2] = a[2];
    out[3] = a[3];
    return out;
};

/**
 * Copy the values from one mat2 to another
 *
 * @param {mat2} out the receiving matrix
 * @param {mat2} a the source matrix
 * @returns {mat2} out
 */
mat2.copy = function(out, a) {
    out[0] = a[0];
    out[1] = a[1];
    out[2] = a[2];
    out[3] = a[3];
    return out;
};

/**
 * Set a mat2 to the identity matrix
 *
 * @param {mat2} out the receiving matrix
 * @returns {mat2} out
 */
mat2.identity = function(out) {
    out[0] = 1;
    out[1] = 0;
    out[2] = 0;
    out[3] = 1;
    return out;
};

/**
 * Transpose the values of a mat2
 *
 * @param {mat2} out the receiving matrix
 * @param {mat2} a the source matrix
 * @returns {mat2} out
 */
mat2.transpose = function(out, a) {
    // If we are transposing ourselves we can skip a few steps but have to cache some values
    if (out === a) {
        var a1 = a[1];
        out[1] = a[2];
        out[2] = a1;
    } else {
        out[0] = a[0];
        out[1] = a[2];
        out[2] = a[1];
        out[3] = a[3];
    }
    
    return out;
};

/**
 * Inverts a mat2
 *
 * @param {mat2} out the receiving matrix
 * @param {mat2} a the source matrix
 * @returns {mat2} out
 */
mat2.invert = function(out, a) {
    var a0 = a[0], a1 = a[1], a2 = a[2], a3 = a[3],

        // Calculate the determinant
        det = a0 * a3 - a2 * a1;

    if (!det) {
        return null;
    }
    det = 1.0 / det;
    
    out[0] =  a3 * det;
    out[1] = -a1 * det;
    out[2] = -a2 * det;
    out[3] =  a0 * det;

    return out;
};

/**
 * Calculates the adjugate of a mat2
 *
 * @param {mat2} out the receiving matrix
 * @param {mat2} a the source matrix
 * @returns {mat2} out
 */
mat2.adjoint = function(out, a) {
    // Caching this value is nessecary if out == a
    var a0 = a[0];
    out[0] =  a[3];
    out[1] = -a[1];
    out[2] = -a[2];
    out[3] =  a0;

    return out;
};

/**
 * Calculates the determinant of a mat2
 *
 * @param {mat2} a the source matrix
 * @returns {Number} determinant of a
 */
mat2.determinant = function (a) {
    return a[0] * a[3] - a[2] * a[1];
};

/**
 * Multiplies two mat2's
 *
 * @param {mat2} out the receiving matrix
 * @param {mat2} a the first operand
 * @param {mat2} b the second operand
 * @returns {mat2} out
 */
mat2.multiply = function (out, a, b) {
    var a0 = a[0], a1 = a[1], a2 = a[2], a3 = a[3];
    var b0 = b[0], b1 = b[1], b2 = b[2], b3 = b[3];
    out[0] = a0 * b0 + a1 * b2;
    out[1] = a0 * b1 + a1 * b3;
    out[2] = a2 * b0 + a3 * b2;
    out[3] = a2 * b1 + a3 * b3;
    return out;
};

/**
 * Alias for {@link mat2.multiply}
 * @function
 */
mat2.mul = mat2.multiply;

/**
 * Rotates a mat2 by the given angle
 *
 * @param {mat2} out the receiving matrix
 * @param {mat2} a the matrix to rotate
 * @param {Number} rad the angle to rotate the matrix by
 * @returns {mat2} out
 */
mat2.rotate = function (out, a, rad) {
    var a0 = a[0], a1 = a[1], a2 = a[2], a3 = a[3],
        s = Math.sin(rad),
        c = Math.cos(rad);
    out[0] = a0 *  c + a1 * s;
    out[1] = a0 * -s + a1 * c;
    out[2] = a2 *  c + a3 * s;
    out[3] = a2 * -s + a3 * c;
    return out;
};

/**
 * Scales the mat2 by the dimensions in the given vec2
 *
 * @param {mat2} out the receiving matrix
 * @param {mat2} a the matrix to rotate
 * @param {vec2} v the vec2 to scale the matrix by
 * @returns {mat2} out
 **/
mat2.scale = function(out, a, v) {
    var a0 = a[0], a1 = a[1], a2 = a[2], a3 = a[3],
        v0 = v[0], v1 = v[1];
    out[0] = a0 * v0;
    out[1] = a1 * v1;
    out[2] = a2 * v0;
    out[3] = a3 * v1;
    return out;
};

/**
 * Returns a string representation of a mat2
 *
 * @param {mat2} mat matrix to represent as a string
 * @returns {String} string representation of the matrix
 */
mat2.str = function (a) {
    return 'mat2(' + a[0] + ', ' + a[1] + ', ' + a[2] + ', ' + a[3] + ')';
};

if(typeof(exports) !== 'undefined') {
    exports.mat2 = mat2;
}
;
/* Copyright (c) 2013, Brandon Jones, Colin MacKenzie IV. All rights reserved.

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

  * Redistributions of source code must retain the above copyright notice, this
    list of conditions and the following disclaimer.
  * Redistributions in binary form must reproduce the above copyright notice,
    this list of conditions and the following disclaimer in the documentation 
    and/or other materials provided with the distribution.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE 
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. */

/**
 * @class 2x3 Matrix
 * @name mat2d
 * 
 * @description 
 * A mat2d contains six elements defined as:
 * <pre>
 * [a, b,
 *  c, d,
 *  tx,ty]
 * </pre>
 * This is a short form for the 3x3 matrix:
 * <pre>
 * [a, b, 0
 *  c, d, 0
 *  tx,ty,1]
 * </pre>
 * The last column is ignored so the array is shorter and operations are faster.
 */

var mat2d = {};

var mat2dIdentity = new Float32Array([
    1, 0,
    0, 1,
    0, 0
]);

/**
 * Creates a new identity mat2d
 *
 * @returns {mat2d} a new 2x3 matrix
 */
mat2d.create = function() {
    var out = new GLMAT_ARRAY_TYPE(6);
    out[0] = 1;
    out[1] = 0;
    out[2] = 0;
    out[3] = 1;
    out[4] = 0;
    out[5] = 0;
    return out;
};

/**
 * Creates a new mat2d initialized with values from an existing matrix
 *
 * @param {mat2d} a matrix to clone
 * @returns {mat2d} a new 2x3 matrix
 */
mat2d.clone = function(a) {
    var out = new GLMAT_ARRAY_TYPE(6);
    out[0] = a[0];
    out[1] = a[1];
    out[2] = a[2];
    out[3] = a[3];
    out[4] = a[4];
    out[5] = a[5];
    return out;
};

/**
 * Copy the values from one mat2d to another
 *
 * @param {mat2d} out the receiving matrix
 * @param {mat2d} a the source matrix
 * @returns {mat2d} out
 */
mat2d.copy = function(out, a) {
    out[0] = a[0];
    out[1] = a[1];
    out[2] = a[2];
    out[3] = a[3];
    out[4] = a[4];
    out[5] = a[5];
    return out;
};

/**
 * Set a mat2d to the identity matrix
 *
 * @param {mat2d} out the receiving matrix
 * @returns {mat2d} out
 */
mat2d.identity = function(out) {
    out[0] = 1;
    out[1] = 0;
    out[2] = 0;
    out[3] = 1;
    out[4] = 0;
    out[5] = 0;
    return out;
};

/**
 * Inverts a mat2d
 *
 * @param {mat2d} out the receiving matrix
 * @param {mat2d} a the source matrix
 * @returns {mat2d} out
 */
mat2d.invert = function(out, a) {
    var aa = a[0], ab = a[1], ac = a[2], ad = a[3],
        atx = a[4], aty = a[5];

    var det = aa * ad - ab * ac;
    if(!det){
        return null;
    }
    det = 1.0 / det;

    out[0] = ad * det;
    out[1] = -ab * det;
    out[2] = -ac * det;
    out[3] = aa * det;
    out[4] = (ac * aty - ad * atx) * det;
    out[5] = (ab * atx - aa * aty) * det;
    return out;
};

/**
 * Calculates the determinant of a mat2d
 *
 * @param {mat2d} a the source matrix
 * @returns {Number} determinant of a
 */
mat2d.determinant = function (a) {
    return a[0] * a[3] - a[1] * a[2];
};

/**
 * Multiplies two mat2d's
 *
 * @param {mat2d} out the receiving matrix
 * @param {mat2d} a the first operand
 * @param {mat2d} b the second operand
 * @returns {mat2d} out
 */
mat2d.multiply = function (out, a, b) {
    var aa = a[0], ab = a[1], ac = a[2], ad = a[3],
        atx = a[4], aty = a[5],
        ba = b[0], bb = b[1], bc = b[2], bd = b[3],
        btx = b[4], bty = b[5];

    out[0] = aa*ba + ab*bc;
    out[1] = aa*bb + ab*bd;
    out[2] = ac*ba + ad*bc;
    out[3] = ac*bb + ad*bd;
    out[4] = ba*atx + bc*aty + btx;
    out[5] = bb*atx + bd*aty + bty;
    return out;
};

/**
 * Alias for {@link mat2d.multiply}
 * @function
 */
mat2d.mul = mat2d.multiply;


/**
 * Rotates a mat2d by the given angle
 *
 * @param {mat2d} out the receiving matrix
 * @param {mat2d} a the matrix to rotate
 * @param {Number} rad the angle to rotate the matrix by
 * @returns {mat2d} out
 */
mat2d.rotate = function (out, a, rad) {
    var aa = a[0],
        ab = a[1],
        ac = a[2],
        ad = a[3],
        atx = a[4],
        aty = a[5],
        st = Math.sin(rad),
        ct = Math.cos(rad);

    out[0] = aa*ct + ab*st;
    out[1] = -aa*st + ab*ct;
    out[2] = ac*ct + ad*st;
    out[3] = -ac*st + ct*ad;
    out[4] = ct*atx + st*aty;
    out[5] = ct*aty - st*atx;
    return out;
};

/**
 * Scales the mat2d by the dimensions in the given vec2
 *
 * @param {mat2d} out the receiving matrix
 * @param {mat2d} a the matrix to translate
 * @param {mat2d} v the vec2 to scale the matrix by
 * @returns {mat2d} out
 **/
mat2d.scale = function(out, a, v) {
    var vx = v[0], vy = v[1];
    out[0] = a[0] * vx;
    out[1] = a[1] * vy;
    out[2] = a[2] * vx;
    out[3] = a[3] * vy;
    out[4] = a[4] * vx;
    out[5] = a[5] * vy;
    return out;
};

/**
 * Translates the mat2d by the dimensions in the given vec2
 *
 * @param {mat2d} out the receiving matrix
 * @param {mat2d} a the matrix to translate
 * @param {mat2d} v the vec2 to translate the matrix by
 * @returns {mat2d} out
 **/
mat2d.translate = function(out, a, v) {
    out[0] = a[0];
    out[1] = a[1];
    out[2] = a[2];
    out[3] = a[3];
    out[4] = a[4] + v[0];
    out[5] = a[5] + v[1];
    return out;
};

/**
 * Returns a string representation of a mat2d
 *
 * @param {mat2d} a matrix to represent as a string
 * @returns {String} string representation of the matrix
 */
mat2d.str = function (a) {
    return 'mat2d(' + a[0] + ', ' + a[1] + ', ' + a[2] + ', ' + 
                    a[3] + ', ' + a[4] + ', ' + a[5] + ')';
};

if(typeof(exports) !== 'undefined') {
    exports.mat2d = mat2d;
}
;
/* Copyright (c) 2013, Brandon Jones, Colin MacKenzie IV. All rights reserved.

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

  * Redistributions of source code must retain the above copyright notice, this
    list of conditions and the following disclaimer.
  * Redistributions in binary form must reproduce the above copyright notice,
    this list of conditions and the following disclaimer in the documentation 
    and/or other materials provided with the distribution.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE 
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. */

/**
 * @class 3x3 Matrix
 * @name mat3
 */

var mat3 = {};

var mat3Identity = new Float32Array([
    1, 0, 0,
    0, 1, 0,
    0, 0, 1
]);

/**
 * Creates a new identity mat3
 *
 * @returns {mat3} a new 3x3 matrix
 */
mat3.create = function() {
    var out = new GLMAT_ARRAY_TYPE(9);
    out[0] = 1;
    out[1] = 0;
    out[2] = 0;
    out[3] = 0;
    out[4] = 1;
    out[5] = 0;
    out[6] = 0;
    out[7] = 0;
    out[8] = 1;
    return out;
};

/**
 * Creates a new mat3 initialized with values from an existing matrix
 *
 * @param {mat3} a matrix to clone
 * @returns {mat3} a new 3x3 matrix
 */
mat3.clone = function(a) {
    var out = new GLMAT_ARRAY_TYPE(9);
    out[0] = a[0];
    out[1] = a[1];
    out[2] = a[2];
    out[3] = a[3];
    out[4] = a[4];
    out[5] = a[5];
    out[6] = a[6];
    out[7] = a[7];
    out[8] = a[8];
    return out;
};

/**
 * Copy the values from one mat3 to another
 *
 * @param {mat3} out the receiving matrix
 * @param {mat3} a the source matrix
 * @returns {mat3} out
 */
mat3.copy = function(out, a) {
    out[0] = a[0];
    out[1] = a[1];
    out[2] = a[2];
    out[3] = a[3];
    out[4] = a[4];
    out[5] = a[5];
    out[6] = a[6];
    out[7] = a[7];
    out[8] = a[8];
    return out;
};

/**
 * Set a mat3 to the identity matrix
 *
 * @param {mat3} out the receiving matrix
 * @returns {mat3} out
 */
mat3.identity = function(out) {
    out[0] = 1;
    out[1] = 0;
    out[2] = 0;
    out[3] = 0;
    out[4] = 1;
    out[5] = 0;
    out[6] = 0;
    out[7] = 0;
    out[8] = 1;
    return out;
};

/**
 * Transpose the values of a mat3
 *
 * @param {mat3} out the receiving matrix
 * @param {mat3} a the source matrix
 * @returns {mat3} out
 */
mat3.transpose = function(out, a) {
    // If we are transposing ourselves we can skip a few steps but have to cache some values
    if (out === a) {
        var a01 = a[1], a02 = a[2], a12 = a[5];
        out[1] = a[3];
        out[2] = a[6];
        out[3] = a01;
        out[5] = a[7];
        out[6] = a02;
        out[7] = a12;
    } else {
        out[0] = a[0];
        out[1] = a[3];
        out[2] = a[6];
        out[3] = a[1];
        out[4] = a[4];
        out[5] = a[7];
        out[6] = a[2];
        out[7] = a[5];
        out[8] = a[8];
    }
    
    return out;
};

/**
 * Inverts a mat3
 *
 * @param {mat3} out the receiving matrix
 * @param {mat3} a the source matrix
 * @returns {mat3} out
 */
mat3.invert = function(out, a) {
    var a00 = a[0], a01 = a[1], a02 = a[2],
        a10 = a[3], a11 = a[4], a12 = a[5],
        a20 = a[6], a21 = a[7], a22 = a[8],

        b01 = a22 * a11 - a12 * a21,
        b11 = -a22 * a10 + a12 * a20,
        b21 = a21 * a10 - a11 * a20,

        // Calculate the determinant
        det = a00 * b01 + a01 * b11 + a02 * b21;

    if (!det) { 
        return null; 
    }
    det = 1.0 / det;

    out[0] = b01 * det;
    out[1] = (-a22 * a01 + a02 * a21) * det;
    out[2] = (a12 * a01 - a02 * a11) * det;
    out[3] = b11 * det;
    out[4] = (a22 * a00 - a02 * a20) * det;
    out[5] = (-a12 * a00 + a02 * a10) * det;
    out[6] = b21 * det;
    out[7] = (-a21 * a00 + a01 * a20) * det;
    out[8] = (a11 * a00 - a01 * a10) * det;
    return out;
};

/**
 * Calculates the adjugate of a mat3
 *
 * @param {mat3} out the receiving matrix
 * @param {mat3} a the source matrix
 * @returns {mat3} out
 */
mat3.adjoint = function(out, a) {
    var a00 = a[0], a01 = a[1], a02 = a[2],
        a10 = a[3], a11 = a[4], a12 = a[5],
        a20 = a[6], a21 = a[7], a22 = a[8];

    out[0] = (a11 * a22 - a12 * a21);
    out[1] = (a02 * a21 - a01 * a22);
    out[2] = (a01 * a12 - a02 * a11);
    out[3] = (a12 * a20 - a10 * a22);
    out[4] = (a00 * a22 - a02 * a20);
    out[5] = (a02 * a10 - a00 * a12);
    out[6] = (a10 * a21 - a11 * a20);
    out[7] = (a01 * a20 - a00 * a21);
    out[8] = (a00 * a11 - a01 * a10);
    return out;
};

/**
 * Calculates the determinant of a mat3
 *
 * @param {mat3} a the source matrix
 * @returns {Number} determinant of a
 */
mat3.determinant = function (a) {
    var a00 = a[0], a01 = a[1], a02 = a[2],
        a10 = a[3], a11 = a[4], a12 = a[5],
        a20 = a[6], a21 = a[7], a22 = a[8];

    return a00 * (a22 * a11 - a12 * a21) + a01 * (-a22 * a10 + a12 * a20) + a02 * (a21 * a10 - a11 * a20);
};

/**
 * Multiplies two mat3's
 *
 * @param {mat3} out the receiving matrix
 * @param {mat3} a the first operand
 * @param {mat3} b the second operand
 * @returns {mat3} out
 */
mat3.multiply = function (out, a, b) {
    var a00 = a[0], a01 = a[1], a02 = a[2],
        a10 = a[3], a11 = a[4], a12 = a[5],
        a20 = a[6], a21 = a[7], a22 = a[8],

        b00 = b[0], b01 = b[1], b02 = b[2],
        b10 = b[3], b11 = b[4], b12 = b[5],
        b20 = b[6], b21 = b[7], b22 = b[8];

    out[0] = b00 * a00 + b01 * a10 + b02 * a20;
    out[1] = b00 * a01 + b01 * a11 + b02 * a21;
    out[2] = b00 * a02 + b01 * a12 + b02 * a22;

    out[3] = b10 * a00 + b11 * a10 + b12 * a20;
    out[4] = b10 * a01 + b11 * a11 + b12 * a21;
    out[5] = b10 * a02 + b11 * a12 + b12 * a22;

    out[6] = b20 * a00 + b21 * a10 + b22 * a20;
    out[7] = b20 * a01 + b21 * a11 + b22 * a21;
    out[8] = b20 * a02 + b21 * a12 + b22 * a22;
    return out;
};

/**
 * Alias for {@link mat3.multiply}
 * @function
 */
mat3.mul = mat3.multiply;

/**
 * Translate a mat3 by the given vector
 *
 * @param {mat3} out the receiving matrix
 * @param {mat3} a the matrix to translate
 * @param {vec2} v vector to translate by
 * @returns {mat3} out
 */
mat3.translate = function(out, a, v) {
    var a00 = a[0], a01 = a[1], a02 = a[2],
        a10 = a[3], a11 = a[4], a12 = a[5],
        a20 = a[6], a21 = a[7], a22 = a[8],
        x = v[0], y = v[1];

    out[0] = a00;
    out[1] = a01;
    out[2] = a02;

    out[3] = a10;
    out[4] = a11;
    out[5] = a12;

    out[6] = x * a00 + y * a10 + a20;
    out[7] = x * a01 + y * a11 + a21;
    out[8] = x * a02 + y * a12 + a22;
    return out;
};

/**
 * Rotates a mat3 by the given angle
 *
 * @param {mat3} out the receiving matrix
 * @param {mat3} a the matrix to rotate
 * @param {Number} rad the angle to rotate the matrix by
 * @returns {mat3} out
 */
mat3.rotate = function (out, a, rad) {
    var a00 = a[0], a01 = a[1], a02 = a[2],
        a10 = a[3], a11 = a[4], a12 = a[5],
        a20 = a[6], a21 = a[7], a22 = a[8],

        s = Math.sin(rad),
        c = Math.cos(rad);

    out[0] = c * a00 + s * a10;
    out[1] = c * a01 + s * a11;
    out[2] = c * a02 + s * a12;

    out[3] = c * a10 - s * a00;
    out[4] = c * a11 - s * a01;
    out[5] = c * a12 - s * a02;

    out[6] = a20;
    out[7] = a21;
    out[8] = a22;
    return out;
};

/**
 * Scales the mat3 by the dimensions in the given vec2
 *
 * @param {mat3} out the receiving matrix
 * @param {mat3} a the matrix to rotate
 * @param {vec2} v the vec2 to scale the matrix by
 * @returns {mat3} out
 **/
mat3.scale = function(out, a, v) {
    var x = v[0], y = v[2];

    out[0] = x * a[0];
    out[1] = x * a[1];
    out[2] = x * a[2];

    out[3] = y * a[3];
    out[4] = y * a[4];
    out[5] = y * a[5];

    out[6] = a[6];
    out[7] = a[7];
    out[8] = a[8];
    return out;
};

/**
 * Copies the values from a mat2d into a mat3
 *
 * @param {mat3} out the receiving matrix
 * @param {mat3} a the matrix to rotate
 * @param {vec2} v the vec2 to scale the matrix by
 * @returns {mat3} out
 **/
mat3.fromMat2d = function(out, a) {
    out[0] = a[0];
    out[1] = a[1];
    out[2] = 0;

    out[3] = a[2];
    out[4] = a[3];
    out[5] = 0;

    out[6] = a[4];
    out[7] = a[5];
    out[8] = 1;
    return out;
};

/**
* Calculates a 3x3 matrix from the given quaternion
*
* @param {mat3} out mat3 receiving operation result
* @param {quat} q Quaternion to create matrix from
*
* @returns {mat3} out
*/
mat3.fromQuat = function (out, q) {
    var x = q[0], y = q[1], z = q[2], w = q[3],
        x2 = x + x,
        y2 = y + y,
        z2 = z + z,

        xx = x * x2,
        xy = x * y2,
        xz = x * z2,
        yy = y * y2,
        yz = y * z2,
        zz = z * z2,
        wx = w * x2,
        wy = w * y2,
        wz = w * z2;

    out[0] = 1 - (yy + zz);
    out[1] = xy + wz;
    out[2] = xz - wy;

    out[3] = xy - wz;
    out[4] = 1 - (xx + zz);
    out[5] = yz + wx;

    out[6] = xz + wy;
    out[7] = yz - wx;
    out[8] = 1 - (xx + yy);

    return out;
};

/**
 * Returns a string representation of a mat3
 *
 * @param {mat3} mat matrix to represent as a string
 * @returns {String} string representation of the matrix
 */
mat3.str = function (a) {
    return 'mat3(' + a[0] + ', ' + a[1] + ', ' + a[2] + ', ' + 
                    a[3] + ', ' + a[4] + ', ' + a[5] + ', ' + 
                    a[6] + ', ' + a[7] + ', ' + a[8] + ')';
};

if(typeof(exports) !== 'undefined') {
    exports.mat3 = mat3;
}
;
/* Copyright (c) 2013, Brandon Jones, Colin MacKenzie IV. All rights reserved.

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

  * Redistributions of source code must retain the above copyright notice, this
    list of conditions and the following disclaimer.
  * Redistributions in binary form must reproduce the above copyright notice,
    this list of conditions and the following disclaimer in the documentation 
    and/or other materials provided with the distribution.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE 
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. */

/**
 * @class 4x4 Matrix
 * @name mat4
 */

var mat4 = {};

var mat4Identity = new Float32Array([
    1, 0, 0, 0,
    0, 1, 0, 0,
    0, 0, 1, 0,
    0, 0, 0, 1
]);

/**
 * Creates a new identity mat4
 *
 * @returns {mat4} a new 4x4 matrix
 */
mat4.create = function() {
    var out = new GLMAT_ARRAY_TYPE(16);
    out[0] = 1;
    out[1] = 0;
    out[2] = 0;
    out[3] = 0;
    out[4] = 0;
    out[5] = 1;
    out[6] = 0;
    out[7] = 0;
    out[8] = 0;
    out[9] = 0;
    out[10] = 1;
    out[11] = 0;
    out[12] = 0;
    out[13] = 0;
    out[14] = 0;
    out[15] = 1;
    return out;
};

/**
 * Creates a new mat4 initialized with values from an existing matrix
 *
 * @param {mat4} a matrix to clone
 * @returns {mat4} a new 4x4 matrix
 */
mat4.clone = function(a) {
    var out = new GLMAT_ARRAY_TYPE(16);
    out[0] = a[0];
    out[1] = a[1];
    out[2] = a[2];
    out[3] = a[3];
    out[4] = a[4];
    out[5] = a[5];
    out[6] = a[6];
    out[7] = a[7];
    out[8] = a[8];
    out[9] = a[9];
    out[10] = a[10];
    out[11] = a[11];
    out[12] = a[12];
    out[13] = a[13];
    out[14] = a[14];
    out[15] = a[15];
    return out;
};

/**
 * Copy the values from one mat4 to another
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the source matrix
 * @returns {mat4} out
 */
mat4.copy = function(out, a) {
    out[0] = a[0];
    out[1] = a[1];
    out[2] = a[2];
    out[3] = a[3];
    out[4] = a[4];
    out[5] = a[5];
    out[6] = a[6];
    out[7] = a[7];
    out[8] = a[8];
    out[9] = a[9];
    out[10] = a[10];
    out[11] = a[11];
    out[12] = a[12];
    out[13] = a[13];
    out[14] = a[14];
    out[15] = a[15];
    return out;
};

/**
 * Set a mat4 to the identity matrix
 *
 * @param {mat4} out the receiving matrix
 * @returns {mat4} out
 */
mat4.identity = function(out) {
    out[0] = 1;
    out[1] = 0;
    out[2] = 0;
    out[3] = 0;
    out[4] = 0;
    out[5] = 1;
    out[6] = 0;
    out[7] = 0;
    out[8] = 0;
    out[9] = 0;
    out[10] = 1;
    out[11] = 0;
    out[12] = 0;
    out[13] = 0;
    out[14] = 0;
    out[15] = 1;
    return out;
};

/**
 * Transpose the values of a mat4
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the source matrix
 * @returns {mat4} out
 */
mat4.transpose = function(out, a) {
    // If we are transposing ourselves we can skip a few steps but have to cache some values
    if (out === a) {
        var a01 = a[1], a02 = a[2], a03 = a[3],
            a12 = a[6], a13 = a[7],
            a23 = a[11];

        out[1] = a[4];
        out[2] = a[8];
        out[3] = a[12];
        out[4] = a01;
        out[6] = a[9];
        out[7] = a[13];
        out[8] = a02;
        out[9] = a12;
        out[11] = a[14];
        out[12] = a03;
        out[13] = a13;
        out[14] = a23;
    } else {
        out[0] = a[0];
        out[1] = a[4];
        out[2] = a[8];
        out[3] = a[12];
        out[4] = a[1];
        out[5] = a[5];
        out[6] = a[9];
        out[7] = a[13];
        out[8] = a[2];
        out[9] = a[6];
        out[10] = a[10];
        out[11] = a[14];
        out[12] = a[3];
        out[13] = a[7];
        out[14] = a[11];
        out[15] = a[15];
    }
    
    return out;
};

/**
 * Inverts a mat4
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the source matrix
 * @returns {mat4} out
 */
mat4.invert = function(out, a) {
    var a00 = a[0], a01 = a[1], a02 = a[2], a03 = a[3],
        a10 = a[4], a11 = a[5], a12 = a[6], a13 = a[7],
        a20 = a[8], a21 = a[9], a22 = a[10], a23 = a[11],
        a30 = a[12], a31 = a[13], a32 = a[14], a33 = a[15],

        b00 = a00 * a11 - a01 * a10,
        b01 = a00 * a12 - a02 * a10,
        b02 = a00 * a13 - a03 * a10,
        b03 = a01 * a12 - a02 * a11,
        b04 = a01 * a13 - a03 * a11,
        b05 = a02 * a13 - a03 * a12,
        b06 = a20 * a31 - a21 * a30,
        b07 = a20 * a32 - a22 * a30,
        b08 = a20 * a33 - a23 * a30,
        b09 = a21 * a32 - a22 * a31,
        b10 = a21 * a33 - a23 * a31,
        b11 = a22 * a33 - a23 * a32,

        // Calculate the determinant
        det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;

    if (!det) { 
        return null; 
    }
    det = 1.0 / det;

    out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;
    out[1] = (a02 * b10 - a01 * b11 - a03 * b09) * det;
    out[2] = (a31 * b05 - a32 * b04 + a33 * b03) * det;
    out[3] = (a22 * b04 - a21 * b05 - a23 * b03) * det;
    out[4] = (a12 * b08 - a10 * b11 - a13 * b07) * det;
    out[5] = (a00 * b11 - a02 * b08 + a03 * b07) * det;
    out[6] = (a32 * b02 - a30 * b05 - a33 * b01) * det;
    out[7] = (a20 * b05 - a22 * b02 + a23 * b01) * det;
    out[8] = (a10 * b10 - a11 * b08 + a13 * b06) * det;
    out[9] = (a01 * b08 - a00 * b10 - a03 * b06) * det;
    out[10] = (a30 * b04 - a31 * b02 + a33 * b00) * det;
    out[11] = (a21 * b02 - a20 * b04 - a23 * b00) * det;
    out[12] = (a11 * b07 - a10 * b09 - a12 * b06) * det;
    out[13] = (a00 * b09 - a01 * b07 + a02 * b06) * det;
    out[14] = (a31 * b01 - a30 * b03 - a32 * b00) * det;
    out[15] = (a20 * b03 - a21 * b01 + a22 * b00) * det;

    return out;
};

/**
 * Calculates the adjugate of a mat4
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the source matrix
 * @returns {mat4} out
 */
mat4.adjoint = function(out, a) {
    var a00 = a[0], a01 = a[1], a02 = a[2], a03 = a[3],
        a10 = a[4], a11 = a[5], a12 = a[6], a13 = a[7],
        a20 = a[8], a21 = a[9], a22 = a[10], a23 = a[11],
        a30 = a[12], a31 = a[13], a32 = a[14], a33 = a[15];

    out[0]  =  (a11 * (a22 * a33 - a23 * a32) - a21 * (a12 * a33 - a13 * a32) + a31 * (a12 * a23 - a13 * a22));
    out[1]  = -(a01 * (a22 * a33 - a23 * a32) - a21 * (a02 * a33 - a03 * a32) + a31 * (a02 * a23 - a03 * a22));
    out[2]  =  (a01 * (a12 * a33 - a13 * a32) - a11 * (a02 * a33 - a03 * a32) + a31 * (a02 * a13 - a03 * a12));
    out[3]  = -(a01 * (a12 * a23 - a13 * a22) - a11 * (a02 * a23 - a03 * a22) + a21 * (a02 * a13 - a03 * a12));
    out[4]  = -(a10 * (a22 * a33 - a23 * a32) - a20 * (a12 * a33 - a13 * a32) + a30 * (a12 * a23 - a13 * a22));
    out[5]  =  (a00 * (a22 * a33 - a23 * a32) - a20 * (a02 * a33 - a03 * a32) + a30 * (a02 * a23 - a03 * a22));
    out[6]  = -(a00 * (a12 * a33 - a13 * a32) - a10 * (a02 * a33 - a03 * a32) + a30 * (a02 * a13 - a03 * a12));
    out[7]  =  (a00 * (a12 * a23 - a13 * a22) - a10 * (a02 * a23 - a03 * a22) + a20 * (a02 * a13 - a03 * a12));
    out[8]  =  (a10 * (a21 * a33 - a23 * a31) - a20 * (a11 * a33 - a13 * a31) + a30 * (a11 * a23 - a13 * a21));
    out[9]  = -(a00 * (a21 * a33 - a23 * a31) - a20 * (a01 * a33 - a03 * a31) + a30 * (a01 * a23 - a03 * a21));
    out[10] =  (a00 * (a11 * a33 - a13 * a31) - a10 * (a01 * a33 - a03 * a31) + a30 * (a01 * a13 - a03 * a11));
    out[11] = -(a00 * (a11 * a23 - a13 * a21) - a10 * (a01 * a23 - a03 * a21) + a20 * (a01 * a13 - a03 * a11));
    out[12] = -(a10 * (a21 * a32 - a22 * a31) - a20 * (a11 * a32 - a12 * a31) + a30 * (a11 * a22 - a12 * a21));
    out[13] =  (a00 * (a21 * a32 - a22 * a31) - a20 * (a01 * a32 - a02 * a31) + a30 * (a01 * a22 - a02 * a21));
    out[14] = -(a00 * (a11 * a32 - a12 * a31) - a10 * (a01 * a32 - a02 * a31) + a30 * (a01 * a12 - a02 * a11));
    out[15] =  (a00 * (a11 * a22 - a12 * a21) - a10 * (a01 * a22 - a02 * a21) + a20 * (a01 * a12 - a02 * a11));
    return out;
};

/**
 * Calculates the determinant of a mat4
 *
 * @param {mat4} a the source matrix
 * @returns {Number} determinant of a
 */
mat4.determinant = function (a) {
    var a00 = a[0], a01 = a[1], a02 = a[2], a03 = a[3],
        a10 = a[4], a11 = a[5], a12 = a[6], a13 = a[7],
        a20 = a[8], a21 = a[9], a22 = a[10], a23 = a[11],
        a30 = a[12], a31 = a[13], a32 = a[14], a33 = a[15],

        b00 = a00 * a11 - a01 * a10,
        b01 = a00 * a12 - a02 * a10,
        b02 = a00 * a13 - a03 * a10,
        b03 = a01 * a12 - a02 * a11,
        b04 = a01 * a13 - a03 * a11,
        b05 = a02 * a13 - a03 * a12,
        b06 = a20 * a31 - a21 * a30,
        b07 = a20 * a32 - a22 * a30,
        b08 = a20 * a33 - a23 * a30,
        b09 = a21 * a32 - a22 * a31,
        b10 = a21 * a33 - a23 * a31,
        b11 = a22 * a33 - a23 * a32;

    // Calculate the determinant
    return b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;
};

/**
 * Multiplies two mat4's
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the first operand
 * @param {mat4} b the second operand
 * @returns {mat4} out
 */
mat4.multiply = function (out, a, b) {
    var a00 = a[0], a01 = a[1], a02 = a[2], a03 = a[3],
        a10 = a[4], a11 = a[5], a12 = a[6], a13 = a[7],
        a20 = a[8], a21 = a[9], a22 = a[10], a23 = a[11],
        a30 = a[12], a31 = a[13], a32 = a[14], a33 = a[15];

    // Cache only the current line of the second matrix
    var b0  = b[0], b1 = b[1], b2 = b[2], b3 = b[3];  
    out[0] = b0*a00 + b1*a10 + b2*a20 + b3*a30;
    out[1] = b0*a01 + b1*a11 + b2*a21 + b3*a31;
    out[2] = b0*a02 + b1*a12 + b2*a22 + b3*a32;
    out[3] = b0*a03 + b1*a13 + b2*a23 + b3*a33;

    b0 = b[4]; b1 = b[5]; b2 = b[6]; b3 = b[7];
    out[4] = b0*a00 + b1*a10 + b2*a20 + b3*a30;
    out[5] = b0*a01 + b1*a11 + b2*a21 + b3*a31;
    out[6] = b0*a02 + b1*a12 + b2*a22 + b3*a32;
    out[7] = b0*a03 + b1*a13 + b2*a23 + b3*a33;

    b0 = b[8]; b1 = b[9]; b2 = b[10]; b3 = b[11];
    out[8] = b0*a00 + b1*a10 + b2*a20 + b3*a30;
    out[9] = b0*a01 + b1*a11 + b2*a21 + b3*a31;
    out[10] = b0*a02 + b1*a12 + b2*a22 + b3*a32;
    out[11] = b0*a03 + b1*a13 + b2*a23 + b3*a33;

    b0 = b[12]; b1 = b[13]; b2 = b[14]; b3 = b[15];
    out[12] = b0*a00 + b1*a10 + b2*a20 + b3*a30;
    out[13] = b0*a01 + b1*a11 + b2*a21 + b3*a31;
    out[14] = b0*a02 + b1*a12 + b2*a22 + b3*a32;
    out[15] = b0*a03 + b1*a13 + b2*a23 + b3*a33;
    return out;
};

/**
 * Alias for {@link mat4.multiply}
 * @function
 */
mat4.mul = mat4.multiply;

/**
 * Translate a mat4 by the given vector
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the matrix to translate
 * @param {vec3} v vector to translate by
 * @returns {mat4} out
 */
mat4.translate = function (out, a, v) {
    var x = v[0], y = v[1], z = v[2],
        a00, a01, a02, a03,
        a10, a11, a12, a13,
        a20, a21, a22, a23;

    if (a === out) {
        out[12] = a[0] * x + a[4] * y + a[8] * z + a[12];
        out[13] = a[1] * x + a[5] * y + a[9] * z + a[13];
        out[14] = a[2] * x + a[6] * y + a[10] * z + a[14];
        out[15] = a[3] * x + a[7] * y + a[11] * z + a[15];
    } else {
        a00 = a[0]; a01 = a[1]; a02 = a[2]; a03 = a[3];
        a10 = a[4]; a11 = a[5]; a12 = a[6]; a13 = a[7];
        a20 = a[8]; a21 = a[9]; a22 = a[10]; a23 = a[11];

        out[0] = a00; out[1] = a01; out[2] = a02; out[3] = a03;
        out[4] = a10; out[5] = a11; out[6] = a12; out[7] = a13;
        out[8] = a20; out[9] = a21; out[10] = a22; out[11] = a23;

        out[12] = a00 * x + a10 * y + a20 * z + a[12];
        out[13] = a01 * x + a11 * y + a21 * z + a[13];
        out[14] = a02 * x + a12 * y + a22 * z + a[14];
        out[15] = a03 * x + a13 * y + a23 * z + a[15];
    }

    return out;
};

/**
 * Scales the mat4 by the dimensions in the given vec3
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the matrix to scale
 * @param {vec3} v the vec3 to scale the matrix by
 * @returns {mat4} out
 **/
mat4.scale = function(out, a, v) {
    var x = v[0], y = v[1], z = v[2];

    out[0] = a[0] * x;
    out[1] = a[1] * x;
    out[2] = a[2] * x;
    out[3] = a[3] * x;
    out[4] = a[4] * y;
    out[5] = a[5] * y;
    out[6] = a[6] * y;
    out[7] = a[7] * y;
    out[8] = a[8] * z;
    out[9] = a[9] * z;
    out[10] = a[10] * z;
    out[11] = a[11] * z;
    out[12] = a[12];
    out[13] = a[13];
    out[14] = a[14];
    out[15] = a[15];
    return out;
};

/**
 * Rotates a mat4 by the given angle
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the matrix to rotate
 * @param {Number} rad the angle to rotate the matrix by
 * @param {vec3} axis the axis to rotate around
 * @returns {mat4} out
 */
mat4.rotate = function (out, a, rad, axis) {
    var x = axis[0], y = axis[1], z = axis[2],
        len = Math.sqrt(x * x + y * y + z * z),
        s, c, t,
        a00, a01, a02, a03,
        a10, a11, a12, a13,
        a20, a21, a22, a23,
        b00, b01, b02,
        b10, b11, b12,
        b20, b21, b22;

    if (Math.abs(len) < GLMAT_EPSILON) { return null; }
    
    len = 1 / len;
    x *= len;
    y *= len;
    z *= len;

    s = Math.sin(rad);
    c = Math.cos(rad);
    t = 1 - c;

    a00 = a[0]; a01 = a[1]; a02 = a[2]; a03 = a[3];
    a10 = a[4]; a11 = a[5]; a12 = a[6]; a13 = a[7];
    a20 = a[8]; a21 = a[9]; a22 = a[10]; a23 = a[11];

    // Construct the elements of the rotation matrix
    b00 = x * x * t + c; b01 = y * x * t + z * s; b02 = z * x * t - y * s;
    b10 = x * y * t - z * s; b11 = y * y * t + c; b12 = z * y * t + x * s;
    b20 = x * z * t + y * s; b21 = y * z * t - x * s; b22 = z * z * t + c;

    // Perform rotation-specific matrix multiplication
    out[0] = a00 * b00 + a10 * b01 + a20 * b02;
    out[1] = a01 * b00 + a11 * b01 + a21 * b02;
    out[2] = a02 * b00 + a12 * b01 + a22 * b02;
    out[3] = a03 * b00 + a13 * b01 + a23 * b02;
    out[4] = a00 * b10 + a10 * b11 + a20 * b12;
    out[5] = a01 * b10 + a11 * b11 + a21 * b12;
    out[6] = a02 * b10 + a12 * b11 + a22 * b12;
    out[7] = a03 * b10 + a13 * b11 + a23 * b12;
    out[8] = a00 * b20 + a10 * b21 + a20 * b22;
    out[9] = a01 * b20 + a11 * b21 + a21 * b22;
    out[10] = a02 * b20 + a12 * b21 + a22 * b22;
    out[11] = a03 * b20 + a13 * b21 + a23 * b22;

    if (a !== out) { // If the source and destination differ, copy the unchanged last row
        out[12] = a[12];
        out[13] = a[13];
        out[14] = a[14];
        out[15] = a[15];
    }
    return out;
};

/**
 * Rotates a matrix by the given angle around the X axis
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the matrix to rotate
 * @param {Number} rad the angle to rotate the matrix by
 * @returns {mat4} out
 */
mat4.rotateX = function (out, a, rad) {
    var s = Math.sin(rad),
        c = Math.cos(rad),
        a10 = a[4],
        a11 = a[5],
        a12 = a[6],
        a13 = a[7],
        a20 = a[8],
        a21 = a[9],
        a22 = a[10],
        a23 = a[11];

    if (a !== out) { // If the source and destination differ, copy the unchanged rows
        out[0]  = a[0];
        out[1]  = a[1];
        out[2]  = a[2];
        out[3]  = a[3];
        out[12] = a[12];
        out[13] = a[13];
        out[14] = a[14];
        out[15] = a[15];
    }

    // Perform axis-specific matrix multiplication
    out[4] = a10 * c + a20 * s;
    out[5] = a11 * c + a21 * s;
    out[6] = a12 * c + a22 * s;
    out[7] = a13 * c + a23 * s;
    out[8] = a20 * c - a10 * s;
    out[9] = a21 * c - a11 * s;
    out[10] = a22 * c - a12 * s;
    out[11] = a23 * c - a13 * s;
    return out;
};

/**
 * Rotates a matrix by the given angle around the Y axis
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the matrix to rotate
 * @param {Number} rad the angle to rotate the matrix by
 * @returns {mat4} out
 */
mat4.rotateY = function (out, a, rad) {
    var s = Math.sin(rad),
        c = Math.cos(rad),
        a00 = a[0],
        a01 = a[1],
        a02 = a[2],
        a03 = a[3],
        a20 = a[8],
        a21 = a[9],
        a22 = a[10],
        a23 = a[11];

    if (a !== out) { // If the source and destination differ, copy the unchanged rows
        out[4]  = a[4];
        out[5]  = a[5];
        out[6]  = a[6];
        out[7]  = a[7];
        out[12] = a[12];
        out[13] = a[13];
        out[14] = a[14];
        out[15] = a[15];
    }

    // Perform axis-specific matrix multiplication
    out[0] = a00 * c - a20 * s;
    out[1] = a01 * c - a21 * s;
    out[2] = a02 * c - a22 * s;
    out[3] = a03 * c - a23 * s;
    out[8] = a00 * s + a20 * c;
    out[9] = a01 * s + a21 * c;
    out[10] = a02 * s + a22 * c;
    out[11] = a03 * s + a23 * c;
    return out;
};

/**
 * Rotates a matrix by the given angle around the Z axis
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the matrix to rotate
 * @param {Number} rad the angle to rotate the matrix by
 * @returns {mat4} out
 */
mat4.rotateZ = function (out, a, rad) {
    var s = Math.sin(rad),
        c = Math.cos(rad),
        a00 = a[0],
        a01 = a[1],
        a02 = a[2],
        a03 = a[3],
        a10 = a[4],
        a11 = a[5],
        a12 = a[6],
        a13 = a[7];

    if (a !== out) { // If the source and destination differ, copy the unchanged last row
        out[8]  = a[8];
        out[9]  = a[9];
        out[10] = a[10];
        out[11] = a[11];
        out[12] = a[12];
        out[13] = a[13];
        out[14] = a[14];
        out[15] = a[15];
    }

    // Perform axis-specific matrix multiplication
    out[0] = a00 * c + a10 * s;
    out[1] = a01 * c + a11 * s;
    out[2] = a02 * c + a12 * s;
    out[3] = a03 * c + a13 * s;
    out[4] = a10 * c - a00 * s;
    out[5] = a11 * c - a01 * s;
    out[6] = a12 * c - a02 * s;
    out[7] = a13 * c - a03 * s;
    return out;
};

/**
 * Creates a matrix from a quaternion rotation and vector translation
 * This is equivalent to (but much faster than):
 *
 *     mat4.identity(dest);
 *     mat4.translate(dest, vec);
 *     var quatMat = mat4.create();
 *     quat4.toMat4(quat, quatMat);
 *     mat4.multiply(dest, quatMat);
 *
 * @param {mat4} out mat4 receiving operation result
 * @param {quat4} q Rotation quaternion
 * @param {vec3} v Translation vector
 * @returns {mat4} out
 */
mat4.fromRotationTranslation = function (out, q, v) {
    // Quaternion math
    var x = q[0], y = q[1], z = q[2], w = q[3],
        x2 = x + x,
        y2 = y + y,
        z2 = z + z,

        xx = x * x2,
        xy = x * y2,
        xz = x * z2,
        yy = y * y2,
        yz = y * z2,
        zz = z * z2,
        wx = w * x2,
        wy = w * y2,
        wz = w * z2;

    out[0] = 1 - (yy + zz);
    out[1] = xy + wz;
    out[2] = xz - wy;
    out[3] = 0;
    out[4] = xy - wz;
    out[5] = 1 - (xx + zz);
    out[6] = yz + wx;
    out[7] = 0;
    out[8] = xz + wy;
    out[9] = yz - wx;
    out[10] = 1 - (xx + yy);
    out[11] = 0;
    out[12] = v[0];
    out[13] = v[1];
    out[14] = v[2];
    out[15] = 1;
    
    return out;
};

/**
* Calculates a 4x4 matrix from the given quaternion
*
* @param {mat4} out mat4 receiving operation result
* @param {quat} q Quaternion to create matrix from
*
* @returns {mat4} out
*/
mat4.fromQuat = function (out, q) {
    var x = q[0], y = q[1], z = q[2], w = q[3],
        x2 = x + x,
        y2 = y + y,
        z2 = z + z,

        xx = x * x2,
        xy = x * y2,
        xz = x * z2,
        yy = y * y2,
        yz = y * z2,
        zz = z * z2,
        wx = w * x2,
        wy = w * y2,
        wz = w * z2;

    out[0] = 1 - (yy + zz);
    out[1] = xy + wz;
    out[2] = xz - wy;
    out[3] = 0;

    out[4] = xy - wz;
    out[5] = 1 - (xx + zz);
    out[6] = yz + wx;
    out[7] = 0;

    out[8] = xz + wy;
    out[9] = yz - wx;
    out[10] = 1 - (xx + yy);
    out[11] = 0;

    out[12] = 0;
    out[13] = 0;
    out[14] = 0;
    out[15] = 1;

    return out;
};

/**
 * Generates a frustum matrix with the given bounds
 *
 * @param {mat4} out mat4 frustum matrix will be written into
 * @param {Number} left Left bound of the frustum
 * @param {Number} right Right bound of the frustum
 * @param {Number} bottom Bottom bound of the frustum
 * @param {Number} top Top bound of the frustum
 * @param {Number} near Near bound of the frustum
 * @param {Number} far Far bound of the frustum
 * @returns {mat4} out
 */
mat4.frustum = function (out, left, right, bottom, top, near, far) {
    var rl = 1 / (right - left),
        tb = 1 / (top - bottom),
        nf = 1 / (near - far);
    out[0] = (near * 2) * rl;
    out[1] = 0;
    out[2] = 0;
    out[3] = 0;
    out[4] = 0;
    out[5] = (near * 2) * tb;
    out[6] = 0;
    out[7] = 0;
    out[8] = (right + left) * rl;
    out[9] = (top + bottom) * tb;
    out[10] = (far + near) * nf;
    out[11] = -1;
    out[12] = 0;
    out[13] = 0;
    out[14] = (far * near * 2) * nf;
    out[15] = 0;
    return out;
};

/**
 * Generates a perspective projection matrix with the given bounds
 *
 * @param {mat4} out mat4 frustum matrix will be written into
 * @param {number} fovy Vertical field of view in radians
 * @param {number} aspect Aspect ratio. typically viewport width/height
 * @param {number} near Near bound of the frustum
 * @param {number} far Far bound of the frustum
 * @returns {mat4} out
 */
mat4.perspective = function (out, fovy, aspect, near, far) {
    var f = 1.0 / Math.tan(fovy / 2),
        nf = 1 / (near - far);
    out[0] = f / aspect;
    out[1] = 0;
    out[2] = 0;
    out[3] = 0;
    out[4] = 0;
    out[5] = f;
    out[6] = 0;
    out[7] = 0;
    out[8] = 0;
    out[9] = 0;
    out[10] = (far + near) * nf;
    out[11] = -1;
    out[12] = 0;
    out[13] = 0;
    out[14] = (2 * far * near) * nf;
    out[15] = 0;
    return out;
};

/**
 * Generates a orthogonal projection matrix with the given bounds
 *
 * @param {mat4} out mat4 frustum matrix will be written into
 * @param {number} left Left bound of the frustum
 * @param {number} right Right bound of the frustum
 * @param {number} bottom Bottom bound of the frustum
 * @param {number} top Top bound of the frustum
 * @param {number} near Near bound of the frustum
 * @param {number} far Far bound of the frustum
 * @returns {mat4} out
 */
mat4.ortho = function (out, left, right, bottom, top, near, far) {
    var lr = 1 / (left - right),
        bt = 1 / (bottom - top),
        nf = 1 / (near - far);
    out[0] = -2 * lr;
    out[1] = 0;
    out[2] = 0;
    out[3] = 0;
    out[4] = 0;
    out[5] = -2 * bt;
    out[6] = 0;
    out[7] = 0;
    out[8] = 0;
    out[9] = 0;
    out[10] = 2 * nf;
    out[11] = 0;
    out[12] = (left + right) * lr;
    out[13] = (top + bottom) * bt;
    out[14] = (far + near) * nf;
    out[15] = 1;
    return out;
};

/**
 * Generates a look-at matrix with the given eye position, focal point, and up axis
 *
 * @param {mat4} out mat4 frustum matrix will be written into
 * @param {vec3} eye Position of the viewer
 * @param {vec3} center Point the viewer is looking at
 * @param {vec3} up vec3 pointing up
 * @returns {mat4} out
 */
mat4.lookAt = function (out, eye, center, up) {
    var x0, x1, x2, y0, y1, y2, z0, z1, z2, len,
        eyex = eye[0],
        eyey = eye[1],
        eyez = eye[2],
        upx = up[0],
        upy = up[1],
        upz = up[2],
        centerx = center[0],
        centery = center[1],
        centerz = center[2];

    if (Math.abs(eyex - centerx) < GLMAT_EPSILON &&
        Math.abs(eyey - centery) < GLMAT_EPSILON &&
        Math.abs(eyez - centerz) < GLMAT_EPSILON) {
        return mat4.identity(out);
    }

    z0 = eyex - centerx;
    z1 = eyey - centery;
    z2 = eyez - centerz;

    len = 1 / Math.sqrt(z0 * z0 + z1 * z1 + z2 * z2);
    z0 *= len;
    z1 *= len;
    z2 *= len;

    x0 = upy * z2 - upz * z1;
    x1 = upz * z0 - upx * z2;
    x2 = upx * z1 - upy * z0;
    len = Math.sqrt(x0 * x0 + x1 * x1 + x2 * x2);
    if (!len) {
        x0 = 0;
        x1 = 0;
        x2 = 0;
    } else {
        len = 1 / len;
        x0 *= len;
        x1 *= len;
        x2 *= len;
    }

    y0 = z1 * x2 - z2 * x1;
    y1 = z2 * x0 - z0 * x2;
    y2 = z0 * x1 - z1 * x0;

    len = Math.sqrt(y0 * y0 + y1 * y1 + y2 * y2);
    if (!len) {
        y0 = 0;
        y1 = 0;
        y2 = 0;
    } else {
        len = 1 / len;
        y0 *= len;
        y1 *= len;
        y2 *= len;
    }

    out[0] = x0;
    out[1] = y0;
    out[2] = z0;
    out[3] = 0;
    out[4] = x1;
    out[5] = y1;
    out[6] = z1;
    out[7] = 0;
    out[8] = x2;
    out[9] = y2;
    out[10] = z2;
    out[11] = 0;
    out[12] = -(x0 * eyex + x1 * eyey + x2 * eyez);
    out[13] = -(y0 * eyex + y1 * eyey + y2 * eyez);
    out[14] = -(z0 * eyex + z1 * eyey + z2 * eyez);
    out[15] = 1;

    return out;
};

/**
 * Returns a string representation of a mat4
 *
 * @param {mat4} mat matrix to represent as a string
 * @returns {String} string representation of the matrix
 */
mat4.str = function (a) {
    return 'mat4(' + a[0] + ', ' + a[1] + ', ' + a[2] + ', ' + a[3] + ', ' +
                    a[4] + ', ' + a[5] + ', ' + a[6] + ', ' + a[7] + ', ' +
                    a[8] + ', ' + a[9] + ', ' + a[10] + ', ' + a[11] + ', ' + 
                    a[12] + ', ' + a[13] + ', ' + a[14] + ', ' + a[15] + ')';
};

if(typeof(exports) !== 'undefined') {
    exports.mat4 = mat4;
}
;
/* Copyright (c) 2013, Brandon Jones, Colin MacKenzie IV. All rights reserved.

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

  * Redistributions of source code must retain the above copyright notice, this
    list of conditions and the following disclaimer.
  * Redistributions in binary form must reproduce the above copyright notice,
    this list of conditions and the following disclaimer in the documentation 
    and/or other materials provided with the distribution.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE 
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. */

/**
 * @class Quaternion
 * @name quat
 */

var quat = {};

var quatIdentity = new Float32Array([0, 0, 0, 1]);

/**
 * Creates a new identity quat
 *
 * @returns {quat} a new quaternion
 */
quat.create = function() {
    var out = new GLMAT_ARRAY_TYPE(4);
    out[0] = 0;
    out[1] = 0;
    out[2] = 0;
    out[3] = 1;
    return out;
};

/**
 * Creates a new quat initialized with values from an existing quaternion
 *
 * @param {quat} a quaternion to clone
 * @returns {quat} a new quaternion
 * @function
 */
quat.clone = vec4.clone;

/**
 * Creates a new quat initialized with the given values
 *
 * @param {Number} x X component
 * @param {Number} y Y component
 * @param {Number} z Z component
 * @param {Number} w W component
 * @returns {quat} a new quaternion
 * @function
 */
quat.fromValues = vec4.fromValues;

/**
 * Copy the values from one quat to another
 *
 * @param {quat} out the receiving quaternion
 * @param {quat} a the source quaternion
 * @returns {quat} out
 * @function
 */
quat.copy = vec4.copy;

/**
 * Set the components of a quat to the given values
 *
 * @param {quat} out the receiving quaternion
 * @param {Number} x X component
 * @param {Number} y Y component
 * @param {Number} z Z component
 * @param {Number} w W component
 * @returns {quat} out
 * @function
 */
quat.set = vec4.set;

/**
 * Set a quat to the identity quaternion
 *
 * @param {quat} out the receiving quaternion
 * @returns {quat} out
 */
quat.identity = function(out) {
    out[0] = 0;
    out[1] = 0;
    out[2] = 0;
    out[3] = 1;
    return out;
};

/**
 * Sets a quat from the given angle and rotation axis,
 * then returns it.
 *
 * @param {quat} out the receiving quaternion
 * @param {vec3} axis the axis around which to rotate
 * @param {Number} rad the angle in radians
 * @returns {quat} out
 **/
quat.setAxisAngle = function(out, axis, rad) {
    rad = rad * 0.5;
    var s = Math.sin(rad);
    out[0] = s * axis[0];
    out[1] = s * axis[1];
    out[2] = s * axis[2];
    out[3] = Math.cos(rad);
    return out;
};

/**
 * Adds two quat's
 *
 * @param {quat} out the receiving quaternion
 * @param {quat} a the first operand
 * @param {quat} b the second operand
 * @returns {quat} out
 * @function
 */
quat.add = vec4.add;

/**
 * Multiplies two quat's
 *
 * @param {quat} out the receiving quaternion
 * @param {quat} a the first operand
 * @param {quat} b the second operand
 * @returns {quat} out
 */
quat.multiply = function(out, a, b) {
    var ax = a[0], ay = a[1], az = a[2], aw = a[3],
        bx = b[0], by = b[1], bz = b[2], bw = b[3];

    out[0] = ax * bw + aw * bx + ay * bz - az * by;
    out[1] = ay * bw + aw * by + az * bx - ax * bz;
    out[2] = az * bw + aw * bz + ax * by - ay * bx;
    out[3] = aw * bw - ax * bx - ay * by - az * bz;
    return out;
};

/**
 * Alias for {@link quat.multiply}
 * @function
 */
quat.mul = quat.multiply;

/**
 * Scales a quat by a scalar number
 *
 * @param {quat} out the receiving vector
 * @param {quat} a the vector to scale
 * @param {Number} b amount to scale the vector by
 * @returns {quat} out
 * @function
 */
quat.scale = vec4.scale;

/**
 * Rotates a quaternion by the given angle around the X axis
 *
 * @param {quat} out quat receiving operation result
 * @param {quat} a quat to rotate
 * @param {number} rad angle (in radians) to rotate
 * @returns {quat} out
 */
quat.rotateX = function (out, a, rad) {
    rad *= 0.5; 

    var ax = a[0], ay = a[1], az = a[2], aw = a[3],
        bx = Math.sin(rad), bw = Math.cos(rad);

    out[0] = ax * bw + aw * bx;
    out[1] = ay * bw + az * bx;
    out[2] = az * bw - ay * bx;
    out[3] = aw * bw - ax * bx;
    return out;
};

/**
 * Rotates a quaternion by the given angle around the Y axis
 *
 * @param {quat} out quat receiving operation result
 * @param {quat} a quat to rotate
 * @param {number} rad angle (in radians) to rotate
 * @returns {quat} out
 */
quat.rotateY = function (out, a, rad) {
    rad *= 0.5; 

    var ax = a[0], ay = a[1], az = a[2], aw = a[3],
        by = Math.sin(rad), bw = Math.cos(rad);

    out[0] = ax * bw - az * by;
    out[1] = ay * bw + aw * by;
    out[2] = az * bw + ax * by;
    out[3] = aw * bw - ay * by;
    return out;
};

/**
 * Rotates a quaternion by the given angle around the Z axis
 *
 * @param {quat} out quat receiving operation result
 * @param {quat} a quat to rotate
 * @param {number} rad angle (in radians) to rotate
 * @returns {quat} out
 */
quat.rotateZ = function (out, a, rad) {
    rad *= 0.5; 

    var ax = a[0], ay = a[1], az = a[2], aw = a[3],
        bz = Math.sin(rad), bw = Math.cos(rad);

    out[0] = ax * bw + ay * bz;
    out[1] = ay * bw - ax * bz;
    out[2] = az * bw + aw * bz;
    out[3] = aw * bw - az * bz;
    return out;
};

/**
 * Calculates the W component of a quat from the X, Y, and Z components.
 * Assumes that quaternion is 1 unit in length.
 * Any existing W component will be ignored.
 *
 * @param {quat} out the receiving quaternion
 * @param {quat} a quat to calculate W component of
 * @returns {quat} out
 */
quat.calculateW = function (out, a) {
    var x = a[0], y = a[1], z = a[2];

    out[0] = x;
    out[1] = y;
    out[2] = z;
    out[3] = -Math.sqrt(Math.abs(1.0 - x * x - y * y - z * z));
    return out;
};

/**
 * Calculates the dot product of two quat's
 *
 * @param {quat} a the first operand
 * @param {quat} b the second operand
 * @returns {Number} dot product of a and b
 * @function
 */
quat.dot = vec4.dot;

/**
 * Performs a linear interpolation between two quat's
 *
 * @param {quat} out the receiving quaternion
 * @param {quat} a the first operand
 * @param {quat} b the second operand
 * @param {Number} t interpolation amount between the two inputs
 * @returns {quat} out
 * @function
 */
quat.lerp = vec4.lerp;

/**
 * Performs a spherical linear interpolation between two quat
 *
 * @param {quat} out the receiving quaternion
 * @param {quat} a the first operand
 * @param {quat} b the second operand
 * @param {Number} t interpolation amount between the two inputs
 * @returns {quat} out
 */
quat.slerp = function (out, a, b, t) {
    var ax = a[0], ay = a[1], az = a[2], aw = a[3],
        bx = b[0], by = b[1], bz = b[2], bw = b[3];

    var cosHalfTheta = ax * bx + ay * by + az * bz + aw * bw,
        halfTheta,
        sinHalfTheta,
        ratioA,
        ratioB;

    if (Math.abs(cosHalfTheta) >= 1.0) {
        if (out !== a) {
            out[0] = ax;
            out[1] = ay;
            out[2] = az;
            out[3] = aw;
        }
        return out;
    }

    halfTheta = Math.acos(cosHalfTheta);
    sinHalfTheta = Math.sqrt(1.0 - cosHalfTheta * cosHalfTheta);

    if (Math.abs(sinHalfTheta) < 0.001) {
        out[0] = (ax * 0.5 + bx * 0.5);
        out[1] = (ay * 0.5 + by * 0.5);
        out[2] = (az * 0.5 + bz * 0.5);
        out[3] = (aw * 0.5 + bw * 0.5);
        return out;
    }

    ratioA = Math.sin((1 - t) * halfTheta) / sinHalfTheta;
    ratioB = Math.sin(t * halfTheta) / sinHalfTheta;

    out[0] = (ax * ratioA + bx * ratioB);
    out[1] = (ay * ratioA + by * ratioB);
    out[2] = (az * ratioA + bz * ratioB);
    out[3] = (aw * ratioA + bw * ratioB);

    return out;
};

/**
 * Calculates the inverse of a quat
 *
 * @param {quat} out the receiving quaternion
 * @param {quat} a quat to calculate inverse of
 * @returns {quat} out
 */
quat.invert = function(out, a) {
    var a0 = a[0], a1 = a[1], a2 = a[2], a3 = a[3],
        dot = a0*a0 + a1*a1 + a2*a2 + a3*a3,
        invDot = dot ? 1.0/dot : 0;
    
    // TODO: Would be faster to return [0,0,0,0] immediately if dot == 0

    out[0] = -a0*invDot;
    out[1] = -a1*invDot;
    out[2] = -a2*invDot;
    out[3] = a3*invDot;
    return out;
};

/**
 * Calculates the conjugate of a quat
 * If the quaternion is normalized, this function is faster than quat.inverse and produces the same result.
 *
 * @param {quat} out the receiving quaternion
 * @param {quat} a quat to calculate conjugate of
 * @returns {quat} out
 */
quat.conjugate = function (out, a) {
    out[0] = -a[0];
    out[1] = -a[1];
    out[2] = -a[2];
    out[3] = a[3];
    return out;
};

/**
 * Calculates the length of a quat
 *
 * @param {quat} a vector to calculate length of
 * @returns {Number} length of a
 * @function
 */
quat.length = vec4.length;

/**
 * Alias for {@link quat.length}
 * @function
 */
quat.len = quat.length;

/**
 * Calculates the squared length of a quat
 *
 * @param {quat} a vector to calculate squared length of
 * @returns {Number} squared length of a
 * @function
 */
quat.squaredLength = vec4.squaredLength;

/**
 * Alias for {@link quat.squaredLength}
 * @function
 */
quat.sqrLen = quat.squaredLength;

/**
 * Normalize a quat
 *
 * @param {quat} out the receiving quaternion
 * @param {quat} a quaternion to normalize
 * @returns {quat} out
 * @function
 */
quat.normalize = vec4.normalize;

/**
 * Creates a quaternion from the given 3x3 rotation matrix.
 *
 * @param {quat} out the receiving quaternion
 * @param {mat3} m rotation matrix
 * @returns {quat} out
 * @function
 */
quat.fromMat3 = (function() {
    var s_iNext = [1,2,0];
    return function(out, m) {
        // Algorithm in Ken Shoemake's article in 1987 SIGGRAPH course notes
        // article "Quaternion Calculus and Fast Animation".
        var fTrace = m[0] + m[4] + m[8];
        var fRoot;

        if ( fTrace > 0.0 ) {
            // |w| > 1/2, may as well choose w > 1/2
            fRoot = Math.sqrt(fTrace + 1.0);  // 2w
            out[3] = 0.5 * fRoot;
            fRoot = 0.5/fRoot;  // 1/(4w)
            out[0] = (m[7]-m[5])*fRoot;
            out[1] = (m[2]-m[6])*fRoot;
            out[2] = (m[3]-m[1])*fRoot;
        } else {
            // |w| <= 1/2
            var i = 0;
            if ( m[4] > m[0] )
              i = 1;
            if ( m[8] > m[i*3+i] )
              i = 2;
            var j = s_iNext[i];
            var k = s_iNext[j];
            
            fRoot = Math.sqrt(m[i*3+i]-m[j*3+j]-m[k*3+k] + 1.0);
            out[i] = 0.5 * fRoot;
            fRoot = 0.5 / fRoot;
            out[3] = (m[k*3+j] - m[j*3+k]) * fRoot;
            out[j] = (m[j*3+i] + m[i*3+j]) * fRoot;
            out[k] = (m[k*3+i] + m[i*3+k]) * fRoot;
        }
        
        return out;
    };
})();

/**
 * Returns a string representation of a quatenion
 *
 * @param {quat} vec vector to represent as a string
 * @returns {String} string representation of the vector
 */
quat.str = function (a) {
    return 'quat(' + a[0] + ', ' + a[1] + ', ' + a[2] + ', ' + a[3] + ')';
};

if(typeof(exports) !== 'undefined') {
    exports.quat = quat;
}
;













  })(shim.exports);
})();

},{}],267:[function(require,module,exports){
/**
 * @module ac-transform
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

module.exports = {
	Transform: require('./ac-transform/Transform')
};




},{"./ac-transform/Transform":268}],268:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';
/**
 * @type {mat4}
 * @ignore
 */
var mat4 = require('gl-matrix').mat4;
/** @type {vec3}
 * @ignore
 */
var vec3 = require('gl-matrix').vec3;
/**
 * @type {vec3}
 * @ignore
 */
var vec4 = require('gl-matrix').vec4;
/**
 * @type {quat}
 * @ignore
 */
var quat = require('gl-matrix').quat;

var degToRad = Math.PI / 180;
var radToDeg= 180 / Math.PI;

// MATRIX SHORTHAND
// Because gl-matrix is a 16 length floating point array for performance,
// it is tricky to translate algorithms you see online because they always refer to A or m11 for affine/non-affine matrices respectively
// This makes it so we can more easily reason about the matrix
var m11 = 0,  mA = 0,     m12 = 1,  mB = 1,      m13 = 2,    m14 = 3;
var m21 = 4,  mC = 4,     m22 = 5,  mD = 5,      m23 = 6,    m24 = 7;
var m31 = 8,              m32 = 9,               m33 = 10,   m34 = 11;
var m41 = 12, mE = 12,    m42 = 13, mF = 13,     m43 = 14,   m44 = 15;

/**
 * @module ac-transform.Transform
 * @alias ac-transform:Transform
 * @constructor
 * @class
 *
 * @desc Javascript implementation of the w3 css3-transforms specification.
 * For performance, all functions modify the existing matrix instead of creating a new one.
 * Call Transform.Clone to clone the matrix, to run functions without modifying this matrix
 */
function Transform() {
	this.m = mat4.create();
}
var proto = Transform.prototype;

////////////////////////////////////////
////////////// ROTATION   //////////////
////////////////////////////////////////
/**
 * @module ac-transform.Transform#rotateX
 * @function
 *
 * @desc Applies a 3D rotation along the X axis by the angle specified.
 * Same as calling `same as rotate3d(1, 0, 0, angle)`
 *
 * @param {number} deg Rotation amount in degrees
 * @returns {Transform}
 */
proto.rotateX = function(deg) {
	var rad = degToRad * deg;
	mat4.rotateX( this.m, this.m, rad );

	return this;
};
/**
 * @module ac-transform.Transform#rotateY
 * @function
 *
 * @desc Applies a 3D rotation along the Y axis by the angle specified.
 * Same as calling `same as rotate3d(0, 1, 0, angle)`
 *
 * @param {number} deg Rotation amount in degrees
 *
 * @returns {Transform}
 */
proto.rotateY = function(deg) {
	var rad = degToRad * deg;
	mat4.rotateY( this.m, this.m, rad );

	return this;
};

/**
 * @module ac-transform.Transform#rotateZ
 * @function
 *
 * @desc Applies a 3D rotation along the Z axis by the angle specified.
 * Same as calling `same as rotate3d(0, 0, 1, angle)`
 *
 * @param {number} deg Rotation amount in degrees
 *
 * @returns {Transform}
 */
proto.rotateZ = function(deg) {
	var rad = degToRad * deg;
	mat4.rotateZ( this.m, this.m, rad );

	return this;
};
/**
 * @alias ac-transform.Transform.rotateZ
 */
proto.rotate = proto.rotateZ;

/**
 * @module ac-transform.Transform#rotate3d
 * @function
 *
 * @desc Applies a 3D rotation about the Vector(x,y,z) by the `deg` angle
 * For example, to rotate around the 180 degrees Y axis, you would call `Transform.rotate3d(0,1,0, 180)`
 *
 * @param {number} x	X axis for direction vector
 * @param {number} y	Y axis for direction vector
 * @param {number} z	Z axis for direction vector
 * @param {number} deg	Rotation amount in degrees
 *
 * @returns {Transform}
 */
proto.rotate3d = function( x, y, z, deg) {
	if (y === null || y === undefined ) y = x;
	if (z === null || y === undefined ) z = x;
	var rad = degToRad * deg;
	mat4.rotate( this.m, this.m, rad, [x,y,z] );

	return this;
};
/**
 * @alias ac-transform.Transform.rotate3d
 */
proto.rotateAxisAngle = proto.rotate3d;

////////////////////////////////////////
///////////////  SCALE   ///////////////
////////////////////////////////////////
/**
 * @module ac-transform.Transform#scale
 * @function
 *
 * @desc Applies a 2D scale operation using the [sx,sy] scaling vector
 *
 * @param {number} sx	Scaling vector along the x-axis
 * @param {number} sy	Scaling vector along the y-axis
 *
 * @returns {Transform}
 */
proto.scale = function( sx, sy ) {
	sy = sy || sx;
	mat4.scale(this.m, this.m, [sx,sy,1]);

	return this;
};
/**
 * @module ac-transform.Transform#scaleX
 * @function
 *
 * @desc Applies a 2D scale operation using the [sx,1] scaling vector, where sx is given as the parameter.
 * @param {number} sx	Scaling vector along the x-axis
 *
 * @returns {Transform}
 */
proto.scaleX = function( sx ) {
	mat4.scale(this.m, this.m, [sx,1,1]);

	return this;
};
/**
 * @module ac-transform.Transform#scaleY
 * @function
 *
 * @desc Applies a 2D scale operation using the [1,sy] scaling vector, where sy is given as the parameter.
 * @param {number} sy	Scaling vector along the y-axis
 *
 * @returns {Transform}
 */
proto.scaleY = function( sy ) {
	mat4.scale(this.m, this.m, [1,sy,1]);

	return this;
};
/**
 * @module ac-transform.Transform#scaleZ
 * @function
 *
 * @desc Applies a 3D scale operation using the [1,1,sz] scaling vector, where sz is given as the parameter.
 * @param sz
 *
 * @returns {Transform}
 */
proto.scaleZ = function( sz ) {
	mat4.scale(this.m, this.m, [1,1,sz]);

	return this;
};
/**
 * @module ac-transform.Transform#scale3d
 * @function
 *
 * @desc Applies a 3D scale operation by the [sx,sy,sz] scaling vector described by the 3 parameters.
 * @param {number} sx	Scaling vector along the x-axis
 * @param {number} sy	Scaling vector along the y-axis
 * @param {number} sz	Scaling vector along the y-axis
 *
 * @returns {Transform}
 */
proto.scale3d = function( sx, sy, sz ) {
	mat4.scale(this.m, this.m, [sx,sy,sz]);

	return this;
};


////////////////////////////////////////
///////////////  SKEW   ////////////////
////////////////////////////////////////
/**
 * @module ac-transform.Transform#skew
 * @function
 *
 * @desc Applies a 2D skew by [ax,ay] for X and Y.
 * If the second parameter is not provided, it has a zero value.
 * @param {number} ax	Skew vector along the X axis
 * @param {number} ay	Skew vector along the X axis
 *
 * @returns {Transform}
 */
proto.skew = function( ax, ay ) {
	if( ay === null || ay === undefined ) {
		return this.skewX(ax);
	}

	ax = degToRad * ax;
	ay = degToRad * ay;

	// X
	var transform = mat4.create();
	transform[mC] = Math.tan(ax);
	transform[mB] = Math.tan(ay);

	mat4.multiply(this.m, this.m, transform);

	return this;
};

/**
 * @module ac-transform.Transform#skewX
 * @function
 *
 * @desc Applies a 2D skew transformation along the X axis by the given angle.
 * @param {number} ax	Skew vector along the X axis
 *
 * @returns {Transform}
 */
proto.skewX = function( ax ) {
	ax = degToRad * ax;

	var transform = mat4.create();
	transform[mC] = Math.tan(ax);

	mat4.multiply(this.m, this.m, transform);

	return this;
};

/**
 * @module ac-transform.Transform#skewY
 * @function
 *
 * @desc Applies a 2D skew transformation along the Y axis by the given angle.
 * @param {number} ay	Skew vector along the Y axis
 *
 * @returns {Transform}
 */
proto.skewY = function( ay ) {
	ay = degToRad * ay;

	var transform = mat4.create();
	transform[mB] = Math.tan(ay);

	mat4.multiply(this.m, this.m, transform);

	return this;
};


////////////////////////////////////////
/////////////  TRANSLATE   /////////////
////////////////////////////////////////
/**
 * @module ac-transform.Transform#translate
 * @function
 *
 * @desc Applies a 2D translation by the vector [tx, ty], where tx represents the X axis, and ty is an optional value representing the Y axis.
 * If <ty> is not provided, ty has zero as a value.
 *
 * @param {number} tx	Translation along the X axis
 * @param {number} [ty]	Optional, translation along the Y axis
 *
 * @returns {Transform}
 */
proto.translate = function(tx, ty) {
	ty = ty || 0;
	mat4.translate( this.m, this.m, [tx, ty, 0] );

	return this;
};

/**
 * @module ac-transform.Transform#translate3d
 * @function
 *
 * @desc Applies a 3D translation by the vector [tx,ty,tz], with tx, ty and tz being the first, second and third translation-value parameters respectively.
 * @param {number} tx	Translation along the X axis
 * @param {number} ty	Translation along the X axis
 * @param {number} tz	Translation along the X axis
 *
 * @returns {Transform}
 */
proto.translate3d = function(tx, ty, tz) {
	mat4.translate( this.m, this.m, [tx, ty, tz] );

	return this;
};

/**
 * @module ac-transform.Transform#translateX
 * @function
 *
 * @desc Applies a 2D translation alon the X axis
 * Same as calling translate3d(tx,0,0);

 * @param {number} tx	Translation along the X axis
 * @returns {Transform}
 */
proto.translateX = function(tx) {
	mat4.translate( this.m, this.m, [tx, 0, 0] );

	return this;
};

/**
 * @module ac-transform.Transform#translateY
 * @function
 *
 * @desc Applies a 2D translation along the Y axis
 * Same as calling translate3d(0,ty,0);

 * @param {number} ty	Translation along the Y axis
 * @returns {Transform}
 */
proto.translateY = function(ty) {
	mat4.translate( this.m, this.m, [0, ty, 0] );

	return this;
};

/**
 * @module ac-transform.Transform#translateZ
 * @function
 *
 * @desc Applies a 3D translation along the Z axis
 * Same as calling translate3d(0,0, tz);
 *
 * @param tz	Translation along the Z axis
 * @returns {Transform}
 */
proto.translateZ = function(tz) {
	mat4.translate( this.m, this.m, [0, 0, tz] );

	return this;
};

////////////////////////////////////////
///////////////   MISC   ///////////////
////////////////////////////////////////
/**
 * @module ac-transform.Transform#perspective
 * @function
 *
 * @desc Applies a perspective projection matrix.
 * The perspective() function represents the distance of the z-plane (z = 0) from the viewer.
 *
 * @param {number} depth Distance of the z-plane in pixels
 * @returns {Transform}
 */
proto.perspective = function( depth ) {
	var t = mat4.create();
	if( depth !== 0 ) {
		t[m34] = -1.0 / depth;
	}

	mat4.multiply( this.m, this.m, t);
};

/**
 * @module ac-transform.Transform#inverse
 * @function
 *
 * @desc Returns a new Transform, which is the inverse of this instance
 * @returns {Transform} A new Transform, in which the matrix has been inverted
 */
proto.inverse = function(){
	var t = this.clone();
	t.m = mat4.invert(t.m, this.m);

	return t;
};

/**
 * @module ac-transform.Transform#inverse
 * @function
 *
 * @desc	Resets this Transform
 * @returns {Transform}
 */
proto.reset = function(){
	mat4.identity(this.m);
	return this;
};

/**
 * @module ac-transform.Transform#clone
 * @function
 *
 * @desc Clones this Transform
 * @returns {Transform}
 */
proto.clone = function(){
	var t = new Transform();
	t.m = mat4.clone( this.m );

	return t;
};

/**
 * @module ac-transform.Transform#toArray
 * @function
 *
 * @desc Returns an object containing all the values in our matrix
 * Used for animation in conjunction with fromObject
 *
 * @returns {Array}
 */
proto.toArray = function(){
	var m = this.m;
	if ( this.isAffine() ) {
		return [m[mA], m[mB], m[mC], m[mD], m[mE], m[mF]];
	}
	return [m[m11], m[m12], m[m13], m[m14], m[m21], m[m22], m[m23], m[m24],
			m[m31], m[m32], m[m33], m[m34], m[m41], m[m42], m[m43], m[m44]];
};

/**
 * @module ac-transform.Transform#fromArray
 * @function
 *
 * @desc Replaces the contents of our matrix, with the contents of this array
 * Used for animation in conjunction with toArray
 * NOTE: Assumes the array has a length of 16
 *
 * @param {Array} arr
 * @returns {Transform}
 */
proto.fromArray = function( arr ){
	this.m = Array.prototype.slice.call(arr);

	return this;
};


/**
 * @module ac-transform.Transform#setMatrixValue
 * @function
 *
 * @desc Sets the matrix via a CSS Transform string. e.g. `element.getComputedStyle().transform`
 *
 * @example
 * var t = new Transform();
 * t.setMatrixValue( window.getComputedStyle(element).transform);
 *
 * @param {String} string	String returned from getComputedStyle().transform
 * @returns {Transform}
 */
proto.setMatrixValue = function(string){
	string = String(string).trim();
	var m = mat4.create();
	if (string === 'none') {
		this.m = m;
		return this;
	}

	var type = string.slice(0, string.indexOf('(')), parts, i;
	if (type === 'matrix3d'){
		parts = string.slice(9, -1).split(',');
		for (i = 0; i < parts.length; i++) {
			m[i] = parseFloat(parts[i]);
		}
	} else if (type === 'matrix'){
		// From: https://github.com/arian/CSSMatrix/blob/master/CSSMatrix.js#L149
		// From: https://github.com/toji/gl-matrix/blob/master/src/gl-matrix/mat4.js#L928
		parts = string.slice(7, -1).split(',');
		for (i = parts.length; i--;) parts[i] = parseFloat(parts[i]);

		m[m11] = parts[0];	// m11 / A
		m[m12] = parts[1];	// m12 / B
		m[m41] = parts[4];	// m41 / C
		m[m21] = parts[2];	// m21 / D
		m[m22] = parts[3];	// m22 / E / TX
		m[m42] = parts[5];	// m42 / F / TY
	} else {
		throw new TypeError('Invalid Matrix Value');
	}

	this.m = m;

	return this;
};

/**
 * @module ac-transform.Transform#decompose
 * @function
 *
 * @desc Decomposes a 4x4 matrix returning independent Translation/Scale/Skew/Perspective/Quaternion properties.
 * If `convertToDegrees` is true, rotation and skew properties are converted from radians to degrees
 *
 * @see Algorithm converted from W3C css-transform pseudo algorithm
 * @link http://www.w3.org/TR/css3-transforms/#interpolation-of-3d-matrices
 *
 * @param {Boolean=} convertToDegrees If true, angle values will be converted from radians to degrees
 * @returns {{translation: vec3, scale: vec3, skew: vec3, perspective: vec4, quaternion: vec4, eulerRotation: vec3, axisAngle: vec3}}
 */
proto.decompose = function( convertToDegrees ){
	convertToDegrees = convertToDegrees || false;

	var matrix = mat4.clone(this.m);
	var translation = vec3.create();
	var scale = vec3.create();
	var skew = vec3.create();
	var perspective = vec4.create();
	var quaternion = vec4.create();
	var eulerRotation = vec3.create();

	// Normalize, or return null if not possible
	//if(matrix[m44] === 0 ) return null;

	for (var i=0; i<16; i++)
		matrix[i] /= matrix[m44];

	// perspectiveMatrix is used to solve for perspective, but it also provides
	// an easy way to test for singularity of the upper 3x3 component.
	var perspectiveMatrix = mat4.clone(matrix);
	perspectiveMatrix[m14] = 0;
	perspectiveMatrix[m24] = 0;
	perspectiveMatrix[m34] = 0;
	perspectiveMatrix[m44] = 1;

	//if (Math.abs(mat4.determinant(perspectiveMatrix)) < 1e-8)
	//	return false;

	var a03 = matrix[3], a13 = matrix[7], a23 = matrix[11],
		a30 = matrix[12], a31 = matrix[13], a32 = matrix[14], a33 = matrix[15];

	var rightHandSide = vec4.create();
	if ( !isZero(matrix[m14]) || !isZero(matrix[m24]) || !isZero(matrix[m34]) ) {
		// rightHandSide is the right hand side of the equation.
		rightHandSide[0] = matrix[m14];
		rightHandSide[1] = matrix[m24];
		rightHandSide[2] = matrix[m34];
		rightHandSide[3] = matrix[m44];

		// Solve the equation by inverting perspectiveMatrix and multiplying
		// rightHandSide by the inverse.
		var inversePerspectiveMatrix = mat4.invert(mat4.create(), perspectiveMatrix);
		var transposedInversePerspectiveMatrix = mat4.transpose(mat4.create(), inversePerspectiveMatrix);
		perspective = vec4.transformMat4(perspective, rightHandSide, transposedInversePerspectiveMatrix);
	} else {
		perspective = vec4.fromValues(0,0,0,1);
	}

	// TRANSLATION
	translation[0] = a30;
	translation[1] = a31;
	translation[2] = a32;

	// Now get scale and shear. 'row' is a 3 element array of 3 component vectors
	var row = [vec3.create(), vec3.create(), vec3.create()];
	row[0][0] = matrix[0];
	row[0][1] = matrix[1];
	row[0][2] = matrix[2];

	row[1][0] = matrix[4];
	row[1][1] = matrix[5];
	row[1][2] = matrix[6];

	row[2][0] = matrix[8];
	row[2][1] = matrix[9];
	row[2][2] = matrix[10];

	// Compute X scale factor and normalize first row.
	scale[0] = vec3.length(row[0]);
	vec3.normalize(row[0], row[0]);

	// Compute XY shear factor and make 2nd row orthogonal to 1st.
	skew[0] = vec3.dot(row[0], row[1]);
	row[1] = this._combine(row[1], row[0], 1.0, -skew[0]);

	// Now, compute Y scale and normalize 2nd row.
	scale[1] = vec3.length(row[1]);
	vec3.normalize(row[1], row[1]);
	skew[0] /= scale[1];

	// Compute XZ and YZ shears, orthogonalize 3rd row
	skew[1] = vec3.dot(row[0], row[2]);
	row[2] = this._combine(row[2], row[0], 1.0, -skew[1]);
	skew[2] = vec3.dot(row[1], row[2]);
	row[2] = this._combine(row[2], row[1], 1.0, -skew[2]);

	// Next, get Z scale and normalize 3rd row.
	scale[2] = vec3.length(row[2]);
	vec3.normalize(row[2], row[2]);
	skew[1] /= scale[2];
	skew[2] /= scale[2];

	// At this point, the matrix (in rows) is orthonormal.
	// Check for a coordinate system flip.  If the determinant
	// is -1, then negate the matrix and the scaling factors.
	var pdum3 = vec3.cross(vec3.create(), row[1], row[2]);
	if (vec3.dot(row[0], pdum3) < 0) {
		for (i = 0; i < 3; i++) {
			scale[i] *= -1;
			row[i][0] *= -1;
			row[i][1] *= -1;
			row[i][2] *= -1;
		}
	}

	// Now, get the rotations out
	quaternion[0] = 0.5 * Math.sqrt(Math.max(1 + row[0][0] - row[1][1] - row[2][2], 0));
	quaternion[1] = 0.5 * Math.sqrt(Math.max(1 - row[0][0] + row[1][1] - row[2][2], 0));
	quaternion[2] = 0.5 * Math.sqrt(Math.max(1 - row[0][0] - row[1][1] + row[2][2], 0));
	quaternion[3] = 0.5 * Math.sqrt(Math.max(1 + row[0][0] + row[1][1] + row[2][2], 0));

	if (row[2][1] > row[1][2])
		quaternion[0] = -quaternion[0];
	if (row[0][2] > row[2][0])
		quaternion[1] = -quaternion[1];
	if (row[1][0] > row[0][1])
		quaternion[2] = -quaternion[2];

	var axisAngle = vec4.fromValues( quaternion[0],quaternion[1],quaternion[2], 2 * Math.acos(quaternion[3]) );

	/** @type {vec3} **/
	var rotation = this._rotationFromQuat(quaternion);

	if( convertToDegrees ) {
		skew[0] = Math.round(skew[0] * radToDeg * 100)/100;
		skew[1] = Math.round(skew[1] * radToDeg * 100)/100;
		skew[2] = Math.round(skew[2] * radToDeg * 100)/100;

		rotation[0] = Math.round(rotation[0] * radToDeg * 100)/100;
		rotation[1] = Math.round(rotation[1] * radToDeg * 100)/100;
		rotation[2] = Math.round(rotation[2] * radToDeg * 100)/100;

		axisAngle[3] = Math.round(axisAngle[3] * radToDeg * 100)/100;
	}

	return {
		translation: translation,
		scale: scale,
		skew: skew,
		perspective: perspective,
		quaternion: quaternion,
		eulerRotation: rotation,
		axisAngle: axisAngle
	}
};

/**
 * Set this transform from recomposed values, if any are not supplied identity versions are supplied
 * @param {vec3|Array.<Number>} translation
 * @param {vec3|Array.<Number>} scale
 * @param {vec3|Array.<Number>} skew
 * @param {vec4|Array.<Number>} perspective
 * @param {vec4|Array.<Number>} quaternion
 *
 * @returns {Transform}
 */
proto.recompose = function(translation, scale, skew, perspective, quaternion) {
	translation = translation || vec3.create();
	scale = scale || vec3.create();
	skew = skew || vec3.create();
	perspective = perspective || vec4.create();
	quaternion = quaternion || vec4.create();

	var matrix = mat4.fromRotationTranslation(mat4.create(), quaternion, translation);

	//apply perspective
	matrix[m14] = perspective[0];
	matrix[m24] = perspective[1];
	matrix[m34] = perspective[2];
	matrix[m44] = perspective[3];

	// apply skew
	// temp is a identity 4x4 matrix initially
	var temp = mat4.create();

	if (skew[2] !== 0) {
		temp[m32] = skew[2];
		mat4.multiply(matrix, matrix, temp)
	}
	if (skew[1] !== 0) {
		temp[m32] = 0;
		temp[m31] = skew[1];
		mat4.multiply(matrix, matrix, temp);
	}

	if (skew[0]) {
		temp[m31] = 0;
		temp[4] = skew[0];
		mat4.multiply(matrix, matrix, temp)
	}

	// apply scale
	mat4.scale(matrix, matrix, scale);
	this.m = matrix;

	return this;
};

/**
 *
 * @module ac-transform.Transform#isAffine
 * @function
 * @desc Returns true if this is an affine transformation
 * @returns {Boolean}
 */
proto.isAffine = function() {
	return (this.m[m13] === 0 && this.m[m14] === 0 && this.m[m23] === 0 && this.m[m24] === 0 &&
	this.m[m31] === 0 && this.m[m32] === 0 && this.m[m33] === 1 && this.m[m34] === 0 && this.m[m43] === 0 && this.m[m44] === 1);
};

/**
 * @module ac-transform.Transform#toString
 * @function
 *
 * @desc Returns a string representation of the matrix, which can be used to apply the matrix to an element
 *
 * @example
 * element.style.transform = transform.toString();
 *
 * @return {string}
 */
proto.toString = function () {
	var m = this.m;
	if ( this.isAffine() ) {
		return 'matrix(' +	m[mA] + ', ' + m[mB] + ', ' +
			m[mC] + ', ' + m[mD] + ', ' +
			m[mE] + ', ' + m[mF] + ')';
	}
	return 'matrix3d('+ m[m11] + ', ' + m[m12] + ', ' + m[m13] + ', ' + m[m14] + ', ' +
		m[m21] + ', ' + m[m22] + ', ' + m[m23] + ', ' + m[m24] + ', ' +
		m[m31] + ', ' + m[m32] + ', ' + m[m33] + ', ' + m[m34] + ', ' +
		m[m41] + ', ' + m[m42] + ', ' + m[m43] + ', ' + m[m44] + ')';
};

/**
 * @alias ac-transform.Transform.toString
 */
proto.toCSSString = proto.toString;


/**
 * @module ac-transform.Transform#_combine
 * @function
 * @private
 *
 * @desc Helper function required for Transform.decompose
 * Creates a new vector, by interpolating A and B using the ratios supplied ascl/bscl respectively
 *
 * http://www.w3.org/TR/css3-transforms/#supporting-functions
 *
 * @param {vec3} A
 * 			Left side vec3
 * @param {vec3} B
 * 			Right side vec3
 * @param {number} ascl
 * 			Scale of vector A
 * @param bscl
 * 			Scale of vector B
 * @returns {vec3}	A new vec3 after combining A and B with the supplied ratios
 * @private
 */
proto._combine = function( A, B, ascl, bscl) {
	var result = vec3.create();
	result[0] = (ascl * A[0]) + (bscl * B[0]);
	result[1] = (ascl * A[1]) + (bscl * B[1]);
	result[2] = (ascl * A[2]) + (bscl * B[2]);

	return result;
};


/**
 * @name ac-transform.Transform#_matrix2dToMat4
 * @function
 * @private
 *
 * @desc Creates a 2d Array representation of the matrix, from a `mat4`
 * @returns {mat4}
 */
proto._matrix2dToMat4 = function( matrix ){
	var out = mat4.create();
	for (var i = 0; i < 4; i++) {
		for (var j = 0; j < 4; j++) {
			out[i * 4 + j] = matrix[i][j];
		}
	}

	return out;
};

/**
 * @name ac-transform.Transform#_mat4ToMatrix2d
 * @function
 * @private
 *
 * @desc Creates a `mat4` from a 2d array of numbers
 * @returns {Array.<Array.<number>>}
 */
proto._mat4ToMatrix2d = function( ref ) {
	var matrix = [];
	for (var i = 0; i < 4; i++) {
		matrix[i] = [];
		for (var j = 0; j < 4; j++) {
			matrix[i][j] = ref[i * 4 + j];
		}
	}

	return matrix;
};


// FROM: http://www.euclideanspace.com/maths/geometry/rotations/conversions/quaternionToAngle/
/**
 * Extracts the rotation in eulerAngles, somewhat experimental because at the poles the numbers are thrown off
 *
 * @param {quat} q
 * @returns {vec3}
 * @private
 */
proto._rotationFromQuat = function(q) {
	var sqw = q[3] * q[3];
	var sqx = q[0] * q[0];
	var sqy = q[1] * q[1];
	var sqz = q[2] * q[2];
	var unit = sqx + sqy + sqz + sqw; // if normalised is one, otherwise is correction factor
	var test = q[0] * q[1] + q[2] * q[3];

	var x, y, z;
	if (test > 0.499 * unit) { // singularity at north pole
		y = 2 * Math.atan2(q[0], q[3]);
		z = Math.PI / 2;
		x = 0;
		return vec3.fromValues(x,y,z);
	}
	if (test < -0.499 * unit) { // singularity at south pole
		y = -2 * Math.atan2(q[0], q[3]);
		z = -Math.PI / 2;
		x = 0;
		return vec3.fromValues(x,y,z);
	}
	y = Math.atan2(2 * q[1] * q[3] - 2 * q[0] * q[2], sqx - sqy - sqz + sqw);
	z = Math.asin(2 * test / unit);
	x = Math.atan2(2 * q[0] * q[3] - 2 * q[1] * q[2], -sqx + sqy - sqz + sqw);

	return vec3.fromValues(x,y,z);
};

var isZero = function( val ) {
	return Math.abs(val) < 1e-4;
};


// Create shorthand matrix accessor getter/setters - for example Transform.m11
//var accessors = {
//	m11: 0, mA: 0, m12: 1, mB: 1, m13: 2, m14: 3,
//	m21: 4, mC: 4, m22: 5, mD: 5, m23: 6, m24: 7,
//	m31: 8, m32: 9, m33: 10, m34: 11,
//	m41: 12, mE: 12, m42: 13, mF: 13, m43: 14, m44: 15
//};
//for (var key in accessors) {
//	if (!accessors.hasOwnProperty(key)) continue;
//
//	(function (myKey) {
//		Object.defineProperty(proto, key, {
//			set: function (val) {
//				this.m[myKey] = val;
//			},
//			get: function () {
//				return this.m[myKey];
//			},
//			enumerable: true,
//			configurable: true
//		});
//	})(accessors[key]);
//}


module.exports = Transform;

},{"gl-matrix":266}],269:[function(require,module,exports){
/** 
 * @module ac-eclipse
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

module.exports = {
	Clip: require('./ac-eclipse/Clip'),
	Timeline: require('./ac-eclipse/Timeline')
};

},{"./ac-eclipse/Clip":270,"./ac-eclipse/Timeline":271}],270:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
require('./helpers/Float32Array'); // stops ac-transform blowing up in old browsers
var transitionEnd = require('./helpers/transitionEnd');

/** @ignore */
var ClipEasing = require('./clips/ClipEasing');
var ClipInlineCss = require('./clips/ClipInlineCss');
var ClipTransitionCss = require('./clips/ClipTransitionCss');

/**
 * @name module:ac-eclipse.Clip
 * @class
 *
 * @desc Clip will transition properties on an object or styles on an element.
 *
 * @param {Object|Element} target
 *        The `Object` or `Element` whose properties / styles will transition / modify.
 *
 * @param {Number} duration
 *        The duration of the transition in seconds.
 *
 * @param {Object} propsTo
 *        An `Object` containing the end state of the properties you wish to
 *        transition on target.
 *
 * @param {Number} [options.delay=0]
 *        Delay in seconds before a clip will start after play has been called.
 *
 * @param {String|Function} [options.ease='ease-out']
 *        The default ease for transitions.
 *
 * @param {Clock} [options.clock=Clock]
 *        An instance of `ac-clock.Clock` to be used. Defaults to global singleton.
 *
 * @param {Object} [options.propsFrom={}]
 *        An `Object` containing the start state of the properties you wish to
 *        transition on target.
 *
 * @param {Object} [options.propsEase={}]
 *        An `Object` containing unique easing algorithms for specific properties.
 *
 * @param {Function} [options.onStart=null]
 *        A callback `Function` called when the clip starts to play.
 *
 * @param {Function} [options.onUpdate=null]
 *        A callback `Function` called when the clip has updated properties.
 *        This should be used if you require to do further calculations with the
 *        properties and not for rendering. Use `onDraw` for rendering.
 *
 * @param {Function} [options.onDraw=null]
 *        A callback `Function` called when the clip has updated properties.
 *        This should be used for rendering, e.g. drawing something to a `canvas`
 *        element.
 *
 * @param {Function} [options.onComplete=null]
 *        A callback `Function` called when the clip has finished playing.
 */
function Clip(target, duration, propsTo, options) {
	
	// if target is an element then transition css styles
	if (target.nodeType) {

		// if css transitions not supports (or inlineStyles option true) then set styles inline
		if (transitionEnd === undefined || (options && options.inlineStyles)) {
			return new ClipInlineCss(target, duration, propsTo, options);
		}

		// otherwise use css transitions to control animations
		return new ClipTransitionCss(target, duration, propsTo, options);
	}

	// used for transitioning properties on objects
	return new ClipEasing(target, duration, propsTo, options);
}

module.exports = Clip;

},{"./clips/ClipEasing":272,"./clips/ClipInlineCss":273,"./clips/ClipTransitionCss":274,"./helpers/Float32Array":276,"./helpers/transitionEnd":286}],271:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var create = require('ac-object').create;

/** @ignore */
var Clip = require('ac-clip').Clip;
var EventEmitter = require('ac-event-emitter').EventEmitter;

function Timeline(options) {
	options = options || {};
}

var proto = Timeline.prototype = create(EventEmitter.prototype);

module.exports = Timeline;

},{"ac-clip":207,"ac-event-emitter":230,"ac-object":790}],272:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var clone = require('ac-object').clone;
var create = require('ac-object').create;

/** @ignore */
var Clip = require('ac-clip').Clip;

/** @ignore */
var DEFAULT_EASE = 'ease'; // should match ac-clip.Clip.DEFAULT_EASE

/**
 * @name module:ac-eclipse.ClipEasing
 * @class
 * @extends Clip
 *
 * @desc ClipEasing basically does the same as ac-clip.Clip - transitioning properties on objects.
 *       The one difference is that ClipEasing can have different easing algorithms per property
 *       and this is set with the propsEase option (see below). To achieve this, when propsEase is
 *       set, ClipEasing will create multiple instances of ac-clip.Clip with each unqiue easing
 *       algorithm. If only one easing is used ClipEasing will work the same as Clip.
 *
 * @param {Object} target
 *        The `Object` whose properties will transition / modify.
 *
 * @param {Number} duration
 *        The duration of the transition in seconds.
 *
 * @param {Object} propsTo
 *        An `Object` containing the end state of the properties you wish to
 *        transition on target.
 *
 * @param {Number} [options.delay=0]
 *        Delay in seconds before a clip will start after play has been called.
 *
 * @param {String|Function} [options.ease='ease-out']
 *        The default ease for transitions.
 *
 * @param {Clock} [options.clock=Clock]
 *        An instance of `ac-clock.Clock` to be used. Defaults to global singleton.
 *
 * @param {Object} [options.propsFrom={}]
 *        An `Object` containing the start state of the properties you wish to
 *        transition on target.
 *
 * @param {Object} [options.propsEase={}]
 *        An `Object` containing unique easing algorithms for specific properties.
 *
 * @param {Function} [options.onStart=null]
 *        A callback `Function` called when the clip starts to play.
 *
 * @param {Function} [options.onUpdate=null]
 *        A callback `Function` called when the clip has updated properties.
 *        This should be used if you require to do further calculations with the
 *        properties and not for rendering. Use `onDraw` for rendering.
 *
 * @param {Function} [options.onDraw=null]
 *        A callback `Function` called when the clip has updated properties.
 *        This should be used for rendering, e.g. drawing something to a `canvas`
 *        element.
 *
 * @param {Function} [options.onComplete=null]
 *        A callback `Function` called when the clip has finished playing.
 */
function ClipEasing(target, duration, propsTo, options) {
	var optionsClone = clone(options || {}, true);

	var easeCount = 0;
	var groupsTo = {};
	var groupsFrom = {};
	var propsFrom = optionsClone.propsFrom || {};
	var eases = {};
	var prop, ease;

	if (optionsClone.propsEase) {
		var defaultEase = optionsClone.ease || DEFAULT_EASE;
		// create groups of props that share the same easing
		for (prop in propsTo) {
			if (propsTo.hasOwnProperty(prop)) {
				ease = optionsClone.propsEase[prop];
				if (ease === undefined) {
					// uses default ease
					if (groupsTo[defaultEase] === undefined) {
						groupsTo[defaultEase] = {};
						groupsFrom[defaultEase] = {};
						eases[defaultEase] = defaultEase;
						easeCount++;
					}
					groupsTo[defaultEase][prop] = propsTo[prop];
					groupsFrom[defaultEase][prop] = propsFrom[prop];
				}
				else if (typeof ease === 'function') {
					// uses function for ease
					// can't use function as key as will mostly match default and other
					// functions when converted to String so use the easeCount as the key
					groupsTo[easeCount] = {};
					groupsFrom[easeCount] = {};
					groupsTo[easeCount][prop] = propsTo[prop];
					groupsFrom[easeCount][prop] = propsFrom[prop];
					eases[easeCount] = ease;
					easeCount++;
				}
				else {
					// uses a predefined string
					if (groupsTo[ease] === undefined) {
						groupsTo[ease] = {};
						groupsFrom[ease] = {};
						eases[ease] = ease;
						easeCount++;
					}
					groupsTo[ease][prop] = propsTo[prop];
					groupsFrom[ease][prop] = propsFrom[prop];
				}
			}
		}
	}

	if (easeCount > 1) {
		// there is more than one ease so we group the props with the
		// same ease and create an array of clips to control them
		this._storeOnUpdate = optionsClone.onUpdate || null;
		optionsClone.onUpdate = null;

		// store the callback functions
		var storeOnStart = optionsClone.onStart;
		var storeOnDraw = optionsClone.onDraw;
		var storeOnComplete = optionsClone.onComplete;
		// then set them to null otherwise ease instance of clip per
		// ease will call them, so if we have 3 types of easing onStart
		// will get triggered 3 times (which would be undesired behaviour)
		optionsClone.onStart = null;
		optionsClone.onDraw = null;
		optionsClone.onComplete = null;

		// iterate through each group of props that share an ease
		// and create a new instance of clip for them. The progress
		// of these clips will be controlled in this._onUpdate
		this._clips = [];
		for (ease in groupsTo) {
			if (groupsTo.hasOwnProperty(ease)) {
				optionsClone.ease = eases[ease];
				optionsClone.propsFrom = groupsFrom[ease];
				this._clips.push(new Clip(target, duration, groupsTo[ease], optionsClone));
			}
		}

		// reset the callback functions as we will want them to be called with this instance of clip
		optionsClone.onUpdate = this._onUpdate;
		optionsClone.onStart = storeOnStart;
		optionsClone.onDraw = storeOnDraw;
		optionsClone.onComplete = storeOnComplete;

		// remove propsFrom as ac-clip.Clip doesn't use / need it
		optionsClone.propsFrom = null;
		// set ease to linear as ease on this doesn't matter anymore as our array of clips are doing all that work
		optionsClone.ease = 'linear';
		// set propsTo to an empty object, again, our array of clips does all that
		propsTo = {};
	}
	else {
		// we do this as the only ease isn't necessarily `options.ease` as `options.propsEase`
		// might contain same ease for all props that's different to `options.ease`
		for (prop in eases) {
			if (eases.hasOwnProperty(prop)) {
				optionsClone.ease = eases[prop];
			}
		}
	}
	
	// finally call super on ac-clip.Clip constructor
	// if easeCount is 1 then ClipEasing is basically just a regular Clip, otherwise it
	// will store an array of clips and update there progress in this._onUpdate
	Clip.call(this, target, duration, propsTo, optionsClone);
}

var proto = ClipEasing.prototype = create(Clip.prototype);

/**
 * @name module:ac-eclipse.ClipEasing#reset
 * @function
 * @override
 *
 * @desc Resets the clip and target properties.
 *
 * @returns {ClipEasing} A reference to this clip.
 */
proto.reset = function () {
	var returnValue = Clip.prototype.reset.call(this);
	if (this._clips) {
		// if we have an array of clips then reset each clip
		var i = this._clips.length;
		while (i--) {
			this._clips[i].reset();
		}
	}
	return returnValue;
};

/**
 * @name module:ac-eclipse.ClipEasing#_onUpdate
 * @function
 * @private
 *
 * @param {Object} [evt=undefined]
 */
/** @ignore */
proto._onUpdate = function (evt) {
	// this method is only called if there was multiple easing algorithms specified on instantiation
	// using `options.propsEase`. In that instance there will be an array of clips that need there
	// progress setting to match this.getProgress() (which is passed in the evt as a progress property)
	var progress = (this._direction === 1) ? evt.progress : 1 - evt.progress;
	var i = this._clips.length;
	while (i--) {
		this._clips[i].setProgress(progress);
	}

	if (typeof this._storeOnUpdate === 'function') {
		this._storeOnUpdate.call(this, evt);
	}
};

module.exports = ClipEasing;

},{"ac-clip":207,"ac-object":790}],273:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var convertToStyleObject = require('../helpers/convertToStyleObject');
var convertToTransitionableObjects = require('../helpers/convertToTransitionableObjects');
var clone = require('ac-object').clone;
var create = require('ac-object').create;
var isCssCubicBezierString = require('../helpers/isCssCubicBezierString');
var removeTransitions = require('../helpers/removeTransitions');

/** @ignore */
var BezierCurveCss = require('../helpers/BezierCurveCss');
var ClipEasing = require('./ClipEasing');
var DomStyles = require('ac-dom-styles');

/**
 * @name module:ac-eclipse.ClipInlineCss
 * @class
 * @extends ClipEasing
 *
 * @desc ClipInlineCss transitions CSS styles on an element. It extends ClipEasing to
 *       transition style properties on an object and then uses ac-dom-styles to apply
 *       these styles to a target element on Clock update.
 *
 * @param {Element} target
 *        The `Element` whose styles will transition / modify.
 *
 * @param {Number} duration
 *        The duration of the transition in seconds.
 *
 * @param {Object} propsTo
 *        An `Object` containing the end state of the properties you wish to
 *        transition on target.
 *
 * @param {Number} [options.delay=0]
 *        Delay in seconds before a clip will start after play has been called.
 *
 * @param {String|Function} [options.ease='ease-out']
 *        The default ease for transitions.
 *
 * @param {Clock} [options.clock=Clock]
 *        An instance of `ac-clock.Clock` to be used. Defaults to global singleton.
 *
 * @param {Object} [options.propsFrom={}]
 *        An `Object` containing the start state of the properties you wish to
 *        transition on target.
 *
 * @param {Object} [options.propsEase={}]
 *        An `Object` containing unique easing algorithms for specific properties.
 *
 * @param {Function} [options.onStart=null]
 *        A callback `Function` called when the clip starts to play.
 *
 * @param {Function} [options.onUpdate=null]
 *        A callback `Function` called when the clip has updated properties.
 *        This should be used if you require to do further calculations with the
 *        properties and not for rendering. Use `onDraw` for rendering.
 *
 * @param {Function} [options.onDraw=null]
 *        A callback `Function` called when the clip has updated properties.
 *        This should be used for rendering, e.g. drawing something to a `canvas`
 *        element.
 *
 * @param {Function} [options.onComplete=null]
 *        A callback `Function` called when the clip has finished playing.
 */
function ClipInlineCss(target, duration, propsTo, options) {
	var optionsClone = clone(options || {}, true);

	this._el = target;
	
	// convert the object so it can be used with clip.
	// e.g. 'width':'10px' becomes 'width':{value:'10',unit'px'}
	var converted = convertToTransitionableObjects(this._el, propsTo || {}, optionsClone.propsFrom || {});
	this._styles = converted.target;
	this._stylesFrom = converted.propsFrom;
	propsTo = converted.propsTo;
	var prop;

	// store callbacks so they can be called later in this._onStart etc
	this._storeOnStart = optionsClone.onStart || null;
	this._storeOnDraw = optionsClone.onDraw || null;
	this._storeOnComplete = optionsClone.onComplete || null;

	// set callbacks to call internal methods on this so we can write styles on start and update etc
	optionsClone.onStart = this._onStart;
	optionsClone.onDraw = this._onDraw;
	optionsClone.onComplete = this._onComplete;
	optionsClone.propsFrom = converted.propsFrom;

	if (isCssCubicBezierString(optionsClone.ease)) {
		// convert to js easing function
		optionsClone.ease = new BezierCurveCss(optionsClone.ease).toEasingFunction();
	}

	if (optionsClone.propsEase) {
		for (prop in optionsClone.propsEase) {

			if (optionsClone.propsEase.hasOwnProperty(prop) && isCssCubicBezierString(optionsClone.propsEase[prop])) {
				// convert to js easing function
				optionsClone.propsEase[prop] = new BezierCurveCss(optionsClone.propsEase[prop]).toEasingFunction();
			}
		}
	}

	// call super on ClipEasing constructor
	ClipEasing.call(this, this._styles, duration, propsTo, optionsClone);

	// if properties we are animating have css transition on them weird things happen so remove
	removeTransitions(this._el, this._styles);

	var completeStyles = (this._isYoyo) ? this._stylesFrom : propsTo;
	this._completeStyles = convertToStyleObject(completeStyles);
	// if set will generate an object of styles to remove when transition completes
	if (optionsClone.removeStylesOnComplete !== undefined) {
		var removeStyles = optionsClone.removeStylesOnComplete;
		if (typeof removeStyles === 'boolean' && removeStyles) {
			// remove all styles
			for (prop in this._completeStyles) {
				if (this._completeStyles.hasOwnProperty(prop)) {
					this._completeStyles[prop] = null;
				}
			}
		}
		else if (typeof removeStyles === 'object' && removeStyles.length) {
			// remove certain styles
			var i = removeStyles.length;
			while (i--) {
				prop = removeStyles[i];
				if (this._completeStyles.hasOwnProperty(prop)) {
					this._completeStyles[prop] = null;
				}
			}
		}
	}
}

var proto = ClipInlineCss.prototype = create(ClipEasing.prototype);

/**
 * @name module:ac-eclipse.ClipInlineCss#reset
 * @function
 * @override
 *
 * @desc Resets the clip and target properties.
 *
 * @returns {ClipInlineCss} A reference to this clip.
 */
proto.reset = function () {
	var returnValue = ClipEasing.prototype.reset.call(this);
	DomStyles.setStyle(this._el, convertToStyleObject(this._styles));
	return returnValue;
};

/**
 * @name module:ac-eclipse.ClipInlineCss#getTarget
 * @function
 * @override
 *
 * @desc Returns the target `Element`.
 *
 * @returns {Element} The target.
 */
proto.getTarget = function () {
	return this._el;
};

/**
 * @name module:ac-eclipse.ClipInlineCss#_onStart
 * @function
 * @private
 *
 * @param {Object} [evt=undefined]
 */
/** @ignore */
proto._onStart = function (evt) {
	if (this.isPlaying() && this._direction === 1) {
		DomStyles.setStyle(this._el, convertToStyleObject(this._stylesFrom));
	}
	if (typeof this._storeOnStart === 'function') {
		this._storeOnStart.call(this, evt);
	}
};

/**
 * @name module:ac-eclipse.ClipInlineCss#_onDraw
 * @function
 * @private
 *
 * @param {Object} [evt=undefined]
 */
/** @ignore */
proto._onDraw = function (evt) {
	DomStyles.setStyle(this._el, convertToStyleObject(this._styles));
	if (typeof this._storeOnDraw === 'function') {
		this._storeOnDraw.call(this, evt);
	}
};

/**
 * @name module:ac-eclipse.ClipInlineCss#_onComplete
 * @function
 * @private
 *
 * @param {Object} [evt=undefined]
 */
/** @ignore */
proto._onComplete = function (evt) {
	DomStyles.setStyle(this._el, this._completeStyles);
	if (typeof this._storeOnComplete === 'function') {
		this._storeOnComplete.call(this, evt);
	}
};

module.exports = ClipInlineCss;

},{"../helpers/BezierCurveCss":275,"../helpers/convertToStyleObject":278,"../helpers/convertToTransitionableObjects":279,"../helpers/isCssCubicBezierString":282,"../helpers/removeTransitions":283,"./ClipEasing":272,"ac-dom-styles":160,"ac-object":790}],274:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var convertToStyleObject = require('../helpers/convertToStyleObject');
var convertToTransitionableObjects = require('../helpers/convertToTransitionableObjects');
var clone = require('ac-object').clone;
var create = require('ac-object').create;
var createPredefined = require('ac-easing').createPredefined;
var isCssCubicBezierString = require('../helpers/isCssCubicBezierString');
var removeTransitions = require('../helpers/removeTransitions');
var splitUnits = require('../helpers/splitUnits');
var toCamCase = require('../helpers/toCamCase');
var transitionEnd = require('../helpers/transitionEnd');
var waitAnimationFrames = require('../helpers/waitAnimationFrames');

/** @ignore */
var BezierCurveCss = require('../helpers/BezierCurveCss');
var ClipEasing = require('./ClipEasing');
var DomStyles = require('ac-dom-styles');

/** @ignore */
var DEFAULT_EASE = 'ease'; // should match ac-eclipse.ClipEasing.DEFAULT_EASE

/**
 * @name module:ac-eclipse.ClipTransitionCss
 * @class
 * @extends ClipEasing
 *
 * @desc ClipTransitionCss transitions CSS styles on an element. As with ClipInlineCss, it
 *       extends ClipEasing to transition style properties on an object. However, instead
 *       of applying these styles on Clock update it instead uses ac-dom-styles to apply
 *       the end styles to a target element along with CSS transition properties.
 *
 * @param {Element} target
 *        The `Element` whose styles will transition / modify.
 *
 * @param {Number} duration
 *        The duration of the transition in seconds.
 *
 * @param {Object} propsTo
 *        An `Object` containing the end state of the properties you wish to
 *        transition on target.
 *
 * @param {Number} [options.delay=0]
 *        Delay in seconds before a clip will start after play has been called.
 *
 * @param {String|Function} [options.ease='ease-out']
 *        The default ease for transitions.
 *
 * @param {Clock} [options.clock=Clock]
 *        An instance of `ac-clock.Clock` to be used. Defaults to global singleton.
 *
 * @param {Object} [options.propsFrom={}]
 *        An `Object` containing the start state of the properties you wish to
 *        transition on target.
 *
 * @param {Object} [options.propsEase={}]
 *        An `Object` containing unique easing algorithms for specific properties.
 *
 * @param {Function} [options.onStart=null]
 *        A callback `Function` called when the clip starts to play.
 *
 * @param {Function} [options.onUpdate=null]
 *        A callback `Function` called when the clip has updated properties.
 *        This should be used if you require to do further calculations with the
 *        properties and not for rendering. Use `onDraw` for rendering.
 *
 * @param {Function} [options.onDraw=null]
 *        A callback `Function` called when the clip has updated properties.
 *        This should be used for rendering, e.g. drawing something to a `canvas`
 *        element.
 *
 * @param {Function} [options.onComplete=null]
 *        A callback `Function` called when the clip has finished playing.
 */
function ClipTransitionCss(target, duration, propsTo, options) {
	var optionsClone = clone(options || {}, true);

	this._el = target;

	// convert the object so it can be used with clip.
	// e.g. 'width':'10px' becomes 'width':{value:'10',unit'px'}
	var converted = convertToTransitionableObjects(this._el, propsTo || {}, optionsClone.propsFrom || {});
	this._styles = converted.target;
	this._propsTo = converted.propsTo;
	this._propsFrom = converted.propsFrom;

	// store callbacks so they can be called later
	this._storeOnStart = optionsClone.onStart || null;
	this._storeOnComplete = optionsClone.onComplete || null;
	optionsClone.onStart = this._onStart;
	optionsClone.onComplete = this._onComplete;

	optionsClone.propsFrom = this._propsFrom;
	
	this._stylesTo = clone(this._propsTo, true);
	this._stylesFrom = clone(this._propsFrom, true);

	optionsClone.ease = optionsClone.ease || DEFAULT_EASE;
	this._eases = {};
	this._propsArray = [];
	this._propsComplete = {};
	var convertedEase;
	var defaultEase;
	var styleCompleteTo = convertToStyleObject(this._stylesTo);
	var styleCompleteFrom = convertToStyleObject(this._stylesFrom);
	this._propsEase = clone(optionsClone.propsEase || {}, true);
	
	var prop;
	for (prop in this._stylesTo) {

		if (this._stylesTo.hasOwnProperty(prop)) {
			// store props as camcase
			this._propsArray[this._propsArray.length] = prop;
			this._propsComplete[toCamCase(prop)] = {
				'1': styleCompleteTo[prop],
				'-1': styleCompleteFrom[prop]
			};

			if (this._propsEase[prop] === undefined) {
				if (this._eases[optionsClone.ease] === undefined) {
					// setup default ease
					convertedEase = this._convertEase(optionsClone.ease);
					this._eases[optionsClone.ease] = convertedEase.css;
					defaultEase = convertedEase.js;
				}

				// use default
				this._propsEase[prop] = optionsClone.ease;
			}
			else if (this._eases[this._propsEase[prop]] === undefined) {
				// setup new bezier curve ease
				convertedEase = this._convertEase(this._propsEase[prop]);
				this._eases[this._propsEase[prop]] = convertedEase.css;
				optionsClone.propsEase[prop] = convertedEase.js;
			}
			else if (isCssCubicBezierString(this._propsEase[prop])) {
				// uses a cubic bezier that we already converted so just need the JS function
				optionsClone.propsEase[prop] = this._eases[this._propsEase[prop]]['1'].toEasingFunction();
			}
		}
	}

	optionsClone.ease = defaultEase;

	// call super on ClipEasing constructor
	ClipEasing.call(this, this._styles, duration, this._propsTo, optionsClone);

	// bind this._onTransitionEnded to this context
	this._onTransitionEnded = this._onTransitionEnded.bind(this);

	// listen for pause event to fire from super so we can set styles
	this.on('pause', this._onPaused);

	// remove CSS transitions that clash with properties Clip will animate
	removeTransitions(this._el, this._stylesTo);

	// store transitions that don't clash with properties Clip will animate
	// because two instances of clip might be transitioning differing properties
	this._otherTransitions = DomStyles.getStyle(this._el, 'transition').transition;
	if (this._otherTransitions === null || this._otherTransitions === 'all 0s ease 0s') {
		this._otherTransitions = '';
	}
	this._completeStyles = {
		'transition': this._otherTransitions
	};

	// if set will generate an object of styles to remove when transition completes
	if (optionsClone.removeStylesOnComplete !== undefined) {
		var removeStyles = optionsClone.removeStylesOnComplete;
		// this._removeStyles = {};
		if (typeof removeStyles === 'boolean' && removeStyles) {
			// remove all styles
			for (prop in this._stylesTo) {
				this._completeStyles[prop] = null;
			}
		}
		else if (typeof removeStyles === 'object' && removeStyles.length) {
			// remove certain styles
			var i = removeStyles.length;
			while (i--) {
				this._completeStyles[removeStyles[i]] = null;
			}
		}
	}
}

var proto = ClipTransitionCss.prototype = create(ClipEasing.prototype);

/**
 * @name module:ac-eclipse.ClipTransitionCss#reset
 * @function
 * @override
 *
 * @desc Resets the clip and target properties.
 *
 * @returns {ClipTransitionCss} A reference to this clip.
 */
proto.reset = function () {
	var returnValue = ClipEasing.prototype.reset.call(this);
	this._applyStyles(0, convertToStyleObject(this._target));
	return returnValue;
};

/**
 * @name module:ac-eclipse.ClipTransitionCss#getTarget
 * @function
 * @override
 *
 * @desc Returns the target `Element`.
 *
 * @returns {Element} The target.
 */
proto.getTarget = function () {
	return this._el;
};

/**
 * @name module:ac-eclipse.ClipTransitionCss#setProgress
 * @function
 * @override
 *
 * @desc Accepts a `Number` between 0 and 1 and will change the position of the clip.
 *
 * @param {Number} progress
 *        Accepts a Number between 0 and 1 and will change the position of the clip.
 *
 * @returns {Number} The current progress.
 */
proto.setProgress = function (progress) {
	var returnValue = ClipEasing.prototype.setProgress.call(this, progress);

	// first we set the styles immediately to using this._target which is updated in super 
	this._applyStyles(0, convertToStyleObject(this._target));

	if (this.isPlaying()) {
		// if we're playing we need to then set the end state along with transitions
		// the reason for waiting two frames here is immediately setting the styles with
		// CSS transition properties will stop the above _applyStyles to _target not be
		// instant (it will animate)
		waitAnimationFrames(function () {
			// ensure still playing - 2 frames can be a long time ;)
			if (this.isPlaying()) {
				var duration = this._duration * (1 - this.getProgress());
				var styles = convertToStyleObject((this._direction > 0) ? this._stylesTo : this._stylesFrom);
				this._applyStyles(duration, styles);
			}
		}.bind(this), 2);
	}

	return returnValue;
};

/**
 * @name module:ac-eclipse.ClipTransitionCss#_convertEase
 * @function
 * @override
 * @private
 *
 * @param {String} ease
 *
 * @returns {Object} Returns an `Object` containing converted eases.
 */
/** @ignore */
proto._convertEase = function (ease) {
	var bezierCurve;
	var jsEase;
	if (isCssCubicBezierString(ease)) {
		bezierCurve = new BezierCurveCss(ease);
		jsEase = bezierCurve.toEasingFunction();
	}
	else {
		bezierCurve = new BezierCurveCss(createPredefined(ease).cssString);
		jsEase = ease;
	}
	return {
		css: {
			'1': bezierCurve,
			'-1': bezierCurve.reversed()
		},
		js: jsEase
	};
};

/**
 * @name module:ac-eclipse.ClipTransitionCss#_complete
 * @function
 * @override
 * @private
 *
 * @fires ClipTransitionCss#complete
 */
/** @ignore */
proto._complete = function () {
	if (this._isComplete()) {
		ClipEasing.prototype._complete.call(this);
	}
	else {
		this._el.addEventListener(transitionEnd, this._onTransitionEnded);
	}
};

/**
 * @name module:ac-eclipse.ClipTransitionCss#_onTransitionEnded
 * @function
 * @private
 *
 * @fires ClipTransitionCss#complete
 */
/** @ignore */
proto._onTransitionEnded = function () {
	this._el.removeEventListener(transitionEnd, this._onTransitionEnded);
	ClipEasing.prototype._complete.call(this);
};

/**
 * @name module:ac-eclipse.ClipTransitionCss#_isComplete
 * @function
 * @private
 *
 * @returns {Boolean} Returns `false` if CSS styles don't match end state.
 */
/** @ignore */
proto._isComplete = function () {
	var styles = DomStyles.getStyle.apply(this, [this._el].concat([this._propsArray]));
	styles['transform'] = null; // ignore transform because rounding errors
	// @todo: maybe find a nice / fast way to check transform
	var target;
	var prop;
	for (prop in styles) {
		if (styles.hasOwnProperty(prop) && styles[prop] !== null) {
			target = this._propsComplete[prop][this._direction];
			// this._el.style[prop] because DomStyles returns the computed style which causes issues when using %
			// splitUnits because the complete style might be '0' (which is valid css) but DomStyles will report '0px'
			if (styles[prop] !== target && this._el.style[prop] !== target && String(splitUnits(styles[prop]).value) !== target) {
				return false;
			}
		}
	}
	return true;
};

/**
 * @name module:ac-eclipse.ClipTransitionCss#_applyStyles
 * @function
 * @private
 *
 * @param {Number} duration
 * @param {Object} styles
 */
/** @ignore */
proto._applyStyles = function (duration, styles) {
	if (duration > 0) {
		var transition = this._otherTransitions + ((this._otherTransitions.length) ? ', ' : '');
		var eases = {};
		var prop;
		for (prop in this._eases) {
			if (this._eases.hasOwnProperty(prop)) {
				// this._eases contains instances of BezierCurveCss
				// split on the current progress to return the correct css bezier curve ease
				eases[prop] = this._eases[prop][this._direction].splitAt(this.getProgress()).toCSSString();
			}
		}
		for (prop in this._stylesTo) {
			if (this._stylesTo.hasOwnProperty(prop)) {
				// iterate through each property and generate a transition string
				transition += prop + ' ' + duration + 'ms ' + eases[this._propsEase[prop]] + ' 0ms, ';
			}
		}
		styles['transition'] = transition.substr(0, transition.length-2);
	}
	else {
		// no transition if duration is 0
		styles['transition'] = this._otherTransitions;
	}

	// apply styles using ac-dom-styles
	DomStyles.setStyle(this._el, styles);
};

/**
 * @name module:ac-eclipse.ClipTransitionCss#_onPaused
 * @function
 * @private
 *
 * @param {Object} [evt=undefined]
 */
/** @ignore */
proto._onPaused = function (evt) {
	// get current styles
	var styles = DomStyles.getStyle.apply(this, [this._el].concat([this._propsArray]));
	// remove transition
	styles['transition'] = this._otherTransitions;

	DomStyles.setStyle(this._el, styles);
};

/**
 * @name module:ac-eclipse.ClipTransitionCss#_onStart
 * @function
 * @private
 *
 * @param {Object} [evt=undefined]
 */
/** @ignore */
proto._onStart = function (evt) {
	// if progress is 0 and direction is 1 then we want to initially apply the fromStyles
	// therefore, to ensure the inital styles don't animate we have to wait 2 frames before
	// apply the end state with CSS transition properties
	var waitFrames = (this._direction === 1 && this.getProgress() === 0) ? 2 : 0;
	if (waitFrames) {
		this._applyStyles(0, convertToStyleObject(this._stylesFrom));
	}

	waitAnimationFrames(function () {
		// ensure still playing - 2 frames can be a long time ;)
		if (this.isPlaying()) {
			var duration = this._duration * (1 - this.getProgress());
			var styles = convertToStyleObject((this._direction > 0) ? this._stylesTo : this._stylesFrom);
			this._applyStyles(duration, styles);
		}
	}.bind(this), waitFrames);

	if (typeof this._storeOnStart === 'function') {
		this._storeOnStart.call(this, evt);
	}
};

/**
 * @name module:ac-eclipse.ClipTransitionCss#_onComplete
 * @function
 * @private
 *
 * @param {Object} [evt=undefined]
 */
/** @ignore */
proto._onComplete = function (evt) {
	DomStyles.setStyle(this._el, this._completeStyles);
	if (typeof this._storeOnComplete === 'function') {
		this._storeOnComplete.call(this, evt);
	}
};

module.exports = ClipTransitionCss;

},{"../helpers/BezierCurveCss":275,"../helpers/convertToStyleObject":278,"../helpers/convertToTransitionableObjects":279,"../helpers/isCssCubicBezierString":282,"../helpers/removeTransitions":283,"../helpers/splitUnits":284,"../helpers/toCamCase":285,"../helpers/transitionEnd":286,"../helpers/waitAnimationFrames":287,"./ClipEasing":272,"ac-dom-styles":160,"ac-easing":222,"ac-object":790}],275:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var createBezier = require('ac-easing').createBezier;

/**
 * @name BezierCurveCss
 * @class
 *
 * @desc Stores information about a CSS cubic bezier easing curve and has useful methods
 *       for splitting and reversing etc.
 *
 * @link http://en.wikipedia.org/wiki/B%C3%A9zier_curve#Cubic_B.C3.A9zier_curves
 * @link http://dev.w3.org/csswg/css-transitions/#propdef-transition-timing-function
 *
 * @param {String|Array} curve
 *        Either a CSS cubic bezier ease `String`, e.g. `'cubic-bezier(0.0, 0.0, 1.0, 1.0)'`.
 *        Alternatively, an `Array` containing the two control points, so using the above
 *        CSS string, `[0, 0, 1, 1]`
 */
function BezierCurveCss(curve) {
	var arr;
	if (typeof curve === 'string') {
		arr = curve.match(/\d*\.?\d+/g);
		var i = arr.length;
		while (i--) {
			arr[i] = Number(arr[i]);
		}
	}
	else {
		arr = curve;
	}
	
	this.p1 = {
		x: arr[0],
		y: arr[1]
	};
	
	this.p2 = {
		x: arr[2],
		y: arr[3]
	};
}

var proto = BezierCurveCss.prototype;

/**
 * @name BezierCurveCss#splitAt
 * @function
 *
 * @desc Splits this bezier curve at a percent (0 to 1) and returns a new BezierCurveCss.
 *       Note: the percent in this instance is the time, or the x-axis of the bezier curve.
 *
 * @param {Number} percent
 *        Accepts a Number between 0 and 1 at which the bezier curver should be split.
 *
 * @returns {BezierCurveCss} A new instance of BezierCurveCss.
 */
proto.splitAt = function (percent) {

	if (percent === 0) {
		return this;
	}

	var x = [this.p1.x, this.p2.x];
	var y = [this.p1.y, this.p2.y];
	var maxIterations = 0;
	var targetX = percent;
	var min = 0;
	var max = 1;
	var startX = this._getStartX(percent, x);

	// So what's happening here? Let me try and explain...
	// CSS uses bezier curves for controlling easing of transitions. The x-axis is the time ratio
	// and the y-axis the output ratio. We want this function to split on the x-axis, as we're thinking
	// about time. Imagine an ease-in curve (0.42, 0.0, 1.00, 1.0). If you split the bezier curve at 0.5
	// you will actually be at 0.6575 on the x-axis. I'm not sure on the maths for getting the actual
	// value we want elegantly so for now we use the below (sort of brute force). It usually takes about
	// 50 iterations and runs in 0-1ms so it's not a major blocker but if you know a better way please
	// feel free to make a pull request.
	// 
	// Make sense? Probably not. Hopefully this diagram will help:
	// https://interactive-git.apple.com/github-enterprise-assets/0000/0080/0000/0508/596a7432-c904-11e4-9650-2db51bc94cfe.png
	while (targetX !== startX && maxIterations < 1000) {
		if (targetX < startX) {
			max = percent;
		}
		else {
			min = percent;
		}

		percent = min + ((max - min) * 0.5); // split min / max
		startX = this._getStartX(percent, x);

		// count iterations so we don't get a maximum call stack size exceeded error if something goes awry
		++maxIterations;
	}

	var split = this._splitBezier(percent, x, y);
	var normalized = this._normalize(split);
	return new BezierCurveCss(normalized);
};

/**
 * @name BezierCurveCss#reversed
 * @function
 *
 * @desc Inverts / rotates the bezier curve. If currently eases in the new BezierCurveCss will ease out.
 * @link http://stackoverflow.com/questions/23453721/opposite-of-ease-cubic-bezier-function
 *
 * @returns {BezierCurveCss} A new instance of BezierCurveCss.
 */
proto.reversed = function () {
	var arr = this.toArray();
	return new BezierCurveCss([
		0.5 - (arr[2] - 0.5),
		0.5 - (arr[3] - 0.5),
		0.5 - (arr[0] - 0.5),
		0.5 - (arr[1] - 0.5)
	]);
};

/**
 * @name BezierCurveCss#toArray
 * @function
 *
 * @desc Returns the anchor points in an array with a length of 4 (as the first point is always 0,0 and the last point 1,1).
 *
 * @returns {Array} The anchor points in an array.
 */
proto.toArray = function () {
	var arr = [
		this.p1.x,
		this.p1.y,
		this.p2.x,
		this.p2.y
	];
	return Array.prototype.slice.call(arr);
};

/**
 * @name BezierCurveCss#toCSSString
 * @function
 *
 * @desc Returns a string that can be used as a CSS ease, e.g. `'cubic-bezier(0.0, 0.0, 1.0, 1.0)'`.
 *
 * @returns {String} A string that can be used as a CSS ease.
 */
proto.toCSSString = function () {
	return 'cubic-bezier(' + this.p1.x + ', ' + this.p1.y + ', ' + this.p2.x + ', ' + this.p2.y + ')';
};

/**
 * @name BezierCurveCss#toEasingFunction
 * @function
 *
 * @desc Returns the equivalent JS easing function.
 *
 * @returns {Function} Equivalent JS easing function.
 */
proto.toEasingFunction = function () {
	return createBezier.apply(this, this.toArray()).easingFunction;
};

/**
 * @name BezierCurveCss#_getStartX
 * @function
 * @private
 *
 * @desc Similar to the _splitBezier function below but only returns the starting X position of the new curve.
 *
 * @param {Number} p
 *        A number between 0 and 1 representing the percent at which the curve should be split.
 *
 * @param {Array} x
 *        The x-axis control points. The start and end points are always 0 and 1 so the length
 *        of this array will always be 2 for the control points only.
 *
 * @returns {Number} todo.
 */
/** @ignore */
proto._getStartX = function (p, x) {
	var cp = p - 1;
	var p2 = p * p;
	var cp2 = cp * cp;
	var p3 = p2 * p;
	return p3 - 3*p2*cp*x[1] + 3*p*cp2*x[0];
};

/**
 * @name BezierCurveCss#_splitBezier
 * @function
 * @private
 *
 * @desc Splits a bezier curve at a percentage along it's curve. Uses De Casteljau's algorithm.
 * @link http://en.wikipedia.org/wiki/De_Casteljau%27s_algorithm
 * @link http://stackoverflow.com/questions/8369488/splitting-a-bezier-curve
 *
 * @param {Number} p
 *        A number between 0 and 1 representing the percent at which the curve should be split.
 *
 * @param {Array} x
 *        The x-axis control points. The start and end points are always 0 and 1 so the length
 *        of this array will always be 2 for the control points only.
 *
 * @param {Array} y
 *        The y-axis control points. The start and end points are always 0 and 1 so the length
 *        of this array will always be 2 for the control points only.
 *
 * @returns {Array} Returns an array of the new start and control points. End points are not
 *                  included as they will always be 1,1.
 */
/** @ignore */
proto._splitBezier = function (p, x, y) {
	var cp = p - 1;
	var p2 = p * p;
	var cp2 = cp * cp;
	var p3 = p2 * p;
	return [
		p3 - 3*p2*cp*x[1] + 3*p*cp2*x[0],	// p0.x
		p3 - 3*p2*cp*y[1] + 3*p*cp2*y[0],	// p0.y
		p2 - 2*p*cp*x[1] + cp2*x[0],		// p1.x
		p2 - 2*p*cp*y[1] + cp2*y[0],		// p1.y
		p - cp*x[1],						// p2.x
		p - cp*y[1]							// p2.y
	];
};

/**
 * @name BezierCurveCss#_normalize
 * @function
 * @private
 *
 * @desc Bezier curves used in CSS easing must always start at 0,0 and end at 1,1.
 *       What this function does is take an Array of control points and stretches it to
 *       meet this requirments.
 *
 * @param {Array} array
 *        An array of start and control points. The end points are always 1,1.
 *
 * @returns {Array} A new array of control points.
 *                  Note: that start points are not inluded as they are now 0,0.
 */
/** @ignore */
proto._normalize = function (array) {
	return [
		(array[2] - array[0]) / (1 - array[0]),	// p1.x
		(array[3] - array[1]) / (1 - array[1]),	// p1.y
		(array[4] - array[0]) / (1 - array[0]),	// p2.x
		(array[5] - array[1]) / (1 - array[1])	// p2.y
	];
};

module.exports = BezierCurveCss;

},{"ac-easing":222}],276:[function(require,module,exports){
// Currently include ac-transform causing old IE to fall over because Float32Array is undefined
if (typeof window.Float32Array === 'undefined') {
	window.Float32Array = function () {};
}

},{}],277:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var splitUnits = require('./splitUnits');

/** @ignore */
// var Transform = require('ac-transform').Transform;

/**
 * @name TransformMatrix
 * @class
 *
 * @desc TransformMatrix is a sort of wrapper for ac-transform. It takes an object
 *       of styles and applies them to an instance of Transform
 *
 * @param {Transform} transform
 *        An instance of ac-transform.Transform.
 *
 * @param {Object} styles
 *        An object containing css transform partial properties, e.g. translateX.
 */
function TransformMatrix(transform, styles) {
	this._transform = transform;
	var prop;
	for (prop in styles) {
		if (styles.hasOwnProperty(prop) && typeof this._transform[prop] === 'function') {
			this._transform[prop].call(this._transform, splitUnits(styles[prop]).value);
		}
	}
}

var proto = TransformMatrix.prototype;

/**
 * @name TransformMatrix#toArray
 * @function
 *
 * @desc Returns the transform matrix as an Array.
 *
 * @returns {Array}
 */
proto.toArray = function () {
	return this._transform.toArray();
};

/**
 * @name TransformMatrix#toCSSString
 * @function
 *
 * @desc Returns the transform matrix as a CSS compatible string.
 *
 * @returns {String}
 */
proto.toCSSString = function () {
	return this._transform.toCSSString();
};

module.exports = TransformMatrix;

},{"./splitUnits":284}],278:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name convertToStyleObject
 * @function
 * 
 * @desc Convert a transitional styles object into actual CSS styles.
 *
 * @param {Object} target
 *        The object of transitional style properties to convert.
 *
 * @returns {Object} An object containing CSS styles.
 */
module.exports = function convertToStyleObject (target) {
	var styles = {};
	var prop;
	for (prop in target) {
		if (target.hasOwnProperty(prop) && target[prop] !== null) {
			if (target[prop].isColor) {
				styles[prop] = 'rgb(' + Math.round(target[prop].r) + ', ' + 
										Math.round(target[prop].g) + ', ' + 
										Math.round(target[prop].b) + ')';
			}
			else if (prop === 'transform') {
				styles[prop] = 'matrix(' + target[prop].join(',') + ')';
			}
			else {
				styles[prop] = target[prop].value + target[prop].unit;
			}
		}
	}
	return styles;
};

},{}],279:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var clone = require('ac-object').clone;
var cssColorNames = require('./cssColorNames');
var splitUnits = require('./splitUnits');
var toCamCase = require('./toCamCase');

/** @ignore */
var ColorUtils = require('ac-color');
var DomStyles = require('ac-dom-styles');
var Feature = require('ac-feature');
var Transform = require('ac-transform').Transform;
var TransformMatrix = require('./TransformMatrix');

// takes a color (hex, color name (e.g. red) etc)
// and returns an RGB object
var toRgbObject = function (color) {
	if (cssColorNames[color]) {
		color = cssColorNames[color];
	}
	else {
		if (ColorUtils.isHex(color)) {
			color = ColorUtils.hexToRgb(color);
		}
		color = ColorUtils.rgbToObject(color);
	}
	color['isColor'] = true;
	return color;
};

/**
 * @name convertToTransitionableObjects
 * @function
 * 
 * @desc Converts objects containing CSS styles into objects that ac-clip.Clip can use / transition.
 *
 * @param {Element} el
 *        The element that will be used to get inital / target styles (the element that will be transitioned).
 *
 * @param {Object} propsTo
 *        The CSS styles that will be transitioned to.
 *
 * @param {Object} propsFrom
 *        The CSS styles that will be a start state when the clip starts. Defaults to the current styles of el.
 *
 * @returns {Object} An object containing transitionable styles broken into target, propsTo and propsFrom.
 */
module.exports = function convertToTransitionableObjects (el, propsTo, propsFrom) {

	var target = {};
	propsTo = clone(propsTo, true);
	propsFrom = clone(propsFrom, true);
	
	var style;	
	var mTarget, mTo, mFrom;
	var isTransformSupported = Feature.cssPropertyAvailable('transform');

	var prop;
	// first loop through each propTo value
	for (prop in propsTo) {
		if (propsTo.hasOwnProperty(prop) && propsTo[prop] !== null) {
			if (prop === 'transform') {
				if (isTransformSupported) {
					// Transform is a JS implementation of the CSS3-Transforms spec
					mTarget = new Transform();
					style = DomStyles.getStyle(el, 'transform')['transform'] || 'none';
					mTarget.setMatrixValue(style);
					// if transform should be relative use mTarget.clone() instead of new Transform()
					mTo = new TransformMatrix(new Transform(), propsTo[prop]);
				}
				if (mTo && mTo.toCSSString() !== mTarget.toCSSString()) {
					mFrom = new TransformMatrix(propsFrom[prop] ? new Transform() : mTarget.clone(), propsFrom[prop]);
					target[prop] = mTarget.toArray();
					propsTo[prop] = mTo.toArray();
					propsFrom[prop] = mFrom.toArray();
				}
				else {
					// transforms not supported
					target[prop] = null;
					propsTo[prop] = null;
				}
			}
			else {
				style = DomStyles.getStyle(el, prop)[toCamCase(prop)];
				if (ColorUtils.isColor(style)) {
					// for colors convert to RGB and use an object
					target[prop] = toRgbObject(style);
					propsFrom[prop] = (propsFrom[prop] !== undefined) ? toRgbObject(propsFrom[prop]) : clone(target[prop], true);
					propsTo[prop] = toRgbObject(propsTo[prop]);
				}
				else {
					// splitUnits takes a CSS value (e.g. 10px) and breaks it into an object ({ value:10, unit:'px' })
					target[prop] = splitUnits(style);
					propsFrom[prop] = (propsFrom[prop] !== undefined) ? splitUnits(propsFrom[prop]) : clone(target[prop], true);
					propsTo[prop] = splitUnits(propsTo[prop]);
				}
			}
		}
	}

	// next we loop through propsFrom and if a propsFrom doesn't have a propsTo we add propsTo to match the current state of target
	for (prop in propsFrom) {
		if (propsFrom.hasOwnProperty(prop) && propsFrom[prop] !== null && (propsTo[prop] === undefined || propsTo[prop] === null)) {
			if (prop === 'transform') {
				if (isTransformSupported) {
					// Transform is a JS implementation of the CSS3-Transforms spec
					mTarget = new Transform();
					mTarget.setMatrixValue(getComputedStyle(el).transform || getComputedStyle(el).webkitTransform || 'none');
					// if transform should be relative use mTarget.clone() instead of new Transform()
					mFrom = new TransformMatrix(new Transform(), propsFrom[prop]);
				}
				if (mFrom && mFrom.toCSSString() !== mTarget.toCSSString()) {
					mTo = new TransformMatrix(mTarget.clone());
					target[prop] = mTarget.toArray();
					propsTo[prop] = mTo.toArray();
					propsFrom[prop] = mFrom.toArray();
				}
				else {
					// transforms not supported
					target[prop] = null;
					propsTo[prop] = null;
					propsFrom[prop] = null;
				}
			}
			else {
				style = DomStyles.getStyle(el, prop)[toCamCase(prop)];
				if (ColorUtils.isColor(style)) {
					// for colors convert to RGB and use an object
					target[prop] = toRgbObject(style);
					propsTo[prop] = clone(target[prop], true);
					propsFrom[prop] = toRgbObject(propsFrom[prop]);
				}
				else {
					// splitUnits takes a CSS value (e.g. 10px) and breaks it into an object ({ value:10, unit:'px' })
					target[prop] = splitUnits(style);
					propsFrom[prop] = splitUnits(propsFrom[prop]);
					propsTo[prop] = clone(target[prop], true);
				}
			}

		}
	}

	return {
		target: target,
		propsTo: propsTo,
		propsFrom: propsFrom
	};
};

},{"./TransformMatrix":277,"./cssColorNames":280,"./splitUnits":284,"./toCamCase":285,"ac-color":209,"ac-dom-styles":160,"ac-feature":241,"ac-object":790,"ac-transform":267}],280:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

// CSS color alias' to RGB object.
// Allows people to used 'red' etc with eclipse.
var cssColorNames = {
	aqua: {r: 0, g: 255, b: 255},
	aliceblue: {r: 240, g: 248, b: 255},
	antiquewhite: {r: 250, g: 235, b: 215},
	black: {r: 0, g: 0, b: 0},
	blue: {r: 0, g: 0, b: 255},
	cyan: {r: 0, g: 255, b: 255},
	darkblue: {r: 0, g: 0, b: 139},
	darkcyan: {r: 0, g: 139, b: 139},
	darkgreen: {r: 0, g: 100, b: 0},
	darkturquoise: {r: 0, g: 206, b: 209},
	deepskyblue: {r: 0, g: 191, b: 255},
	green: {r: 0, g: 128, b: 0},
	lime: {r: 0, g: 255, b: 0},
	mediumblue: {r: 0, g: 0, b: 205},
	mediumspringgreen: {r: 0, g: 250, b: 154},
	navy: {r: 0, g: 0, b: 128},
	springgreen: {r: 0, g: 255, b: 127},
	teal: {r: 0, g: 128, b: 128},
	midnightblue: {r: 25, g: 25, b: 112},
	dodgerblue: {r: 30, g: 144, b: 255},
	lightseagreen: {r: 32, g: 178, b: 170},
	forestgreen: {r: 34, g: 139, b: 34},
	seagreen: {r: 46, g: 139, b: 87},
	darkslategray: {r: 47, g: 79, b: 79},
	darkslategrey: {r: 47, g: 79, b: 79},
	limegreen: {r: 50, g: 205, b: 50},
	mediumseagreen: {r: 60, g: 179, b: 113},
	turquoise: {r: 64, g: 224, b: 208},
	royalblue: {r: 65, g: 105, b: 225},
	steelblue: {r: 70, g: 130, b: 180},
	darkslateblue: {r: 72, g: 61, b: 139},
	mediumturquoise: {r: 72, g: 209, b: 204},
	indigo: {r: 75, g: 0, b: 130},
	darkolivegreen: {r: 85, g: 107, b: 47},
	cadetblue: {r: 95, g: 158, b: 160},
	cornflowerblue: {r: 100, g: 149, b: 237},
	mediumaquamarine: {r: 102, g: 205, b: 170},
	dimgray: {r: 105, g: 105, b: 105},
	dimgrey: {r: 105, g: 105, b: 105},
	slateblue: {r: 106, g: 90, b: 205},
	olivedrab: {r: 107, g: 142, b: 35},
	slategray: {r: 112, g: 128, b: 144},
	slategrey: {r: 112, g: 128, b: 144},
	lightslategray: {r: 119, g: 136, b: 153},
	lightslategrey: {r: 119, g: 136, b: 153},
	mediumslateblue: {r: 123, g: 104, b: 238},
	lawngreen: {r: 124, g: 252, b: 0},
	aquamarine: {r: 127, g: 255, b: 212},
	chartreuse: {r: 127, g: 255, b: 0},
	gray: {r: 128, g: 128, b: 128},
	grey: {r: 128, g: 128, b: 128},
	maroon: {r: 128, g: 0, b: 0},
	olive: {r: 128, g: 128, b: 0},
	purple: {r: 128, g: 0, b: 128},
	lightskyblue: {r: 135, g: 206, b: 250},
	skyblue: {r: 135, g: 206, b: 235},
	blueviolet: {r: 138, g: 43, b: 226},
	darkmagenta: {r: 139, g: 0, b: 139},
	darkred: {r: 139, g: 0, b: 0},
	saddlebrown: {r: 139, g: 69, b: 19},
	darkseagreen: {r: 143, g: 188, b: 143},
	lightgreen: {r: 144, g: 238, b: 144},
	mediumpurple: {r: 147, g: 112, b: 219},
	darkviolet: {r: 148, g: 0, b: 211},
	palegreen: {r: 152, g: 251, b: 152},
	darkorchid: {r: 153, g: 50, b: 204},
	yellowgreen: {r: 154, g: 205, b: 50},
	sienna: {r: 160, g: 82, b: 45},
	brown: {r: 165, g: 42, b: 42},
	darkgray: {r: 169, g: 169, b: 169},
	darkgrey: {r: 169, g: 169, b: 169},
	greenyellow: {r: 173, g: 255, b: 47},
	lightblue: {r: 173, g: 216, b: 230},
	paleturquoise: {r: 175, g: 238, b: 238},
	lightsteelblue: {r: 176, g: 196, b: 222},
	powderblue: {r: 176, g: 224, b: 230},
	firebrick: {r: 178, g: 34, b: 34},
	darkgoldenrod: {r: 184, g: 134, b: 11},
	mediumorchid: {r: 186, g: 85, b: 211},
	rosybrown: {r: 188, g: 143, b: 143},
	darkkhaki: {r: 189, g: 183, b: 107},
	silver: {r: 192, g: 192, b: 192},
	mediumvioletred: {r: 199, g: 21, b: 133},
	indianred: {r: 205, g: 92, b: 92},
	peru: {r: 205, g: 133, b: 63},
	chocolate: {r: 210, g: 105, b: 30},
	tan: {r: 210, g: 180, b: 140},
	lightgray: {r: 211, g: 211, b: 211},
	lightgrey: {r: 211, g: 211, b: 211},
	thistle: {r: 216, g: 191, b: 216},
	goldenrod: {r: 218, g: 165, b: 32},
	orchid: {r: 218, g: 112, b: 214},
	palevioletred: {r: 219, g: 112, b: 147},
	crimson: {r: 220, g: 20, b: 60},
	gainsboro: {r: 220, g: 220, b: 220},
	plum: {r: 221, g: 160, b: 221},
	burlywood: {r: 222, g: 184, b: 135},
	lightcyan: {r: 224, g: 255, b: 255},
	lavender: {r: 230, g: 230, b: 250},
	darksalmon: {r: 233, g: 150, b: 122},
	palegoldenrod: {r: 238, g: 232, b: 170},
	violet: {r: 238, g: 130, b: 238},
	azure: {r: 240, g: 255, b: 255},
	honeydew: {r: 240, g: 255, b: 240},
	khaki: {r: 240, g: 230, b: 140},
	lightcoral: {r: 240, g: 128, b: 128},
	sandybrown: {r: 244, g: 164, b: 96},
	beige: {r: 245, g: 245, b: 220},
	mintcream: {r: 245, g: 255, b: 250},
	wheat: {r: 245, g: 222, b: 179},
	whitesmoke: {r: 245, g: 245, b: 245},
	ghostwhite: {r: 248, g: 248, b: 255},
	lightgoldenrodyellow: {r: 250, g: 250, b: 210},
	linen: {r: 250, g: 240, b: 230},
	salmon: {r: 250, g: 128, b: 114},
	oldlace: {r: 253, g: 245, b: 230},
	bisque: {r: 255, g: 228, b: 196},
	blanchedalmond: {r: 255, g: 235, b: 205},
	coral: {r: 255, g: 127, b: 80},
	cornsilk: {r: 255, g: 248, b: 220},
	darkorange: {r: 255, g: 140, b: 0},
	deeppink: {r: 255, g: 20, b: 147},
	floralwhite: {r: 255, g: 250, b: 240},
	fuchsia: {r: 255, g: 0, b: 255},
	gold: {r: 255, g: 215, b: 0},
	hotpink: {r: 255, g: 105, b: 180},
	ivory: {r: 255, g: 255, b: 240},
	lavenderblush: {r: 255, g: 240, b: 245},
	lemonchiffon: {r: 255, g: 250, b: 205},
	lightpink: {r: 255, g: 182, b: 193},
	lightsalmon: {r: 255, g: 160, b: 122},
	lightyellow: {r: 255, g: 255, b: 224},
	magenta: {r: 255, g: 0, b: 255},
	mistyrose: {r: 255, g: 228, b: 225},
	moccasin: {r: 255, g: 228, b: 181},
	navajowhite: {r: 255, g: 222, b: 173},
	orange: {r: 255, g: 165, b: 0},
	orangered: {r: 255, g: 69, b: 0},
	papayawhip: {r: 255, g: 239, b: 213},
	peachpuff: {r: 255, g: 218, b: 185},
	pink: {r: 255, g: 192, b: 203},
	red: {r: 255, g: 0, b: 0},
	seashell: {r: 255, g: 245, b: 238},
	snow: {r: 255, g: 250, b: 250},
	tomato: {r: 255, g: 99, b: 71},
	white: {r: 255, g: 255, b: 255},
	yellow: {r: 255, g: 255, b: 0},
	rebeccapurple: {r: 102, g: 51, b: 153}
};

module.exports = cssColorNames;

},{}],281:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name getShorthandTransition
 * @function
 * 
 * @desc Converts an object containing longhand CSS transition properties into a shorthand string.
 *
 * @param {Object} styles
 *        An object containing longhand CSS transition properties:
 *        transitionProperty, transitionDuration, transitionTimingFunction, transitionDelay.
 *
 * @returns {String} Transition properties as shorthand.
 */
module.exports = function getShorthandTransition (styles) {
	if (styles.transitionProperty) {
		var transition = '';
		var props = styles.transitionProperty.split(', ');
		var duration = styles.transitionDuration.split(', ');
		var ease = styles.transitionTimingFunction.replace(/\d+[,]+[\s]/gi, function (match) {
			return match.substr(0, match.length-1);
		}).split(', ');
		var delay = styles.transitionDelay.split(', ');

		var i = props.length;
		while (i--) {
			transition += props[i] + ' ' + duration[i] + ' ' + ease[i] + ' ' + delay[i] + ', ';
		}

		return transition.substr(0, transition.length - 2);
	}

	return false;
};

},{}],282:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name isCssCubicBezierString
 * @function
 * 
 * @desc Returns a boolean depending if a string starts with 'cubic-bezier('.
 *       Essentially, is an easing string cubic-bezier or predefined easing name like 'ease-out'.
 *
 * @param {String} str
 *        An easing string (e.g. 'ease-out' or 'cubic-bezier(...)'.
 *
 * @returns {Boolean} `true` if the string starts with 'cubic-bezier(', else `false`
 */
module.exports = function isCssCubicBezierString (str) {
	return typeof str === 'string' && str.substr(0, 13) === 'cubic-bezier(';
};

},{}],283:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var getShorthandTransition = require('./getShorthandTransition');

/** @ignore */
var DomStyles = require('ac-dom-styles');

/**
 * @name removeTransitions
 * @function
 *
 * @desc Removes any CSS transitions that already exist for properties that
 *       will be transitioned using Clip.
 *
 * @param {Element} el
 *        The element from which to get the CSS transition property.
 *
 * @param {Object} propsTo
 *        An object containing which properties will be transitioned / removed.
 */
module.exports = function removeTransitions (el, propsTo) {
	var transition = DomStyles.getStyle(el, 
		'transition',
		'transition-property',
		'transition-duration',
		'transition-timing-function',
		'transition-delay'
	);
	// DomStyles returns an object, if transition is undefined then instead get shorthand transitions
	transition = transition.transition || getShorthandTransition(transition);

	if (transition && transition.length) {
		transition = transition.split(',');
		var deleteCount = 0;
		var prop;
		var i = transition.length;
		while (i--) {
			prop = transition[i].trim().split(' ')[0];
			if (propsTo[prop] !== undefined) {
				transition.splice(i, 1);
				++deleteCount;
			}
		}
		if (deleteCount) {
			if (transition.length === 0) {
				transition = ['all'];
			}
			DomStyles.setStyle(el, {
				'transition': transition.join(',').trim()
			});
		}
	}
};

},{"./getShorthandTransition":281,"ac-dom-styles":160}],284:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name splitUnits
 * @function
 * 
 * @desc Takes a value with units and splits it into an object.
 *       E.g. '10px' becomes the object { value:10, units:'px' }
 *
 * @param {String} value
 *        The value to be converted into an object, e.g. '10px'.
 *
 * @returns {Object} The return object, contains 'value' and 'units'
 *                   e.g. { value:10, units:'px' }.
 */
module.exports = function splitUnits (value) {

	value = String(value);
	if (value.indexOf(' ') > -1) {
		throw new Error('Shorthand CSS is not supported. Please use longhand CSS only.');
	}

	var regex = /(\d*\.?\d*)(.*)/;
	var multipler = 1;

	if (value && value.substr(0, 1) === '-') {
		// if the value is negative
		value = value.substr(1);
		multipler = -1;
	}

	var match = String(value).match(regex);

	return {
		value: Number(match[1]) * multipler,
		unit: match[2]
	};
};

},{}],285:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name toCamCase
 * @function
 * 
 * @desc Simply converts a dash seperated string to camel case.
 *       E.g. background-color becomes backgroundColor
 *
 * @param {String} str
 *        Input string, e.g. background-color
 *
 * @returns {String} Output string, e.g. backgroundColor.
 */
module.exports = function toCamCase (str) {

	var camelCaseReplace = function (match, group, offset, string) {
		return (offset === 0) && (string.substr(1, 3) !== 'moz') ? group : group.toUpperCase();
	};

	return str.replace(/-(\w)/g, camelCaseReplace);
};

},{}],286:[function(require,module,exports){
'use strict';

var transitionEnd;

/* From Modernizr */
module.exports = (function transitionEndEvent () {

	if (transitionEnd) {
		return transitionEnd;
	}

	var t;
	var el = document.createElement('fakeelement');
	var transitions = {
		'transition':'transitionend',
		'OTransition':'oTransitionEnd',
		'MozTransition':'transitionend',
		'WebkitTransition':'webkitTransitionEnd'
	};

	for (t in transitions) {
		if ( el.style[t] !== undefined ) {
			transitionEnd = transitions[t];
			return transitionEnd;
		}
	}
})();

},{}],287:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name waitAnimationFrames
 * @function
 * 
 * @desc Waits n amount of animation frames before triggering a callback function.
 *       This exists because when applying CSS styles to dom elements in certain
 *       browsers it takes more than one requestAnimationFrame to apply the styles.
 *       The issue is when using CSS transition - if you need to set an initial state
 *       and then animate to an end start using CSS transitions you need to wait 2
 *       frames otherwise the browser will animate to the initial state.
 *
 * @param {Function} callback
 *        The function to be called.
 *
 * @param {Number} frames
 *        The amount of frames to wait until triggering the callback.
 */
module.exports = function waitAnimationFrames (callback, frames) {
	if (frames) {
		var count = 0;
		var waitFunc = function () {
			if (count === frames) {
				callback.call(this);
			}
			else {
				++count;
				window.requestAnimationFrame(waitFunc);
			}
		};
		waitFunc();
	}
	else {
		callback.call(this);
	}
};

},{}],288:[function(require,module,exports){
/** 
 * @module ac-array
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

module.exports = {
	flatten:      require('./ac-array/flatten'),
	intersection: require('./ac-array/intersection'),
	toArray:      require('./ac-array/toArray'),
	union:        require('./ac-array/union'),
	unique:       require('./ac-array/unique'),
	without:      require('./ac-array/without')
};

},{"./ac-array/flatten":289,"./ac-array/intersection":290,"./ac-array/toArray":291,"./ac-array/union":292,"./ac-array/unique":293,"./ac-array/without":294}],289:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name module:ac-array.flatten
 *
 * @function
 * 
 * @desc Take a multi-dimensional array and flatten it into a single level.
 *
 * @param {Array} array
 *        Take a multi-dimensional array and flatten it into a single level
 *
 * @returns {Array} Flattened array.
 */
module.exports = function flatten (array) {
	var flattenedArray = [];
	var callback = function (item) {
		if (Array.isArray(item)) {
			item.forEach(callback);
		} else {
			flattenedArray.push(item);
		}
	};
	array.forEach(callback);
	return flattenedArray;
};

},{}],290:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name module:ac-array.intersection
 *
 * @function
 * 
 * @desc Produce an array that contains every item shared between all the passed-in arrays.
 *       Based on: https://github.com/jashkenas/underscore/blob/master/underscore.js#L525
 *
 * @param {...Array} array
 *        Any number of arrays
 *
 * @returns {Array} An empty array if no matches or an array containing all matches.
 */
module.exports = function intersection (array) {
	// If nothing was passed return an empty array
	if (!array) {
		return [];
	}
	var argsLength = arguments.length;
	var i = 0;
	var len = array.length;
	var result = [];
	var item;

	for(i; i < len; i++) {
		item = array[i];

		// If item has already been pushed continue on to the next iteration
		if (result.indexOf(item) > -1) {
			continue;
		}

		// If the item does not exist in the arguments index break;
		for(var j = 1; j < argsLength; j++) {
			if (arguments[j].indexOf(item) < 0) {
				break;
			}
		}

		// If all arguments have been matched push the item into the result
		if (j === argsLength) {
			result.push(item);
		}
	}

	return result;
};

},{}],291:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name module:ac-array.toArray
 *
 * @function
 * 
 * @desc Take an Array-like object and convert it to an actual Array.
 *
 * @param {Object} arrayLike
 *        Take an Array-like object and convert it to an actual Array
 *        (for instance a NodeList)
 *
 * @returns {Array} Generated array from object.
 */
module.exports = function toArray (arrayLike) {
	return Array.prototype.slice.call(arrayLike);
};

},{}],292:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var flatten = require('./flatten');
var unique = require('./unique');

/**
 * @name module:ac-array.union
 *
 * @function
 * 
 * @desc Creates a union of unique values of the provided arrays.
 *
 * @param {...Array} array
 *        The array(s) to create a union of
 *
 * @returns {Array} An array containing the union of the provided arrays.
 */
module.exports = function union (array) {
	return unique(flatten(Array.prototype.slice.call(arguments)));
};

},{"./flatten":289,"./unique":293}],293:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name module:ac-array.unique
 *
 * @function
 * 
 * @desc Takes an array containing duplicates and returns a new
 *       array containing only unique values.
 *
 * @param {Array} array
 *        An array containing duplicate values
 *
 * @returns {Array} An array containing only unique values.
 */
module.exports = function unique (array) {
	var _unique = function(prev, current) {
		if (prev.indexOf(current) < 0) {
			prev.push(current);
		}
		return prev;
	};
	return array.reduce(_unique, []);
};

},{}],294:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name module:ac-array.without
 *
 * @function
 * 
 * @desc Removes an entry from an array.
 *
 * @param {Array} arr
 *        Source array
 *
 * @param {*} value
 *        Entry in array to remove
 *
 * @returns {Array} A new array that is the source array without the first
 *                  instance of the value provided.
 */
module.exports = function without (arr, value, recurse) {
	var newArr;
	var index = arr.indexOf(value);
	var length = arr.length;

	if (index >= 0) {

		// iterating through the array will be faster than calling .without() over and over
		if(recurse) {
			// clone the arr to newArr
			newArr = arr.slice(0, length);
			// start at the first index and continue
			var i,
				amountRemoved = 0;
			for (i = index; i < length; i++) {
				// if the value matches, remove it from the newArr
				if (arr[ i ] === value) {
					newArr.splice(i - amountRemoved, 1);
					// add one to the amountRemoved to handle the difference between arr and newArr
					amountRemoved++;
				}
			}

		// If it’s the last item
		} else if (index === (length - 1)) {
			newArr = arr.slice(0, (length - 1));

		// If it’s the first item
		} else if (index === 0) {
			newArr = arr.slice(1);

		// If it’s in the middle
		} else {
			newArr = arr.slice(0, index);
			newArr = newArr.concat(arr.slice(index + 1));
		}

	} else {
		return arr;
	}

	return newArr;
};

},{}],295:[function(require,module,exports){
module.exports.DOMEmitter = require("./ac-dom-emitter/DOMEmitter");
},{"./ac-dom-emitter/DOMEmitter":296}],296:[function(require,module,exports){
/*global module */
'use strict';
var proto;

var EventEmitter = require('ac-event-emitter').EventEmitter;

/**
 * @name .DOMEmitter
 * @class DOMEmitter
 * <pre>DOMEmitter = require('/DOMEmitter');</pre>
 */

var internalEventPrefix = 'dom-emitter';

function DOMEmitter( el ) {
    if ( el === null ) {
        return;
    }
    this.el = el;
    this._bindings = {};
    this._eventEmitter = new EventEmitter();
}


proto = DOMEmitter.prototype;

proto._parseEventNames = function( evt ) {
    // handle any undefined/nulls and send em back
    if ( !evt ) {
        return [ evt ];
    }
    return evt.split(' ');
};

proto._onListenerEvent = function( evtName, e ) {
    this.trigger( evtName, e, false );
};

proto._setListener = function( evt ) {
    this._bindings[ evt ] = this._onListenerEvent.bind( this, evt );
    this._addEventListener( evt, this._bindings[ evt ] );
};

proto._removeListener = function( evt ) {
    this._removeEventListener( evt, this._bindings[ evt ] );
    delete this._bindings[ evt ];
};

proto._addEventListener = function( evt, func, useCapture ) {
    if ( this.el.addEventListener ) {
        this.el.addEventListener( evt, func, useCapture );
    } else if ( this.el.attachEvent ) {
        this.el.attachEvent( 'on' + evt, func );
    } else {
        target[ 'on' + evt ] = func;
    }
    return this;
};

proto._removeEventListener = function( evt, func, useCapture ) {
   if ( this.el.removeEventListener ) {
        this.el.removeEventListener( evt, func, useCapture );
    } else {
        this.el.detachEvent( 'on' + evt, func );
    }

    return this;
};

proto._triggerInternalEvent = function( evt, data ) {
    this.trigger( internalEventPrefix + ':' + evt, data );
};

proto.on = function( evts, callback, context ) {
    evts = this._parseEventNames( evts );
    evts.forEach( function( callback, context, evt ) {

        if ( !this.has( evt ) ) {
            this._setListener( evt );
        }

         this._triggerInternalEvent( 'willon', {
            evt : evt,
            callback : callback,
            context : context
        });

        this._eventEmitter.on( evt, callback, context );
       
        this._triggerInternalEvent( 'didon', {
            evt : evt,
            callback : callback,
            context : context
        });

    }.bind( this, callback, context ));

    return this;
};

proto.off = function( evts, callback, context ) {
    var args = Array.prototype.slice.call( arguments, 0 );
    evts = this._parseEventNames( evts );
    evts.forEach( function( callback, context, args, evt ) {

        // Handle unbinding all events ( this.off(); )
        if ( args.length === 0 ) {
            this._eventEmitter.off();

            // for each event, unbind it
            var i;
            for ( i in this._bindings ) {
                if ( this._bindings.hasOwnProperty( i ) ) {
                    this._removeListener( i );
                }
            }
            return;
        }

        this._triggerInternalEvent( 'willoff', {
            evt : evt,
            callback : callback,
            context : context
        });

        this._eventEmitter.off( evt, callback, context );
        
        this._triggerInternalEvent( 'didoff', {
            evt : evt,
            callback : callback,
            context : context
        });

        // for specific events
        if ( !this.has( evt ) ) {
            this._removeListener( evt );
        }
            
    }.bind( this, callback, context, args ));

    return this;
};

proto.once = function( evts, callback, context ) {
    evts = this._parseEventNames( evts );
    evts.forEach( function( callback, context, evt ) {
        
        if ( !this.has( evt ) ) {
            this._setListener( evt );
        }
        
        this._triggerInternalEvent( 'willonce', {
            evt : evt,
            callback : callback,
            context : context
        });

        this._eventEmitter.once.call( this, evt, callback, context );
        
        this._triggerInternalEvent( 'didonce', {
            evt : evt,
            callback : callback,
            context : context
        });

    }.bind( this, callback, context ));

    return this;
};

proto.has = function( evt, callback, context ) {
    if ( this._eventEmitter && this._eventEmitter.has.apply( this._eventEmitter, arguments ) ) {
        return true;
    }
    return false;
};

proto.trigger = function( evts, data, doNotPropogate ) {
    evts = this._parseEventNames( evts );
    evts.forEach( function( data, doNotPropogate, evt ) {
        this._eventEmitter.trigger( evt, data, doNotPropogate );
    }.bind( this, data, doNotPropogate ));

    return this;
    
};

proto.destroy = function() {
    this._triggerInternalEvent( 'willdestroy' );
    this.off();
    this.el = this._eventEmitter = this._bindings = null;
};

module.exports = DOMEmitter;

},{"ac-event-emitter":327}],297:[function(require,module,exports){
/**
 * @module ac-dom-styles
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

var vendorTransformHelper = require('./ac-dom-styles/vendorTransformHelper');

/**
 * Utility methods dealing with Elements
 * @name module:ac-dom-styles
 * @kind namespace
 */
var ac_dom_styles = {};

/**
 * Set one or more CSS styles on a DOM element.
 *
 * Usage:
 *
 *     // element and style paramaters as strings
 *     require('ac-dom-styles').setStyle('nav', 'float:left; background:#ccc;');
 *     // element paramater as DOM element, style paramater as an object
 *     var element = document.getElementById('nav');
 *     require('ac-dom-styles').setStyle(element, {
 *         float: "left",
 *         background: "#ccc"
 *     });
 *
 * @param {Element} el The DOM element to set the style/s on.
 * @param {String|Object} styles One or more styles as CSS string or an object with property/value pairs.
 * @returns el
 * @name module:ac-dom-styles.setStyle
 * @kind function
 */
ac_dom_styles.setStyle = function (el, styles) {
	var stylesObj;
	var camelCaseProp;
	var prop;

	if ((typeof styles !== 'string' && typeof styles !== 'object') || Array.isArray(styles)) {
		throw new TypeError('styles argument must be either an object or a string');
	}

	stylesObj = ac_dom_styles.setStyle.__explodeStyleStringToObject(styles);

	// iterate over stylesObj and set styles
	for (prop in stylesObj) {
		if (stylesObj.hasOwnProperty(prop)) {
			camelCaseProp = prop.replace(/-(\w)/g, ac_dom_styles.setStyle.__camelCaseReplace);
			ac_dom_styles.setStyle.__setStyle(el, camelCaseProp, stylesObj, stylesObj[prop]);
		}
	}

	return el;
};

/** @ignore */
ac_dom_styles.setStyle.__explodeStyleStringToObject = function (styles) {
	var stylesObj = (typeof styles === 'object') ? styles : {};
	var splitStyles;
	var colon;
	var len;
	var i;

	if (typeof styles === 'string') {
		splitStyles = styles.split(';');
		len = splitStyles.length;
		for (i = 0; i < len; i += 1) {
			colon = splitStyles[i].indexOf(':');
			if (colon > 0) {
				stylesObj[splitStyles[i].substr(0, colon).trim()] = splitStyles[i].substr(colon + 1).trim();
			}
		}
	}

	return stylesObj;
};

/** @ignore */
ac_dom_styles.setStyle.__setStyle = function (element, camelCaseProp, stylesObj, stylesValue) {
	if (typeof element.style[camelCaseProp] !== 'undefined') {
		element.style[camelCaseProp] = stylesValue;
	}
};

// replace function to handle camelCasing for module:ac-dom-styles.setStyle and getStyle.
// Accounts for Mozilla expecting 'Moz'.
/** @ignore */
ac_dom_styles.setStyle.__camelCaseReplace = function (match, group, offset, string) {
	return (offset === 0) && (string.substr(1, 3) !== 'moz') ? group : group.toUpperCase();
};

/**
 * Retrieves the value of a style property on a DOM element.
 * @param {Element} el The DOM element to check the style of.
 * @param {String} property The style property
 * @param {Object} [css] Overrides for window.getComputedStyle(el)
 * @returns {String} The value for the style property on this Element
 * @name module:ac-dom-styles.getStyle
 * @kind function
 */
ac_dom_styles.getStyle = function (el, property, css) {
	var value;

	property = property.replace(/-(\w)/g, ac_dom_styles.setStyle.__camelCaseReplace);

	property = (property === 'float') ? 'cssFloat' : property;

	css = css || window.getComputedStyle(el, null);
	value = css ? css[property] : null;

	if (property === 'opacity') {
		return value ? parseFloat(value) : 1.0;
	}

	return value === 'auto' ? null : value;
};

/**
 * Sets all the vendor specific style {{{property}}} to {{{value}}} on {{{el}}}.
 * @param {Element} el The Element for which to set the style upon
 * @param {String} property The css property, e.g. borderRadius, webkitBorderRadius, border-radius, etc...
 * @param {String|Number} value The value for which to set the element's css property
 * @name module:ac-dom-styles.setVendorPrefixStyle
 * @kind function
 */
ac_dom_styles.setVendorPrefixStyle = function (el, property, value) {
	if (typeof property !== 'string') {
		throw new TypeError('ac-dom-styles.setVendorPrefixStyle: property must be a string');
	}
	if (typeof value !== 'string' && typeof value !== 'number') {
		throw new TypeError('ac-dom-styles.setVendorPrefixStyle: value must be a string or a number');
	}

	// Empty value accounts for non-vendor-prefixed properties
	var prefixes = ['', 'webkit', 'Moz', 'ms', 'O'];
	var prefixedCamelProp;
	var prefixedValue;

	// Coerce value to string
	value += '';

	// Strip prefix from property if it has one
	property = property.replace(/-(webkit|moz|ms|o)-/i, '');
	// Strip js camelcase vendor prefix if it has one and lowercase first letter. e.g. webkitTransform
	property = property.replace(/^(webkit|Moz|ms|O)/, '');
	property = property.charAt(0).toLowerCase() + property.slice(1);

	// camelCase property
	property = property.replace(/-(\w)/, function (match, group) {
		return group.toUpperCase();
	});

	// Insert token for vendor prefix replacement in values
	value = value.replace(/-(webkit|moz|ms|o)-/, '-vendor-');

	// Iterate through prefixes array testing for existence of property. Update if present.
	prefixes.forEach(function (prefix) {
		// Apply prefixes
		prefixedCamelProp = (prefix === '') ? property : prefix + property.charAt(0).toUpperCase() + property.slice(1);
		prefixedValue = (prefix === '') ? value.replace('-vendor-', '') : value.replace('-vendor-', '-' + prefix.charAt(0).toLowerCase() + prefix.slice(1) + '-');

		if (prefixedCamelProp in el.style) {
			ac_dom_styles.setStyle(el, prefixedCamelProp + ':' + prefixedValue);
		}
	});

};

/**
 * Returns the style value for a specific property as a string and, if necessary, prefixed
 * with the correct vendor prefix for the executing browser.
 * @param {Element} el The DOM Element from which to return the style.
 * @param {String} property The CSS property to fetch the style for. Will accept either a CSS
 * property or a javascript Element.style property name. Vendor prefixes are optional. Any
 * acceptable property as a string will return the same results. e.g. -webkit-box-shadow,
 * -moz-box-shadow, boxShadow, and msBoxShadow will all yield the same return value.
 * @returns {String} The specified property's style as a string
 * @name module:ac-dom-styles.getVendorPrefixStyle
 * @kind function
 */
ac_dom_styles.getVendorPrefixStyle = function (el, property) {
	if (typeof property !== 'string') {
		throw new TypeError('ac-dom-styles.getVendorPrefixStyle: property must be a string');
	}

	var prefixes = ['', 'webkit', 'Moz', 'ms', 'O'];
	var style;

	// Strip css vendor prefix from property if it has one. e.g. -webkit-transform
	property = property.replace(/-(webkit|moz|ms|o)-/i, '');
	// Strip js camelcase vendor prefix if it has one and lowercase first letter. e.g. webkitTransform
	property = property.replace(/^(webkit|Moz|ms|O)/, '').charAt(0).toLowerCase() + property.slice(1);

	// camelCase property
	property = property.replace(/-(\w)/, function (match, group) {
		return group.toUpperCase();
	});

	// Iterate through prefixes array, testing for existence of property. module:ac-dom-styles.getStyle runs on the first match.
	prefixes.some(function (prefix, index) {
		// Apply prefixes
		var prefixedCamelProp = (prefix === '') ? property : prefix + property.charAt(0).toUpperCase() + property.slice(1);

		if (prefixedCamelProp in el.style) {
			style = ac_dom_styles.getStyle(el, prefixedCamelProp);
			return true;
		}
	});

	return style;
};

/**
 * Sets all the appropriate vendor prefixed transform properties to {{{transformFunctions}}} on {{{el}}}.
 * If the 3D version of the transform is available it will set that in favor of the 2D transform.
 * @param {Element} el The Element for which to set the style upon
 * @param {String|Object} transformFunctions the value for which to set the element's transform property. As a string
 * it takes the form of <code>[transformFunction]([parameters])</code>. As an object, pass the
 * <code>[transformFunctions]</code> as the key and the <code>[parameters]</code> as string to the key's value.
 * @name module:ac-dom-styles.setVendorPrefixTransform
 * @kind function
 */
ac_dom_styles.setVendorPrefixTransform = function (el, transformFunctions) {
	if ((typeof transformFunctions !== 'string' && typeof transformFunctions !== 'object') || Array.isArray(transformFunctions) || transformFunctions === null) {
		throw new TypeError('ac-dom-styles.setVendorPrefixTransform: transformFunctions argument must be either an object or a string');
	}

	ac_dom_styles.setVendorPrefixStyle(el, 'transform', vendorTransformHelper.convert2dFunctions(transformFunctions));
};

// IE compatibility
require('./ac-dom-styles/ie')(ac_dom_styles);

module.exports = ac_dom_styles;

},{"./ac-dom-styles/ie":298,"./ac-dom-styles/vendorTransformHelper":299}],298:[function(require,module,exports){
'use strict';

module.exports = function(ac_dom_styles) {
	/**
	 * IE 8 and below getStyle shim accounts for the absence of getComputedStyle as well as IE's
	 * currentStyle object's lack of support for background, font and border css shorthand props.
	 */
	if (typeof window.getComputedStyle !== 'function') {
		ac_dom_styles.getStyle = function (el, style, css) {
			var alphaFilter;
			var value;

			css = css || el.currentStyle;
			if (css) {
				style = style.replace(/-(\w)/g, ac_dom_styles.setStyle.__camelCaseReplace);

				// IE's currentStyle uses styleFloat instead of float
				style = style === 'float' ? 'styleFloat' : style;

				value = css[style] || null;
				return value === 'auto' ? null : value;
			}
		};
	}
};

},{}],299:[function(require,module,exports){
'use strict';

/*
 * A static helper object that handles the work for module:ac-dom-styles.setVendorPrefixTransform.
 * Functionality is abstracted out into this helper object in order to break it up into manageable chunks
 * and also to enable testing of the code that would otherwise be unreachable by the test suites.
 */
/** @ignore */
var vendorTransformHelper = {

	__objectifiedFunctions: {},

	/*
		The paramMaps are used as templates for mapping 2D transform function parameters into
		their equivalent 3D function counterparts. 'p1', 'p2', etc. are replacement tokens that
		correspond to the 2D function parameters. p1 is the first 2D parameter, p2 is the second and so on.
	*/
	__paramMaps: {
		translate: 'p1, p2, 0',
		translateX: 'p1, 0, 0',
		translateY: '0, p1, 0',
		scale: 'p1, p2, 1',
		scaleX: 'p1, 1, 1',
		scaleY: '1, p1, 1',
		rotate: '0, 0, 1, p1',
		matrix: 'p1, p2, 0, 0, p3, p4, 0, 0, 0, 0, 1, 0, p5, p6, 0, 1'
	},

	/*
		@param {String|Object} functions2d A space separated string of transform functions, or an object
		with function names as the keys and a string of comma separataed parameters as the values.
		@returns {String} A space separated list of transform functions with any eligible 2D functions
		mapped to their 3D counterparts.
	*/
	convert2dFunctions: function (functions2d) {
		var values;

		this.__init(functions2d);
		// loop through functions & replace 2d function with 3d function where available
		for (var func in this.__objectifiedFunctions) {
			if (this.__objectifiedFunctions.hasOwnProperty(func)) {
				values = this.__objectifiedFunctions[func].replace(' ', '').split(',');
				if (func in this.__paramMaps) {
					for (var map in this.__paramMaps) {
						if (func === map) {
							this.valuesToSet.push(this.__stripFunctionAxis(func) + '3d(' + this.__map2DTransformParams(values, this.__paramMaps[func]) + ')');
						}
					}
				} else {
					this.valuesToSet.push(func + '(' + this.__objectifiedFunctions[func] + ')');
				}
			}
		}
		return this.valuesToSet.join(' ');
	},

	/*
		Handles some light house cleaning - resetting properties.
		Expects to receive the functions2d parameter from convert2dFunctions and fills the
		_objectifiedFunctions property with key/value pairs from this string or object.
		@param {String|Object} functions2d A space separated string of transform functions, or an object
		with function names as the keys and a string of comma separataed parameters as the values.
		@returns {undefined}
	*/
	__init: function (functions2d) {
		this.valuesToSet = [];
		this.__objectifiedFunctions = (typeof functions2d === 'object') ? functions2d : {};
		if (typeof functions2d === 'string') {
			this.__objectifiedFunctions = this.__objectifyFunctionString(functions2d);
		}
	},

	/*
		@param {Array} params2d Array containing all the parameters from a transform function as
		individual members.
		@param {String} template3d One of the parameter maps from the __paramMaps object.
		@returns {String} The template3d parameter with the 2D function values mapped into it.
	*/
	__map2DTransformParams: function (params2d, template3d) {
		params2d.forEach(function (val, i) {
			template3d = template3d.replace('p' + (i + 1), val);
		});
		return template3d;
	},

	/*
		Splits a space separated string of transform functions into an array with each
		function as a member.
		@param {String} functionString A space separated string of transform functions
		@returns {Array} An array with each function from the string as a member
	*/
	__splitFunctionStringToArray: function (functionString) {
		return functionString.match(/[\w]+\(.+?\)/g);
	},

	/*
		Takes a single transform function as a string and splits its name and parameters into an array.
		@param {String} functionString
		@returns {Array} The resulting array from a match() method. The entire functionString
		will be the first member with the function name and the parameters populating the
		second and third members respectively.
	*/
	__splitFunctionNameAndParams: function (functionString) {
		return functionString.match(/(.*)\((.*)\)/);
	},

	/*
		Strips the X or Y axis off the end of a transform function.
		@param {String} func A transform function name that specifies an X or Y axis at the end
		@returns {String} The function with the axis removed
	*/
	__stripFunctionAxis: function (func) {
		return func.match(/([a-z]+)(|X|Y)$/)[1];
	},

	/*
		Splits a string of transform functions into an object consisting of the function
		names as the keys and the parameters as their respective values.
		@param {String} functionString A space separated string of transform functions
		@returns {Object} An object filled with keys as function names and values as their
		respective parameters
	*/
	__objectifyFunctionString: function (functionString) {
		var self = this;
		var splitMember;
		this.__splitFunctionStringToArray(functionString).forEach(function (member) {
			splitMember = self.__splitFunctionNameAndParams(member);
			self.__objectifiedFunctions[splitMember[1]] = splitMember[2];
		});
		return this.__objectifiedFunctions;
	}
};

module.exports = vendorTransformHelper;

},{}],300:[function(require,module,exports){
/**
 * @module ac-dom-metrics
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

var ac_dom_styles = require('ac-dom-styles');

var ac_dom_metrics = {};

/** @ignore */
var viewportScrollOffsets = function () {
	return {
		x: window.pageXOffset || document.documentElement.scrollLeft || document.body.scrollLeft,
		y: window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
	};
};

/** @ignore */
var viewportDimensions = function () {
	return {
		height: window.innerHeight || document.documentElement.clientHeight,
		width: window.innerWidth || document.documentElement.clientWidth
	};
};

/**
 * Returns an object with top and left offset values for an element relative
 * to the absolute top and left locations of html document.
 * @param {Element} el
 * @returns {Object} An object with numeric values for top and left properties.
 * @name module:ac-dom-metrics.cumulativeOffset
 * @kind function
 */
ac_dom_metrics.cumulativeOffset = function (el) {
	var box = ac_dom_metrics.getBoundingBox(el);
	var scrollOffsets = viewportScrollOffsets();
	var offset = [box.top + scrollOffsets.y, box.left + scrollOffsets.x];
	offset.top = offset[0];
	offset.left = offset[1];
	return offset;
};

/**
 * Returns the bounding box values for an element including width and height.
 * Borders and padding are included. Values are affected by box-sizing.
 * @param {Element} el The Element you want to query
 * @returns {Object} An object with top, right, bottom, left, width and height values as numbers
 * @name module:ac-dom-metrics.getBoundingBox
 * @kind function
 */
ac_dom_metrics.getBoundingBox = function (el) {
	var rect = el.getBoundingClientRect();
	var width = rect.width || rect.right - rect.left;
	var height = rect.height || rect.bottom - rect.top;

	return {
		top: rect.top,
		right: rect.right,
		bottom: rect.bottom,
		left: rect.left,
		width: width,
		height: height
	};
};

/**
 * Returns the width and height of an element's content box. Padding and
 * borders are not included. Accounts for `box-sizing:border-box;`.
 * @param {Element} el The element you want to query
 * @returns {Object} An object with width and height values as numbers
 * @name module:ac-dom-metrics.getInnerDimensions
 * @kind function
 */
ac_dom_metrics.getInnerDimensions = function (el) {
	var dims = ac_dom_metrics.getBoundingBox(el);
	var width = dims.width;
	var height = dims.height;
	var style;
	var styleValue;
	var css = window.getComputedStyle ? window.getComputedStyle(el, null) : null;

	['padding', 'border'].forEach(function (prop) {
		['Top', 'Right', 'Bottom', 'Left'].forEach(function (side) {
			style = prop === 'border' ? prop + side + 'Width' : prop + side;
			styleValue = parseFloat(ac_dom_styles.getStyle(el, style, css));
			styleValue = isNaN(styleValue) ? 0 : styleValue;
			if (side === 'Right' || side === 'Left') {
				width -= styleValue;
			}
			if (side === 'Top' || side === 'Bottom') {
				height -= styleValue;
			}
		});
	});

	return {
		width: width,
		height: height
	};
};

/**
 * Returns the width and height of an element including borders and margins.
 * Accounts for `box-sizing:border-box;`.
 * @param {Element} el The Element you want to query
 * @returns {Object} An object with width and height values as numbers
 * @name module:ac-dom-metrics.getOuterDimensions
 * @kind function
 */
ac_dom_metrics.getOuterDimensions = function (el) {
	var dims = ac_dom_metrics.getBoundingBox(el);
	var width = dims.width;
	var height = dims.height;
	var marginStyle;
	var css = window.getComputedStyle ? window.getComputedStyle(el, null) : null;

	['margin'].forEach(function (prop) {
		['Top', 'Right', 'Bottom', 'Left'].forEach(function (side) {
			marginStyle = parseFloat(ac_dom_styles.getStyle(el, prop + side, css));
			marginStyle = isNaN(marginStyle) ? 0 : marginStyle;
			if (side === 'Right' || side === 'Left') {
				width += marginStyle;
			}
			if (side === 'Top' || side === 'Bottom') {
				height += marginStyle;
			}
		});
	});

	return {
		width: width,
		height: height
	};
};

/**
 * Determines the amount of the height of the element that is in view.
 * @param {Element} element
 * @param {Object} [boundingBox] Memoized value from {@link ac_dom_metrics.getBoundingBox(el)}
 * @returns {Integer} Number of pixels of the element that are currently within the viewport.
 * @name module:ac-dom-metrics.pixelsInViewport
 * @kind function
 */
ac_dom_metrics.pixelsInViewport = function (el, boundingBox) {
	// Amount of the element that is visible inside of the viewport (px)
	var pixelsInView;

	// Get element and viewport metrics
	var viewportMetrics = viewportDimensions();
	boundingBox = boundingBox || ac_dom_metrics.getBoundingBox(el);

	// Determine the offset from the top of the element relative to the top edge
	// of the viewport (px)
	var elementViewportOffsetY = boundingBox.top;

	// If element is fully in view or cropped by bottom edge of viewport
	if (elementViewportOffsetY >= 0) {
		pixelsInView = viewportMetrics.height - elementViewportOffsetY;

		// If the bottom edge of element is in view and the top edge, then it
		// is fully in view
		if (pixelsInView > boundingBox.height) {
			pixelsInView = boundingBox.height;
		}

		// If element is cropped by top edge of viewport or is scrolled out of
		// view above top edge of viewport
	} else {
		pixelsInView = boundingBox.height + elementViewportOffsetY;
	}

	// If the element is completely out of view past the bottom edge of
	// the viewport, then 0 px of it is in view
	if (pixelsInView < 0) {
		pixelsInView = 0;
	}

	if (pixelsInView > viewportMetrics.height){
		pixelsInView = viewportMetrics.height;
	}

	return pixelsInView;
};

/**
 * Determines the percentage of the height of the Element that is in view.
 * @param {Element} el
 * @returns {Float} 0-1, Percentage of the Element within the viewport.
 * @name module:ac-dom-metrics.percentInViewport
 * @kind function
 */
ac_dom_metrics.percentInViewport = function (el) {
	var boundingBox = ac_dom_metrics.getBoundingBox(el);
	var pixelsInView = ac_dom_metrics.pixelsInViewport(el, boundingBox);
	return pixelsInView / boundingBox.height;
};

/**
 * Check if an Element is visible in the viewport above a percentage threshold.
 * @param {Element} el
 * @param {Float} [threshold=0] 0-1, Minimum percentage of the Element within the viewport.
 * @returns {Boolean} `true` if the Element meets the visibility threshold, otherwise `false`.
 * @name module:ac-dom-metrics.isInViewport
 * @kind function
 */
ac_dom_metrics.isInViewport = function (el, threshold) {
	var percentInViewport = ac_dom_metrics.percentInViewport(el);

	// Ensure that threshold is defined and within bounds.
	if (typeof threshold !== "number" || 1 < threshold || threshold < 0){
		threshold = 0;
	}

	return (percentInViewport > threshold || percentInViewport === 1);
};

require('./ac-dom-metrics/ie')(ac_dom_metrics);

module.exports = ac_dom_metrics;

},{"./ac-dom-metrics/ie":301,"ac-dom-styles":297}],301:[function(require,module,exports){
'use strict';

module.exports = function(ac_metrics) {

	/**
	 * Rudimentary shim for getBoundingClientRect in IE < 8.
	 * getBoundingClientRect is available in IE8 even with documentMode as IE7.
	 * It is not available in vanilla IE7.
	 */
	if (!('getBoundingClientRect' in document.createElement('_'))) {
		ac_metrics.getBoundingBox = function (el) {
			var left = el.offsetLeft;
			var top = el.offsetTop;
			var width = el.offsetWidth;
			var height = el.offsetHeight;
			return {
				top: top,
				right: left + width,
				bottom: top + height,
				left: left,
				width: width,
				height: height
			};
		};
	}
};

},{}],302:[function(require,module,exports){
arguments[4][89][0].apply(exports,arguments)
},{"dup":89}],303:[function(require,module,exports){
arguments[4][90][0].apply(exports,arguments)
},{"dup":90}],304:[function(require,module,exports){
arguments[4][91][0].apply(exports,arguments)
},{"dup":91}],305:[function(require,module,exports){
arguments[4][92][0].apply(exports,arguments)
},{"dup":92}],306:[function(require,module,exports){
arguments[4][93][0].apply(exports,arguments)
},{"dup":93}],307:[function(require,module,exports){
arguments[4][94][0].apply(exports,arguments)
},{"dup":94}],308:[function(require,module,exports){
arguments[4][95][0].apply(exports,arguments)
},{"dup":95}],309:[function(require,module,exports){
arguments[4][96][0].apply(exports,arguments)
},{"./ELEMENT_NODE":306,"./internal/isNodeType":315,"ac-polyfills/Array/prototype.filter":797,"ac-polyfills/Array/prototype.slice":799,"dup":96}],310:[function(require,module,exports){
arguments[4][97][0].apply(exports,arguments)
},{"./COMMENT_NODE":302,"./DOCUMENT_FRAGMENT_NODE":303,"./DOCUMENT_NODE":304,"./DOCUMENT_TYPE_NODE":305,"./ELEMENT_NODE":306,"./TEXT_NODE":307,"./createDocumentFragment":308,"./filterByNodeType":309,"./insertAfter":311,"./insertBefore":312,"./insertFirstChild":313,"./insertLastChild":314,"./isComment":317,"./isDocument":318,"./isDocumentFragment":319,"./isDocumentType":320,"./isElement":321,"./isNode":322,"./isNodeList":323,"./isTextNode":324,"./remove":325,"./replace":326,"dup":97}],311:[function(require,module,exports){
arguments[4][98][0].apply(exports,arguments)
},{"./internal/validate":316,"dup":98}],312:[function(require,module,exports){
arguments[4][99][0].apply(exports,arguments)
},{"./internal/validate":316,"dup":99}],313:[function(require,module,exports){
arguments[4][100][0].apply(exports,arguments)
},{"./internal/validate":316,"dup":100}],314:[function(require,module,exports){
arguments[4][101][0].apply(exports,arguments)
},{"./internal/validate":316,"dup":101}],315:[function(require,module,exports){
arguments[4][102][0].apply(exports,arguments)
},{"../isNode":322,"dup":102}],316:[function(require,module,exports){
arguments[4][103][0].apply(exports,arguments)
},{"../COMMENT_NODE":302,"../DOCUMENT_FRAGMENT_NODE":303,"../ELEMENT_NODE":306,"../TEXT_NODE":307,"./isNodeType":315,"dup":103}],317:[function(require,module,exports){
arguments[4][104][0].apply(exports,arguments)
},{"./COMMENT_NODE":302,"./internal/isNodeType":315,"dup":104}],318:[function(require,module,exports){
arguments[4][105][0].apply(exports,arguments)
},{"./DOCUMENT_NODE":304,"./internal/isNodeType":315,"dup":105}],319:[function(require,module,exports){
arguments[4][106][0].apply(exports,arguments)
},{"./DOCUMENT_FRAGMENT_NODE":303,"./internal/isNodeType":315,"dup":106}],320:[function(require,module,exports){
arguments[4][107][0].apply(exports,arguments)
},{"./DOCUMENT_TYPE_NODE":305,"./internal/isNodeType":315,"dup":107}],321:[function(require,module,exports){
arguments[4][108][0].apply(exports,arguments)
},{"./ELEMENT_NODE":306,"./internal/isNodeType":315,"dup":108}],322:[function(require,module,exports){
arguments[4][109][0].apply(exports,arguments)
},{"dup":109}],323:[function(require,module,exports){
arguments[4][110][0].apply(exports,arguments)
},{"dup":110}],324:[function(require,module,exports){
arguments[4][111][0].apply(exports,arguments)
},{"./TEXT_NODE":307,"./internal/isNodeType":315,"dup":111}],325:[function(require,module,exports){
arguments[4][112][0].apply(exports,arguments)
},{"./internal/validate":316,"dup":112}],326:[function(require,module,exports){
arguments[4][113][0].apply(exports,arguments)
},{"./internal/validate":316,"dup":113}],327:[function(require,module,exports){
arguments[4][135][0].apply(exports,arguments)
},{"./ac-event-emitter/EventEmitter":328,"dup":135}],328:[function(require,module,exports){
arguments[4][136][0].apply(exports,arguments)
},{"dup":136}],329:[function(require,module,exports){
arguments[4][88][0].apply(exports,arguments)
},{"dup":88}],330:[function(require,module,exports){
arguments[4][114][0].apply(exports,arguments)
},{"./ac-dom-traversal/ancestor":331,"./ac-dom-traversal/ancestors":332,"./ac-dom-traversal/children":333,"./ac-dom-traversal/filterBySelector":334,"./ac-dom-traversal/firstChild":335,"./ac-dom-traversal/lastChild":338,"./ac-dom-traversal/matchesSelector":339,"./ac-dom-traversal/nextSibling":340,"./ac-dom-traversal/nextSiblings":341,"./ac-dom-traversal/previousSibling":342,"./ac-dom-traversal/previousSiblings":343,"./ac-dom-traversal/querySelector":344,"./ac-dom-traversal/querySelectorAll":345,"./ac-dom-traversal/shims/ie":346,"./ac-dom-traversal/siblings":347,"dup":114}],331:[function(require,module,exports){
arguments[4][115][0].apply(exports,arguments)
},{"./helpers/validate":337,"./matchesSelector":339,"ac-dom-nodes":310,"dup":115}],332:[function(require,module,exports){
arguments[4][116][0].apply(exports,arguments)
},{"./helpers/validate":337,"./matchesSelector":339,"ac-dom-nodes":310,"dup":116}],333:[function(require,module,exports){
arguments[4][117][0].apply(exports,arguments)
},{"./filterBySelector":334,"./helpers/validate":337,"ac-dom-nodes":310,"dup":117}],334:[function(require,module,exports){
arguments[4][118][0].apply(exports,arguments)
},{"./helpers/validate":337,"./matchesSelector":339,"dup":118}],335:[function(require,module,exports){
arguments[4][119][0].apply(exports,arguments)
},{"./children":333,"./helpers/validate":337,"dup":119}],336:[function(require,module,exports){
arguments[4][120][0].apply(exports,arguments)
},{"dup":120}],337:[function(require,module,exports){
arguments[4][121][0].apply(exports,arguments)
},{"ac-dom-nodes":310,"dup":121}],338:[function(require,module,exports){
arguments[4][122][0].apply(exports,arguments)
},{"./children":333,"./helpers/validate":337,"dup":122}],339:[function(require,module,exports){
arguments[4][123][0].apply(exports,arguments)
},{"./helpers/nativeMatches":336,"./helpers/validate":337,"ac-dom-nodes":310,"dup":123}],340:[function(require,module,exports){
arguments[4][124][0].apply(exports,arguments)
},{"./helpers/validate":337,"./matchesSelector":339,"ac-dom-nodes":310,"dup":124}],341:[function(require,module,exports){
arguments[4][125][0].apply(exports,arguments)
},{"./helpers/validate":337,"./matchesSelector":339,"ac-dom-nodes":310,"dup":125}],342:[function(require,module,exports){
arguments[4][126][0].apply(exports,arguments)
},{"./helpers/validate":337,"./matchesSelector":339,"ac-dom-nodes":310,"dup":126}],343:[function(require,module,exports){
arguments[4][127][0].apply(exports,arguments)
},{"./helpers/validate":337,"./matchesSelector":339,"ac-dom-nodes":310,"dup":127}],344:[function(require,module,exports){
arguments[4][128][0].apply(exports,arguments)
},{"./helpers/validate":337,"dup":128}],345:[function(require,module,exports){
arguments[4][129][0].apply(exports,arguments)
},{"./helpers/validate":337,"dup":129}],346:[function(require,module,exports){
arguments[4][130][0].apply(exports,arguments)
},{"../helpers/nativeMatches":336,"../helpers/validate":337,"../vendor/sizzle/sizzle":348,"ac-dom-nodes":310,"dup":130}],347:[function(require,module,exports){
arguments[4][131][0].apply(exports,arguments)
},{"./children":333,"./helpers/validate":337,"dup":131}],348:[function(require,module,exports){
arguments[4][132][0].apply(exports,arguments)
},{"dup":132}],349:[function(require,module,exports){
arguments[4][133][0].apply(exports,arguments)
},{"./ac-dom-emitter/DOMEmitter":350,"dup":133}],350:[function(require,module,exports){
arguments[4][134][0].apply(exports,arguments)
},{"ac-dom-events":329,"ac-dom-traversal":330,"ac-event-emitter":327,"dup":134}],351:[function(require,module,exports){
arguments[4][137][0].apply(exports,arguments)
},{"./ac-shared-instance/SharedInstance":352,"dup":137}],352:[function(require,module,exports){
arguments[4][138][0].apply(exports,arguments)
},{"dup":138}],353:[function(require,module,exports){
arguments[4][139][0].apply(exports,arguments)
},{"./ac-window-delegate/WindowDelegate":356,"./ac-window-delegate/WindowDelegateCustomEvent":357,"./ac-window-delegate/WindowDelegateOptimizer":358,"dup":139}],354:[function(require,module,exports){
arguments[4][140][0].apply(exports,arguments)
},{"ac-event-emitter":327,"dup":140}],355:[function(require,module,exports){
arguments[4][141][0].apply(exports,arguments)
},{"ac-event-emitter":327,"dup":141}],356:[function(require,module,exports){
arguments[4][142][0].apply(exports,arguments)
},{"./CustomEventController":354,"./OptimizerController":355,"./optimizers/optimizers":361,"./queries/queries":370,"ac-dom-emitter":349,"ac-shared-instance":351,"dup":142}],357:[function(require,module,exports){
arguments[4][143][0].apply(exports,arguments)
},{"ac-event-emitter":327,"dup":143}],358:[function(require,module,exports){
arguments[4][144][0].apply(exports,arguments)
},{"ac-event-emitter":327,"dup":144}],359:[function(require,module,exports){
arguments[4][145][0].apply(exports,arguments)
},{"../../WindowDelegateOptimizer":358,"../../queries/queries":370,"dup":145}],360:[function(require,module,exports){
arguments[4][146][0].apply(exports,arguments)
},{"../../WindowDelegateOptimizer":358,"../../queries/queries":370,"dup":146}],361:[function(require,module,exports){
arguments[4][147][0].apply(exports,arguments)
},{"./events/resize":359,"./events/scroll":360,"dup":147}],362:[function(require,module,exports){
arguments[4][148][0].apply(exports,arguments)
},{"dup":148}],363:[function(require,module,exports){
arguments[4][149][0].apply(exports,arguments)
},{"dup":149}],364:[function(require,module,exports){
arguments[4][150][0].apply(exports,arguments)
},{"dup":150}],365:[function(require,module,exports){
arguments[4][151][0].apply(exports,arguments)
},{"dup":151}],366:[function(require,module,exports){
arguments[4][152][0].apply(exports,arguments)
},{"dup":152}],367:[function(require,module,exports){
arguments[4][153][0].apply(exports,arguments)
},{"dup":153}],368:[function(require,module,exports){
arguments[4][154][0].apply(exports,arguments)
},{"dup":154}],369:[function(require,module,exports){
arguments[4][155][0].apply(exports,arguments)
},{"dup":155}],370:[function(require,module,exports){
arguments[4][156][0].apply(exports,arguments)
},{"./methods/clientHeight":362,"./methods/clientWidth":363,"./methods/innerHeight":364,"./methods/innerWidth":365,"./methods/maxScrollX":366,"./methods/maxScrollY":367,"./methods/scrollX":368,"./methods/scrollY":369,"dup":156}],371:[function(require,module,exports){
var ElementTracker = require('./ac-element-tracker/ElementTracker');
module.exports = new ElementTracker();
module.exports.ElementTracker = ElementTracker;

},{"./ac-element-tracker/ElementTracker":372}],372:[function(require,module,exports){
/**
 *  @desc Tracks, reports metrics, and emits events for various elements on the page
 *  @module ElementTracker
 */

'use strict';

var proto;
var ac_Object = require('ac-object');
var ac_dom_nodes = require('ac-dom-nodes');
var ac_dom_metrics = require('ac-dom-metrics');
var ac_Array = require('ac-array');
var windowDelegate = require('ac-window-delegate').WindowDelegate;
var TrackedElement = require('./TrackedElement');
var EventEmitter = require('ac-event-emitter').EventEmitter;

// default autoStart to false because it gives the user a chance to attach their event listeners
// before things start firing events.
var defaultOptions = {
	autoStart: false
};

/**
 * @constructor
 * @name ElementTracker
 * @param {(Array|NodeList)} elements - Array or Nodelist of DOM elements to track
 * @param {Object} [options] - Hash of user defined options
 */
function ElementTracker (elements, options) {

	this.options = ac_Object.clone(defaultOptions);
	this.options = typeof options === 'object' ? ac_Object.extend(this.options, options) : this.options;
	this.windowDelegate = windowDelegate;

	// are we tracking?
	this.tracking = false;

	// array of tracked element objects
	this.elements = [];

	// add elements if we get a valid Element object, Array or NodeList
	if (elements && (Array.isArray(elements) || ac_dom_nodes.isNodeList(elements) || ac_dom_nodes.isElement(elements))) {
		this.addElements(elements);
	}

	// only start if autoStart
	if (this.options.autoStart) {
		this.start();
	}

}

proto = ElementTracker.prototype = ac_Object.create(EventEmitter.prototype);

var nodelistToStringPattern = /^\[object (HTMLCollection|NodeList|Object)\]$/;


/**
 * @desc Accepts single DOM Elements or an array of DOM Elements. Turns DOM Elements into TrackedElement objects and pushes them to this.elements
 * @private
 */
proto._registerElements = function (elements) {
	// make sure we use an array
	elements = [].concat(elements);

	elements.forEach(function (element) {
		// only register elements that are present in the DOM
		if (this._elementInDOM(element)) {
			var trackedElement = new TrackedElement(element);
			// we only want to get this once intially for now
			trackedElement.offsetTop = trackedElement.element.offsetTop;

			this.elements.push(trackedElement);
		}

	}, this);
};


/**
 * @desc Register objects that are already TrackedElement instances. Will accept a single object or an array of objects
 * @private
 */
proto._registerTrackedElements = function (trackedElements) {
	var objects = [].concat(trackedElements);

	objects.forEach(function (object) {
		// only register objects in DOM
		if (this._elementInDOM(object.element)) {
			object.offsetTop = object.element.offsetTop;
			this.elements.push(object);
		}
	}, this);
};

/**
 * @desc returns true if the element is a valid element and exists in the DOM
 * @private
 */
proto._elementInDOM = function (element) {
	var assertion = false;
	var body = document.getElementsByTagName('body')[0];

	if (ac_dom_nodes.isElement(element) && body.contains(element)) {
		assertion = true;
	}

	return assertion;
};

/**
 * @private
 */
proto._onVPChange = function () {
	this.elements.forEach(function (elementObj) {
		this.refreshElementState(elementObj);
	}, this);
};


/**
 * @private
 */
proto._elementPercentInView = function (elementObj) {
	return elementObj.pixelsInView / elementObj.height;
};

/**
 * @private
 */
proto._elementPixelsInView = function (elementObj) {
	// pixels in view will be 0 if none of the conditions below are met
	var pixels = 0;
	var top = elementObj.top;
	var bottom = elementObj.bottom;
	var winHeight = this.windowDelegate.innerHeight();

	// if both element top and bottom extend beyond viewport
	if (top <= 0 && bottom >= winHeight) {
		pixels = winHeight;

	// if element top is in view, but bottom isn't
	} else if (top >= 0 && top < winHeight && bottom > winHeight) {
		pixels = winHeight - top;

	// if element top is not in view, but bottom is
	} else if (top < 0 && (bottom < winHeight && bottom >= 0)) {
		pixels = elementObj.bottom;

	// if element is entirely in view
	} else if (top >= 0 && bottom <= winHeight) {
		pixels = elementObj.height;
	}

	return pixels;
};

/**
 * @desc Conditions to meet and actions to take when refreshing the element's state if is in view, but was not necessarily already in view.
 * @private
 */
proto._ifInView = function (trackedElement, alreadyInView) {
	// if the element enters view
	if (!alreadyInView) {
		trackedElement.trigger('enterview', trackedElement);
	}
};

/**
 * @desc Conditions to meet and actions to take when refreshing the element's state if it was already in view, but not necessarily in view anymore.
 * @private
 */
proto._ifAlreadyInView = function (trackedElement) {
	// if the element exits view
	if (!trackedElement.inView) {
		trackedElement.trigger('exitview', trackedElement);
	}
};

/**
 * Public Methods
 */


/**
 * @name ElementTracker#addElements
 * @desc Add elements to the element index. Accepts single element or array of elements or a nodelist
 * @public
 * @method
 * @param {(Element|Array|NodeList)} collection - A single DOM Element or an array of DOM Elements or a NodeList
 */
proto.addElements = function (collection) {
	collection = ac_dom_nodes.isNodeList(collection) ? ac_Array.toArray(collection) : [].concat(collection);
	collection.forEach(function (element) {
		this.addElement(element);
	}, this);
};

/**
 * @name ElementTracker#addElement
 * @desc Add a single element to be tracked. Pass just the DOM Element to use the default options, or pass an object with properties that match the `TrackedElement` API.
 * @public
 * @method
 * @param {Element} element - A DOM Element object
 * @returns a new instance of a `TrackedElement` object.
 * @throws TypeError if the supplied element is not a valid DOM Element
 */
proto.addElement = function (element) {
	var trackedElement;

	if (ac_dom_nodes.isElement(element)) {
		trackedElement = new TrackedElement(element);
		this._registerTrackedElements(trackedElement);
	}

	return trackedElement;
};

/**
 * @name ElementTracker#removeElement
 * @desc Remove an element object from the element index. Will remove any duplicates of passed element.
 * @public
 * @method
 * @param {(Element|Object)} element - A DOM Element or a valid `TrackedElement` object
 */
proto.removeElement = function (element) {
	var indexes = [];
	var filtered;

	this.elements.forEach(function (elementObj, i) {
		if (elementObj === element || elementObj.element === element) {
			indexes.push(i);
		}
	});

	// remove matched elements at specified indexes
	filtered = this.elements.filter(function (element, i) {
		return indexes.indexOf(i) < 0 ? true : false;
	});

	this.elements = filtered;
};

/**
 * @name ElementTracker#stop
 * @desc Stop tracking. Removes the scroll listener.
 * @public
 * @method
 */
proto.stop = function () {
	if (this.tracking === true) {
		this.tracking = false;
		this.windowDelegate.off('scroll resize orientationchange', this._onVPChange);
	}
};

/**
 * @name ElementTracker#start
 * @desc Start tracking. Adds the scroll listener.
 * @public
 * @method
 */
proto.start = function () {
	if (this.tracking === false) {
		this.tracking = true;
		this.windowDelegate.on('scroll resize orientationchange', this._onVPChange, this);
		this.refreshAllElementStates();
	}
};

/**
 * @name ElementTracker#refershAllElementStates
 * @desc Force a metric and state update on all tracked elements
 * @public
 * @method
 */
proto.refreshAllElementStates = function () {
	this.elements.forEach(function (trackedElement) {
		this.refreshElementState(trackedElement);
	}, this);
};

/**
 * @name ElementTracker#refershAllElementStates
 * @desc Force a metric and state update provided tracked element
 * @param {Object} trackedElement - the `TrackedElement` object of the elemet you want to update.
 * @public
 * @method
 * @returns the passed `trackedElement` object
 */
proto.refreshElementState = function (trackedElement) {
	var box = ac_dom_metrics.getBoundingBox(trackedElement.element);
	var alreadyInView = trackedElement.inView;

	trackedElement = ac_Object.extend(trackedElement, box);
	trackedElement.pixelsInView = this._elementPixelsInView(trackedElement);
	trackedElement.percentInView = this._elementPercentInView(trackedElement);
	trackedElement.inView = trackedElement.pixelsInView > 0;

	if (trackedElement.inView) {
		this._ifInView(trackedElement, alreadyInView);
	}

	if (alreadyInView) {
		this._ifAlreadyInView(trackedElement);
	}

	return trackedElement;
};



module.exports = ElementTracker;

},{"./TrackedElement":373,"ac-array":288,"ac-dom-metrics":300,"ac-dom-nodes":310,"ac-event-emitter":327,"ac-object":375,"ac-window-delegate":353}],373:[function(require,module,exports){
/**
 *  @desc Extends DOMEmitter and wraps a DOM Element with metrics related to its position in the viewport.
 *  @module TrackedElement
 */

'use strict';

var proto;
var DOMEmitter = require('ac-dom-emitter').DOMEmitter;
var ac_dom_nodes = require('ac-dom-nodes');
var ac_Object = require('ac-object');

/**
 * @constructor
 * @name TrackedElement
 * @param {Element} element - A valid DOM element
 */
function TrackedElement (element) {

	// if just an element is passed
	if (ac_dom_nodes.isElement(element)) {
		this.element = element;
	} else {
		throw new TypeError('TrackedElement: ' + element + ' is not a valid DOM element');
	}

	// baseline property values
	this.inView = false;
	this.percentInView = 0;
	this.pixelsInView = 0;
	this.offsetTop = 0;
	this.top = 0;
	this.right = 0;
	this.bottom = 0;
	this.left = 0;
	this.width = 0;
	this.height = 0;

	DOMEmitter.call(this, element);

}

proto = TrackedElement.prototype = ac_Object.create(DOMEmitter.prototype);


module.exports = TrackedElement;

},{"ac-dom-emitter":295,"ac-dom-nodes":310,"ac-object":375}],374:[function(require,module,exports){
arguments[4][1][0].apply(exports,arguments)
},{"dup":1}],375:[function(require,module,exports){
/**
 * @module ac-object
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

module.exports = {
	clone: require('./ac-object/clone'),
	create: require('./ac-object/create'),
	defaults: require('./ac-object/defaults'),
	extend: require('./ac-object/extend'),
	getPrototypeOf: require('./ac-object/getPrototypeOf'),
	isDate: require('./ac-object/isDate'),
	isEmpty: require('./ac-object/isEmpty'),
	isRegExp: require('./ac-object/isRegExp'),
	toQueryParameters: require('./ac-object/toQueryParameters')
};

},{"./ac-object/clone":376,"./ac-object/create":377,"./ac-object/defaults":378,"./ac-object/extend":379,"./ac-object/getPrototypeOf":380,"./ac-object/isDate":381,"./ac-object/isEmpty":382,"./ac-object/isRegExp":383,"./ac-object/toQueryParameters":384}],376:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var extend = require('./extend');

/**
 * @name module:ac-object.clone
 *
 * @function
 * 
 * @desc Create a new Object that has the same properties as the original.
 *
 * @param {Object} object
 *        The Object to make a clone of.
 *
 * @returns {Object} The cloned object.
 */
module.exports = function clone (object) {
	return extend({}, object);
};

},{"./extend":379}],377:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var F = function () {};

/**
 * @name module:ac-object.create
 *
 * @function
 *
 * @desc Create a new Object who’s prototype is the object passed
 *
 * @see  https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/create
 *
 * @param {Object} proto
 *        The prototype for the new Object
 *
 * @returns {Object} The new Object
 */
module.exports = function create(proto) {
	// Don’t support second argument because it is not possible to accurately polyfill
	if (arguments.length > 1) {
		throw new Error('Second argument not supported');
	}

	// Prototype object is required
	if (proto === null || typeof proto !== 'object') {
		throw new TypeError('Object prototype may only be an Object.');
	}

	// If native Object.create exists, use it!
	if (typeof Object.create === 'function') {
		return Object.create(proto);

	// Otherwise create a new Object F with the prototype provided assigned to it
	} else {
		F.prototype = proto;
		return new F();
	}
};

},{}],378:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var extend = require('./extend');

/**
 * @name module:ac-object.defaults
 *
 * @function
 * 
 * @desc Combines defaults and options into a new object and returns it.
 *
 * @param {Object} defaultsObj
 *        The defaults object.
 *
 * @param {Object} options
 *        The options object.
 *
 * @returns {Object} An object resulting from the combination of defaults and options.
 */
module.exports = function defaults (defaultsObj, options) {
	if (typeof defaultsObj !== 'object'){
		throw new TypeError('defaults: must provide a defaults object');
	}
	options = options || {};
	if (typeof options !== 'object'){
		throw new TypeError('defaults: options must be a typeof object');
	}
	return extend({}, defaultsObj, options);
};

},{"./extend":379}],379:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var hasOwnProp = Object.prototype.hasOwnProperty;

/**
 * @name module:ac-object.extend
 *
 * @function
 * 
 * @desc Add properties from one object into another. Not a deep copy.
 *
 * @param {Object} destination
 *        The object where the properties will end up. Properties in this Object
 *        that have the same key as properties in the source object will be
 *        overwritten with the source property’s value. If destination is not
 *        provided a blank object is created.
 *
 * @param {Object} source
 *        The properties to add / overwrite in the destination Object. An infinite
 *        number of source paramaters may be passed.
 *
 * @returns {Object} The extended object.
 */
module.exports = function extend () {
	var args;
	var dest;

	if (arguments.length < 2) {
		args = [{}, arguments[0]];
	} else {
		args = [].slice.call(arguments);
	}

	dest = args.shift();

	args.forEach(function (source) {
		if (source != null) {
			for (var property in source) {
				// Anything that does not prototype Object will not have this method
				if (hasOwnProp.call(source, property)) {
					dest[property] = source[property];
				}
			}
		}
	});

	return dest;	
};

},{}],380:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var hasOwnProp = Object.prototype.hasOwnProperty;

/**
 * @name module:ac-object.getPrototypeOf
 *
 * @function
 * 
 * @desc Returns the prototype (i.e. the internal [[Prototype]]) of the specified object.
 *
 * @param {Object} obj
 *        The object whose prototype is to be returned.
 *
 * @returns {Object} The prototype of the specified object.
 */
module.exports = function getPrototypeOf (obj) {
	if (Object.getPrototypeOf) {
		return Object.getPrototypeOf(obj);
	}
	else {
		if (typeof obj !== 'object') {
			throw new Error('Requested prototype of a value that is not an object.');
		}
		else if (typeof this.__proto__ === 'object') {
			return obj.__proto__;
		}
		else {
			var constructor = obj.constructor;
			var oldConstructor;
			if (hasOwnProp.call(obj, 'constructor')) {
				oldConstructor = constructor;
				// reset constructor
				if (!(delete obj.constructor)) {
					// can't delete obj.constructor, return null
					return null;
				}
				// get real constructor
				constructor = obj.constructor;
				// restore constructor
				obj.constructor = oldConstructor;
			}
			// needed for IE
			return constructor ? constructor.prototype : null;
		}
	}
};

},{}],381:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name module:ac-object.isDate
 *
 * @function
 * 
 * @desc Test an Object to see if it is an instance of the Date constructor or not.
 *
 * @param {Object} date
 *        The Object to test.
 *
 * @returns {Boolean} If the Object is a Date or not.
 */
module.exports = function isDate (date) {
	return Object.prototype.toString.call(date) === '[object Date]';
};

},{}],382:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var hasOwnProp = Object.prototype.hasOwnProperty;

/**
 * @name module:ac-object.isEmpty
 *
 * @function
 * 
 * @desc Check if an empty object.
 *
 * @param {Object} object
 *        The Object to check if empty.
 *
 * @returns {Boolean} Return true if and only if object is empty ({}).
 */
module.exports = function isEmpty (object) {
	var prop;

	if (typeof object !== 'object') {
		throw new TypeError('ac-base.Object.isEmpty : Invalid parameter - expected object');
	}

	for (prop in object) {
		if (hasOwnProp.call(object, prop)) {
			return false;
		}
	}

	return true;
};

},{}],383:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name module:ac-object.isRegExp
 *
 * @function
 * 
 * @desc Test whether or not an Object is a Regular Expression.
 *
 * @param {Object} obj
 *        Object to test whether or not it is a Regular Expression.
 *
 * @returns {Boolean} Whether or not it is a Regular Expression.
 */
module.exports = function isRegExp (obj) {
	return window.RegExp ? obj instanceof RegExp : false;
};

},{}],384:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var qs = require('qs');

/**
 * @name module:ac-object.toQueryParameters
 *
 * @function
 * 
 * @desc Convert object to query string.
 *
 * @param {Object} object
 *        The Object to convert to a query string.
 *
 * @returns {String} Returns query string representation of object.
 */
module.exports = function toQueryParameters (object) {
	if (typeof object !== 'object'){
		throw new TypeError('toQueryParameters error: argument is not an object');
	}
	return qs.stringify(object);
};

},{"qs":374}],385:[function(require,module,exports){
var ElementEngagement = require('./ac-element-engagement/ElementEngagement');

module.exports = new ElementEngagement();
module.exports.ElementEngagement = ElementEngagement;

},{"./ac-element-engagement/ElementEngagement":386}],386:[function(require,module,exports){
/**
 *  @desc Reports user engagement on tracked elements
 *  @module ElementEngagement
 */

'use strict';

var proto;
var ac_Object = require('ac-object');
var Super = require('ac-element-tracker').ElementTracker;

var trackedElementDefaults = {
	timeToEngage: 500,
	inViewThreshold: 0.75,
	stopOnEngaged: true
};

// defaults for when we decorate the TrackedElement objects
var extendedTrackedElementProps = {
	thresholdEnterTime: 0,
	thresholdExitTime: 0,
	inThreshold: false,
	engaged: false,
	tracking: true
};


/**
 * @constructor
 * @todo Think about implementing real time engagement tracking.
 *         current behavior is to report engagement only on thresholdexit.
 *         This mirrors the current track-section-engagement script.
 * @name ElementEngagement
 */

var ElementEngagement = function () {
	Super.call(this);
};

proto = ElementEngagement.prototype = ac_Object.create(Super.prototype);

/**
 * @desc decorates the TrackedElement instances with ElementEngagement specific properties
 * @private
 */
proto._decorateTrackedElement = function (trackedElement, options) {
	var extendedDefaults;

	// merge user specified options with defaults
	extendedDefaults = ac_Object.defaults(trackedElementDefaults, options || {});
	ac_Object.extend(trackedElement, extendedDefaults);
	ac_Object.extend(trackedElement, extendedTrackedElementProps);
};


/**
 * @desc Adds EventEmitter listeners to an individual TrackedElement object
 * @private
 */
proto._attachElementListeners = function (trackedElement) {
	trackedElement.on('thresholdenter', this._thresholdEnter, this);
	trackedElement.on('thresholdexit', this._thresholdExit, this);
	trackedElement.on('enterview', this._enterView, this);
	trackedElement.on('exitview', this._exitView, this);
};

/**
 * @desc Removes EventEmitter listeners from an individaul TrackedElement object
 * @private
 */
proto._removeElementListeners = function (trackedElement) {
	trackedElement.off('thresholdenter', this._thresholdEnter);
	trackedElement.off('thresholdexit', this._thresholdExit);
	trackedElement.off('enterview', this._enterView);
	trackedElement.off('exitview', this._exitView);
};

/**
 * @desc Attaches EventEmitter listeners to all TrackedElement objects
 * @private
 */
proto._attachAllElementListeners = function () {
	this.elements.forEach(function (trackedElement) {
		if (!trackedElement.stopOnEngaged) {
			this._attachElementListeners(trackedElement);
		} else if (!trackedElement.engaged) {
			this._attachElementListeners(trackedElement);
		}
	}, this);
};

/**
 * @desc Removes EventEmitter listeners from all TrackedElement objects
 * @private
 */
proto._removeAllElementListeners = function () {
	this.elements.forEach(function (trackedElement) {
		this._removeElementListeners(trackedElement);
	}, this);
};


/**
 * @desc is the element in view past its defined threshold? Offset if viewport is >= element height.
 * @private
 */
proto._elementInViewPastThreshold = function (trackedElement) {
	var winHeight = this.windowDelegate.innerHeight();
	var isIt = false;

	// if the whole viewport is filled with the element, then we consider that enough in view
	if (trackedElement.pixelsInView === winHeight) {
		isIt = true;
	} else {
		isIt = (trackedElement.percentInView > trackedElement.inViewThreshold);
	}

	return isIt;
};


/**
 * @desc Conditions to meet and actions to take when refreshing the element's state if is in view, but was not necessarily already in view.
 * @private
 */
proto._ifInView = function (trackedElement, alreadyInView) {
	var alreadyInThreshold = trackedElement.inThreshold;
	Super.prototype._ifInView.apply(this, arguments);

	// if element enters view threshold
	if (!alreadyInThreshold && this._elementInViewPastThreshold(trackedElement)) {
		trackedElement.inThreshold = true;
		trackedElement.trigger('thresholdenter', trackedElement);

		if (typeof trackedElement.timeToEngage === 'number' && trackedElement.timeToEngage >= 0) {
			trackedElement.engagedTimeout = window.setTimeout(this._engaged.bind(this, trackedElement), trackedElement.timeToEngage);
		}
	}
};

/**
 * @desc Conditions to meet and actions to take when refreshing the element's state if it was already in view, but not necessarily in view anymore.
 * @private
 */
proto._ifAlreadyInView = function (trackedElement) {
	var alreadyInThreshold = trackedElement.inThreshold;
	Super.prototype._ifAlreadyInView.apply(this, arguments);

	// if element exits view threshold
	if (alreadyInThreshold && !this._elementInViewPastThreshold(trackedElement)) {
		trackedElement.inThreshold = false;
		trackedElement.trigger('thresholdexit', trackedElement);

		if (trackedElement.engagedTimeout) {
			window.clearTimeout(trackedElement.engagedTimeout);
			trackedElement.engagedTimeout = null;
		}
	}
};

proto._engaged = function (trackedElement) {
	trackedElement.engagedTimeout = null;
	this._elementEngaged(trackedElement);
	trackedElement.trigger('engaged', trackedElement);
	this.trigger('engaged', trackedElement);
};

/**
 * @desc Method that gets fired on EventEmitter 'thresholdenter' event
 * @private
 */
proto._thresholdEnter = function (trackedElement) {
	// replace old values
	trackedElement.thresholdEnterTime = Date.now();
	trackedElement.thresholdExitTime = 0;

	// fire thresholdenter event
	this.trigger('thresholdenter', trackedElement);
};

/**
 * @desc Method that gets fired on EventEmitter 'thresholdexit' event
 * @private
 **/
proto._thresholdExit = function (trackedElement) {
	// set exit time
	trackedElement.thresholdExitTime = Date.now();

	// fire thresholdexit event
	this.trigger('thresholdexit', trackedElement);
};

proto._enterView = function (trackedElement) {
	this.trigger('enterview', trackedElement);
};

proto._exitView = function (trackedElement) {
	this.trigger('exitview', trackedElement);
};

/**
 * @desc Method that fires on EventEmitter 'engaged' event
 * @private
 */
proto._elementEngaged = function (trackedElement) {
	trackedElement.engaged = true;
	// stop tracking element if stopOnEngaged is true
	if (trackedElement.stopOnEngaged) {
		this.stop(trackedElement);
	}
};


/**
 * Public methods
 */

/**
 * @method
 * @public
 * @desc Remove tracking from all elements. Or pass a single TrackedElement object to
 *       remove tracking from only that element.
 * @name ElementEngagement#stop
 * @param {Object} [trackedElement] - A TrackedElement object that is provided to ElementEngagement
 *                                    by ElementTracker.
 */
proto.stop = function (trackedElement) {
	// stop everything
	if (this.tracking && !trackedElement) {
		this._removeAllElementListeners();
		Super.prototype.stop.call(this);
	}

	// just stop tracking the trackedElement
	if (trackedElement && trackedElement.tracking) {
		trackedElement.tracking = false;
		this._removeElementListeners(trackedElement);
	}

};

/**
 * @method
 * @public
 * @desc Start tracking all elements, or pass a single TrackedElement object to start
 *       tracking only that element. Will not resume tracking on elements that have
 *       already been engaged.
 * @name ElementEngagement#start
 * @param {Object} [trackedElement] - A TrackedElement object that is provided to ElementEngagement
 *                                    by ElementTracker.
 */
proto.start = function (trackedElement) {
	// start everything
	if (!trackedElement) {
		this._attachAllElementListeners();
	}

	// just start tracking the trackedElement
	if (trackedElement && !trackedElement.tracking) {
		if (!trackedElement.stopOnEngaged) {
			trackedElement.tracking = true;
			this._attachElementListeners(trackedElement);
		} else if (!trackedElement.engaged) {
			trackedElement.tracking = true;
			this._attachElementListeners(trackedElement);
		}
	}

	// Start tracking if not already. Else, just refresh the elements
	if (!this.tracking) {
		Super.prototype.start.call(this);
	} else {
		this.refreshAllElementStates();
	}

};

// add a single element
proto.addElement = function (element, options) {
	var trackedElement = Super.prototype.addElement.call(this, element);
	this._decorateTrackedElement(trackedElement, options);

	return trackedElement;
};

// add a bunch of elements that all use the same options
proto.addElements = function (collection, options) {
	// call forEach with collection as context to iterate over nodelist or array
	[].forEach.call(collection, function (element) {
		this.addElement(element, options);
	}, this);
};


module.exports = ElementEngagement;

},{"ac-element-tracker":371,"ac-object":375}],387:[function(require,module,exports){
/** 
 * @module ac-event-emitter
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

module.exports = {
	EventEmitter: require('./ac-event-emitter/EventEmitter')
};

},{"./ac-event-emitter/EventEmitter":388}],388:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

var propagationName = 'EventEmitter:propagation';

/**
 * @constructor
 */
var EventEmitter = function (context) {
    // we should only create a context property if
    // the user is using EventEmitter through composition
    // and not using it as a part of their prototype chain
    if (context) {
        this.context = context;
    }
};



// shorthand to the prototype
var proto = EventEmitter.prototype;



// test to see if the instant has an object
// that as been allocated to store events
var getEvents = function () {
    if (!this.hasOwnProperty('_events') && typeof this._events !== 'object') {
        this._events = {};
    }
    return this._events;
};


var isArray = function (arg) {
    if (typeof Array.isArray === 'function') {
        return Array.isArray(arg);
    }

    return Object.prototype.toString.call(arg) === '[object Array]';
};



// @arguments arguments Could be:
//  event Single string event, space seperated string, or map of events/callbacks
//  callback Callback function for space seperated or single events
//  context Context to apply to callbacks when invoked
// @argument register The function that will get called for each event/callback/context
var parseEvents = function (args, register) {
    var events = args[0];
    var callback = args[1];
    var context = args[2];
    var evt;
    var length;
    var i;

    // event should be a string or an plain object (not an array or null)
    if ((typeof events !== 'string' && typeof events !== 'object') || events === null || isArray(events)) {
        throw new TypeError('Expecting event name to be a string or object.');
    }

    // ensure that calls to on/once with a string for event names
    // also come with a callback function
    if ((typeof events === 'string') && !callback) {
        throw new Error('Expecting a callback function to be provided.');
    }

    // callback should be a function
    if (callback && (typeof callback !== 'function')) {
        // unless we have a map of events/callbacks, then it could actually
        // be a context object
        if (typeof events === 'object' && typeof callback === 'object') {
            context = callback;
        }
        else {
            throw new TypeError('Expecting callback to be a function.');
        }
    }

    register.call(this, events, callback, context);
};



// Finds the array of callback objects for
// a given event name, then executes the provided
// callback for each one of them. Passing the callback
// object and the index.
var each = function (event, callback, context) {
    var eventsArray;
    var i;
    var length;

    eventsArray = getEvents.call(this)[event];

    if (!eventsArray || eventsArray.length === 0) {
        return;
    }

    // copy it in case anything we call tries to modify it
    eventsArray = eventsArray.slice();

    // reset this._stoppedImmediatePropagation for the run loop
    this._stoppedImmediatePropagation = false;

    for (i = 0, length = eventsArray.length; i < length; i += 1) {
        // if the event has been stopped via the run loop, break early
        if (this._stoppedImmediatePropagation || callback.call(context, eventsArray[i], i)) {
            break;
        }
    }
};



// Remove a callback for a given event
var removeSpecificCallback = function (events, event, callback) {
    // looking for a specific callback
    var i = -1;
    each.call(this, event, function (callbackObject, index) {
        if (callbackObject.callback === callback) {
            i = index;
            return true;
        }
    });

    if (i === -1) {
        return;
    }

    events[event].splice(i, 1);
};



/**
 * A method for adding a callback for a given event
 * @method
 * @param {string} event Event name
 * @param {function} callback A function to invoke when an event is triggered
 * @param {object} [context] A context to bind to the callback
 */
proto.on = function () {
    var events = getEvents.call(this);

    parseEvents.call(this, arguments, function (event, callback, context) {
        events[event] = events[event] || (events[event] = []);
        events[event].push({
            callback: callback,
            context: context
        });
    });

    return this;
};



/**
 * A method for adding a callback for an event that will only execute once
 * and then be removed.
 * @method
 * @param {string} event Event name
 * @param {function} callback A function to invoke when an event is triggered
 * @param {object} [context] A context to bind to the callback
 */
proto.once = function () {
    parseEvents.call(this, arguments, function (event, callback, context) {
        var wrapper = function (data) {
            callback.call(context || this, data);
            this.off(event, wrapper);
        };
        this.on(event, wrapper, this);
    });

    return this;
};



/**
 * A method for removing a callback for a given event
 * If no arguments are specified, all handlers are removed.
 * @method
 * @param {string} [event] Event name
 * @param {function} [callback] A function to remove
 */
proto.off = function (event, callback) {
    var events = getEvents.call(this);
    var evt;
    var split;
    var length;
    var i;

    // if no arguments are specified
    // we will drop all callbacks
    if (arguments.length === 0) {
        this._events = {};
    }
    // event names should be a string
    else if (!event || (typeof event !== 'string' && typeof event !== 'object') || Array.isArray(event)) {
        throw new TypeError('Expecting event name to be a string or object.');
    }

    if (typeof event === 'object') {
        for (evt in event) {
        	if (event.hasOwnProperty(evt)) {
				removeSpecificCallback.call(this, events, evt, event[evt]);
        	}
        }
    }

    // one or more events passed as string
    if (typeof event === 'string') {
        split = event.split(' ');

        // only one event passed
        if (split.length === 1) {
            // if a callback was specified remove that callback
            if (callback) {
                removeSpecificCallback.call(this, events, event, callback);
            }
            // otherwise, remove all the callbacks for that event
            else {
                events[event] = [];
            }
        }
        // space seperated events passed
        else {
            for (i = 0, length = split.length; i < length; i += 1) {
                events[split[i]] = [];
            }
        }
    }

    return this;
};



/**
 * A method for firing/triggering an event
 * @method
 * @param {string} event Event name
 * @param {object} [data] Data to pass to the listening callbacks
 * @param {boolean} [doNotPropagate] Flag to silence propagation
 */
proto.trigger = function (event, data, doNotPropagate) {
    var eventName;
    var length;
    var evt;
    var i;

    // you need at least an event
    if (!event) {
        throw new Error('trigger method requires an event name');
    }

    // event names should be a string
    if (typeof event !== 'string') {
        throw new TypeError('Expecting event names to be a string.');
    }

    // doNotPropagate flag should be a boolean
    if (doNotPropagate && typeof doNotPropagate !== 'boolean') {
        throw new TypeError('Expecting doNotPropagate to be a boolean.');
    }

    // split events incase we are trigger multiples with a space delimiter
    event = event.split(' ');

    // loop through the events
    for (i = 0, length = event.length; i < length; i += 1) {
        evt = event[i];


        // call all the callbacks for the given event
        each.call(this, evt, function (callbackObject) {
            callbackObject.callback.call(callbackObject.context || this.context || this, data);
        }, this);


         // propagate event if anyone else is listening, unless told not to
        if (!doNotPropagate) {
            eventName = evt;
            each.call(this, propagationName, function (propagation) {
                if (propagation.prefix) {
                    eventName = propagation.prefix + eventName;
                }

                propagation.emitter.trigger(eventName, data);
            });
        }
    }

    return this;
};


/**
 * A method for propagating events to another EventEmitter
 * @method
 * @param {object} eventEmitter An event emitting object to propagate events to
 * @param {string} [prefix] A prefix to be appended to the name of a propagating event
 */
proto.propagateTo = function (eventEmitter, prefix) {
    var events = getEvents.call(this);

    if (!events[propagationName]) {
        this._events[propagationName] = [];
    }

    events[propagationName].push({
        emitter: eventEmitter,
        prefix: prefix
    });
};



/**
 * A method for removing propagation
 * @method
 * @param {object} [eventEmitter] The event emitter to stop propagating to
 */
proto.stopPropagatingTo = function (eventEmitter) {
    var events = getEvents.call(this);

    // If an argument was not specified,
    // all propagations will be removed.
    if (!eventEmitter) {
        events[propagationName] = [];
        return;
    }

    // If an event emitter was passed in,
    // just removed propagation to that object
    var propagationTargets = events[propagationName];
    var length = propagationTargets.length;
    var i;

    for(i = 0; i < length; i += 1) {
        if (propagationTargets[i].emitter === eventEmitter) {
            propagationTargets.splice(i, 1);
            break;
        }
    }
};



/**
 * A method for cancelling future callbacks from firing in a event trigger loop
 * @method
 */
proto.stopImmediatePropagation = function () {
    this._stoppedImmediatePropagation = true;
};



/**
 * A method for checking whether or not there are callbacks for a given event
 * @method
 * @param {string} evt An event name to check
 * @param {function} [callback] A callback to check for
 * @parma {object} [context] A particular context
 */
proto.has = function (evt, callback, context) {
    var events = getEvents.call(this);
    var eventsArray = events[evt];
	var callbackContainer;
    var i;
    var l;
    var objKeys;
    var x;

    // return an array of all events if no arguments specified
    if (arguments.length === 0) {
        objKeys = [];
        for (x in events) {
            if (events.hasOwnProperty(x)) {
                objKeys.push(x);
            }
        }

        return objKeys;
    }

    // If there's no events, exit.
    if (!eventsArray) {
        return false;
    }

    // If we are not looking for a particular callback,
    // check the length of the events array
    if (!callback) {
        return (eventsArray.length > 0) ? true : false;
    }

    // If we are looking for a particular callback/context, loop through
    // the array of callbacks for the given event name
    for (i = 0, l = eventsArray.length; i < l; i += 1) {
        callbackContainer = eventsArray[i];

        if (
            // looking for both a callback and a context
            (context && callback && callbackContainer.context === context && callbackContainer.callback === callback) ||
            // just looking for a callback
            (callback && !context && callbackContainer.callback === callback)
        ) {
            return true;
        }
    }

    return false;
};



module.exports = EventEmitter;

},{}],389:[function(require,module,exports){
'use strict';

/**
 * @module module:ac-feature
 */
var feature = {
	cssPropertyAvailable: require('./ac-feature/cssPropertyAvailable'),
	localStorageAvailable: require('./ac-feature/localStorageAvailable')
};

var hasOwnProp = Object.prototype.hasOwnProperty;

/**
 * Returns whether the browser supports the 3d media query
 * @returns {Boolean} whether or not the browser supports the 3d media query
 * @name module:ac-feature.threeDTransformsAvailable
 * @kind function
 */
feature.threeDTransformsAvailable = function () {
	// Memoize previously returned value
	if (typeof this._threeDTransformsAvailable !== 'undefined') {
		return this._threeDTransformsAvailable;
	}

	var div, style;

	try {
		this._threeDTransformsAvailable = false;

		if (hasOwnProp.call(window, 'styleMedia')) {
			this._threeDTransformsAvailable = window.styleMedia.matchMedium('(-webkit-transform-3d)');

		} else if (hasOwnProp.call(window, 'media')) {
			this._threeDTransformsAvailable = window.media.matchMedium('(-webkit-transform-3d)');
		}

		// chrome returns all the values as true, but doesn't actually have 3d support
		if (!this._threeDTransformsAvailable) {
			if (!(style = document.getElementById('supportsThreeDStyle'))) {
				style = document.createElement('style');
				style.id = 'supportsThreeDStyle';
				style.textContent = '@media (transform-3d),(-o-transform-3d),(-moz-transform-3d),(-ms-transform-3d),(-webkit-transform-3d) { #supportsThreeD { height:3px } }';
				document.querySelector('head').appendChild(style);
			}

			if (!(div = document.querySelector('#supportsThreeD'))) {
				div = document.createElement('div');
				div.id = 'supportsThreeD';
				document.body.appendChild(div);
			}
			this._threeDTransformsAvailable = (div.offsetHeight === 3) || style.style['MozTransform'] !== undefined || style.style['WebkitTransform'] !== undefined;
		}

		return this._threeDTransformsAvailable;
	} catch (e) {
		return false;
	}
};

/**
 * Detects whether or not the browser understands the HTML5 Canvas API.
 * @returns {Boolean} true if the browser supports canvas.
 * @name module:ac-feature.canvasAvailable
 * @kind function
 */
feature.canvasAvailable = function () {
	// Memoize previously returned value
	if (typeof this._canvasAvailable !== 'undefined') {
		return this._canvasAvailable;
	}

	var canvas = document.createElement('canvas');

	this._canvasAvailable = !!(typeof canvas.getContext === 'function' && canvas.getContext('2d'));
	return this._canvasAvailable;
};

/**
 * Returns whether the browser supports HTML5 sessionStorage, and
 * does not have privacy mode enabled or cookies turned off.
 * @returns {Boolean} true if the browser supports sessionStorage
 * @name module:ac-feature.sessionStorageAvailable
 * @kind function
 */
feature.sessionStorageAvailable = function () {
	// Memoize previously returned value
	if (typeof this._sessionStorageAvailable !== 'undefined') {
		return this._sessionStorageAvailable;
	}

	try {
		if (typeof window.sessionStorage !== 'undefined' && typeof window.sessionStorage.setItem === 'function') {
			window.sessionStorage.setItem('ac_browser_detect', 'test');
			this._sessionStorageAvailable = true;
			window.sessionStorage.removeItem('ac_browser_detect', 'test');
		} else {
			this._sessionStorageAvailable = false;
		}
	} catch (e) {
		this._sessionStorageAvailable = false;
	}
	return this._sessionStorageAvailable;
};

/**
 * Returns whether the browser has cookies enabled.
 * @returns {Boolean} true if cookies are enabled.
 * @name module:ac-feature.cookiesAvailable
 * @kind function
 */
feature.cookiesAvailable = function () {
	// Memoize previously returned value
	if (typeof this._cookiesAvailable !== 'undefined') {
		return this._cookiesAvailable;
	}
	this._cookiesAvailable = (hasOwnProp.call(document, 'cookie') && !!navigator.cookieEnabled) ? true : false;
	return this._cookiesAvailable;
};


// Some devices swap the width/height when in landscape, so we want to make
// sure we're always reporting width as the lesser value. Except when the
// device isn't orientable, then we want to honor window.screen.width.
/** @ignore */
feature.__normalizedScreenWidth = function () {
	// We only care if the device is orientable
	if (typeof window.orientation === 'undefined') {
		return window.screen.width;
	}
	return window.screen.width < window.screen.height ? window.screen.width : window.screen.height;
};

/**
 * Tests for touch support on the device.
 * DocumentTouch is specific to Firefox <25 support.
 * @returns {Boolean} true if the device supports touch.
 * @name module:ac-feature.touchAvailable
 * @kind function
 */
feature.touchAvailable = function () {
	return !!(('ontouchstart' in window) || window.DocumentTouch && document instanceof window.DocumentTouch);
};

/**
 * Attempts to determine if device is a desktop. The test is based on the assumptions
 * that desktop machines don't support touch and aren't orientable
 * @returns {Boolean} true if device has no support for touch and orientation
 * @name module:ac-feature.isDesktop
 * @kind function
 */
feature.isDesktop = function () {
	if (!this.touchAvailable() && !window.orientation) {
		return true;
	}
	return false;
};

/**
 * Attempts to determine if device is handheld. e.g. phones and iPod Touches.
 * The test is based on the value of module:ac-feature.isDesktop() and
 * if the device screen width is less than or equal to 480 pixels.
 * @returns {Boolean} true if the device is determined to be handheld
 * @name module:ac-feature.isHandheld
 * @kind function
 */
feature.isHandheld = function () {
	return !this.isDesktop() && !this.isTablet();
};

/**
 * Attempts to determine if device is a tablet. i.e. iPad or Nexus 7.
 * The test is based on the value of module:ac-feature.isDesktop() and
 * if the device screen width is greater than 480 pixels.
 * @returns {Boolean} true if the device is determined to be a tablet
 * @name module:ac-feature.isTablet
 * @kind function
 */
feature.isTablet = function () {
	return !this.isDesktop() && this.__normalizedScreenWidth() > 480;
};

/**
 * Attempts to determine whether the display is retina.
 * @returns {Boolean} true if DPR is determined to be greater than or equal to 1.5
 * @name module:ac-feature.isRetina
 * @kind function
 */
feature.isRetina = function () {
	// Vendor prefixes and media queries for DPR detection are a mess
	var mediaQueryStrings = [
		'min-device-pixel-ratio:1.5',
		'-webkit-min-device-pixel-ratio:1.5',
		'min-resolution:1.5dppx',
		'min-resolution:144dpi',
		'min--moz-device-pixel-ratio:1.5'
	];
	var i;

	// Use devicePixelRatio if available
	if (window.devicePixelRatio !== undefined) {
		if (window.devicePixelRatio >= 1.5) {
			return true;
		}

	// Else resort to matchMedia
	} else {
		for (i = 0; i < mediaQueryStrings.length; i += 1) {
			if (window.matchMedia('(' + mediaQueryStrings[i] + ')').matches === true) {
				return true;
			}
		}
	}

	// Otherwise return false
	return false;
};

/**
 * Browser support for SVG in background images very closely matches that of SVG in <img> tags.
 * Detecting this feature checks for support as both inline and background images.
 * @returns {Boolean} true if SVG support is available
 * @name module:ac-feature.svgAvailable
 * @kind function
 */
feature.svgAvailable = function () {
	return document.implementation.hasFeature('http://www.w3.org/TR/SVG11/feature#Image', '1.1');
};

module.exports = feature;

},{"./ac-feature/cssPropertyAvailable":390,"./ac-feature/localStorageAvailable":391}],390:[function(require,module,exports){
'use strict';

var style = null;
var prefixes = null;
var preFixes = null;
var css = null;

/**
 * Sets all the vendor specific style property to value on element.
 * @param {String} property The CSS property to test, can be of the form: webkitBorderRadius, mozBorderRadius, etc.; borderRadius -webkit-border-radius, -moz-border-radius, etc.; border-radius
 * @returns true if the current browser supports the given CSS property, otherwise, returns false.
 * @name module:ac-feature.cssPropertyAvailable
 * @kind function
 */
module.exports = function (property) {

	if (style === null) {
		style = document.createElement('browserdetect').style;
	}
	if (prefixes === null) {
		prefixes = ['-webkit-', '-moz-', '-o-', '-ms-', '-khtml-', ''];
	}
	if (preFixes === null) {
		preFixes = ['Webkit', 'Moz', 'O', 'ms', 'Khtml', ''];
	}
	if (css === null) {
		css = {};
	}

	property = property.replace(/([A-Z]+)([A-Z][a-z])/g, '$1\\-$2').replace(/([a-z\d])([A-Z])/g, '$1\\-$2').replace(/^(\-*webkit|\-*moz|\-*o|\-*ms|\-*khtml)\-/, '').toLowerCase();
	switch (property) {
	case 'gradient':
		if (css.gradient !== undefined) {
			return css.gradient;
		}

		property = 'background-image:';
		var value1 = 'gradient(linear,left top,right bottom,from(#9f9),to(white));';
		var value2 = 'linear-gradient(left top,#9f9, white);';

		style.cssText = (property + prefixes.join(value1 + property) + prefixes.join(value2 + property)).slice(0, -property.length);
		css.gradient = (style.backgroundImage.indexOf('gradient') !== -1);
		return css.gradient;

	case 'inset-box-shadow':
		if (css['inset-box-shadow'] !== undefined) {
			return css['inset-box-shadow'];
		}

		property = 'box-shadow:';
		var value = '#fff 0 1px 1px inset;';

		style.cssText = prefixes.join(property + value);
		css['inset-box-shadow'] = (style.cssText.indexOf('inset') !== -1);
		return css['inset-box-shadow'];

	default:
		var properties = property.split('-');
		var length = properties.length;
		var Property;
		var i;
		var j;

		if (properties.length > 0) {
			property = properties[0];
			for (i = 1; i < length; i += 1) {
				property += properties[i].substr(0, 1).toUpperCase() + properties[i].substr(1);
			}
		}
		Property = property.substr(0, 1).toUpperCase() + property.substr(1);

		if (css[property] !== undefined) {
			return css[property];
		}

		for (j = preFixes.length - 1; j >= 0; j -= 1) {
			if (style[preFixes[j] + property] !== undefined || style[preFixes[j] + Property] !== undefined) {
				css[property] = true;
				return true;
			}
		}
		return false;
	}
};

},{}],391:[function(require,module,exports){
'use strict';

var isAvailable = null;

/**
 * Returns whether the browser supports HTML5 localStorage, and
 * does not have privacy mode enabled or cookies turned off.
 * NOTE: Does not support Firefox <= 13 because of a bug where Firefox interprets a nonexistent item as null instead of undefined
 * @returns {Boolean} true if the browser supports localStorage
 * @name module:ac-feature.localStorageAvailable
 * @kind function
 */
module.exports = function localStorageAvailable() {
	// Memoize previously returned value
	if (isAvailable === null) {
		isAvailable = !!(window.localStorage && window.localStorage.non_existent !== null);
	}
	return isAvailable;
};

},{}],392:[function(require,module,exports){
/**
 * @module ac-experience-reporter
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

var ExperienceReporter = require('./ac-experience-reporter/ExperienceReporter');

module.exports = new ExperienceReporter();
module.exports.ExperienceReporter = ExperienceReporter;

},{"./ac-experience-reporter/ExperienceReporter":394}],393:[function(require,module,exports){
'use strict';

var ExperienceObject = function (data, environment) {

	this._data = data;
	this._environment = environment;

	this.experienceObject = this._matchExperienceToEnvironment() || {};
	this.experience = this.experienceObject.type || 'static';

	return this;
};


var proto = ExperienceObject.prototype;

// return the single, most specific, matched experience bucket
proto._matchExperienceToEnvironment = function () {
	var matchedExperience = false;
	// match our environment to the experience data JSON buckets
	var filteredEnhancements = this._filterByEnvironment();

	// select the most specific of the matched experience buckets
	if (filteredEnhancements.length > 0) {
		matchedExperience = filteredEnhancements.length === 1 ? filteredEnhancements[0] : this._filterBySpecificity(filteredEnhancements);
	}

	return matchedExperience;
};



// match our environment to the experience data JSON buckets
// may return multiple matched experiences as some may be more specific than others, but still match
// Includes all buckets whose values all jive with reported environment
proto._filterByEnvironment = function () {

	var filteredEnhancements = this._data.filter(function (enhancementObj) {
		var match = false;

		for (var prop in enhancementObj) {
			// don't include 'type' in comparison
			if (prop !== 'type' && enhancementObj.hasOwnProperty(prop)) {
				if (/^min_/.test(prop)) {
					match = this._environment[prop.replace(/^min_/, '')] >= enhancementObj[prop];

				} else if (/^max_/.test(prop)) {
					match = this._environment[prop.replace(/^max_/, '')] <= enhancementObj[prop];

				} else {
					match = enhancementObj[prop] === this._environment[prop];
				}

				if (!match) {
					// break if we get a false value
					break;
				}
			}
		}
		return match;
	}, this);

	return filteredEnhancements;
};



// filter the matched experience buckets to return the most specific experience match
proto._filterBySpecificity = function (reducedObjects) {
	var objects = reducedObjects;
	var maxLength = 0;
	var filtered = [];

	// figure out the highest number of keys in the objects
	objects.forEach(function (obj) {
		var len = Object.keys(obj).length;
		maxLength = len > maxLength ? len : maxLength;
	});

	// load filtered array with objects that match the maxLength
	objects.forEach(function (obj) {
		var len = Object.keys(obj).length;
		if (len === maxLength) {
			filtered.push(obj);
		}
	});

	// if it is a tie between two objects, return the first in the array
	// although if there is a tie, they should theoreticaly be identical
	return filtered[0];
};



module.exports = ExperienceObject;



},{}],394:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

var ac_Browser = require('ac-browser');
var ac_Feature = require('ac-feature');
var castToFloat = require('../utils/castToFloat');
var ExperienceObject = require('./ExperienceObject');


/**
 * @name ExperienceReporter
 * @constructor
 *
 * @desc Returns specific data based on a supplied dataset and the browser’s environment
 *
 */
function ExperienceReporter () {
	this._environment = this._setEnvironment();
}

var proto = ExperienceReporter.prototype;


proto.newExperience = function (data) {

	// Parse data to make sure all `version` properties are cast to floats
	data.forEach(function (experienceObjectData) {
		var prop;

		for (prop in experienceObjectData) {
			if (experienceObjectData.hasOwnProperty(prop)) {
				if (/(^(min_|max_))|((_version|_width|_height)$)/.test(prop)) {
					experienceObjectData[prop] = castToFloat(experienceObjectData[prop]);
				}
			}
		}
	});

	return new ExperienceObject(data, this._environment);
};

// returns information about the users browser
proto.getEnvironment = function() {
	return this._environment;
};

// builds the environment object
proto._setEnvironment = function() {
	var environment = {
		// add platform type to the environment object
		platform: this._setPlatform(),

		// add OS data to the environment object
		os: ac_Browser.os.toLowerCase(),
		os_version: castToFloat(ac_Browser.osVersion),

		// add browser data to the environment object
		browser: ac_Browser.name.toLowerCase(),
		browser_version: castToFloat(ac_Browser.version),

		retina: ac_Feature.isRetina(),

		// viewport dims
		viewport_width: window.innerWidth,
		viewport_height: window.innerHeight
	};

	return environment;
};

proto._setPlatform = function() {
	var platform = 'desktop';

	if (ac_Feature.isTablet()) {
		platform = 'tablet';
	} else if (ac_Feature.isHandheld()) {
		platform = 'handheld';
	}

	return platform;
};

module.exports = ExperienceReporter;

},{"../utils/castToFloat":395,"./ExperienceObject":393,"ac-browser":49,"ac-feature":389}],395:[function(require,module,exports){
'use strict';

module.exports = function castToFloat(value) {
	return window.parseFloat(value, 10);
};

},{}],396:[function(require,module,exports){
/**
 * @module ac-prefixer
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

var Prefixer = require('./ac-prefixer/Prefixer');

module.exports = new Prefixer();
module.exports.Prefixer = Prefixer;

},{"./ac-prefixer/Prefixer":397}],397:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var camelCasedEvents = require('./Prefixer/camelCasedEvents');

var RE_CSS_FUNCTION_PARAMS = /(\([^\)]+\))/gi;
var RE_CSS_VALUES = /([^ ,;\(]+(\([^\)]+\))?)/gi;
var RE_ALL_PREFIXES = /(-webkit-|-moz-|-ms-)|^(webkit|moz|ms)/gi;
var RE_DOM_PREFIXES = /^(webkit|moz|ms)/gi;
var CSS_PREFIXES = ['-webkit-', '-moz-', '-ms-'];
var DOM_PREFIXES = ['Webkit', 'Moz', 'ms'];
var EVT_PREFIXES = ['webkit', 'moz', 'ms'];

/**
 * @name module:ac-prefixer.Prefixer
 *
 * @class
 *
 * @desc Helper methods for prefixing CSS properties and values, and event types.
 *
 */
function Prefixer() {
	this._supportsAvailable = ('CSS' in window && 'supports' in window.CSS);
	this._cssPrefixes = CSS_PREFIXES;
	this._domPrefixes = DOM_PREFIXES;
	this._evtPrefixes = EVT_PREFIXES;
	this._styleProperties = {};
	this._styleValues = {};
	this._eventTypes = {};
}

var proto = Prefixer.prototype;

/**
 * @name module:ac-prefixer.Prefixer#getEventType
 *
 * @function
 *
 * @desc Get an Event type with appropriate vendor prefix and casing.
 *
 * @param {String} type
 *        A lowercase string representing the Event type.
 *        e.g., "click", "transitionend"
 *
 * @returns {String} The prefixed Event type.
 */
proto.getEventType = function (type) {
	var prop;
	var i;

	type = type.toLowerCase();

	if (type in this._eventTypes) {
		return this._eventTypes[type];
	}

	// unprefixed first
	if (this._checkEventType('on' + type)) {
		return this._eventTypes[type] = type;
	}

	// camelCased vendor prefixes
	if (camelCasedEvents[type]) {
		for (prop in camelCasedEvents[type]) {
			if (this._checkEventType(prop)) {
				return this._eventTypes[type] = camelCasedEvents[type][prop];
			}
		}
	}

	// lowercase vendor prefixes
	for (i = 0; i < this._evtPrefixes.length; i++) {
		if (this._checkEventType('on' + this._evtPrefixes[i] + type)) {
			this._eventTypes[type] = this._evtPrefixes[i] + type;
			this._reduceAvailablePrefixes(i);
			return this._eventTypes[type];
		}
	}

	// default to lowercase and unprefixed
	return this._eventTypes[type] = type;
};

/**
 * @name module:ac-prefixer.Prefixer#getEventType
 *
 * @function
 * @private
 *
 * @desc Check if an Event type is available.
 *
 * @param {String} type
 *        A DOM-style string representing the Event type.
 *        e.g., "onclick", "ontransitionend", "onwebkittransitionend"
 *
 * @returns {String} The prefixed Event type.
 */
proto._checkEventType = function (type) {
	return (type in window || type in document);
};

/**
 * @name module:ac-prefixer.Prefixer#getStyleProperty
 *
 * @function
 *
 * @desc Returns the property in DOM form with vendor prefix, as needed.
 *
 * @param {String} property
 *        The unprefixed property name in CSS or DOM form.
 *
 * @returns {String|Boolean} The property in DOM form, or `false` if not available.
 */
proto.getStyleProperty = function (property) {
	var properties;
	var ucProperty;
	var i;

	property += '';

	if (property in this._styleProperties) {
		return this._styleProperties[property].dom;
	}

	property = this._toDOM(property);

	this._prepareTestElement();

	ucProperty = property.charAt(0).toUpperCase() + property.substr(1);

	if (property === 'filter') {
		// Chrome has both prefixed and unprefixed `filter`
		// but only the prefixed version is fully implemented.
		// Firefox isn't prefixed, so we drop it here.
		properties = ['WebkitFilter', 'filter'];
	} else {
		properties = (property + ' ' + this._domPrefixes.join(ucProperty + ' ') + ucProperty).split(' ');
	}

	for (i = 0; i < properties.length; i++) {
		if (this._el.style[properties[i]] !== undefined) {

			if (i !== 0) {
				this._reduceAvailablePrefixes(i - 1);
			}

			this._memoizeStyleProperty(property, properties[i]);
			return properties[i];
		}
	}

	this._memoizeStyleProperty(property, false);
	return false;
};

/**
 * @name module:ac-prefixer.Prefixer#_memoizeStyleProperty
 *
 * @function
 * @private
 *
 * @desc Memoize the results of getStyleProperty
 *
 * @param {String} property
 *        The unprefixed property name in DOM form.
 *
 * @param {String} prefixed
 *        The properly prefixed property name in DOM form.
 */
proto._memoizeStyleProperty = function (property, prefixed) {
	var cssProperty = this._toCSS(property);
	var cssPrefixed = (prefixed === false) ? false : this._toCSS(prefixed);

	this._styleProperties[property] =
		this._styleProperties[prefixed] =
		this._styleProperties[cssProperty] =
		this._styleProperties[cssPrefixed] = {
			dom: prefixed,
			css: cssPrefixed
		};
};

/**
 * @name module:ac-prefixer.Prefixer#getStyleCSS
 *
 * @function
 *
 * @desc Returns a CSS property or full CSS rule with vendor prefixes, as needed.
 *
 * @param {String} property
 *        The unprefixed property name in CSS or DOM form.
 *
 * @param {String} [value]
 *        The unprefixed property's value.
 *
 * @returns {String|Boolean}
 *          The property in CSS form if no value is provided.
 *          The full CSS rule if a value is provided.
 *          `false` if the property and/or value are not avialable.
 */
proto.getStyleCSS = function (property, value) {
	var css;

	property = this.getStyleProperty(property);

	if (!property) {
		return false;
	}

	css = this._styleProperties[property].css;

	if (typeof value !== 'undefined') {
		value = this.getStyleValue(property, value);

		if (value === false) {
			return false;
		}

		css += ':' + value + ';';
	}

	return css;
};

/**
 * @name module:ac-prefixer.Prefixer#getStyleValue
 *
 * @function
 *
 * @desc Returns the value for a specific property with vendor prefix(es), as needed.
 *
 * @param {String} property
 *        The unprefixed property name in CSS or DOM form.
 *
 * @param {String} value
 *        The unprefixed property value.
 *
 * @returns {String|Boolean} The value, or `false` if not available.
 */
proto.getStyleValue = function (property, value) {
	var cssProperty;

	value += '';
	property = this.getStyleProperty(property);

	if (!property) {
		return false;
	}

	if (this._testStyleValue(property, value)) {
		return value;
	}

	cssProperty = this._styleProperties[property].css;

	value = value.replace(RE_CSS_VALUES, function (match) {
		var values;
		var valueKey;
		var key;
		var i;

		// ignore colors and numbers
		if (match[0] === '#' || !isNaN(match[0])) {
			return match;
		}

		// check memoized value
		valueKey = match.replace(RE_CSS_FUNCTION_PARAMS, '');
		key = cssProperty + ':' + valueKey;
		if (key in this._styleValues) {
			if (this._styleValues[key] === false) {
				// value not supported, stripped
				return '';
			}

			return match.replace(valueKey, this._styleValues[key]);
		}

		// prepare potential prefixes
		values = this._cssPrefixes.map(function (prefix) {
			return prefix + match;
		});
		values = [match].concat(values);

		// check potential prefixes
		for (i = 0; i < values.length; i++) {
			if (this._testStyleValue(property, values[i])) {
				// valid prefix found

				if (i !== 0) {
					this._reduceAvailablePrefixes(i - 1);
				}

				this._styleValues[key] = values[i].replace(RE_CSS_FUNCTION_PARAMS, '');
				return values[i];
			}
		}

		// value not supported, stripped
		this._styleValues[key] = false;
		return '';
	}.bind(this));

	value = value.trim();
	return (value === '') ? false : value;
};

/**
 * @name module:ac-prefixer.Prefixer#_testStyleValue
 *
 * @function
 * @private
 *
 * @desc Determine whether or not a CSS value is valid
 *
 * @param {String} property
 *        The property name in DOM form, prefixed as needed.
 *
 * @param {String} value
 *        The value to test.
 *
 * @returns {Boolean} `true` if the value is valid, otherwise `false`.
 */
proto._testStyleValue = function (property, value) {
	var before;

	if (this._supportsAvailable) {
		property = this._styleProperties[property].css;
		return CSS.supports(property, value);
	}

	this._prepareTestElement();
	before = this._el.style[property];

	try {
		this._el.style[property] = value;
	} catch (e) {
		// Old IE throws an error for invalid values
		return false;
	}

	return (this._el.style[property] && this._el.style[property] !== before);
};

/**
 * @name module:ac-prefixer.Prefixer#stripPrefixes
 *
 * @function
 *
 * @desc Strips vendor prefixes from a property or value.
 *
 * @param {String} str
 *        The property or value in CSS or DOM form.
 *
 * @returns {String} String in original form with vendor prefixes removed.
 */
proto.stripPrefixes = function (str) {
	str = String.prototype.replace.call(str, RE_ALL_PREFIXES, '');
	return str.charAt(0).toLowerCase() + str.slice(1);
};

/**
 * @name module:ac-prefixer.Prefixer#_reduceAvailablePrefixes
 *
 * @function
 * @private
 *
 * @desc Reduces the possible CSS and DOM prefixes to a single item.
 *
 * @param {Integer} index
 *        The index of the prefix to keep.
 */
proto._reduceAvailablePrefixes = function (index) {
	if (this._cssPrefixes.length !== 1) {
		this._cssPrefixes = [this._cssPrefixes[index]];
		this._domPrefixes = [this._domPrefixes[index]];
		this._evtPrefixes = [this._evtPrefixes[index]];
	}
};

/**
 * @name module:ac-prefixer.Prefixer#_toDOM
 *
 * @function
 * @private
 *
 * @desc Converts a property to DOM form (i.e., "WebkitPropertyName").
 *
 * @param {String} str
 *        The property in CSS or DOM form.
 *
 * @returns {String} String in DOM form.
 */
proto._toDOM = function (str) {
	var i;

	if (str.toLowerCase() === 'float') {
		return 'cssFloat';
	}

	str = str.replace(/-([a-z])/g, function (str, m1) {
		return m1.toUpperCase();
	});

	if (str.substr(0, 2) === 'Ms') {
		str = 'ms' + str.substr(2);
	}

	return str;
};

/**
 * @name module:ac-prefixer.Prefixer#_toCSS
 *
 * @function
 * @private
 *
 * @desc Converts a property or value to CSS form (i.e., "-webkit-property-name").
 *
 * @param {String} str
 *        The property or value in CSS or DOM form.
 *
 * @returns {String} String in CSS form.
 */
proto._toCSS = function (str) {
	var i;

	if (str.toLowerCase() === 'cssfloat') {
		return 'float';
	}

	if (RE_DOM_PREFIXES.test(str)) {
		str = '-' + str;
	}

	return str.replace(/([A-Z]+)([A-Z][a-z])/g, '$1-$2').replace(/([a-z\d])([A-Z])/g, '$1-$2').toLowerCase();
};

/**
 * @name module:ac-prefixer.Prefixer#_prepareTestElement
 *
 * @function
 * @private
 *
 * @desc Creates the test Element and/or resets it's style properties.
 */
proto._prepareTestElement = function () {
	if (!this._el) {
		this._el = document.createElement('_');
	} else {
		this._el.style.cssText = '';
		this._el.removeAttribute('style');
	}
};

module.exports = Prefixer;

},{"./Prefixer/camelCasedEvents":398}],398:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
module.exports = {
	transitionend: {
		onwebkittransitionend: 'webkitTransitionEnd',
		onmstransitionend: 'MSTransitionEnd'
	},
	animationstart: {
		onwebkitanimationstart: 'webkitAnimationStart',
		onmsanimationstart: 'MSAnimationStart'
	},
	animationend: {
		onwebkitanimationend: 'webkitAnimationEnd',
		onmsanimationend: 'MSAnimationEnd'
	},
	animationiteration: {
		onwebkitanimationiteration: 'webkitAnimationIteration',
		onmsanimationiteration: 'MSAnimationIteration'
	},
	fullscreenchange: {
		onmsfullscreenchange: 'MSFullscreenChange'
	},
	fullscreenerror: {
		onmsfullscreenerror: 'MSFullscreenError'
	}
};

},{}],399:[function(require,module,exports){
/**
 * @module ac-feature
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var memoize = require('./ac-feature/helpers/memoize');
var memoizeBlacklist = [
	'cssPropertyAvailable', // delegated to ac-prefixer
	'isRetina' // value can change
];
var method;

/**
 * @name module:ac-feature
 * @kind namespace
 */
var ac_feature = {
	canvasAvailable: require('./ac-feature/canvasAvailable'),
	continuousScrollEventsAvailable: require('./ac-feature/continuousScrollEventsAvailable'),
	cookiesAvailable: require('./ac-feature/cookiesAvailable'),
	cssLinearGradientAvailable: require('./ac-feature/cssLinearGradientAvailable'),
	cssPropertyAvailable: require('./ac-feature/cssPropertyAvailable'),
	isDesktop: require('./ac-feature/isDesktop'),
	isHandheld: require('./ac-feature/isHandheld'),
	isRetina: require('./ac-feature/isRetina'),
	isTablet: require('./ac-feature/isTablet'),
	localStorageAvailable: require('./ac-feature/localStorageAvailable'),
	mediaElementsAvailable: require('./ac-feature/mediaElementsAvailable'),
	sessionStorageAvailable: require('./ac-feature/sessionStorageAvailable'),
	svgAvailable: require('./ac-feature/svgAvailable'),
	threeDTransformsAvailable: require('./ac-feature/threeDTransformsAvailable'),
	touchAvailable: require('./ac-feature/touchAvailable'),
	webGLAvailable: require('./ac-feature/webGLAvailable')
};

for (method in ac_feature) {
	if (memoizeBlacklist.indexOf(method) === -1) {
		ac_feature[method] = memoize(ac_feature[method]);
	}
}

module.exports = ac_feature;

},{"./ac-feature/canvasAvailable":400,"./ac-feature/continuousScrollEventsAvailable":401,"./ac-feature/cookiesAvailable":402,"./ac-feature/cssLinearGradientAvailable":403,"./ac-feature/cssPropertyAvailable":404,"./ac-feature/helpers/memoize":406,"./ac-feature/isDesktop":407,"./ac-feature/isHandheld":408,"./ac-feature/isRetina":409,"./ac-feature/isTablet":410,"./ac-feature/localStorageAvailable":411,"./ac-feature/mediaElementsAvailable":412,"./ac-feature/sessionStorageAvailable":413,"./ac-feature/svgAvailable":414,"./ac-feature/threeDTransformsAvailable":415,"./ac-feature/touchAvailable":416,"./ac-feature/webGLAvailable":417}],400:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var globalsHelper = require('./helpers/globals');

/**
 * @name module:ac-feature.canvasAvailable
 *
 * @function
 *
 * @desc Returns the availability of the HTML5 Canvas API.
 *
 * @returns {Boolean} `true` if the browser supports canvas, otherwise `false`.
 */
module.exports = function canvasAvailable() {
	var documentObj = globalsHelper.getDocument();
	var canvas = documentObj.createElement('canvas');

	return !!(typeof canvas.getContext === 'function' && canvas.getContext('2d'));
};

},{"./helpers/globals":405}],401:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var ac_browser = require('ac-browser');
var touchAvailable = require('./touchAvailable');

/**
 * @name module:ac-feature.continuousScrollEventsAvailable
 *
 * @function
 *
 * @desc Returns the availability of continuous scroll events.
 *       iOS < 8 pauses painting and does not fire scroll events during scroll (only at the start and end).
 *
 * @returns {Boolean} `true` if scroll events are fired during scrolling, otherwise `false`.
 */
module.exports = function continuousScrollEventsAvailable() {
	return (!touchAvailable() || (ac_browser.os === 'iOS' && ac_browser.version >= 8) || ac_browser.name === 'Chrome');
};

},{"./touchAvailable":416,"ac-browser":49}],402:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var globalsHelper = require('./helpers/globals');

/**
 * @name module:ac-feature.cookiesAvailable
 *
 * @function
 *
 * @desc Returns the availability of cookies.
 *
 * @returns {Boolean} `true` if cookies are enabled, otherwise `false`.
 */
module.exports = function cookiesAvailable() {
	var available = false;
	var documentObj = globalsHelper.getDocument();
	var navigatorObj = globalsHelper.getNavigator();

	try {
		if ('cookie' in documentObj && !!navigatorObj.cookieEnabled) {
			documentObj.cookie = 'ac_feature_cookie=1';
			available = (documentObj.cookie.indexOf('ac_feature_cookie') !== -1);
			documentObj.cookie = 'ac_feature_cookie=; expires=Thu, 01 Jan 1970 00:00:01 GMT;';
		}
	} catch (err) {}

	return available;
};

},{"./helpers/globals":405}],403:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var cssPropertyAvailable = require('./cssPropertyAvailable');

/**
 * @name module:ac-feature.cssLinearGradientAvailable
 *
 * @function
 *
 * @desc Returns the availability of linear-gradient() in CSS, including vendor-prefixed flavors.
 *
 * @returns {Boolean} `true` if linear-gradient() is available, otherwise `false`.
 */
module.exports = function cssLinearGradientAvailable() {
	var values = [
		'linear-gradient(to bottom right, #9f9, white)',
		'linear-gradient(top left, #9f9, white)',
		'gradient(linear, left top, right bottom, from(#9f9), to(white))'
	];

	return values.some(function (value) {
		return cssPropertyAvailable('background-image', value);
	});
};

},{"./cssPropertyAvailable":404}],404:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var prefixer = require('ac-prefixer');

/**
 * @name module:ac-feature.cssPropertyAvailable
 *
 * @function
 *
 * @desc Returns the availability of a CSS property including vendor-prefixed flavors, along with an optional value.
 *
 * @param {String} property
 *        The CSS property to test.
 *        Can be in DOM (borderRadius) or CSS (border-radius) form.
 *
 * @param {String} [value]
 *        An optional value to test.
 *
 * @returns {Boolean} `true` if the browser supports the given CSS property/value, otherwise `false`.
 */
module.exports = function cssPropertyAvailable(property, value) {
	if (typeof value !== 'undefined') {
		return !!prefixer.getStyleValue(property, value);
	} else {
		return !!prefixer.getStyleProperty(property);
	}
};

},{"ac-prefixer":396}],405:[function(require,module,exports){
arguments[4][240][0].apply(exports,arguments)
},{"dup":240}],406:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name memoize
 *
 * @function
 * @private
 *
 * @desc Memoize a Function's return value
 *
 * @returns {Function} A Function with memoized results.
 */
module.exports = function memoize(fnc) {
	var result;

	return function () {
		if (typeof result !== 'undefined') {
			return result;
		} else {
			return result = fnc();
		}
	};
};

},{}],407:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var touchAvailable = require('./touchAvailable');
var globalsHelper = require('./helpers/globals');

/**
 * @name module:ac-feature.isDesktop
 *
 * @function
 *
 * @desc Attempts to determine if device is a Desktop.
 *       The test is based on the assumptions that desktops don't support touch and aren't orientable.
 *
 * @returns {Boolean} `true` if device does not support touch and/or orientation, otherwise `false`.
 */
module.exports = function isDesktop() {
	var windowObj = globalsHelper.getWindow();

	return (!touchAvailable() && !windowObj.orientation);
};

},{"./helpers/globals":405,"./touchAvailable":416}],408:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var isDesktop = require('./isDesktop');
var isTablet = require('./isTablet');

/**
 * @name module:ac-feature.isHandheld
 *
 * @function
 *
 * @desc Attempts to determine if device is a Handheld (e.g., iPhone, iPod Touch, etc).
 *       The test is based on the value of [isDesktop()]{module:ac-feature.isDesktop()}
 *       and if the device screen width is < 600px.
 *
 * @returns {Boolean} `true` if device is not a Desktop or Tablet, otherwise `false`.
 */
module.exports = function isHandheld() {
	return (!isDesktop() && !isTablet());
};

},{"./isDesktop":407,"./isTablet":410}],409:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var globalsHelper = require('./helpers/globals');

/**
 * @name module:ac-feature.isRetina
 *
 * @function
 *
 * @desc Determines whether or not the display is Retina.
 *
 * @returns {Boolean} `true` if the DPR is >= 1.5, otherwise `false`.
 */
module.exports = function isRetina() {
	var windowObj = globalsHelper.getWindow();
	return ('devicePixelRatio' in windowObj && windowObj.devicePixelRatio >= 1.5);
};

},{"./helpers/globals":405}],410:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var isDesktop = require('./isDesktop');
var globalsHelper = require('./helpers/globals');

/**
 * @name module:ac-feature.isTablet
 *
 * @function
 *
 * @desc Attempts to determine if device is a Tablet.
 *       The test is based on the values of [isDesktop()]{module:ac-feature.isDesktop()}
 *       and if the device screen width is >= 600px.
 *
 * @returns {Boolean} `true` if device is determined to be a Tablet otherwise `false`.
 */
module.exports = function isTablet() {
	var windowObj = globalsHelper.getWindow();
	var width = windowObj.screen.width;

	if (windowObj.orientation && windowObj.screen.height < width) {
		// normalize screen width for orientable devices
		width = windowObj.screen.height;
	}

	return (!isDesktop() && width >= 600);
};

},{"./helpers/globals":405,"./isDesktop":407}],411:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var globalsHelper = require('./helpers/globals');

/**
 * @name module:ac-feature.localStorageAvailable
 *
 * @function
 *
 * @desc Returns the availability of HTML5 localStorage.
 *       Privacy mode must be disabled and cookies must be enabled.
 *       NOTE: Does not support Firefox <= 13 because of a bug where Firefox
 *       interprets a nonexistent item as null instead of undefined
 *
 * @returns {Boolean} `true` if localStorage is available, otherwise `false`.
 */
module.exports = function localStorageAvailable() {
	var windowObj = globalsHelper.getWindow();
	var available = false;

	try {
		available = !!(windowObj.localStorage && windowObj.localStorage.non_existent !== null);
	} catch (err) {}

	return available;
};

},{"./helpers/globals":405}],412:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var globalsHelper = require('./helpers/globals');

/**
 * @name module:ac-feature.mediaElementsAvailable
 *
 * @function
 *
 * @desc Returns the availability of HTML5 video/audio tags
 *
 * @returns {Boolean} `true` if the browser supports video/audio tags, otherwise `false`.
 */
module.exports = function mediaElementsAvailable() {
	var windowObj = globalsHelper.getWindow();

	return ('HTMLMediaElement' in windowObj);
};

},{"./helpers/globals":405}],413:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var globalsHelper = require('./helpers/globals');

/**
 * @name module:ac-feature.sessionStorageAvailable
 *
 * @function
 *
 * @desc Returns the availability of HTML5 sessionStorage.
 *       Privacy mode must be disabled and cookies must be enabled.
 *
 * @returns {Boolean} `true` if sessionStorage is available, otherwise `false`.
 */
module.exports = function sessionStorageAvailable() {
	var windowObj = globalsHelper.getWindow();
	var available = false;

	try {
		if ('sessionStorage' in windowObj && typeof windowObj.sessionStorage.setItem === 'function') {
			windowObj.sessionStorage.setItem('ac_feature', 'test');
			available = true;
			windowObj.sessionStorage.removeItem('ac_feature', 'test');
		}
	} catch (e) {}

	return available;
};

},{"./helpers/globals":405}],414:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var globalsHelper = require('./helpers/globals');

/**
 * @name module:ac-feature.svgAvailable
 *
 * @function
 *
 * @desc Returns the availability of SVG for <img> tags and background images.
 *
 * @returns {Boolean} `true` if SVG is supported, otherwise `false`.
 */
module.exports = function svgAvailable() {
	var documentObj = globalsHelper.getDocument();

	return documentObj.implementation.hasFeature('http://www.w3.org/TR/SVG11/feature#Image', '1.1');
};

},{"./helpers/globals":405}],415:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var cssPropertyAvailable = require('./cssPropertyAvailable');

/**
 * @name module:ac-feature.threeDTransformsAvailable
 *
 * @function
 *
 * @desc Returns the availability of 3D transforms (e.g., 'translateZ').
 *
 * @returns {Boolean} `true` if 3D transforms are supported, otherwise `false`.
 */
module.exports = function threeDTransformsAvailable() {
	return (cssPropertyAvailable('perspective', '1px') && cssPropertyAvailable('transform', 'translateZ(0)'));
};

},{"./cssPropertyAvailable":404}],416:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var globalsHelper = require('./helpers/globals');

/**
 * @name module:ac-feature.touchAvailable
 *
 * @function
 *
 * @desc Returns the availability of touch events.
 *
 * @returns {Boolean} `true` if touch events are supported, otherwise `false`.
 */
module.exports = function touchAvailable() {
	var windowObj = globalsHelper.getWindow();
	var documentObj = globalsHelper.getDocument();

	// DocumentTouch is specific to Firefox <25 support.
	return !!(('ontouchstart' in windowObj) || windowObj.DocumentTouch && documentObj instanceof windowObj.DocumentTouch);
};

},{"./helpers/globals":405}],417:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var globalsHelper = require('./helpers/globals');

/**
 * @name module:ac-feature.webGLAvailable
 *
 * @function
 *
 * @desc Returns the availability of the HTML5 webGL API.
 *
 * @returns {Boolean} `true` if the browser supports webGL, otherwise `false`.
 */
module.exports = function webGLAvailable() {
	var documentObj = globalsHelper.getDocument();
	var canvas = documentObj.createElement('canvas');

	return !!(typeof canvas.getContext === 'function' && canvas.getContext('webgl'));
};

},{"./helpers/globals":405}],418:[function(require,module,exports){
arguments[4][203][0].apply(exports,arguments)
},{"./ac-clock/Clock":419,"./ac-clock/ThrottledClock":420,"./ac-clock/sharedClockInstance":421,"dup":203}],419:[function(require,module,exports){
arguments[4][204][0].apply(exports,arguments)
},{"ac-event-emitter":572,"dup":204}],420:[function(require,module,exports){
arguments[4][205][0].apply(exports,arguments)
},{"./sharedClockInstance":421,"ac-event-emitter":572,"dup":205}],421:[function(require,module,exports){
arguments[4][206][0].apply(exports,arguments)
},{"./Clock":419,"dup":206}],422:[function(require,module,exports){
/** 
 * @module ac-console
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

module.exports = {
	log: require('./ac-console/log')
};

},{"./ac-console/log":423}],423:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

var debugMessagingKey = 'f7c9180f-5c45-47b4-8de4-428015f096c0';
var allowDebugMessaging = !!(function () {
	try { return window.localStorage.getItem(debugMessagingKey); } catch (err) {}
}());

module.exports = function log () {
	if (window.console && typeof console.log !== 'undefined' && allowDebugMessaging) {
		console.log.apply(console, Array.prototype.slice.call(arguments, 0));
	}
};

},{}],424:[function(require,module,exports){
arguments[4][89][0].apply(exports,arguments)
},{"dup":89}],425:[function(require,module,exports){
arguments[4][90][0].apply(exports,arguments)
},{"dup":90}],426:[function(require,module,exports){
arguments[4][91][0].apply(exports,arguments)
},{"dup":91}],427:[function(require,module,exports){
arguments[4][92][0].apply(exports,arguments)
},{"dup":92}],428:[function(require,module,exports){
arguments[4][93][0].apply(exports,arguments)
},{"dup":93}],429:[function(require,module,exports){
arguments[4][94][0].apply(exports,arguments)
},{"dup":94}],430:[function(require,module,exports){
arguments[4][95][0].apply(exports,arguments)
},{"dup":95}],431:[function(require,module,exports){
arguments[4][96][0].apply(exports,arguments)
},{"./ELEMENT_NODE":428,"./internal/isNodeType":437,"ac-polyfills/Array/prototype.filter":797,"ac-polyfills/Array/prototype.slice":799,"dup":96}],432:[function(require,module,exports){
arguments[4][97][0].apply(exports,arguments)
},{"./COMMENT_NODE":424,"./DOCUMENT_FRAGMENT_NODE":425,"./DOCUMENT_NODE":426,"./DOCUMENT_TYPE_NODE":427,"./ELEMENT_NODE":428,"./TEXT_NODE":429,"./createDocumentFragment":430,"./filterByNodeType":431,"./insertAfter":433,"./insertBefore":434,"./insertFirstChild":435,"./insertLastChild":436,"./isComment":439,"./isDocument":440,"./isDocumentFragment":441,"./isDocumentType":442,"./isElement":443,"./isNode":444,"./isNodeList":445,"./isTextNode":446,"./remove":447,"./replace":448,"dup":97}],433:[function(require,module,exports){
arguments[4][98][0].apply(exports,arguments)
},{"./internal/validate":438,"dup":98}],434:[function(require,module,exports){
arguments[4][99][0].apply(exports,arguments)
},{"./internal/validate":438,"dup":99}],435:[function(require,module,exports){
arguments[4][100][0].apply(exports,arguments)
},{"./internal/validate":438,"dup":100}],436:[function(require,module,exports){
arguments[4][101][0].apply(exports,arguments)
},{"./internal/validate":438,"dup":101}],437:[function(require,module,exports){
arguments[4][102][0].apply(exports,arguments)
},{"../isNode":444,"dup":102}],438:[function(require,module,exports){
arguments[4][103][0].apply(exports,arguments)
},{"../COMMENT_NODE":424,"../DOCUMENT_FRAGMENT_NODE":425,"../ELEMENT_NODE":428,"../TEXT_NODE":429,"./isNodeType":437,"dup":103}],439:[function(require,module,exports){
arguments[4][104][0].apply(exports,arguments)
},{"./COMMENT_NODE":424,"./internal/isNodeType":437,"dup":104}],440:[function(require,module,exports){
arguments[4][105][0].apply(exports,arguments)
},{"./DOCUMENT_NODE":426,"./internal/isNodeType":437,"dup":105}],441:[function(require,module,exports){
arguments[4][106][0].apply(exports,arguments)
},{"./DOCUMENT_FRAGMENT_NODE":425,"./internal/isNodeType":437,"dup":106}],442:[function(require,module,exports){
arguments[4][107][0].apply(exports,arguments)
},{"./DOCUMENT_TYPE_NODE":427,"./internal/isNodeType":437,"dup":107}],443:[function(require,module,exports){
arguments[4][108][0].apply(exports,arguments)
},{"./ELEMENT_NODE":428,"./internal/isNodeType":437,"dup":108}],444:[function(require,module,exports){
arguments[4][109][0].apply(exports,arguments)
},{"dup":109}],445:[function(require,module,exports){
arguments[4][110][0].apply(exports,arguments)
},{"dup":110}],446:[function(require,module,exports){
arguments[4][111][0].apply(exports,arguments)
},{"./TEXT_NODE":429,"./internal/isNodeType":437,"dup":111}],447:[function(require,module,exports){
arguments[4][112][0].apply(exports,arguments)
},{"./internal/validate":438,"dup":112}],448:[function(require,module,exports){
arguments[4][113][0].apply(exports,arguments)
},{"./internal/validate":438,"dup":113}],449:[function(require,module,exports){
arguments[4][173][0].apply(exports,arguments)
},{"./internal/validate":451,"./matchesSelector":452,"ac-dom-nodes/isElement":443,"dup":173}],450:[function(require,module,exports){
arguments[4][179][0].apply(exports,arguments)
},{"dup":179}],451:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

require('ac-polyfills/Array/prototype.indexOf');

/** @ignore */
var isNode = require('ac-dom-nodes/isNode');
var COMMENT_NODE = require('ac-dom-nodes/COMMENT_NODE');
var DOCUMENT_FRAGMENT_NODE = require('ac-dom-nodes/DOCUMENT_FRAGMENT_NODE');
var DOCUMENT_NODE = require('ac-dom-nodes/DOCUMENT_NODE');
var ELEMENT_NODE = require('ac-dom-nodes/ELEMENT_NODE');
var TEXT_NODE = require('ac-dom-nodes/TEXT_NODE');

/** @ignore */
var isNodeType = function (node, nodeType) {
	if (!isNode(node)) {
		return false;
	}

	if (typeof nodeType === 'number') {
		return (node.nodeType === nodeType);
	}

	return (nodeType.indexOf(node.nodeType) !== -1);
};

/** @ignore */
var VALID_PARENT_NODE = [
	ELEMENT_NODE,
	DOCUMENT_NODE,
	DOCUMENT_FRAGMENT_NODE
];

/** @ignore */
var ERR_INVALID_PARENT_NODE = ' must be an Element, Document, or Document Fragment';

/** @ignore */
var VALID_CHILD_NODE = [
	ELEMENT_NODE,
	TEXT_NODE,
	COMMENT_NODE
];

/** @ignore */
var ERR_INVALID_CHILD_NODE = ' must be an Element, TextNode, or Comment';

/** @ignore */
var ERR_INVALID_SELECTOR = ' must be a string';

module.exports = {

	/** @ignore */
	parentNode: function (node, required, funcName, paramName) {
		paramName = paramName || 'node';

		if ((node || required) && !isNodeType(node, VALID_PARENT_NODE)) {
			throw new TypeError(funcName + ': ' + paramName + ERR_INVALID_PARENT_NODE);
		}
	},

	/** @ignore */
	childNode: function (node, required, funcName, paramName) {
		paramName = paramName || 'node';

		if (!node && !required) {
			return;
		}

		if (!isNodeType(node, VALID_CHILD_NODE)) {
			throw new TypeError(funcName + ': ' + paramName + ERR_INVALID_CHILD_NODE);
		}
	},

	/** @ignore */
	selector: function (selector, required, funcName, paramName) {
		paramName = paramName || 'selector';

		if ((selector || required) && typeof selector !== 'string') {
			throw new TypeError(funcName + ': ' + paramName + ERR_INVALID_SELECTOR);
		}
	}

};

},{"ac-dom-nodes/COMMENT_NODE":424,"ac-dom-nodes/DOCUMENT_FRAGMENT_NODE":425,"ac-dom-nodes/DOCUMENT_NODE":426,"ac-dom-nodes/ELEMENT_NODE":428,"ac-dom-nodes/TEXT_NODE":429,"ac-dom-nodes/isNode":444,"ac-polyfills/Array/prototype.indexOf":798}],452:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var isElement = require('ac-dom-nodes/isElement');
var validate = require('./internal/validate');
var nativeMatches = require('./internal/nativeMatches');
var matchesSelectorShim = require('./shims/matchesSelector');

/**
 * @name module:ac-dom-traversal.matchesSelector
 *
 * @function
 *
 * @desc Returns whether or not an Element matches a given CSS selector.
 *
 * @param {Node} node
 *        The Element to be checked.
 *
 * @param {String} selector
 *        CSS selectors, separated by commas, to check Element against.
 *
 * @returns {Boolean} `true` if the Element matches the selector, otherwise `false`
 */
module.exports = function matchesSelector(node, selector) {
 	validate.selector(selector, true, 'matchesSelector');

 	if (!isElement(node)) {
 		return false;
 	}

 	if (!nativeMatches) {
 		return matchesSelectorShim(node, selector);
 	}

	return nativeMatches.call(node, selector);
};

},{"./internal/nativeMatches":450,"./internal/validate":451,"./shims/matchesSelector":454,"ac-dom-nodes/isElement":443}],453:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

require('ac-polyfills/Array/prototype.slice');

/** @ignore */
var validate = require('./internal/validate');
var querySelectorAllShim = require('./shims/querySelectorAll');
var querySelectorAllAvailable = ('querySelectorAll' in document);

/**
 * @name module:ac-dom-traversal.querySelectorAll
 *
 * @function
 *
 * @desc Returns an Array of Elements within the specified context that match given CSS selector(s).
 *
 * @param {String} selector
 *        One or more CSS selectors separated by commas.
 *
 * @param {Node} [context=document]
 *        An optional ParentNode to scope the selector to. Defaults to `document`.
 *
 * @returns {Element[]} Array of matching Elements
 */
module.exports = function querySelectorAll(selector, context) {
	context = context || document;

	validate.parentNode(context, true, 'querySelectorAll', 'context');
	validate.selector(selector, true, 'querySelectorAll');

	if (!querySelectorAllAvailable) {
		return querySelectorAllShim(selector, context);
	}

	return Array.prototype.slice.call(context.querySelectorAll(selector));
};

},{"./internal/validate":451,"./shims/querySelectorAll":455,"ac-polyfills/Array/prototype.slice":799}],454:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var querySelectorAll = require('../querySelectorAll');

/**
 * module:ac-dom-traversal.matchesSelector shim for IE < 8
 */
module.exports = function matchesSelector(node, selector) {
	var context = node.parentNode || document;
	var nodes = querySelectorAll(selector, context);
	var i;

	for (i = 0; i < nodes.length; i++) {
		if (nodes[i] === node) {
			return true;
		}
	}

	return false;
};

},{"../querySelectorAll":453}],455:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var isElement = require('ac-dom-nodes/isElement');
var isDocumentFragment = require('ac-dom-nodes/isDocumentFragment');
var removeElement = require('ac-dom-nodes/remove');
var COLLECTION_NAME = '_ac_qsa';

/**
 * module:ac-dom-traversal.querySelectorAll shim for IE < 8
 */
module.exports = function querySelectorAll(selector, context) {
	var style = document.createElement('style');
	var parent;
	var els = [];
	var el;

	// default context
	context = context || document;

	// prepare the collection
	document[COLLECTION_NAME] = [];

	// prepare style tag
	if (isDocumentFragment(context)) {
		context.appendChild(style);
	} else {
		document.body.appendChild(style);
	}

	// css expression to add matched elements to the collection
	style.styleSheet.cssText = selector + '{ac-qsa:expression(document.' + COLLECTION_NAME + ' && document.' + COLLECTION_NAME + '.push(this))}';

	// trigger a reflow
	window.scrollBy(0, 0);

	// cleanup and collect matched elements
	while (document[COLLECTION_NAME].length) {
		el = document[COLLECTION_NAME].shift();
		el.style.removeAttribute('ac-qsa');

		if (context === document) {
			els.push(el);
		} else {
			parent = el;
		 	while ((parent = parent.parentNode) && isElement(parent)) {
		 		if (parent === context) {
		 			els.push(el);
		 			break;
		 		}
		 	}
		}

		els.push(el);
	}

	// reset collection and styles
	document[COLLECTION_NAME] = null;
	removeElement(style);

	// done!
	return els;
};

},{"ac-dom-nodes/isDocumentFragment":441,"ac-dom-nodes/isElement":443,"ac-dom-nodes/remove":447}],456:[function(require,module,exports){
arguments[4][207][0].apply(exports,arguments)
},{"./ac-clip/Clip":457,"dup":207}],457:[function(require,module,exports){
arguments[4][208][0].apply(exports,arguments)
},{"ac-clock":418,"ac-easing":471,"ac-event-emitter":572,"ac-object":790,"dup":208}],458:[function(require,module,exports){
arguments[4][209][0].apply(exports,arguments)
},{"./ac-color/decimalToHex":459,"./ac-color/hexToDecimal":460,"./ac-color/hexToRgb":461,"./ac-color/isColor":462,"./ac-color/isHex":463,"./ac-color/isRgb":464,"./ac-color/mixColors":465,"./ac-color/rgbToArray":466,"./ac-color/rgbToDecimal":467,"./ac-color/rgbToHex":468,"./ac-color/rgbToObject":469,"./ac-color/shortToLongHex":470,"dup":209}],459:[function(require,module,exports){
arguments[4][210][0].apply(exports,arguments)
},{"dup":210}],460:[function(require,module,exports){
arguments[4][211][0].apply(exports,arguments)
},{"dup":211}],461:[function(require,module,exports){
arguments[4][212][0].apply(exports,arguments)
},{"./shortToLongHex":470,"dup":212}],462:[function(require,module,exports){
arguments[4][213][0].apply(exports,arguments)
},{"./isHex":463,"./isRgb":464,"dup":213}],463:[function(require,module,exports){
arguments[4][214][0].apply(exports,arguments)
},{"dup":214}],464:[function(require,module,exports){
arguments[4][215][0].apply(exports,arguments)
},{"dup":215}],465:[function(require,module,exports){
arguments[4][216][0].apply(exports,arguments)
},{"./hexToRgb":461,"./isHex":463,"./rgbToObject":469,"dup":216}],466:[function(require,module,exports){
arguments[4][217][0].apply(exports,arguments)
},{"./rgbToObject":469,"dup":217}],467:[function(require,module,exports){
arguments[4][218][0].apply(exports,arguments)
},{"./hexToDecimal":460,"./rgbToArray":466,"./rgbToHex":468,"dup":218}],468:[function(require,module,exports){
arguments[4][219][0].apply(exports,arguments)
},{"dup":219}],469:[function(require,module,exports){
arguments[4][220][0].apply(exports,arguments)
},{"dup":220}],470:[function(require,module,exports){
arguments[4][221][0].apply(exports,arguments)
},{"dup":221}],471:[function(require,module,exports){
arguments[4][222][0].apply(exports,arguments)
},{"./ac-easing/Ease":472,"./ac-easing/createBezier":473,"./ac-easing/createPredefined":474,"./ac-easing/createStep":475,"dup":222}],472:[function(require,module,exports){
arguments[4][223][0].apply(exports,arguments)
},{"dup":223}],473:[function(require,module,exports){
arguments[4][224][0].apply(exports,arguments)
},{"./Ease":472,"./helpers/KeySpline":476,"dup":224}],474:[function(require,module,exports){
arguments[4][225][0].apply(exports,arguments)
},{"./Ease":472,"./createStep":475,"./helpers/cssAliases":477,"./helpers/easingFunctions":478,"dup":225}],475:[function(require,module,exports){
arguments[4][226][0].apply(exports,arguments)
},{"./Ease":472,"dup":226}],476:[function(require,module,exports){
arguments[4][227][0].apply(exports,arguments)
},{"dup":227}],477:[function(require,module,exports){
arguments[4][228][0].apply(exports,arguments)
},{"dup":228}],478:[function(require,module,exports){
arguments[4][229][0].apply(exports,arguments)
},{"../createBezier":473,"dup":229}],479:[function(require,module,exports){
arguments[4][266][0].apply(exports,arguments)
},{"dup":266}],480:[function(require,module,exports){
arguments[4][267][0].apply(exports,arguments)
},{"./ac-transform/Transform":481,"dup":267}],481:[function(require,module,exports){
arguments[4][268][0].apply(exports,arguments)
},{"dup":268,"gl-matrix":479}],482:[function(require,module,exports){
arguments[4][269][0].apply(exports,arguments)
},{"./ac-eclipse/Clip":483,"./ac-eclipse/Timeline":484,"dup":269}],483:[function(require,module,exports){
arguments[4][270][0].apply(exports,arguments)
},{"./clips/ClipEasing":485,"./clips/ClipInlineCss":486,"./clips/ClipTransitionCss":487,"./helpers/Float32Array":490,"./helpers/transitionEnd":500,"dup":270}],484:[function(require,module,exports){
arguments[4][271][0].apply(exports,arguments)
},{"ac-clip":456,"ac-event-emitter":572,"ac-object":790,"dup":271}],485:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var clone = require('ac-object').clone;
var create = require('ac-object').create;
var isCssCubicBezierString = require('../helpers/isCssCubicBezierString');

/** @ignore */
var BezierCurveCssManager = require('../helpers/BezierCurveCssManager');
var Clip = require('ac-clip').Clip;

/** @ignore */
var DEFAULT_EASE = 'ease'; // should match ac-clip.Clip.DEFAULT_EASE

/**
 * @name module:ac-eclipse.ClipEasing
 * @class
 * @extends Clip
 *
 * @desc ClipEasing basically does the same as ac-clip.Clip - transitioning properties on objects.
 *       The one difference is that ClipEasing can have different easing algorithms per property
 *       and this is set with the propsEase option (see below). To achieve this, when propsEase is
 *       set, ClipEasing will create multiple instances of ac-clip.Clip with each unqiue easing
 *       algorithm. If only one easing is used ClipEasing will work the same as Clip.
 *
 * @param {Object} target
 *        The `Object` whose properties will transition / modify.
 *
 * @param {Number} duration
 *        The duration of the transition in seconds.
 *
 * @param {Object} propsTo
 *        An `Object` containing the end state of the properties you wish to
 *        transition on target.
 *
 * @param {Number} [options.delay=0]
 *        Delay in seconds before a clip will start after play has been called.
 *
 * @param {String|Function} [options.ease='ease-out']
 *        The default ease for transitions.
 *
 * @param {Clock} [options.clock=Clock]
 *        An instance of `ac-clock.Clock` to be used. Defaults to global singleton.
 *
 * @param {Object} [options.propsFrom={}]
 *        An `Object` containing the start state of the properties you wish to
 *        transition on target.
 *
 * @param {Object} [options.propsEase={}]
 *        An `Object` containing unique easing algorithms for specific properties.
 *
 * @param {Function} [options.onStart=null]
 *        A callback `Function` called when the clip starts to play.
 *
 * @param {Function} [options.onUpdate=null]
 *        A callback `Function` called when the clip has updated properties.
 *        This should be used if you require to do further calculations with the
 *        properties and not for rendering. Use `onDraw` for rendering.
 *
 * @param {Function} [options.onDraw=null]
 *        A callback `Function` called when the clip has updated properties.
 *        This should be used for rendering, e.g. drawing something to a `canvas`
 *        element.
 *
 * @param {Function} [options.onComplete=null]
 *        A callback `Function` called when the clip has finished playing.
 */
function ClipEasing(target, duration, propsTo, options) {
	var optionsClone = clone(options || {}, true);

	var easeCount = 0;
	var groupsTo = {};
	var groupsFrom = {};
	var propsFrom = optionsClone.propsFrom || {};
	var eases = {};
	var prop, ease;

	if (isCssCubicBezierString(optionsClone.ease)) {
		// convert to js easing function
		optionsClone.ease = BezierCurveCssManager.create(optionsClone.ease).toEasingFunction();
	}

	if (optionsClone.propsEase) {
		var defaultEase = optionsClone.ease || DEFAULT_EASE;
		
		// create groups of props that share the same easing
		for (prop in propsTo) {
			if (propsTo.hasOwnProperty(prop)) {

				ease = optionsClone.propsEase[prop];
				if (isCssCubicBezierString(ease)) {
					// if cubic bezier css string then convert to js function
					ease = BezierCurveCssManager.create(optionsClone.propsEase[prop]).toEasingFunction();
				}

				if (ease === undefined) {
					// uses default ease
					if (groupsTo[defaultEase] === undefined) {
						groupsTo[defaultEase] = {};
						groupsFrom[defaultEase] = {};
						eases[defaultEase] = defaultEase;
						easeCount++;
					}
					groupsTo[defaultEase][prop] = propsTo[prop];
					groupsFrom[defaultEase][prop] = propsFrom[prop];
				}
				else if (typeof ease === 'function') {
					// uses function for ease
					// can't use function as key as will mostly match default and other
					// functions when converted to String so use the easeCount as the key
					groupsTo[easeCount] = {};
					groupsFrom[easeCount] = {};
					groupsTo[easeCount][prop] = propsTo[prop];
					groupsFrom[easeCount][prop] = propsFrom[prop];
					eases[easeCount] = ease;
					easeCount++;
				}
				else {
					// uses a predefined string
					if (groupsTo[ease] === undefined) {
						groupsTo[ease] = {};
						groupsFrom[ease] = {};
						eases[ease] = ease;
						easeCount++;
					}
					groupsTo[ease][prop] = propsTo[prop];
					groupsFrom[ease][prop] = propsFrom[prop];
				}
			}
		}
	}

	if (easeCount > 1) {
		// there is more than one ease so we group the props with the
		// same ease and create an array of clips to control them
		this._storeOnUpdate = optionsClone.onUpdate || null;
		optionsClone.onUpdate = null;

		// store the callback functions
		var storeOnStart = optionsClone.onStart;
		var storeOnDraw = optionsClone.onDraw;
		var storeOnComplete = optionsClone.onComplete;
		// then set them to null otherwise ease instance of clip per
		// ease will call them, so if we have 3 types of easing onStart
		// will get triggered 3 times (which would be undesired behaviour)
		optionsClone.onStart = null;
		optionsClone.onDraw = null;
		optionsClone.onComplete = null;

		// iterate through each group of props that share an ease
		// and create a new instance of clip for them. The progress
		// of these clips will be controlled in this._onUpdate
		this._clips = [];
		for (ease in groupsTo) {
			if (groupsTo.hasOwnProperty(ease)) {
				optionsClone.ease = eases[ease];
				optionsClone.propsFrom = groupsFrom[ease];
				this._clips.push(new Clip(target, duration, groupsTo[ease], optionsClone));
			}
		}

		// reset the callback functions as we will want them to be called with this instance of clip
		optionsClone.onUpdate = this._onUpdate;
		optionsClone.onStart = storeOnStart;
		optionsClone.onDraw = storeOnDraw;
		optionsClone.onComplete = storeOnComplete;

		// remove propsFrom as ac-clip.Clip doesn't use / need it
		optionsClone.propsFrom = null;
		// set ease to linear as ease on this doesn't matter anymore as our array of clips are doing all that work
		optionsClone.ease = 'linear';
		// set propsTo to an empty object, again, our array of clips does all that
		propsTo = {};
	}
	else {
		// we do this as the only ease isn't necessarily `options.ease` as `options.propsEase`
		// might contain same ease for all props that's different to `options.ease`
		for (prop in eases) {
			if (eases.hasOwnProperty(prop)) {
				optionsClone.ease = eases[prop];
			}
		}
	}
	
	// finally call super on ac-clip.Clip constructor
	// if easeCount is 1 then ClipEasing is basically just a regular Clip, otherwise it
	// will store an array of clips and update there progress in this._onUpdate
	Clip.call(this, target, duration, propsTo, optionsClone);
}

var proto = ClipEasing.prototype = create(Clip.prototype);

/**
 * @name module:ac-eclipse.ClipEasing#reset
 * @function
 * @override
 *
 * @desc Resets the clip and target properties.
 *
 * @returns {ClipEasing} A reference to this clip.
 */
proto.reset = function () {
	var returnValue = Clip.prototype.reset.call(this);
	if (this._clips) {
		// if we have an array of clips then reset each clip
		var i = this._clips.length;
		while (i--) {
			this._clips[i].reset();
		}
	}
	return returnValue;
};

/**
 * @name module:ac-clip.ClipEasing#destroy
 * @function
 * @override
 *
 * @desc Immediately stop the clip and make it eligible for garbage collection.
 *       A clip can not be reused after it has been destroyed.
 *
 * @returns {ClipEasing} A reference to this clip.
 */
proto.destroy = function () {
	var returnValue = Clip.prototype.destroy.call(this);
	if (this._clips) {
		// if we have an array of clips then destroy each clip
		var i = this._clips.length;
		while (i--) {
			this._clips[i].reset();
		}
		this._clips = null;
	}
	this._eases = null;
	this._storeOnUpdate = null;
	return returnValue;
};

/**
 * @name module:ac-eclipse.ClipEasing#_onUpdate
 * @function
 * @private
 *
 * @param {Object} [evt=undefined]
 */
/** @ignore */
proto._onUpdate = function (evt) {
	// this method is only called if there was multiple easing algorithms specified on instantiation
	// using `options.propsEase`. In that instance there will be an array of clips that need there
	// progress setting to match this.getProgress() (which is passed in the evt as a progress property)
	var progress = (this._direction === 1) ? evt.progress : 1 - evt.progress;
	var i = this._clips.length;
	while (i--) {
		this._clips[i].setProgress(progress);
	}

	if (typeof this._storeOnUpdate === 'function') {
		this._storeOnUpdate.call(this, evt);
	}
};

module.exports = ClipEasing;

},{"../helpers/BezierCurveCssManager":489,"../helpers/isCssCubicBezierString":496,"ac-clip":456,"ac-object":790}],486:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var convertToStyleObject = require('../helpers/convertToStyleObject');
var convertToTransitionableObjects = require('../helpers/convertToTransitionableObjects');
var clone = require('ac-object').clone;
var create = require('ac-object').create;
var removeTransitions = require('../helpers/removeTransitions');

/** @ignore */
var BezierCurveCssManager = require('../helpers/BezierCurveCssManager');
var ClipEasing = require('./ClipEasing');
var DomStyles = require('ac-dom-styles');

/**
 * @name module:ac-eclipse.ClipInlineCss
 * @class
 * @extends ClipEasing
 *
 * @desc ClipInlineCss transitions CSS styles on an element. It extends ClipEasing to
 *       transition style properties on an object and then uses ac-dom-styles to apply
 *       these styles to a target element on Clock update.
 *
 * @param {Element} target
 *        The `Element` whose styles will transition / modify.
 *
 * @param {Number} duration
 *        The duration of the transition in seconds.
 *
 * @param {Object} propsTo
 *        An `Object` containing the end state of the properties you wish to
 *        transition on target.
 *
 * @param {Number} [options.delay=0]
 *        Delay in seconds before a clip will start after play has been called.
 *
 * @param {String|Function} [options.ease='ease-out']
 *        The default ease for transitions.
 *
 * @param {Clock} [options.clock=Clock]
 *        An instance of `ac-clock.Clock` to be used. Defaults to global singleton.
 *
 * @param {Object} [options.propsFrom={}]
 *        An `Object` containing the start state of the properties you wish to
 *        transition on target.
 *
 * @param {Object} [options.propsEase={}]
 *        An `Object` containing unique easing algorithms for specific properties.
 *
 * @param {Function} [options.onStart=null]
 *        A callback `Function` called when the clip starts to play.
 *
 * @param {Function} [options.onUpdate=null]
 *        A callback `Function` called when the clip has updated properties.
 *        This should be used if you require to do further calculations with the
 *        properties and not for rendering. Use `onDraw` for rendering.
 *
 * @param {Function} [options.onDraw=null]
 *        A callback `Function` called when the clip has updated properties.
 *        This should be used for rendering, e.g. drawing something to a `canvas`
 *        element.
 *
 * @param {Function} [options.onComplete=null]
 *        A callback `Function` called when the clip has finished playing.
 */
function ClipInlineCss(target, duration, propsTo, options) {
	var optionsClone = clone(options || {}, true);

	this._el = target;
	
	// convert the object so it can be used with clip.
	// e.g. 'width':'10px' becomes 'width':{value:'10',unit'px'}
	var converted = convertToTransitionableObjects(this._el, propsTo || {}, optionsClone.propsFrom || {});
	this._styles = converted.target;
	this._stylesFrom = converted.propsFrom;
	propsTo = converted.propsTo;
	var prop;

	// store callbacks so they can be called later in this._onStart etc
	this._storeOnStart = optionsClone.onStart || null;
	this._storeOnDraw = optionsClone.onDraw || null;
	this._storeOnComplete = optionsClone.onComplete || null;

	// set callbacks to call internal methods on this so we can write styles on start and update etc
	optionsClone.onStart = this._onStart;
	optionsClone.onDraw = this._onDraw;
	optionsClone.onComplete = this._onComplete;
	optionsClone.propsFrom = converted.propsFrom;

	// call super on ClipEasing constructor
	ClipEasing.call(this, this._styles, duration, propsTo, optionsClone);

	// if properties we are animating have css transition on them weird things happen so remove
	removeTransitions(this._el, this._styles);

	var completeStyles = (this._isYoyo) ? this._stylesFrom : propsTo;
	this._completeStyles = convertToStyleObject(completeStyles);
	// if set will generate an object of styles to remove when transition completes
	if (optionsClone.removeStylesOnComplete !== undefined) {
		var removeStyles = optionsClone.removeStylesOnComplete;
		if (typeof removeStyles === 'boolean' && removeStyles) {
			// remove all styles
			for (prop in this._completeStyles) {
				if (this._completeStyles.hasOwnProperty(prop)) {
					this._completeStyles[prop] = null;
				}
			}
		}
		else if (typeof removeStyles === 'object' && removeStyles.length) {
			// remove certain styles
			var i = removeStyles.length;
			while (i--) {
				prop = removeStyles[i];
				if (this._completeStyles.hasOwnProperty(prop)) {
					this._completeStyles[prop] = null;
				}
			}
		}
	}
}

var proto = ClipInlineCss.prototype = create(ClipEasing.prototype);

/**
 * @name module:ac-eclipse.ClipInlineCss#reset
 * @function
 * @override
 *
 * @desc Resets the clip and target properties.
 *
 * @returns {ClipInlineCss} A reference to this clip.
 */
proto.reset = function () {
	var returnValue = ClipEasing.prototype.reset.call(this);
	DomStyles.setStyle(this._el, convertToStyleObject(this._styles));
	return returnValue;
};

/**
 * @name module:ac-clip.ClipInlineCss#destroy
 * @function
 * @override
 *
 * @desc Immediately stop the clip and make it eligible for garbage collection.
 *       A clip can not be reused after it has been destroyed.
 *
 * @returns {ClipInlineCss} A reference to this clip.
 */
proto.destroy = function () {
	var returnValue = ClipEasing.prototype.destroy.call(this);
	this._el = null;
	this._styles = null;
	this._stylesFrom = null;
	this._stylesTo = null;
	this._completeStyles = null;
	this._storeOnStart = null;
	this._storeOnDraw = null;
	this._storeOnComplete = null;
	return returnValue;
};

/**
 * @name module:ac-eclipse.ClipInlineCss#getTarget
 * @function
 * @override
 *
 * @desc Returns the target `Element`.
 *
 * @returns {Element} The target.
 */
proto.getTarget = function () {
	return this._el;
};

/**
 * @name module:ac-eclipse.ClipInlineCss#_onStart
 * @function
 * @private
 *
 * @param {Object} [evt=undefined]
 */
/** @ignore */
proto._onStart = function (evt) {
	if (this.isPlaying() && this._direction === 1) {
		DomStyles.setStyle(this._el, convertToStyleObject(this._stylesFrom));
	}
	if (typeof this._storeOnStart === 'function') {
		this._storeOnStart.call(this, evt);
	}
};

/**
 * @name module:ac-eclipse.ClipInlineCss#_onDraw
 * @function
 * @private
 *
 * @param {Object} [evt=undefined]
 */
/** @ignore */
proto._onDraw = function (evt) {
	DomStyles.setStyle(this._el, convertToStyleObject(this._styles));
	if (typeof this._storeOnDraw === 'function') {
		this._storeOnDraw.call(this, evt);
	}
};

/**
 * @name module:ac-eclipse.ClipInlineCss#_onComplete
 * @function
 * @private
 *
 * @param {Object} [evt=undefined]
 */
/** @ignore */
proto._onComplete = function (evt) {
	DomStyles.setStyle(this._el, this._completeStyles);
	if (typeof this._storeOnComplete === 'function') {
		this._storeOnComplete.call(this, evt);
	}
};

module.exports = ClipInlineCss;

},{"../helpers/BezierCurveCssManager":489,"../helpers/convertToStyleObject":492,"../helpers/convertToTransitionableObjects":493,"../helpers/removeTransitions":497,"./ClipEasing":485,"ac-dom-styles":160,"ac-object":790}],487:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var convertToStyleObject = require('../helpers/convertToStyleObject');
var convertToTransitionableObjects = require('../helpers/convertToTransitionableObjects');
var clone = require('ac-object').clone;
var create = require('ac-object').create;
var createPredefined = require('ac-easing').createPredefined;
var isCssCubicBezierString = require('../helpers/isCssCubicBezierString');
var removeTransitions = require('../helpers/removeTransitions');
var splitUnits = require('../helpers/splitUnits');
var toCamCase = require('../helpers/toCamCase');
var transitionEnd = require('../helpers/transitionEnd');
var waitAnimationFrames = require('../helpers/waitAnimationFrames');

/** @ignore */
var BezierCurveCssManager = require('../helpers/BezierCurveCssManager');
var ClipEasing = require('./ClipEasing');
var DomStyles = require('ac-dom-styles');

/** @ignore */
var DEFAULT_EASE = 'ease'; // should match ac-eclipse.ClipEasing.DEFAULT_EASE

/**
 * @name module:ac-eclipse.ClipTransitionCss
 * @class
 * @extends ClipEasing
 *
 * @desc ClipTransitionCss transitions CSS styles on an element. As with ClipInlineCss, it
 *       extends ClipEasing to transition style properties on an object. However, instead
 *       of applying these styles on Clock update it instead uses ac-dom-styles to apply
 *       the end styles to a target element along with CSS transition properties.
 *
 * @param {Element} target
 *        The `Element` whose styles will transition / modify.
 *
 * @param {Number} duration
 *        The duration of the transition in seconds.
 *
 * @param {Object} propsTo
 *        An `Object` containing the end state of the properties you wish to
 *        transition on target.
 *
 * @param {Number} [options.delay=0]
 *        Delay in seconds before a clip will start after play has been called.
 *
 * @param {String|Function} [options.ease='ease-out']
 *        The default ease for transitions.
 *
 * @param {Clock} [options.clock=Clock]
 *        An instance of `ac-clock.Clock` to be used. Defaults to global singleton.
 *
 * @param {Object} [options.propsFrom={}]
 *        An `Object` containing the start state of the properties you wish to
 *        transition on target.
 *
 * @param {Object} [options.propsEase={}]
 *        An `Object` containing unique easing algorithms for specific properties.
 *
 * @param {Function} [options.onStart=null]
 *        A callback `Function` called when the clip starts to play.
 *
 * @param {Function} [options.onUpdate=null]
 *        A callback `Function` called when the clip has updated properties.
 *        This should be used if you require to do further calculations with the
 *        properties and not for rendering. Use `onDraw` for rendering.
 *
 * @param {Function} [options.onDraw=null]
 *        A callback `Function` called when the clip has updated properties.
 *        This should be used for rendering, e.g. drawing something to a `canvas`
 *        element.
 *
 * @param {Function} [options.onComplete=null]
 *        A callback `Function` called when the clip has finished playing.
 */
function ClipTransitionCss(target, duration, propsTo, options) {
	var optionsClone = clone(options || {}, true);

	this._el = target;

	// convert the object so it can be used with clip.
	// e.g. 'width':'10px' becomes 'width':{value:'10',unit'px'}
	var converted = convertToTransitionableObjects(this._el, propsTo || {}, optionsClone.propsFrom || {});
	this._styles = converted.target;
	this._propsTo = converted.propsTo;
	this._propsFrom = converted.propsFrom;

	// store callbacks so they can be called later
	this._storeOnStart = optionsClone.onStart || null;
	this._storeOnComplete = optionsClone.onComplete || null;
	optionsClone.onStart = this._onStart;
	optionsClone.onComplete = this._onComplete;

	optionsClone.propsFrom = this._propsFrom;
	
	this._stylesTo = clone(this._propsTo, true);
	this._stylesFrom = clone(this._propsFrom, true);

	optionsClone.ease = optionsClone.ease || DEFAULT_EASE;
	this._eases = {};
	this._propsArray = [];
	this._propsComplete = {};
	var convertedEase;
	var defaultEase;
	var styleCompleteTo = convertToStyleObject(this._stylesTo);
	var styleCompleteFrom = convertToStyleObject(this._stylesFrom);
	this._propsEase = clone(optionsClone.propsEase || {}, true);
	
	var prop;
	for (prop in this._stylesTo) {

		if (this._stylesTo.hasOwnProperty(prop)) {
			// store props as camcase
			this._propsArray[this._propsArray.length] = prop;
			this._propsComplete[toCamCase(prop)] = {
				'1': styleCompleteTo[prop],
				'-1': styleCompleteFrom[prop]
			};

			if (this._propsEase[prop] === undefined) {
				if (this._eases[optionsClone.ease] === undefined) {
					// setup default ease
					convertedEase = this._convertEase(optionsClone.ease);
					this._eases[optionsClone.ease] = convertedEase.css;
					defaultEase = convertedEase.js;
				}

				// use default
				this._propsEase[prop] = optionsClone.ease;
			}
			else if (this._eases[this._propsEase[prop]] === undefined) {
				// setup new bezier curve ease
				convertedEase = this._convertEase(this._propsEase[prop]);
				this._eases[this._propsEase[prop]] = convertedEase.css;
				optionsClone.propsEase[prop] = convertedEase.js;
			}
			else if (isCssCubicBezierString(this._propsEase[prop])) {
				// uses a cubic bezier that we already converted so just need the JS function
				optionsClone.propsEase[prop] = this._eases[this._propsEase[prop]]['1'].toEasingFunction();
			}
		}
	}

	optionsClone.ease = defaultEase;

	// call super on ClipEasing constructor
	ClipEasing.call(this, this._styles, duration, this._propsTo, optionsClone);

	// bind this._onTransitionEnded to this context
	this._onTransitionEnded = this._onTransitionEnded.bind(this);

	// listen for pause event to fire from super so we can set styles
	this.on('pause', this._onPaused);

	// remove CSS transitions that clash with properties Clip will animate
	removeTransitions(this._el, this._stylesTo);

	// store transitions that don't clash with properties Clip will animate
	// because two instances of clip might be transitioning differing properties
	this._otherTransitions = DomStyles.getStyle(this._el, 'transition').transition;
	if (this._otherTransitions === null || this._otherTransitions === 'all 0s ease 0s') {
		this._otherTransitions = '';
	}
	this._completeStyles = {
		'transition': this._otherTransitions
	};

	// if set will generate an object of styles to remove when transition completes
	if (optionsClone.removeStylesOnComplete !== undefined) {
		var removeStyles = optionsClone.removeStylesOnComplete;
		// this._removeStyles = {};
		if (typeof removeStyles === 'boolean' && removeStyles) {
			// remove all styles
			for (prop in this._stylesTo) {
				this._completeStyles[prop] = null;
			}
		}
		else if (typeof removeStyles === 'object' && removeStyles.length) {
			// remove certain styles
			var i = removeStyles.length;
			while (i--) {
				this._completeStyles[removeStyles[i]] = null;
			}
		}
	}
}

var proto = ClipTransitionCss.prototype = create(ClipEasing.prototype);

/**
 * @name module:ac-eclipse.ClipTransitionCss#reset
 * @function
 * @override
 *
 * @desc Resets the clip and target properties.
 *
 * @returns {ClipTransitionCss} A reference to this clip.
 */
proto.reset = function () {
	var returnValue = ClipEasing.prototype.reset.call(this);
	this._applyStyles(0, convertToStyleObject(this._target));
	return returnValue;
};

/**
 * @name module:ac-clip.ClipTransitionCss#destroy
 * @function
 * @override
 *
 * @desc Immediately stop the clip and make it eligible for garbage collection.
 *       A clip can not be reused after it has been destroyed.
 *
 * @returns {ClipTransitionCss} A reference to this clip.
 */
proto.destroy = function () {
	var returnValue = ClipEasing.prototype.destroy.call(this);
	this._removeTransitionListener();
	this._el = null;
	this._propsArray = null;
	this._propsComplete = null;
	this._styles = null;
	this._stylesFrom = null;
	this._stylesTo = null;
	this._completeStyles = null;
	this._storeOnStart = null;
	this._storeOnComplete = null;
	this._onTransitionEnded = null;
	return returnValue;
};

/**
 * @name module:ac-eclipse.ClipTransitionCss#getTarget
 * @function
 * @override
 *
 * @desc Returns the target `Element`.
 *
 * @returns {Element} The target.
 */
proto.getTarget = function () {
	return this._el;
};

/**
 * @name module:ac-eclipse.ClipTransitionCss#setProgress
 * @function
 * @override
 *
 * @desc Accepts a `Number` between 0 and 1 and will change the position of the clip.
 *
 * @param {Number} progress
 *        Accepts a Number between 0 and 1 and will change the position of the clip.
 *
 * @returns {Number} The current progress.
 */
proto.setProgress = function (progress) {
	var returnValue = ClipEasing.prototype.setProgress.call(this, progress);

	// first we set the styles immediately to using this._target which is updated in super 
	this._applyStyles(0, convertToStyleObject(this._target));

	if (this.isPlaying()) {
		// if we're playing we need to then set the end state along with transitions
		// the reason for waiting two frames here is immediately setting the styles with
		// CSS transition properties will stop the above _applyStyles to _target not be
		// instant (it will animate)
		waitAnimationFrames(function () {
			// ensure still playing - 2 frames can be a long time ;)
			if (this.isPlaying()) {
				var duration = this._duration * (1 - this.getProgress());
				var styles = convertToStyleObject((this._direction > 0) ? this._stylesTo : this._stylesFrom);
				this._applyStyles(duration, styles);
			}
		}.bind(this), 2);
	}

	return returnValue;
};

/**
 * @name module:ac-eclipse.ClipTransitionCss#_convertEase
 * @function
 * @override
 * @private
 *
 * @param {String} ease
 *
 * @returns {Object} Returns an `Object` containing converted eases.
 */
/** @ignore */
proto._convertEase = function (ease) {
	var bezierCurve;
	var jsEase;
	if (isCssCubicBezierString(ease)) {
		bezierCurve = BezierCurveCssManager.create(ease);
		jsEase = bezierCurve.toEasingFunction();
	}
	else {
		bezierCurve = BezierCurveCssManager.create(createPredefined(ease).cssString);
		jsEase = ease;
	}
	return {
		css: {
			'1': bezierCurve,
			'-1': bezierCurve.reversed()
		},
		js: jsEase
	};
};

/**
 * @name module:ac-clip.ClipTransitionCss#_stop
 * @function
 * @override
 * @private
 */
/** @ignore */
proto._stop = function () {
	this._removeTransitionListener();
	ClipEasing.prototype._stop.call(this);
};

/**
 * @name module:ac-eclipse.ClipTransitionCss#_complete
 * @function
 * @override
 * @private
 *
 * @fires ClipTransitionCss#complete
 */
/** @ignore */
proto._complete = function () {
	if (this._isComplete()) {
		ClipEasing.prototype._complete.call(this);
	}
	else {
		this._el.addEventListener(transitionEnd, this._onTransitionEnded);
	}
};

/**
 * @name module:ac-eclipse.ClipTransitionCss#_onTransitionEnded
 * @function
 * @private
 *
 * @fires ClipTransitionCss#complete
 */
/** @ignore */
proto._onTransitionEnded = function () {
	this._removeTransitionListener();
	ClipEasing.prototype._complete.call(this);
};

/**
 * @name module:ac-eclipse.ClipTransitionCss#_removeTransitionListener
 * @function
 * @private
 */
/** @ignore */
proto._removeTransitionListener = function () {
	if (this._el && this._onTransitionEnded) {
		this._el.removeEventListener(transitionEnd, this._onTransitionEnded);
	}
};

/**
 * @name module:ac-eclipse.ClipTransitionCss#_isComplete
 * @function
 * @private
 *
 * @returns {Boolean} Returns `false` if CSS styles don't match end state.
 */
/** @ignore */
proto._isComplete = function () {
	var styles = DomStyles.getStyle.apply(this, [this._el].concat([this._propsArray]));
	styles['transform'] = null; // ignore transform because rounding errors
	// @todo: maybe find a nice / fast way to check transform
	var target;
	var prop;
	for (prop in styles) {
		if (styles.hasOwnProperty(prop) && styles[prop] !== null) {
			target = this._propsComplete[prop][this._direction];
			// this._el.style[prop] because DomStyles returns the computed style which causes issues when using %
			// splitUnits because the complete style might be '0' (which is valid css) but DomStyles will report '0px'
			if (styles[prop] !== target && this._el.style[prop] !== target && String(splitUnits(styles[prop]).value) !== target) {
				return false;
			}
		}
	}
	return true;
};

/**
 * @name module:ac-eclipse.ClipTransitionCss#_applyStyles
 * @function
 * @private
 *
 * @param {Number} duration
 * @param {Object} styles
 */
/** @ignore */
proto._applyStyles = function (duration, styles) {
	if (duration > 0) {
		var transition = this._otherTransitions + ((this._otherTransitions.length) ? ', ' : '');
		var eases = {};
		var prop;
		for (prop in this._eases) {
			if (this._eases.hasOwnProperty(prop)) {
				// this._eases contains instances of BezierCurveCss
				// split on the current progress to return the correct css bezier curve ease
				eases[prop] = this._eases[prop][this._direction].splitAt(this.getProgress()).toCSSString();
			}
		}
		for (prop in this._stylesTo) {
			if (this._stylesTo.hasOwnProperty(prop)) {
				// iterate through each property and generate a transition string
				transition += prop + ' ' + duration + 'ms ' + eases[this._propsEase[prop]] + ' 0ms, ';
			}
		}
		styles['transition'] = transition.substr(0, transition.length-2);
	}
	else {
		// no transition if duration is 0
		styles['transition'] = this._otherTransitions;
	}

	// apply styles using ac-dom-styles
	DomStyles.setStyle(this._el, styles);
};

/**
 * @name module:ac-eclipse.ClipTransitionCss#_onPaused
 * @function
 * @private
 *
 * @param {Object} [evt=undefined]
 */
/** @ignore */
proto._onPaused = function (evt) {
	// get current styles
	var styles = DomStyles.getStyle.apply(this, [this._el].concat([this._propsArray]));
	// remove transition
	styles['transition'] = this._otherTransitions;

	DomStyles.setStyle(this._el, styles);
};

/**
 * @name module:ac-eclipse.ClipTransitionCss#_onStart
 * @function
 * @private
 *
 * @param {Object} [evt=undefined]
 */
/** @ignore */
proto._onStart = function (evt) {
	// if progress is 0 and direction is 1 then we want to initially apply the fromStyles
	// therefore, to ensure the inital styles don't animate we have to wait 2 frames before
	// apply the end state with CSS transition properties
	var waitFrames = (this._direction === 1 && this.getProgress() === 0) ? 2 : 0;
	if (waitFrames) {
		this._applyStyles(0, convertToStyleObject(this._stylesFrom));
	}

	waitAnimationFrames(function () {
		// ensure still playing - 2 frames can be a long time ;)
		if (this.isPlaying()) {
			var duration = this._duration * (1 - this.getProgress());
			var styles = convertToStyleObject((this._direction > 0) ? this._stylesTo : this._stylesFrom);
			this._applyStyles(duration, styles);
		}
	}.bind(this), waitFrames);

	if (typeof this._storeOnStart === 'function') {
		this._storeOnStart.call(this, evt);
	}
};

/**
 * @name module:ac-eclipse.ClipTransitionCss#_onComplete
 * @function
 * @private
 *
 * @param {Object} [evt=undefined]
 */
/** @ignore */
proto._onComplete = function (evt) {
	DomStyles.setStyle(this._el, this._completeStyles);
	if (typeof this._storeOnComplete === 'function') {
		this._storeOnComplete.call(this, evt);
	}
};

module.exports = ClipTransitionCss;

},{"../helpers/BezierCurveCssManager":489,"../helpers/convertToStyleObject":492,"../helpers/convertToTransitionableObjects":493,"../helpers/isCssCubicBezierString":496,"../helpers/removeTransitions":497,"../helpers/splitUnits":498,"../helpers/toCamCase":499,"../helpers/transitionEnd":500,"../helpers/waitAnimationFrames":501,"./ClipEasing":485,"ac-dom-styles":160,"ac-easing":471,"ac-object":790}],488:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var createBezier = require('ac-easing').createBezier;

/**
 * @name BezierCurveCss
 * @class
 *
 * @desc Stores information about a CSS cubic bezier easing curve and has useful methods
 *       for splitting and reversing etc.
 *
 * @link http://en.wikipedia.org/wiki/B%C3%A9zier_curve#Cubic_B.C3.A9zier_curves
 * @link http://dev.w3.org/csswg/css-transitions/#propdef-transition-timing-function
 *
 * @param {Array} curve
 *        An `Array` containing the two control points, e.g. `[0, 0, 1, 1]`
 *
 * @param {BezierCurveCssManager} manager
 *        A reference to the BezierCurveCssManager instance that will create new instancs
 *        of BezierCurveCss when split and reverse methods are invoked.
 */
function BezierCurveCss(curve, manager) {
	this.manager = manager;
	
	this.p1 = {
		x: curve[0],
		y: curve[1]
	};
	
	this.p2 = {
		x: curve[2],
		y: curve[3]
	};

	this._cacheSplits = {};
}

var proto = BezierCurveCss.prototype;

/**
 * @name BezierCurveCss#splitAt
 * @function
 *
 * @desc Splits this bezier curve at a percent (0 to 1) and returns a new BezierCurveCss.
 *       Note: the percent in this instance is the time, or the x-axis of the bezier curve.
 *
 * @param {Number} percent
 *        Accepts a Number between 0 and 1 at which the bezier curver should be split.
 *
 * @returns {BezierCurveCss} A new instance of BezierCurveCss.
 */
proto.splitAt = function (percent) {

	if (percent === 0) {
		return this;
	}
	else if (this._cacheSplits[percent] !== undefined) {
		return this._cacheSplits[percent];
	}

	var x = [this.p1.x, this.p2.x];
	var y = [this.p1.y, this.p2.y];
	var maxIterations = 0;
	var targetX = percent;
	var min = 0;
	var max = 1;
	var startX = this._getStartX(percent, x);

	// So what's happening here? Let me try and explain...
	// CSS uses bezier curves for controlling easing of transitions. The x-axis is the time ratio
	// and the y-axis the output ratio. We want this function to split on the x-axis, as we're thinking
	// about time. Imagine an ease-in curve (0.42, 0.0, 1.00, 1.0). If you split the bezier curve at 0.5
	// you will actually be at 0.6575 on the x-axis. I'm not sure on the maths for getting the actual
	// value we want elegantly so for now we use the below (sort of brute force). It usually takes about
	// 50 iterations and runs in 0-1ms so it's not a major blocker but if you know a better way please
	// feel free to make a pull request.
	// 
	// Make sense? Probably not. Hopefully this diagram will help:
	// https://interactive-git.apple.com/github-enterprise-assets/0000/0080/0000/0508/596a7432-c904-11e4-9650-2db51bc94cfe.png
	while (targetX !== startX && maxIterations < 1000) {
		if (targetX < startX) {
			max = percent;
		}
		else {
			min = percent;
		}

		percent = min + ((max - min) * 0.5); // split min / max
		startX = this._getStartX(percent, x);

		// count iterations so we don't get a maximum call stack size exceeded error if something goes awry
		++maxIterations;
	}

	var split = this._splitBezier(percent, x, y);
	var normalized = this._normalize(split);
	var newBezierCurve = this.manager.create(normalized);

	this._cacheSplits[targetX] = newBezierCurve;

	return newBezierCurve;
};

/**
 * @name BezierCurveCss#reversed
 * @function
 *
 * @desc Inverts / rotates the bezier curve. If currently eases in the new BezierCurveCss will ease out.
 * @link http://stackoverflow.com/questions/23453721/opposite-of-ease-cubic-bezier-function
 *
 * @returns {BezierCurveCss} A new instance of BezierCurveCss.
 */
proto.reversed = function () {
	var arr = this.toArray();
	return this.manager.create([
		0.5 - (arr[2] - 0.5),
		0.5 - (arr[3] - 0.5),
		0.5 - (arr[0] - 0.5),
		0.5 - (arr[1] - 0.5)
	]);
};

/**
 * @name BezierCurveCss#toArray
 * @function
 *
 * @desc Returns the anchor points in an array with a length of 4 (as the first point is always 0,0 and the last point 1,1).
 *
 * @returns {Array} The anchor points in an array.
 */
proto.toArray = function () {
	var arr = [
		this.p1.x,
		this.p1.y,
		this.p2.x,
		this.p2.y
	];
	return Array.prototype.slice.call(arr);
};

/**
 * @name BezierCurveCss#toCSSString
 * @function
 *
 * @desc Returns a string that can be used as a CSS ease, e.g. `'cubic-bezier(0.0, 0.0, 1.0, 1.0)'`.
 *
 * @returns {String} A string that can be used as a CSS ease.
 */
proto.toCSSString = function () {
	return 'cubic-bezier(' + this.p1.x + ', ' + this.p1.y + ', ' + this.p2.x + ', ' + this.p2.y + ')';
};

/**
 * @name BezierCurveCss#toEasingFunction
 * @function
 *
 * @desc Returns the equivalent JS easing function.
 *
 * @returns {Function} Equivalent JS easing function.
 */
proto.toEasingFunction = function () {
	return createBezier.apply(this, this.toArray()).easingFunction;
};

/**
 * @name BezierCurveCss#_getStartX
 * @function
 * @private
 *
 * @desc Similar to the _splitBezier function below but only returns the starting X position of the new curve.
 *
 * @param {Number} p
 *        A number between 0 and 1 representing the percent at which the curve should be split.
 *
 * @param {Array} x
 *        The x-axis control points. The start and end points are always 0 and 1 so the length
 *        of this array will always be 2 for the control points only.
 *
 * @returns {Number} todo.
 */
/** @ignore */
proto._getStartX = function (p, x) {
	var cp = p - 1;
	var p2 = p * p;
	var cp2 = cp * cp;
	var p3 = p2 * p;
	return p3 - 3*p2*cp*x[1] + 3*p*cp2*x[0];
};

/**
 * @name BezierCurveCss#_splitBezier
 * @function
 * @private
 *
 * @desc Splits a bezier curve at a percentage along it's curve. Uses De Casteljau's algorithm.
 * @link http://en.wikipedia.org/wiki/De_Casteljau%27s_algorithm
 * @link http://stackoverflow.com/questions/8369488/splitting-a-bezier-curve
 *
 * @param {Number} p
 *        A number between 0 and 1 representing the percent at which the curve should be split.
 *
 * @param {Array} x
 *        The x-axis control points. The start and end points are always 0 and 1 so the length
 *        of this array will always be 2 for the control points only.
 *
 * @param {Array} y
 *        The y-axis control points. The start and end points are always 0 and 1 so the length
 *        of this array will always be 2 for the control points only.
 *
 * @returns {Array} Returns an array of the new start and control points. End points are not
 *                  included as they will always be 1,1.
 */
/** @ignore */
proto._splitBezier = function (p, x, y) {
	var cp = p - 1;
	var p2 = p * p;
	var cp2 = cp * cp;
	var p3 = p2 * p;
	return [
		p3 - 3*p2*cp*x[1] + 3*p*cp2*x[0],	// p0.x
		p3 - 3*p2*cp*y[1] + 3*p*cp2*y[0],	// p0.y
		p2 - 2*p*cp*x[1] + cp2*x[0],		// p1.x
		p2 - 2*p*cp*y[1] + cp2*y[0],		// p1.y
		p - cp*x[1],						// p2.x
		p - cp*y[1]							// p2.y
	];
};

/**
 * @name BezierCurveCss#_normalize
 * @function
 * @private
 *
 * @desc Bezier curves used in CSS easing must always start at 0,0 and end at 1,1.
 *       What this function does is take an Array of control points and stretches it to
 *       meet this requirments.
 *
 * @param {Array} array
 *        An array of start and control points. The end points are always 1,1.
 *
 * @returns {Array} A new array of control points.
 *                  Note: that start points are not inluded as they are now 0,0.
 */
/** @ignore */
proto._normalize = function (array) {
	return [
		(array[2] - array[0]) / (1 - array[0]),	// p1.x
		(array[3] - array[1]) / (1 - array[1]),	// p1.y
		(array[4] - array[0]) / (1 - array[0]),	// p2.x
		(array[5] - array[1]) / (1 - array[1])	// p2.y
	];
};

module.exports = BezierCurveCss;

},{"ac-easing":471}],489:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var BezierCurveCss = require('./BezierCurveCss');

/**
 * @name BezierCurveCssManager
 * @class
 * @singleton
 *
 * @desc Manages instances of BezierCurveCss to enable caching.
 */
function BezierCurveCssManager() {
	this._instances = {};
}

var proto = BezierCurveCssManager.prototype;

/**
 * @name BezierCurveCssManager#curve
 * @function
 *
 * @desc Returns an instance of BezierCurveCss. Checks to see if there's already an
 *       instance first otherwise create new instance.
 *
 * @param {String|Array} curve
 *        Either a CSS cubic bezier ease `String`, e.g. `'cubic-bezier(0.0, 0.0, 1.0, 1.0)'`.
 *        Alternatively, an `Array` containing the two control points, so using the above
 *        CSS string, `[0, 0, 1, 1]`
 *
 * @returns {BezierCurveCss} An instance of BezierCurveCss.
 */
proto.create = function (curve) {
	var key;
	if (typeof curve === 'string') {
		key = curve.replace(/ /g, '');
	}
	else {
		key = 'cubic-bezier(' + curve.join(',') + ')';
	}

	if (this._instances[key] === undefined) {
		if (typeof curve === 'string') {
			curve = curve.match(/\d*\.?\d+/g);
			var i = curve.length;
			while (i--) {
				curve[i] = Number(curve[i]);
			}
		}
		this._instances[key] = new BezierCurveCss(curve, this);
	}

	return this._instances[key];
};

module.exports = new BezierCurveCssManager();

},{"./BezierCurveCss":488}],490:[function(require,module,exports){
arguments[4][276][0].apply(exports,arguments)
},{"dup":276}],491:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var splitUnits = require('./splitUnits');

/** @ignore */
var DomMetrics = require('ac-dom-metrics');

/** @ignore */
var percentagePropToDimention = {
	translateX: 'width',
	translateY: 'height'
};

/**
 * @name TransformMatrix
 * @class
 *
 * @desc TransformMatrix is a sort of wrapper for ac-transform. It takes an object
 *       of styles and applies them to an instance of Transform
 *
 * @param {Transform} transform
 *        An instance of ac-transform.Transform.
 *
 * @param {Element} el
 *        The element to use to get dimentions from when using %.
 *
 * @param {Object} styles
 *        An object containing css transform partial properties, e.g. translateX.
 */
function TransformMatrix(transform, el, styles) {
	this._transform = transform;
	var split;
	var value;
	var prop;
	for (prop in styles) {
		if (styles.hasOwnProperty(prop) && typeof this._transform[prop] === 'function') {
			split = splitUnits(styles[prop]);
			if (split.unit === '%') {
				value = this._convertPercentToPixelValue(prop, split.value, el);
			}
			else {
				value = split.value;
			}
			this._transform[prop].call(this._transform, value);
		}
	}
}

var proto = TransformMatrix.prototype;

/**
 * @name TransformMatrix#_convertPercentToPixelValue
 * @function
 * @private
 *
 * @param {String} prop
 * @param {Number} value
 * @param {Element} el
 *
 * @return {Number}
 */
/** @ignore */
proto._convertPercentToPixelValue = function (prop, value, el) {
	prop = percentagePropToDimention[prop];
	var dimentions = DomMetrics.getDimensions(el);

	if (dimentions[prop]) {
		value *= 0.01;
		return dimentions[prop] * value;
	}

	return value;
};

/**
 * @name TransformMatrix#toArray
 * @function
 *
 * @desc Returns the transform matrix as an Array.
 *
 * @returns {Array}
 */
proto.toArray = function () {
	return this._transform.toArray();
};

/**
 * @name TransformMatrix#toCSSString
 * @function
 *
 * @desc Returns the transform matrix as a CSS compatible string.
 *
 * @returns {String}
 */
proto.toCSSString = function () {
	return this._transform.toCSSString();
};

module.exports = TransformMatrix;

},{"./splitUnits":498,"ac-dom-metrics":86}],492:[function(require,module,exports){
arguments[4][278][0].apply(exports,arguments)
},{"dup":278}],493:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var clone = require('ac-object').clone;
var cssColorNames = require('./cssColorNames');
var splitUnits = require('./splitUnits');
var toCamCase = require('./toCamCase');

/** @ignore */
var ColorUtils = require('ac-color');
var DomStyles = require('ac-dom-styles');
var Feature = require('ac-feature');
var Transform = require('ac-transform').Transform;
var TransformMatrix = require('./TransformMatrix');

// takes a color (hex, color name (e.g. red) etc)
// and returns an RGB object
var toRgbObject = function (color) {
	if (cssColorNames[color]) {
		color = cssColorNames[color];
	}
	else {
		if (ColorUtils.isHex(color)) {
			color = ColorUtils.hexToRgb(color);
		}
		color = ColorUtils.rgbToObject(color);
	}
	color['isColor'] = true;
	return color;
};

/**
 * @name convertToTransitionableObjects
 * @function
 * 
 * @desc Converts objects containing CSS styles into objects that ac-clip.Clip can use / transition.
 *
 * @param {Element} el
 *        The element that will be used to get inital / target styles (the element that will be transitioned).
 *
 * @param {Object} propsTo
 *        The CSS styles that will be transitioned to.
 *
 * @param {Object} propsFrom
 *        The CSS styles that will be a start state when the clip starts. Defaults to the current styles of el.
 *
 * @returns {Object} An object containing transitionable styles broken into target, propsTo and propsFrom.
 */
module.exports = function convertToTransitionableObjects (el, propsTo, propsFrom) {

	var target = {};
	propsTo = clone(propsTo, true);
	propsFrom = clone(propsFrom, true);
	
	var style;	
	var mTarget, mTo, mFrom;
	var isTransformSupported = Feature.cssPropertyAvailable('transform');

	var prop;
	// first loop through each propTo value
	for (prop in propsTo) {
		if (propsTo.hasOwnProperty(prop) && propsTo[prop] !== null) {
			if (prop === 'transform') {
				if (isTransformSupported) {
					// Transform is a JS implementation of the CSS3-Transforms spec
					mTarget = new Transform();
					style = DomStyles.getStyle(el, 'transform')['transform'] || 'none';
					mTarget.setMatrixValue(style);
					// if transform should be relative use mTarget.clone() instead of new Transform()
					mTo = new TransformMatrix(new Transform(), el, propsTo[prop]);
				}
				if (mTo && mTo.toCSSString() !== mTarget.toCSSString()) {
					mFrom = new TransformMatrix(propsFrom[prop] ? new Transform() : mTarget.clone(), el, propsFrom[prop]);
					target[prop] = mTarget.toArray();
					propsTo[prop] = mTo.toArray();
					propsFrom[prop] = mFrom.toArray();
				}
				else {
					// transforms not supported
					target[prop] = null;
					propsTo[prop] = null;
				}
			}
			else {
				style = DomStyles.getStyle(el, prop)[toCamCase(prop)];
				if (ColorUtils.isColor(style)) {
					// for colors convert to RGB and use an object
					target[prop] = toRgbObject(style);
					propsFrom[prop] = (propsFrom[prop] !== undefined) ? toRgbObject(propsFrom[prop]) : clone(target[prop], true);
					propsTo[prop] = toRgbObject(propsTo[prop]);
				}
				else {
					// splitUnits takes a CSS value (e.g. 10px) and breaks it into an object ({ value:10, unit:'px' })
					target[prop] = splitUnits(style);
					propsFrom[prop] = (propsFrom[prop] !== undefined) ? splitUnits(propsFrom[prop]) : clone(target[prop], true);
					propsTo[prop] = splitUnits(propsTo[prop]);
				}
			}
		}
	}

	// next we loop through propsFrom and if a propsFrom doesn't have a propsTo we add propsTo to match the current state of target
	for (prop in propsFrom) {
		if (propsFrom.hasOwnProperty(prop) && propsFrom[prop] !== null && (propsTo[prop] === undefined || propsTo[prop] === null)) {
			if (prop === 'transform') {
				if (isTransformSupported) {
					// Transform is a JS implementation of the CSS3-Transforms spec
					mTarget = new Transform();
					mTarget.setMatrixValue(getComputedStyle(el).transform || getComputedStyle(el).webkitTransform || 'none');
					// if transform should be relative use mTarget.clone() instead of new Transform()
					mFrom = new TransformMatrix(new Transform(), el, propsFrom[prop]);
				}
				if (mFrom && mFrom.toCSSString() !== mTarget.toCSSString()) {
					mTo = new TransformMatrix(mTarget.clone());
					target[prop] = mTarget.toArray();
					propsTo[prop] = mTo.toArray();
					propsFrom[prop] = mFrom.toArray();
				}
				else {
					// transforms not supported
					target[prop] = null;
					propsTo[prop] = null;
					propsFrom[prop] = null;
				}
			}
			else {
				style = DomStyles.getStyle(el, prop)[toCamCase(prop)];
				if (ColorUtils.isColor(style)) {
					// for colors convert to RGB and use an object
					target[prop] = toRgbObject(style);
					propsTo[prop] = clone(target[prop], true);
					propsFrom[prop] = toRgbObject(propsFrom[prop]);
				}
				else {
					// splitUnits takes a CSS value (e.g. 10px) and breaks it into an object ({ value:10, unit:'px' })
					target[prop] = splitUnits(style);
					propsFrom[prop] = splitUnits(propsFrom[prop]);
					propsTo[prop] = clone(target[prop], true);
				}
			}

		}
	}

	return {
		target: target,
		propsTo: propsTo,
		propsFrom: propsFrom
	};
};

},{"./TransformMatrix":491,"./cssColorNames":494,"./splitUnits":498,"./toCamCase":499,"ac-color":458,"ac-dom-styles":160,"ac-feature":583,"ac-object":790,"ac-transform":480}],494:[function(require,module,exports){
arguments[4][280][0].apply(exports,arguments)
},{"dup":280}],495:[function(require,module,exports){
arguments[4][281][0].apply(exports,arguments)
},{"dup":281}],496:[function(require,module,exports){
arguments[4][282][0].apply(exports,arguments)
},{"dup":282}],497:[function(require,module,exports){
arguments[4][283][0].apply(exports,arguments)
},{"./getShorthandTransition":495,"ac-dom-styles":160,"dup":283}],498:[function(require,module,exports){
arguments[4][284][0].apply(exports,arguments)
},{"dup":284}],499:[function(require,module,exports){
arguments[4][285][0].apply(exports,arguments)
},{"dup":285}],500:[function(require,module,exports){
arguments[4][286][0].apply(exports,arguments)
},{"dup":286}],501:[function(require,module,exports){
arguments[4][287][0].apply(exports,arguments)
},{"dup":287}],502:[function(require,module,exports){
arguments[4][288][0].apply(exports,arguments)
},{"./ac-array/flatten":503,"./ac-array/intersection":504,"./ac-array/toArray":505,"./ac-array/union":506,"./ac-array/unique":507,"./ac-array/without":508,"dup":288}],503:[function(require,module,exports){
arguments[4][289][0].apply(exports,arguments)
},{"dup":289}],504:[function(require,module,exports){
arguments[4][290][0].apply(exports,arguments)
},{"dup":290}],505:[function(require,module,exports){
arguments[4][291][0].apply(exports,arguments)
},{"dup":291}],506:[function(require,module,exports){
arguments[4][292][0].apply(exports,arguments)
},{"./flatten":503,"./unique":507,"dup":292}],507:[function(require,module,exports){
arguments[4][293][0].apply(exports,arguments)
},{"dup":293}],508:[function(require,module,exports){
arguments[4][294][0].apply(exports,arguments)
},{"dup":294}],509:[function(require,module,exports){
arguments[4][295][0].apply(exports,arguments)
},{"./ac-dom-emitter/DOMEmitter":510,"dup":295}],510:[function(require,module,exports){
arguments[4][296][0].apply(exports,arguments)
},{"ac-event-emitter":572,"dup":296}],511:[function(require,module,exports){
arguments[4][297][0].apply(exports,arguments)
},{"./ac-dom-styles/ie":512,"./ac-dom-styles/vendorTransformHelper":513,"dup":297}],512:[function(require,module,exports){
arguments[4][298][0].apply(exports,arguments)
},{"dup":298}],513:[function(require,module,exports){
arguments[4][299][0].apply(exports,arguments)
},{"dup":299}],514:[function(require,module,exports){
arguments[4][300][0].apply(exports,arguments)
},{"./ac-dom-metrics/ie":515,"ac-dom-styles":511,"dup":300}],515:[function(require,module,exports){
arguments[4][301][0].apply(exports,arguments)
},{"dup":301}],516:[function(require,module,exports){
arguments[4][1][0].apply(exports,arguments)
},{"dup":1}],517:[function(require,module,exports){
arguments[4][375][0].apply(exports,arguments)
},{"./ac-object/clone":518,"./ac-object/create":519,"./ac-object/defaults":520,"./ac-object/extend":521,"./ac-object/getPrototypeOf":522,"./ac-object/isDate":523,"./ac-object/isEmpty":524,"./ac-object/isRegExp":525,"./ac-object/toQueryParameters":526,"dup":375}],518:[function(require,module,exports){
arguments[4][376][0].apply(exports,arguments)
},{"./extend":521,"dup":376}],519:[function(require,module,exports){
arguments[4][377][0].apply(exports,arguments)
},{"dup":377}],520:[function(require,module,exports){
arguments[4][378][0].apply(exports,arguments)
},{"./extend":521,"dup":378}],521:[function(require,module,exports){
arguments[4][379][0].apply(exports,arguments)
},{"dup":379}],522:[function(require,module,exports){
arguments[4][380][0].apply(exports,arguments)
},{"dup":380}],523:[function(require,module,exports){
arguments[4][381][0].apply(exports,arguments)
},{"dup":381}],524:[function(require,module,exports){
arguments[4][382][0].apply(exports,arguments)
},{"dup":382}],525:[function(require,module,exports){
arguments[4][383][0].apply(exports,arguments)
},{"dup":383}],526:[function(require,module,exports){
arguments[4][384][0].apply(exports,arguments)
},{"dup":384,"qs":516}],527:[function(require,module,exports){
arguments[4][88][0].apply(exports,arguments)
},{"dup":88}],528:[function(require,module,exports){
arguments[4][114][0].apply(exports,arguments)
},{"./ac-dom-traversal/ancestor":529,"./ac-dom-traversal/ancestors":530,"./ac-dom-traversal/children":531,"./ac-dom-traversal/filterBySelector":532,"./ac-dom-traversal/firstChild":533,"./ac-dom-traversal/lastChild":536,"./ac-dom-traversal/matchesSelector":537,"./ac-dom-traversal/nextSibling":538,"./ac-dom-traversal/nextSiblings":539,"./ac-dom-traversal/previousSibling":540,"./ac-dom-traversal/previousSiblings":541,"./ac-dom-traversal/querySelector":542,"./ac-dom-traversal/querySelectorAll":543,"./ac-dom-traversal/shims/ie":544,"./ac-dom-traversal/siblings":545,"dup":114}],529:[function(require,module,exports){
arguments[4][115][0].apply(exports,arguments)
},{"./helpers/validate":535,"./matchesSelector":537,"ac-dom-nodes":432,"dup":115}],530:[function(require,module,exports){
arguments[4][116][0].apply(exports,arguments)
},{"./helpers/validate":535,"./matchesSelector":537,"ac-dom-nodes":432,"dup":116}],531:[function(require,module,exports){
arguments[4][117][0].apply(exports,arguments)
},{"./filterBySelector":532,"./helpers/validate":535,"ac-dom-nodes":432,"dup":117}],532:[function(require,module,exports){
arguments[4][118][0].apply(exports,arguments)
},{"./helpers/validate":535,"./matchesSelector":537,"dup":118}],533:[function(require,module,exports){
arguments[4][119][0].apply(exports,arguments)
},{"./children":531,"./helpers/validate":535,"dup":119}],534:[function(require,module,exports){
arguments[4][120][0].apply(exports,arguments)
},{"dup":120}],535:[function(require,module,exports){
arguments[4][121][0].apply(exports,arguments)
},{"ac-dom-nodes":432,"dup":121}],536:[function(require,module,exports){
arguments[4][122][0].apply(exports,arguments)
},{"./children":531,"./helpers/validate":535,"dup":122}],537:[function(require,module,exports){
arguments[4][123][0].apply(exports,arguments)
},{"./helpers/nativeMatches":534,"./helpers/validate":535,"ac-dom-nodes":432,"dup":123}],538:[function(require,module,exports){
arguments[4][124][0].apply(exports,arguments)
},{"./helpers/validate":535,"./matchesSelector":537,"ac-dom-nodes":432,"dup":124}],539:[function(require,module,exports){
arguments[4][125][0].apply(exports,arguments)
},{"./helpers/validate":535,"./matchesSelector":537,"ac-dom-nodes":432,"dup":125}],540:[function(require,module,exports){
arguments[4][126][0].apply(exports,arguments)
},{"./helpers/validate":535,"./matchesSelector":537,"ac-dom-nodes":432,"dup":126}],541:[function(require,module,exports){
arguments[4][127][0].apply(exports,arguments)
},{"./helpers/validate":535,"./matchesSelector":537,"ac-dom-nodes":432,"dup":127}],542:[function(require,module,exports){
arguments[4][128][0].apply(exports,arguments)
},{"./helpers/validate":535,"dup":128}],543:[function(require,module,exports){
arguments[4][129][0].apply(exports,arguments)
},{"./helpers/validate":535,"dup":129}],544:[function(require,module,exports){
arguments[4][130][0].apply(exports,arguments)
},{"../helpers/nativeMatches":534,"../helpers/validate":535,"../vendor/sizzle/sizzle":546,"ac-dom-nodes":432,"dup":130}],545:[function(require,module,exports){
arguments[4][131][0].apply(exports,arguments)
},{"./children":531,"./helpers/validate":535,"dup":131}],546:[function(require,module,exports){
arguments[4][132][0].apply(exports,arguments)
},{"dup":132}],547:[function(require,module,exports){
arguments[4][133][0].apply(exports,arguments)
},{"./ac-dom-emitter/DOMEmitter":548,"dup":133}],548:[function(require,module,exports){
arguments[4][134][0].apply(exports,arguments)
},{"ac-dom-events":527,"ac-dom-traversal":528,"ac-event-emitter":572,"dup":134}],549:[function(require,module,exports){
arguments[4][137][0].apply(exports,arguments)
},{"./ac-shared-instance/SharedInstance":550,"dup":137}],550:[function(require,module,exports){
arguments[4][138][0].apply(exports,arguments)
},{"dup":138}],551:[function(require,module,exports){
arguments[4][139][0].apply(exports,arguments)
},{"./ac-window-delegate/WindowDelegate":554,"./ac-window-delegate/WindowDelegateCustomEvent":555,"./ac-window-delegate/WindowDelegateOptimizer":556,"dup":139}],552:[function(require,module,exports){
arguments[4][140][0].apply(exports,arguments)
},{"ac-event-emitter":572,"dup":140}],553:[function(require,module,exports){
arguments[4][141][0].apply(exports,arguments)
},{"ac-event-emitter":572,"dup":141}],554:[function(require,module,exports){
arguments[4][142][0].apply(exports,arguments)
},{"./CustomEventController":552,"./OptimizerController":553,"./optimizers/optimizers":559,"./queries/queries":568,"ac-dom-emitter":547,"ac-shared-instance":549,"dup":142}],555:[function(require,module,exports){
arguments[4][143][0].apply(exports,arguments)
},{"ac-event-emitter":572,"dup":143}],556:[function(require,module,exports){
arguments[4][144][0].apply(exports,arguments)
},{"ac-event-emitter":572,"dup":144}],557:[function(require,module,exports){
arguments[4][145][0].apply(exports,arguments)
},{"../../WindowDelegateOptimizer":556,"../../queries/queries":568,"dup":145}],558:[function(require,module,exports){
arguments[4][146][0].apply(exports,arguments)
},{"../../WindowDelegateOptimizer":556,"../../queries/queries":568,"dup":146}],559:[function(require,module,exports){
arguments[4][147][0].apply(exports,arguments)
},{"./events/resize":557,"./events/scroll":558,"dup":147}],560:[function(require,module,exports){
arguments[4][148][0].apply(exports,arguments)
},{"dup":148}],561:[function(require,module,exports){
arguments[4][149][0].apply(exports,arguments)
},{"dup":149}],562:[function(require,module,exports){
arguments[4][150][0].apply(exports,arguments)
},{"dup":150}],563:[function(require,module,exports){
arguments[4][151][0].apply(exports,arguments)
},{"dup":151}],564:[function(require,module,exports){
arguments[4][152][0].apply(exports,arguments)
},{"dup":152}],565:[function(require,module,exports){
arguments[4][153][0].apply(exports,arguments)
},{"dup":153}],566:[function(require,module,exports){
arguments[4][154][0].apply(exports,arguments)
},{"dup":154}],567:[function(require,module,exports){
arguments[4][155][0].apply(exports,arguments)
},{"dup":155}],568:[function(require,module,exports){
arguments[4][156][0].apply(exports,arguments)
},{"./methods/clientHeight":560,"./methods/clientWidth":561,"./methods/innerHeight":562,"./methods/innerWidth":563,"./methods/maxScrollX":564,"./methods/maxScrollY":565,"./methods/scrollX":566,"./methods/scrollY":567,"dup":156}],569:[function(require,module,exports){
arguments[4][371][0].apply(exports,arguments)
},{"./ac-element-tracker/ElementTracker":570,"dup":371}],570:[function(require,module,exports){
arguments[4][372][0].apply(exports,arguments)
},{"./TrackedElement":571,"ac-array":502,"ac-dom-metrics":514,"ac-dom-nodes":432,"ac-event-emitter":572,"ac-object":517,"ac-window-delegate":551,"dup":372}],571:[function(require,module,exports){
arguments[4][373][0].apply(exports,arguments)
},{"ac-dom-emitter":509,"ac-dom-nodes":432,"ac-object":517,"dup":373}],572:[function(require,module,exports){
arguments[4][135][0].apply(exports,arguments)
},{"./ac-event-emitter/EventEmitter":573,"dup":135}],573:[function(require,module,exports){
arguments[4][136][0].apply(exports,arguments)
},{"dup":136}],574:[function(require,module,exports){
arguments[4][232][0].apply(exports,arguments)
},{"./helpers/globals":582,"ac-function/once":608,"dup":232}],575:[function(require,module,exports){
arguments[4][233][0].apply(exports,arguments)
},{"./touchAvailable":604,"ac-browser":49,"ac-function/once":608,"dup":233}],576:[function(require,module,exports){
arguments[4][234][0].apply(exports,arguments)
},{"./helpers/globals":582,"ac-function/once":608,"dup":234}],577:[function(require,module,exports){
arguments[4][235][0].apply(exports,arguments)
},{"ac-function/once":608,"ac-prefixer/getStyleValue":592,"dup":235}],578:[function(require,module,exports){
arguments[4][236][0].apply(exports,arguments)
},{"ac-function/memoize":607,"ac-prefixer/getStyleProperty":591,"ac-prefixer/getStyleValue":592,"dup":236}],579:[function(require,module,exports){
arguments[4][237][0].apply(exports,arguments)
},{"ac-function/once":608,"ac-prefixer/getStyleValue":592,"dup":237}],580:[function(require,module,exports){
arguments[4][238][0].apply(exports,arguments)
},{"./helpers/globals":582,"ac-function/memoize":607,"dup":238}],581:[function(require,module,exports){
arguments[4][239][0].apply(exports,arguments)
},{"ac-function/memoize":607,"ac-prefixer/getEventType":590,"dup":239}],582:[function(require,module,exports){
arguments[4][240][0].apply(exports,arguments)
},{"dup":240}],583:[function(require,module,exports){
arguments[4][241][0].apply(exports,arguments)
},{"./canvasAvailable":574,"./continuousScrollEventsAvailable":575,"./cookiesAvailable":576,"./cssLinearGradientAvailable":577,"./cssPropertyAvailable":578,"./cssViewportUnitsAvailable":579,"./elementAttributeAvailable":580,"./eventTypeAvailable":581,"./isDesktop":584,"./isHandheld":585,"./isRetina":586,"./isTablet":587,"./localStorageAvailable":588,"./mediaElementsAvailable":589,"./sessionStorageAvailable":601,"./svgAvailable":602,"./threeDTransformsAvailable":603,"./touchAvailable":604,"./webGLAvailable":605,"dup":241}],584:[function(require,module,exports){
arguments[4][242][0].apply(exports,arguments)
},{"./helpers/globals":582,"./touchAvailable":604,"ac-function/once":608,"dup":242}],585:[function(require,module,exports){
arguments[4][243][0].apply(exports,arguments)
},{"./isDesktop":584,"./isTablet":587,"ac-function/once":608,"dup":243}],586:[function(require,module,exports){
arguments[4][244][0].apply(exports,arguments)
},{"./helpers/globals":582,"dup":244}],587:[function(require,module,exports){
arguments[4][245][0].apply(exports,arguments)
},{"./helpers/globals":582,"./isDesktop":584,"ac-function/once":608,"dup":245}],588:[function(require,module,exports){
arguments[4][246][0].apply(exports,arguments)
},{"./helpers/globals":582,"ac-function/once":608,"dup":246}],589:[function(require,module,exports){
arguments[4][247][0].apply(exports,arguments)
},{"./helpers/globals":582,"ac-function/once":608,"dup":247}],590:[function(require,module,exports){
arguments[4][66][0].apply(exports,arguments)
},{"./shared/camelCasedEventTypes":593,"./shared/prefixHelper":595,"./utils/eventTypeAvailable":598,"dup":66}],591:[function(require,module,exports){
arguments[4][163][0].apply(exports,arguments)
},{"./shared/getStyleTestElement":594,"./shared/prefixHelper":595,"./shared/stylePropertyCache":596,"./utils/toCSS":599,"./utils/toDOM":600,"dup":163}],592:[function(require,module,exports){
arguments[4][164][0].apply(exports,arguments)
},{"./getStyleProperty":591,"./shared/prefixHelper":595,"./shared/stylePropertyCache":596,"./shared/styleValueAvailable":597,"dup":164}],593:[function(require,module,exports){
arguments[4][67][0].apply(exports,arguments)
},{"dup":67}],594:[function(require,module,exports){
arguments[4][165][0].apply(exports,arguments)
},{"dup":165}],595:[function(require,module,exports){
arguments[4][68][0].apply(exports,arguments)
},{"dup":68}],596:[function(require,module,exports){
arguments[4][167][0].apply(exports,arguments)
},{"dup":167}],597:[function(require,module,exports){
arguments[4][168][0].apply(exports,arguments)
},{"./getStyleTestElement":594,"./stylePropertyCache":596,"dup":168}],598:[function(require,module,exports){
arguments[4][69][0].apply(exports,arguments)
},{"dup":69}],599:[function(require,module,exports){
arguments[4][170][0].apply(exports,arguments)
},{"dup":170}],600:[function(require,module,exports){
arguments[4][171][0].apply(exports,arguments)
},{"dup":171}],601:[function(require,module,exports){
arguments[4][261][0].apply(exports,arguments)
},{"./helpers/globals":582,"ac-function/once":608,"dup":261}],602:[function(require,module,exports){
arguments[4][262][0].apply(exports,arguments)
},{"./helpers/globals":582,"ac-function/once":608,"dup":262}],603:[function(require,module,exports){
arguments[4][263][0].apply(exports,arguments)
},{"ac-function/once":608,"ac-prefixer/getStyleValue":592,"dup":263}],604:[function(require,module,exports){
arguments[4][264][0].apply(exports,arguments)
},{"./helpers/globals":582,"ac-function/once":608,"dup":264}],605:[function(require,module,exports){
arguments[4][265][0].apply(exports,arguments)
},{"./helpers/globals":582,"ac-function/once":608,"dup":265}],606:[function(require,module,exports){
/**
 * @copyright 2015 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name module:ac-function.debounce
 *
 * @function
 *
 * @desc Returns a function, that, as long as it continues to be invoked, will
 *       not be triggered. The function will be called after it stops being
 *       called for N milliseconds.
 *
 * @param {Function} func
 *        The function to be executed.
 *
 * @param {Number} wait
 *        The time to wait before executing the function in milliseconds.
 *
 * @returns {Function} Debounced function.
 */
function debounce (func, wait) {
	var timeout;

	return function () {
		var args = arguments;
		var context = this;

		var later = function () {
			timeout = null;
			func.apply(context, args);
		};

		clearTimeout(timeout);
		timeout = setTimeout(later, wait);
	};

}

module.exports = debounce;

},{}],607:[function(require,module,exports){
arguments[4][248][0].apply(exports,arguments)
},{"dup":248}],608:[function(require,module,exports){
arguments[4][249][0].apply(exports,arguments)
},{"dup":249}],609:[function(require,module,exports){
'use strict';

var preventDefault = require('ac-dom-events/preventDefault');
var stopPropagation = require('ac-dom-events/stopPropagation');

function hasPageCoords (e) {
	if (e.touches && e.touches.length === 0) {
		return false;
	}

	if (typeof e.pageX !== 'number') {
		return false;
	}

	return true;
};


function PointerEvent (e) {
	this.originalEvent = e;

	if (hasPageCoords(e)) {
		this.pageX = e.touches ? e.touches[0].pageX : this.originalEvent.pageX;
		this.pageY = e.touches ? e.touches[0].pageY : this.originalEvent.pageY;
	}

};

var proto = PointerEvent.prototype;

proto.preventDefault = function () {
	preventDefault(this.originalEvent);
};

proto.stopPropagation = function () {
	stopPropagation(this.originalEvent);
};

module.exports = PointerEvent;

},{"ac-dom-events/preventDefault":70,"ac-dom-events/stopPropagation":74}],610:[function(require,module,exports){
/**
 * @module ac-gesture-pointermove
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

var EventEmitter = require('ac-event-emitter').EventEmitter;
var addEventListener = require('ac-dom-events/addEventListener');
var removeEventListener = require('ac-dom-events/removeEventListener');
var PointerEvent = require('./PointerEvent');
var objectCreate = require('ac-object/create');
var INPUTS = require('./util/inputs');


function PointerMove (element, options) {
	this.options = options || {};
	this.element = element;

	this._listeners = [];

	if (options.mouse === true) {
		this._listeners.push(INPUTS.MOUSE);
	}

	if (options.touch === true) {
		this._listeners.push(INPUTS.TOUCH);
	}

	this._boundMove = this._move.bind(this);
	this._boundEnd = this._end.bind(this);
	this._boundCancel = this._cancel.bind(this);
	this._boundStart = this._start.bind(this);

	this._hasFiredStart = false;
	this._startEvent = null;

}

var proto = PointerMove.prototype = objectCreate(EventEmitter.prototype);

proto._start = function (e) {
	for(var i = 0; i < this._listeners.length; i += 1) {
		addEventListener(this.element, this._listeners[i].MOVE_EVENT, this._boundMove);
		addEventListener(this.element, this._listeners[i].END_EVENT, this._boundEnd);
		addEventListener(this.element, this._listeners[i].CANCEL_EVENT, this._boundCancel);
	}

	this._startEvent = new PointerEvent(e);
};

proto._move = function (e) {
	if (this._hasFiredStart === false) {
		this._hasFiredStart = true;
		this.trigger('start', this._startEvent);
	}

	this.trigger('move', new PointerEvent(e));
};

proto._end = function (e) {
	this._removeAllListeners();

	this.trigger('end', new PointerEvent(e));
	this._hasFiredStart = false;
	this._startEvent = null;
};

proto._cancel = function (e) {
	this._removeAllListeners();

	this.trigger('cancel', new PointerEvent(e));

	this._hasFiredStart = false;
	this._startEvent = null;
};

proto._removeAllListeners = function () {
	for(var i = 0; i < this._listeners.length; i += 1) {
		removeEventListener(this.element, this._listeners[i].MOVE_EVENT, this._boundMove);
		removeEventListener(this.element, this._listeners[i].END_EVENT, this._boundEnd);
		removeEventListener(this.element, this._listeners[i].CANCEL_EVENT, this._boundCancel);
	}
}

proto.activate = function () {

	for(var i = 0; i < this._listeners.length; i += 1) {
		addEventListener(this.element, this._listeners[i].START_EVENT, this._boundStart);
	}

};


proto.destroy = function () {
	this._boundStart = null;
	this._boundEnd = null;
	this._boundCancel = null;


};


PointerMove.create = function (element, options) {
	return new PointerMove(element, options);
}

module.exports = PointerMove;

},{"./PointerEvent":609,"./util/inputs":611,"ac-dom-events/addEventListener":63,"ac-dom-events/removeEventListener":71,"ac-event-emitter":572,"ac-object/create":786}],611:[function(require,module,exports){
'use strict';

var INPUTS = {
	MOUSE: {
		START_EVENT:'mousedown',
		MOVE_EVENT:'mousemove',
		END_EVENT:'mouseup',
		CANCEL_EVENT:'mouseleave'
	},
	TOUCH: {
		START_EVENT:'touchstart',
		MOVE_EVENT:'touchmove',
		END_EVENT:'touchend',
		CANCEL_EVENT:'touchcancel'
	}
};


module.exports = INPUTS;

},{}],612:[function(require,module,exports){
arguments[4][288][0].apply(exports,arguments)
},{"./ac-array/flatten":613,"./ac-array/intersection":614,"./ac-array/toArray":615,"./ac-array/union":616,"./ac-array/unique":617,"./ac-array/without":618,"dup":288}],613:[function(require,module,exports){
arguments[4][289][0].apply(exports,arguments)
},{"dup":289}],614:[function(require,module,exports){
arguments[4][290][0].apply(exports,arguments)
},{"dup":290}],615:[function(require,module,exports){
arguments[4][291][0].apply(exports,arguments)
},{"dup":291}],616:[function(require,module,exports){
arguments[4][292][0].apply(exports,arguments)
},{"./flatten":613,"./unique":617,"dup":292}],617:[function(require,module,exports){
arguments[4][293][0].apply(exports,arguments)
},{"dup":293}],618:[function(require,module,exports){
arguments[4][294][0].apply(exports,arguments)
},{"dup":294}],619:[function(require,module,exports){
arguments[4][137][0].apply(exports,arguments)
},{"./ac-shared-instance/SharedInstance":620,"dup":137}],620:[function(require,module,exports){
arguments[4][138][0].apply(exports,arguments)
},{"dup":138}],621:[function(require,module,exports){
/** 
 * @module ac-mvc-cid
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

module.exports = {
	CID: require('./ac-mvc-cid/CID')
};

},{"./ac-mvc-cid/CID":622}],622:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

var SharedInstance = require('ac-shared-instance').SharedInstance;

var sharedInstanceName = 'ac-mvc-cid:CID',
	sharedInstanceVersion = '1.0.0';

/**
 * @name module:ac-mvc-cid.CID
 * @class
 * 
 * @desc CID Generator for client id's
 * 
 */
function CID() {
	// set cid count to zero
	this._idCount = 0;
}

var proto = CID.prototype;

proto._cidPrefix = 'cid';

proto.getNewCID = function() {
	var cid = this._cidPrefix + '-' + this._idCount;
	this._idCount++;

	return cid;
};

module.exports = SharedInstance.share( sharedInstanceName, sharedInstanceVersion, CID );
},{"ac-shared-instance":619}],623:[function(require,module,exports){
arguments[4][1][0].apply(exports,arguments)
},{"dup":1}],624:[function(require,module,exports){
arguments[4][375][0].apply(exports,arguments)
},{"./ac-object/clone":625,"./ac-object/create":626,"./ac-object/defaults":627,"./ac-object/extend":628,"./ac-object/getPrototypeOf":629,"./ac-object/isDate":630,"./ac-object/isEmpty":631,"./ac-object/isRegExp":632,"./ac-object/toQueryParameters":633,"dup":375}],625:[function(require,module,exports){
arguments[4][376][0].apply(exports,arguments)
},{"./extend":628,"dup":376}],626:[function(require,module,exports){
arguments[4][377][0].apply(exports,arguments)
},{"dup":377}],627:[function(require,module,exports){
arguments[4][378][0].apply(exports,arguments)
},{"./extend":628,"dup":378}],628:[function(require,module,exports){
arguments[4][379][0].apply(exports,arguments)
},{"dup":379}],629:[function(require,module,exports){
arguments[4][380][0].apply(exports,arguments)
},{"dup":380}],630:[function(require,module,exports){
arguments[4][381][0].apply(exports,arguments)
},{"dup":381}],631:[function(require,module,exports){
arguments[4][382][0].apply(exports,arguments)
},{"dup":382}],632:[function(require,module,exports){
arguments[4][383][0].apply(exports,arguments)
},{"dup":383}],633:[function(require,module,exports){
arguments[4][384][0].apply(exports,arguments)
},{"dup":384,"qs":623}],634:[function(require,module,exports){
/** 
 * @module ac-mvc-collection
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

module.exports = {
	Collection: require('./ac-mvc-collection/Collection')
};

},{"./ac-mvc-collection/Collection":635}],635:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

var ac_Object = require('ac-object'),
	ac_Array = require('ac-array'),
	CID = require('ac-mvc-cid').CID,
	EventEmitter = require('ac-event-emitter').EventEmitter;

// List of Array.prototype methods we want to support natively
var mixinArrayMethods = [
	'every',
	'filter',
	'forEach',
	'map',
	'reduce',
	'reduceRight',
	'some',
	'slice',
	'sort',
	'reverse',
	'indexOf',
	'lastIndexOf'
];

// List of ac-array methods we want to support natively
var mixinACArrayMethods = [
	'intersection',
	'union',
	'unique',
	'without'
];

var eventNames = {
	add : 'add',
	remove : 'remove',
	set : 'set',
	reset : 'reset',
	empty : 'empty',
	destroy : 'destroy'
};

function mixinPrototypeMethod( target, name, func, boundArgsArr ) {
	// don't overwrite existing functionality
	if ( typeof target[ name ] !== 'undefined' ) {
		return;
	}

	// this essentially emulates function.bind, however it does not modify the function context (this)
	// mimicing something like: this.funcName = myFunc.bind( null, arg1, arg2 );
	// null binding doesn't work in anything but FF, so we mirror that implementation here
	target[ name ] = (function( func, boundArgsArr ) {
		return function() {
			var args = ac_Array.toArray( arguments ),
				newArgs = boundArgsArr.concat( args );
			return func.apply( this, newArgs );
		};
	}( func, boundArgsArr ));
}

/**
 * @name module:ac-mvc-collection.Collection
 * @class
 * 
 * @desc Library for managing many instances of Model
 * 
 * @param {Object} [models] (Optional)
 *        Single model, array of models, array of data (non-models) or empty
 */
function Collection( options ) {
	EventEmitter.call( this );
	// set options
	this.options = ac_Object.defaults( this.defaultOptions, options || {} );
	this.models = [];
	this.cid = CID.getNewCID();

	// set a model attribute if needed
	if ( this.options.ModelType ) {
		this.ModelType = this.options.ModelType;
	}

	// if a model attribute exists, add an object for id -> idx searches
	if ( this.ModelType ) {
		this._modelsObject = {};
	}

	// bind events for adding references for id -> idx relationships
	this.on( eventNames.add, this._addToModelsObject, this );
	this.on( eventNames.remove, this._removeFromModelsObject, this );

	// add models if passed in
	if ( this.options.models ) {
		this.add( this.options.models );
	}
}

var proto = Collection.prototype = ac_Object.create( EventEmitter.prototype );

proto.defaultOptions = {};

proto.count = function() {
	if ( !this.models ) {
		return null;
	}
	
	return this.models.length;
};

proto.add = function( models, options ) {
	// normalize argument inputs
	options = options || {};
	// handle no data being passed
	if ( typeof models === 'undefined' ) {
		models = [];
	}

	// if something is passed in but it isn't an Array, wrap it in an array
	models = this._returnAsArray( models );

	// ensure model instances of the data passed in if this.ModelType exists
	models = this._createModels( models );

	// ensure this.models exists, and set models to it if it doesn't
	if ( this.models.length === 0 ) {
		this.models = models;
	} else {
		this.models = this.models.concat( models );
	}

	this._trigger( eventNames.add, { models : models }, options );
	
	return this;
};

// remove models from collection and return them 
proto.remove = function( models, options ) {
	options = options || {};

	// if nothing passed, just return
	if ( !models ) {
		return [];
	}
	// ensure content is in an array
	models = this._returnAsArray( models );

	var result = [],
		i,
		idx,
		len = models.length;

	for ( i = 0; i < len; i++ ) {
		idx = this.indexOf( models[ i ] );

		if ( idx > -1 ) {
			result.push( models[ i ] );
			// remove but don't trigger until later
			this.spliceWithOptions([ idx, 1 ], { silent : true });
		}
	}

	// shoot out an event that objects will be removed
	if ( result.length > 0 ) {
		this._trigger( eventNames.remove, { models : result }, options );
	}

	return result;
};

// empty the array 
proto.reset = function( models, options ) {
	options = options || {};
	// clear and then repopulate
	this.empty( options );
	this.add( models, options );

	this._trigger( eventNames.reset, {
		models : this.models
	}, options );
	
	return this;
};

// clears the array and return removed models
proto.empty = function( options ) {
	options = options || {};
	// return removed models
	var result = this.slice( 0 );

	// reset the array
	this.models = [];

	// reset dictionary if exists
	if ( this._modelsObject ) {
		this._modelsObject = {};
	}

	if ( result.length > 0 ) {
		// trigger remove event
		this._trigger( eventNames.remove, {
			models : result
		}, options );

		// trigger empty event
		this._trigger( eventNames.empty, {
			models : result
		}, options );
	}

	// return the list that was removed
	return result;

};

proto.destroy = function( options ) {
	// destroy on all models
	options = options || {};

	// empty models
	var models = this.empty( options );

	// trigger destroy event
	this._trigger( eventNames.destroy, {
		models : models
	}, options );

	// remove bindings
	this.off();

	// nullify properties
	var i;
	for ( i in this ) {
		if ( this.hasOwnProperty( i ) ) {
			this[ i ] = null;
		}
	}

};

// get a model by id or cid
proto.get = function( id ) {

	// see if we can get a model by id or cid
	var model = this._getModelByID( id );

	if ( model ) {
		return model;
	}

	// if not found, iterate over this.models and see if it is found
	var i,
		len = this.models.length;

	for ( i = 0; i < len; i++ ) {
		if (
			( typeof this.models[ i ].id !== 'undefined' && this.models[ i ].id === id ) ||
			( typeof this.models[ i ].cid !== 'undefined' && this.models[ i ].cid === id )
		) {
			model = this.models[ i ];
			break;
		}
	}

	return model;
};

// takes in an array of model attribute data, updating models if they already exist in the collection (by id),
// adding it as a new model if DNE, and then removes models that no longer exist in the data array and returns them
proto.set = function( data, options ) {
	// normalize argument inputs
	options = options || {};
	// handle no data being passed
	if ( typeof data === 'undefined' ) {
		data = [];
	}

	// if something is passed in but it isn't an Array, wrap it in an array
	data = this._returnAsArray( data );

	var i,
		matchParameter = 'id',
		len = data.length,
		added = [],
		result = [],
		modelIds = {},
		storedModelsReference;

	// set the matchParamater to the idAttribue of the ModelType if one exists
	if ( this.ModelType && this.ModelType.prototype.idAttribute ) {
		matchParameter = this.ModelType.prototype.idAttribute;
	}

	// in some cases, we might need to change sort to find by a different property than ID
	if ( options.matchParameter ) {
		matchParameter = options.matchParameter;
	}

	for ( i = 0; i < len; i++ ) {
		storedModelsReference = null;
		// if the data is an object, we can see if it has an ID property and a model inside of the collection
		if ( typeof data[ i ] === 'object' ) {
			storedModelsReference = this.get( data[ i ][ matchParameter ] );
		}
		
		// see if we already have this model by id
		if ( storedModelsReference ) {
			// if we have a ModelType, call set
			if ( this.ModelType ) {
				storedModelsReference.set( data[ i ] );
				// save the model cid for fast lookup on remove checks
				modelIds[ storedModelsReference.cid ] = true;
			// otherwise ust replace the data
			} else {
				storedModelsReference = data[ i ];
			}

			// update it and save it to the new this.models array
			result.push( storedModelsReference );
			continue;
		}

		// if we don't have this model in the collection yet, see if we should make it into a new ModelType
		if ( this.ModelType ) {
			// do that if needed
			data[ i ] = this._createModel( data[ i ] );
		}

		// push this to the list of "added" models if DNE already in this.models
		if ( this.ModelType || this.indexOf( data[ i ] ) === -1 ) {
			added.push( data[ i ] );
		}
		
		result.push( data[ i ] );
	}

	// replace this.models with result, and all of the models that no longer exist should have "remove" triggered
	// TODO: Can this be done without another loop?
	var j,
		resultLen = result.length,
		removed = [],
		didRemove,
		model;
	len = this.models.length;

	for ( i = 0; i < len; i++ ) {
		model = this.models[ i ];

		// we can quickly see if this is being preserved if it's a model through dictionary lookup
		if ( this.ModelType ) {

			// if it was saved, don't add it to removed list
			didRemove = true;
			// console.log( modelIds );
			if ( modelIds[ model.cid ] ) {
				didRemove = false;
			}

		//  if there isn't a model, we have to check against each of the 'result' values to see if it was preserved
		} else {
			didRemove = true;
			for ( j = 0; j < resultLen; j++ ) {
				if ( model === result[ j ] ) {
					didRemove = false;
					break;
				}
			}
		}

		// if the valye was removed from the new data, add it to the removed list
		if ( didRemove ) {
			removed.push( model );
		}
	}

	// save new result to this.models
	this.models = result;

	// trigger events
	if ( added.length > 0 ) {
		this._trigger( eventNames.add, {
			models : added
		}, options );
	}

	if ( removed.length > 0 ) {
		this._trigger( eventNames.remove, {
			models : removed
		}, options );
	}

	this._trigger( eventNames.set, {
		models : result
	}, options );

	return removed;
};

// get a model at an index
proto.at = function( idx ) {
	if ( !this.models ) {
		return;
	}
	return this.models[ idx ];
};

proto.find = function( query, options ) {
	// query should be an object
	if ( typeof query !== 'object' ) {
		console.warn('Collection.protoype.find query needs to be an object');
		return [];
	}

	options = options || {};

	var result = [],
		reverse = false,
		resultLen = 0,
		model,
		i,
		limit = null,
		idx = 0,
		len = this.models.length,
		idxLimit = len;

	if ( options.reverse ) {
		idx = len - 1;
		idxLimit = -1;
		reverse = true;
	}

	if ( options.limit ) {
		limit = options.limit;
	}

	for ( i = idx; ( reverse ? i > idxLimit : i < idxLimit ); ( reverse ? i-- : i++ ) ) {
		model = this.models[ i ];
		if ( this._modelMatchesProperties( model, query ) ) {

			if ( reverse ) {
				result.unshift( model );
			} else {
				result.push( model );
			}
			resultLen++;

			if ( limit && resultLen >= limit ) {
				break;
			}

		}
	}
	
	return result;

};

proto.push = function() {
	return this.pushWithOptions( ac_Array.toArray( arguments ) );
};

proto.pop = function() {
	return this.popWithOptions( ac_Array.toArray( arguments ) );
};

proto.shift = function() {
	return this.shiftWithOptions( ac_Array.toArray( arguments ) );
};

proto.unshift = function() {
	return this.unshiftWithOptions( ac_Array.toArray( arguments ) );
};

proto.splice = function() {
	return this.spliceWithOptions( ac_Array.toArray( arguments ) );
};

proto.pushWithOptions = function( args, options ) {
	options = options || {};
	var models = this._createModels( args ),
		result = Array.prototype.push.apply( this.models, models );
		
	if ( models.length > 0 ) {
		this._trigger( eventNames.add, { models : models }, options );
	}

	return result;
};

proto.popWithOptions = function( args, options ) {
	options = options || {};
	var removed = Array.prototype.pop.call( this.models );

	if ( removed ) {
		this._trigger( eventNames.remove, { models : [ removed ] }, options );
	}

	return removed;
};

proto.shiftWithOptions = function( args, options ) {
	options = options || {};
	var removed = Array.prototype.shift.call( this.models );

	if ( removed  ) {
		this._trigger( eventNames.remove, { models : [ removed ] }, options );
	}

	return removed;
};

proto.unshiftWithOptions = function( args, options ) {
	options = options || {};
	var models = this._createModels( args ),
		result = Array.prototype.unshift.apply( this.models, models );
		
	if ( models.length > 0 ) {
		this._trigger( eventNames.add, { models : models }, options );
	}

	return result;
};

proto.spliceWithOptions = function( args, options ) {
	options = options || {};
	var sliceArgs = [ args[ 0 ], args[ 1 ] ],
		appendArgs,
		models,
		removedArr;

	// get values for splice appending
	if ( args.length > 2 ) {
		appendArgs = args.slice( 2, args.length );
		models = this._createModels( appendArgs );
		sliceArgs = sliceArgs.concat( models );
	}

	removedArr = Array.prototype.splice.apply( this.models, sliceArgs );
		
	if ( removedArr.length > 0 ) {
		this._trigger( eventNames.remove, { models : removedArr }, options );
	}

	if ( models ) {
		this._trigger( eventNames.add, { models : models }, options );
	}

	return removedArr;
};

proto._trigger = function( evt, data, options ) {
	options = options || {};
	
	if ( !options.silent ) {
		this.trigger( evt, data );
	}
};

proto._getModelByID = function( id ) {
	if ( this.ModelType && this._modelsObject && this._modelsObject[ id ] ) {
		return this._modelsObject[ id ];
	}
	return null;
};

proto._createModel = function( data ) {
	if ( data instanceof this.ModelType || data instanceof Collection ) {
		return data;
	}

	return new this.ModelType( data );
};

proto._createModels = function( arr ) {
	if ( !this.ModelType ) {
		return Array.prototype.slice.call( arr, 0 );
	}

	var result = [],
		model,
		i,
		len = arr.length;

		for ( i = 0; i < len; i++ ) {
			model = arr[ i ];
			if ( !( model instanceof this.ModelType ) ) {
				model = this._createModel( model );
			}

			result.push( model );
		}
		
	return result;
};

proto._modelMatchesProperties = function( model, matchObj ) {
	
	var i;
	for ( i in matchObj ) {
		if ( matchObj.hasOwnProperty( i ) ) {

			if ( this._getPropFromModel( model, i ) !== matchObj[ i ] ) {
				return false;
			}

		}
	}
	
	return true;
};

proto._getPropFromModel = function( model, key ) {
	if ( this.ModelType ) {
		return model.get( key );
	}
	return model[ key ];
};

// keep track of models om am object id -> idx relationships
proto._addToModelsObject = function( data ) {
	if ( !this._modelsObject || !data.models ) {
		this._modelsObject = {};
	}

	data.models.forEach( function( model ) {
		this._modelsObject[ model.id ] = model;
		this._modelsObject[ model.cid ] = model;
	}, this );

};

// remove references to models in objects on remove
proto._removeFromModelsObject = function( data ) {
	if ( !this._modelsObject || !data.models ) {
		this._modelsObject = {};
	}

	data.models.forEach( function( model ) {
		this._modelsObject[ model.id ] = null;
		this._modelsObject[ model.cid ] = null;
	}, this );
};

proto._returnAsArray = function( data ) {
	if ( !Array.isArray( data ) ) {
		data = [ data ];
	}
	return data;
};

// proxy functionality to an ac-array method that will call this.models as its source array
proto._acArrayProxy = function( method ) {
	// get arguments
	var args = ac_Array.toArray( arguments );

	// replace the first argument to be this.models (instead of method)
	args[ 0 ] = this.models;

	// call the ac-array method
	return ac_Array[ method ].apply( ac_Array, args );
};

proto._arrayPrototypeProxy = function( method ) {
	// get arguments
	var args = ac_Array.toArray( arguments );

	// remove the first argument from the array (method isn't wanted)
	args.shift();

	// call the Array method
	return Array.prototype[ method ].apply( this.models, args );
};

// Mixin Array.prototype methods
mixinArrayMethods.forEach( function( methodName ) {
	if ( typeof Array.prototype[ methodName ] === 'function' ) {
		mixinPrototypeMethod( this, methodName, this._arrayPrototypeProxy, [ methodName ] );
	}
}, proto );

// Mixin ac-array methods
mixinACArrayMethods.forEach( function( methodName ) {
	if ( typeof ac_Array[ methodName ] === 'function' ) {
		mixinPrototypeMethod( this, methodName, this._acArrayProxy, [ methodName ] );
	}
}, proto );


module.exports = Collection;
},{"ac-array":612,"ac-event-emitter":572,"ac-mvc-cid":621,"ac-object":624}],636:[function(require,module,exports){
arguments[4][137][0].apply(exports,arguments)
},{"./ac-shared-instance/SharedInstance":637,"dup":137}],637:[function(require,module,exports){
arguments[4][138][0].apply(exports,arguments)
},{"dup":138}],638:[function(require,module,exports){
arguments[4][621][0].apply(exports,arguments)
},{"./ac-mvc-cid/CID":639,"dup":621}],639:[function(require,module,exports){
arguments[4][622][0].apply(exports,arguments)
},{"ac-shared-instance":636,"dup":622}],640:[function(require,module,exports){
arguments[4][1][0].apply(exports,arguments)
},{"dup":1}],641:[function(require,module,exports){
arguments[4][375][0].apply(exports,arguments)
},{"./ac-object/clone":642,"./ac-object/create":643,"./ac-object/defaults":644,"./ac-object/extend":645,"./ac-object/getPrototypeOf":646,"./ac-object/isDate":647,"./ac-object/isEmpty":648,"./ac-object/isRegExp":649,"./ac-object/toQueryParameters":650,"dup":375}],642:[function(require,module,exports){
arguments[4][376][0].apply(exports,arguments)
},{"./extend":645,"dup":376}],643:[function(require,module,exports){
arguments[4][377][0].apply(exports,arguments)
},{"dup":377}],644:[function(require,module,exports){
arguments[4][378][0].apply(exports,arguments)
},{"./extend":645,"dup":378}],645:[function(require,module,exports){
arguments[4][379][0].apply(exports,arguments)
},{"dup":379}],646:[function(require,module,exports){
arguments[4][380][0].apply(exports,arguments)
},{"dup":380}],647:[function(require,module,exports){
arguments[4][381][0].apply(exports,arguments)
},{"dup":381}],648:[function(require,module,exports){
arguments[4][382][0].apply(exports,arguments)
},{"dup":382}],649:[function(require,module,exports){
arguments[4][383][0].apply(exports,arguments)
},{"dup":383}],650:[function(require,module,exports){
arguments[4][384][0].apply(exports,arguments)
},{"dup":384,"qs":640}],651:[function(require,module,exports){
/** 
 * @module ac-mvc-model
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

module.exports = {
	Model: require('./ac-mvc-model/Model')
};

},{"./ac-mvc-model/Model":652}],652:[function(require,module,exports){
'use strict';

var EventEmitter = require('ac-event-emitter').EventEmitter;
var ac_Object = require('ac-object');
var CID = require('ac-mvc-cid').CID;

var Model = function(attributes) {
	this.attributes = ac_Object.defaults(this.defaultAttributes, attributes || {});
	this.cid = CID.getNewCID();
	
	if (this.attributes[this.idAttribute]) {
		this.id = this.attributes[this.idAttribute];
	}

};

var proto = Model.prototype = ac_Object.create(EventEmitter.prototype);

proto.defaultAttributes = {};
proto.idAttribute = 'id';

proto._trigger = function (evtName, evtObject, options) {
	options = options || {};

	if (options.silent !== true) {
		this.trigger(evtName, evtObject);
	}
};

proto._triggerChange = function (evtName, evtObject, options) {
	return this._trigger('change:' + evtName, evtObject, options);
};

proto.get = function (attr) {
	if ( !this.attributes ) {
		return;
	}

	return this.attributes[attr];
};

proto.set = function (attrs, options) {
	if ( !this.attributes ) {
		return;
	}
	
	var propName;
	var evtObject;
	var previous;
	var changeObj = {};
	var shouldPublishChange = false;

	for(propName in attrs) {
		if (attrs.hasOwnProperty(propName)) {

			// get previous data
			previous = this.get(propName);

			// test to see if changes occured
			if (
				// if the values are objects, we have to do a deep check to see if they are the same
				(typeof previous === 'object' && typeof attrs[propName] === 'object' && JSON.stringify(previous) === JSON.stringify(attrs[propName])) ||
				// if it's the same as the new data, just continue
				(previous === attrs[propName])
			) {
				continue;
			}

			// if it is different, replace previous data with the new data and mark that a change occured
			shouldPublishChange = true;
			this.attributes[propName] = attrs[propName];

			// create an event object to store values
			evtObject = {
				value:attrs[propName],
				previous:previous
			};

			// push the changeset to the changeObj
			changeObj[propName] = evtObject;
			//publish the specific changeset on the prop
			this._triggerChange(propName, evtObject, options);

		}
	}

	// publish the whole changeset
	if (shouldPublishChange) {
		this._trigger('change', changeObj, options);
	}

};

proto.has = function (attr) {
	if ( !this.attributes ) {
		return false;
	}

	return (this.attributes[attr] !== undefined);
};

proto.eachAttribute = function (handler, context) {
	if ( !this.attributes ) {
		return;
	}

	var propName;
	for(propName in this.attributes) {
		if (this.attributes.hasOwnProperty(propName)) {
			handler.call(context, {
				attribute:propName,
				value:this.attributes[propName]
			});
		}
	}
};

proto.destroy = function () {
	// alert bindings that a destroy will occur
	this.trigger('destroy');

	// remove all events
	this.off();

	// remove instance properties
	var propName;
	for (propName in this) {
		if (this.hasOwnProperty(propName)) {
			this[propName] = null;
		}
	}
};

module.exports = Model;

},{"ac-event-emitter":572,"ac-mvc-cid":638,"ac-object":641}],653:[function(require,module,exports){
'use strict';

function create (particle, position) {

	var mass = particle.mass;

	return {

		equilibrium:position, // resting
		stiffness:-30,

		damping:-8,

		update: function (e) {
			var frameRate

			if (e.fps === 0) {
				return;
			}

			frameRate = 1 / e.fps;

			var spring_force = this.stiffness * ( (particle.position.x - 0) - this.equilibrium );
			var damper_force = this.damping * particle.velocity.x;

			var a = ( spring_force + damper_force ) / mass;
			particle.velocity.x += a * frameRate;
			particle.position.x += particle.velocity.x * frameRate;
		}
	};

};


module.exports = {
	create:create
};

},{}],654:[function(require,module,exports){
/** 
 * @module ac-routes
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

module.exports = {
	Routes: require('./ac-routes/Routes'),
	Route: require('./ac-routes/Route')
};

},{"./ac-routes/Route":655,"./ac-routes/Routes":656}],655:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name Route
 * @class
 *
 *     var Route = require('ac-routes').Route;
 *
 * @param {String|RegExp} path
 *        The path that the Route will use to detect matches.
 *
 * @param {Function} callback
 *        The callback function that will be called when a match.
 *
 * @param {Object} [context=undefined]
 *        The context of the callback function.
 *
 * @param {Boolean} [greedy=false]
 *        When set to true the Routes will stop searching for
 *        other Route instances with a match.
 *
 * @param {Number} [priority=0]
 *        The higher the number the higher the priority.
 */
function Route(path, callback, context, greedy, priority) {
	this.path = path;
	this.callback = callback;
	this.context = context;
	this.greedy = greedy || false;
	this.priority = priority || 0;
	if(typeof this.priority !== 'number') {
		throw new Error('Priority must be a Number.');
	}

	this.identifierPattern = '([a-zA-Z0-9\\-\\_]+)';
	this.tokensRe = new RegExp(':' + this.identifierPattern, 'g');
	this.matcher = this._createRouteMatcher(path);
}

var proto = Route.prototype;

/**
 * @name Route#_createRouteMatcher
 *
 * @function
 * @private
 *
 * @desc Converts the given path to RegEx and returns an Object
 *       with the pattern and tokens.
 *
 * @param {String|RegExp} path
 *        The path to be converted to a RegEx, or a RegEx.
 *
 * @returns {Object} An Object containing the RegEx and tokens (if any).
 */
proto._createRouteMatcher = function (path) {
	if(path && path.exec) {
		return {
			pattern: path
		};
	}
	else if(path === '/') {
		return {
			pattern: /^\/$/
		};
	}
	else if(typeof path !== 'string') {
		throw new Error('path must be either a string or regex');
	}

	var routeTokens = this._extractRouteTokens(path);
	var paramReString = path.replace(this.tokensRe, this.identifierPattern);
	var paramRe = new RegExp(paramReString, 'g');

	return {
		pattern: paramRe,
		routeTokens: routeTokens
	};
};

/**
 * @name Route#_extractRouteTokens
 *
 * @function
 * @private
 *
 * @desc Takes the route path and returns an array of tokens.
 *
 * @param {String} routePattern
 *        The route path.
 *
 * @returns {Array} An array of tokens.
 */
proto._extractRouteTokens = function (routePattern) {
	var routeTokenPattern = routePattern.replace(this.tokensRe, ':' + this.identifierPattern);
	var routeTokenRe = new RegExp(routeTokenPattern, 'g');
	var routeTokens = routeTokenRe.exec(routePattern);

	if (routeTokens && routeTokens.length > 1) {
		routeTokens = routeTokens.slice(1);
	} else {
		routeTokens = null;
	}

	return routeTokens;
};

/**
 * @name Route#match
 *
 * @function
 *
 * @desc Takes a path and tests if it matches the route RegEx.
 *       If there's a match it'll execute the callback.
 *
 * @param {String} path
 *        The path to test against.
 *
 * @returns {Boolean} `true` if a match was found and the
 *          callback was successfully executed, otherwise `false`.
 */
proto.match = function (path) {
	this.matcher.pattern.lastIndex = 0;
	var matches = this.matcher.pattern.exec(path);
	if(matches) {
		var params = (matches.length) ? matches.slice(1) : [];
		var callback = this.callback;
		if(callback && typeof callback === 'function') {
			callback.apply(this.context || this, params);
			return true;
		}
	}
	return false;
};

module.exports = Route;

},{}],656:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var Route = require('./Route');

/**
 * @name Routes
 * @class
 *
 *     var Routes = require('ac-routes').Routes;
 *
 * @param {Array} [routes=undefined]
 *        An array of Routes to be added upon instantiation.
 */
function Routes(routes) {
	this._routes = {};
	if(routes) {
		this.addRoutes(routes);
	}
}

var proto = Routes.prototype;

/**
 * @name Routes#_getIndex
 *
 * @function
 * @private
 *
 * @desc Loops through all routes and if it finds a match returns index of where
 *       the route is in it's associated array.
 *
 * @param {String} path
 *        The route path.
 *
 * @param {Function} callback
 *        The route callback.
 *
 * @param {Object} context
 *        The context of the callback.
 *
 * @returns {Number} Index of matches route if found, otherwise -1.
 */
proto._getIndex = function (path, callback, context) {
	if(this._routes[path] !== undefined) {
		var i = this._routes[path].length;
		while(--i > -1) {
			if(this._routes[path][i].callback === callback && this._routes[path][i].context === context) {
				return i;
			}
		}
	}
	return -1;
};

/**
 * @name Routes#match
 *
 * @function
 *
 * @desc Loops through all the routes and calls the match method.
 *
 * @param {String} path
 *        The string to use when calling match on Route.
 */
proto.match = function(path) {
	var routeString, i;
	for(routeString in this._routes) {
		i = this._routes[routeString].length;
		while(--i > -1) {
			if(this._routes[routeString][i].match(path) && this._routes[routeString][i].greedy) {
				break;
			}
		}
	}
};

/**
 * @name Routes#add
 *
 * @function
 *
 * @desc Adds a Route object.
 *
 * @param {Route} route
 *        An instance of Route to be added.
 *
 * @returns {Route} The added Route instance.
 */
proto.add = function (route) {
	if(this._routes[route.path] === undefined) {
		this._routes[route.path] = [route];
	}
	else if(!this.get(route.path, route.callback, route.context)) {
		var i, len = this._routes[route.path].length;
		if(len > 0) {
			for(i = 0; i < len; ++i) {
				if(this._routes[route.path][i].priority > route.priority) {
					this._routes[route.path].splice(i, 0, route);
					return route;
				}
			}
		}
		this._routes[route.path].push(route);
	}
	return route;
};

/**
 * @name Routes#remove
 *
 * @function
 *
 * @desc Removes a route object.
 *
 * @param {Route} route
 *        An instance of Route to be removed.
 *
 * @returns {Boolean|Route} The removed Route instance if it exists, otherwise false.
 */
proto.remove = function (route) {
	var i = this._getIndex(route.path, route.callback, route.context);
	if(i > -1) {
		this._routes[route.path].splice(i, 1);
		return route;
	}
	return false;
};

/**
 * @name Routes#get
 *
 * @function
 *
 * @desc Searches for and returns a Route.
 *
 * @param {String} path
 *        The path associated with the Route.
 *
 * @param {Function} callback
 *        The callback associated with the Route.
 *
 * @param {Object} context
 *        The context associated with the Route.
 *
 * @returns {Boolean|Route} The Route instance if it exists, otherwise false.
 */
proto.get = function (path, callback, context) {
	var i = this._getIndex(path, callback, context);
	if(i > -1) {
		return this._routes[path][i];
	}
	return false;
};

/**
 * @name Routes#createRoute
 *
 * @function
 *
 * @desc Creates a new Route instance, adds it to the routes and returns it.
 *
 * @param {String} path
 *        The route path.
 *
 * @param {Function} callback
 *        The route callback.
 *
 * @param {Object} context
 *        The context of the callback.
 *
 * @param {Boolean} [greedy=false]
 *        When set to true the Routes will stop searching for
 *        other Route instances with a match.
 *
 * @param {Number} [priority=0]
 *        The higher the number the higher the priority.
 *
 * @returns {Route} The new Route instance.
 */
proto.createRoute = function (path, callback, context, greedy, priority) {
	var route = new Route(path, callback, context, greedy, priority);
	this.add(route);
	return route;
};

/**
 * @name Routes#addRoutes
 *
 * @function
 *
 * @desc Adds multiple Route instances.
 *
 * @param {Array} routes
 *        An Array of Route objects.
 */
proto.addRoutes = function (routes) {
	if(routes instanceof Array) {
		var i, route, len = routes.length;
		for(i = 0; i < len; ++i) {
			route = routes[i];
			if(route && typeof route === 'object') {
				this.add(route);
			}
		}
	}
	else {
		throw new Error('routes must be an Array.');
	}
};

/**
 * @name Routes#removeRoutes
 *
 * @function
 *
 * @desc Removes multiple Route instances.
 *
 * @param {Array} routes
 *        An Array of Route objects.
 */
proto.removeRoutes = function (routes) {
	if(routes instanceof Array) {
		var i, route, len = routes.length;
		for(i = 0; i < len; ++i) {
			route = routes[i];
			if(route && typeof route === 'object') {
				this.remove(route);
			}
		}
	}
	else {
		throw new Error('routes must be an Array.');
	}
};

/**
 * @name Routes#getRoutes
 *
 * @function
 *
 * @desc Returns an Array of Route instances associated with the given path.
 *
 * @param {String} path
 *        The path to find Route instances associated with.
 *
 * @returns {Array} An Array of Route instances.
 */
proto.getRoutes = function (path) {
	if(this._routes[path] === undefined) {
		return [];
	}
	return this._routes[path];
};

module.exports = Routes;

},{"./Route":655}],657:[function(require,module,exports){
'ues strict';

function State (options) {
	this.options = options || {};
}


var proto = State.prototype;

proto.onExit = function () {};
proto.onEnter = function () {};

module.exports = State;

},{}],658:[function(require,module,exports){
'use strict';


var ac_object = require('ac-object');
var EventEmitter = require('ac-event-emitter').EventEmitter;

function StateMachine (options) {
	this.options = options || {};

	this.previousState = null;
	this.currentState = options.currentState || null;
};

var proto = StateMachine.prototype = ac_object.create(EventEmitter.prototype);


proto.handleInput = function (inputName, data) {
	var currentStateHandler = this.currentState[inputName];

	if (typeof currentStateHandler === 'function') {
		return this.currentState[inputName](this, data);
	}
};

proto.gotoPreviousState = function (data) {
	this.changeState(this.previousState, data);
};

proto.changeState = function (newState, data) {
	this.previousState = this.currentState;
	this.currentState = newState;

	var promises = [
		this.previousState.onExit(this, data),
		this.currentState.onEnter(this, data)
	];

	return Promise.all(promises);

};



module.exports = StateMachine;

},{"ac-event-emitter":572,"ac-object":790}],659:[function(require,module,exports){
/**
 * @module ac-state-machine
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

module.exports = {
	StateMachine: require('./StateMachine'),
	State:require('./State')
};

},{"./State":657,"./StateMachine":658}],660:[function(require,module,exports){
'use strict';

var Gallery = require('./ac-gallery/Gallery');
var SlideGallery = require('./ac-gallery/SlideGallery');
var FadeGallery = require('./ac-gallery/FadeGallery');

module.exports = {
	Gallery:Gallery,
	SlideGallery:SlideGallery,
	FadeGallery:FadeGallery
};

},{"./ac-gallery/FadeGallery":661,"./ac-gallery/Gallery":662,"./ac-gallery/SlideGallery":663}],661:[function(require,module,exports){
'use strict';

var Gallery = require('./Gallery');
var Clip = require('ac-eclipse').Clip;
var setStyle = require('ac-dom-styles/setStyle');

var FadeGallery = Gallery.extend({

	initialize: function () {
		this._boundCreateClip = this._createClip.bind(this);
		this.canSpring = false;
	},

	_createClip: function (incomingElement, outgoingElement, duration, easing, resolve) {
		var clip = new Clip(incomingElement, duration, {
			opacity:1
		}, {
			onStart:function () {
				setStyle(outgoingElement, {
					zIndex:1
				});

				setStyle(incomingElement, {
					zIndex:2
				});
			},
			onComplete: function () {
				setStyle(outgoingElement, {
					opacity:0
				});

				window.requestAnimationFrame(resolve);
			},
			ease:easing
		});

		return clip;
	},

	drawInitial: function (initial) {
		var initialElement = initial.get('element');

		setStyle(initialElement, {
			zIndex:2,
			opacity:1
		});

		this.model.forEach(function (model) {
			if (model !== initial) {
				setStyle(model.get('element'), {
					zIndex:1,
					opacity:0
				});
			}

		}, this);

	},

	draw: function (incoming, outgoing, options) {
		var incomingElement = incoming.get('element');
		var outgoingElement = outgoing.get('element');
		var easing = options.easing || this.getEasing();
		var duration = options.duration || this.getDuration();

		return new Promise(function (resolve, reject) {
			var clip = this._createClip(incomingElement, outgoingElement, duration, easing, resolve);
			clip.play();

		}.bind(this));
	},

	destroy: function () {
		this._boundCreateClip = null;
	}

});


module.exports = FadeGallery;

},{"./Gallery":662,"ac-dom-styles/setStyle":172,"ac-eclipse":482}],662:[function(require,module,exports){
'use strict';

var defaults = require('ac-object/defaults');
var objectCreate = require('ac-object/create');
var objectExtend = require('ac-object/extend');

var GalleryCollection	 = require('./model/GalleryCollection');

var EventEmitter = require('ac-event-emitter').EventEmitter;
var Routes = require('ac-routes').Routes;


var StateMachine = require('ac-state-machine').StateMachine;
var stateFactory = require('./states/factory');

var ERR_MISSING_ID = 'Could not create gallery: "id" is missing';
var ERR_GALLERY_MISSING_EL = 'Could not create gallery: "el" was not specified';


var defaultOptions = {
	duration: 0.4,
	easing: 'linear',
	endless: false,
	initial: 0
};



/**
 * @name Gallery
 * @class
 *
 *     var Gallery = require('ac-gallery').Gallery;
 *
 * @param {Array} keyframes
 *        Keyframes that the gallery will use to display its content.
 *
 * @param {Number} [options.duration=0.4]
 *        The {@link Segue#duration}, in seconds.
 *
 * @param {String} [options.easing=linear]
 *        The {@link Segue#easing} function as a string.
 *
 * @param {Boolean} [options.endless]
 *        If `true`, the Gallery can go “around the horn.” In other words, the previous Keyframe to the first Keyframe is the last Keyframe, and the next Keyframe to the last Keyframe is the first Keyframe.
 *        This does not imply that the next Keyframe is displayed to the right of the last Keyframe or the last Keyframe is to the left of the first Keyframe.
 *
 * @param {Boolean} [options.locks]
 *        If `true`, prevents the Gallery from showing a new Keyframe if the {@link Segue#isBusy}.
 *
 * @throws {TypeError}
 *        If keyframes argument is not a valid keyframes array
 *
 */

function Gallery (options) {
	this.options = defaults(defaultOptions, options || {});

	this.id = this.options.id;
	if (!this.id) {
		throw new Error(ERR_MISSING_ID);
	}

	this.model = this.options.model || new GalleryCollection();
	this.model.setSelected(this.options.initial);

	this.stateMachine = new StateMachine({
		currentState:stateFactory.create('initialize', this)
	});

	this.routes = options.routes || new Routes();
	this.routes.add(this.routes.createRoute(this.id + '/show/:id', this.show, this));
	this.routes.add(this.routes.createRoute(this.id + '/previous', this.showPrevious, this));
	this.routes.add(this.routes.createRoute(this.id + '/next', this.showNext, this));


	this.el = this.options.el;

	if (!this.el) {
		throw new Error(ERR_GALLERY_MISSING_EL);
	}

	this.easing = this.options.easing || this.easing;
	this.duration = this.options.duration || this.duration;

	this.initialize(options);

	this.show(this.model.getSelected());

}

var proto = Gallery.prototype = objectCreate(EventEmitter.prototype);


proto.sendGalleryEvent = function (galleryEvent) {
	this.trigger(galleryEvent.type, galleryEvent.data);
};

proto.easing = 'linear';
proto.duration = 0.4;

proto.getSlideAt = function (index) {
	return this.model.at(index);
};


proto.setDuration = function (duration) {
	this.duration = duration;
};

proto.getDuration = function () {
	return this.duration;
};

proto.setEasing = function (easing) {
	this.easing = easing;
};

proto.getEasing = function () {
	return this.easing;
};

/* Stubbed methods to overwrite in subclasses */
proto.cancelDraw = function () {};
proto.initialize = function () {};
proto.drawInitial = function () {};
proto.beforeDraw = function () {};
proto.draw = function () {};
proto.afterDraw = function () {};
proto.destroy = function () {};
proto.drawBounceInProgress = function () {};
proto.drawBounceOutProgress = function () {};
proto.drawProgress = function () {};
proto.drawSnap = function () {};
proto.drawResize = function () {};
proto.removeStyles = function () {};
proto.resize = function () {};

proto.setProgress = function (progress) {
	this.stateMachine.handleInput('seek', {
		progress:progress
	});
};

proto.snap = function (index) {
	this.stateMachine.handleInput('pointerUp', {
		progress:index
	});
};


/**
 * @name Gallery#getSelected
 *
 * @function
 *
 * @desc Alias of {@link Gallery#getSelectedKeyframe}.
 */
proto.getSelected = function () {
	return this.model.getSelected();
};

proto.getItems = function () {
	return this.model.models;
};

proto.setEngaged = function (engaged) {
	this.stateMachine.handleInput('engagementChange', {
		engaged:engaged
	});
};

proto.slideAt = function () {
	var model = this.model.at.apply(this.model, arguments);

	if (!model) {
		return null;
	}

	return model;
};

proto.getPreviousState = function () {
	return this.stateMachine.previousState;
};

proto.getCurrentState = function () {
	return this.stateMachine.currentState;
};

/**
 * @name Gallery#isEndless
 *
 * @function
 *
 * @desc Wrapper for Querying options.endless
 *
 * @returns {Boolean} The default is false
 *
 */
proto.isEndless = function () {
	return this.model.isEndless();
};

/**
 * @name Gallery#indexOf
 *
 * @function
 *
 * @desc Retrieve the Gallery’s currently selected Keyframe's index.
 *
 * @returns {Integer} Currently selected Keyframe index.
 */
proto.indexOf = function (model) {
	return this.model.indexOf(model);
};


/**
 * @name Gallery#count
 *
 * @function
 *
 * @desc Returns number of items in the gallery.
 *
 * @returns {Integer} number of items in the gallery.
 *
 */
proto.count = function () {
	return this.model.count();
};



/**
 * @name Gallery#getNext
 *
 * @function
 *
 * @desc Retrieve the Gallery’s item that is after the currently
 *       selected item.
 *
 * If the Gallery can go “around the horn” with `options.endless = true`,
 * then there will always be a next item. If the currently selected
 * item is the last in the array, then the first
 * item in the array will be returned.
 *
 * @returns {Model} Gallery’s next item.
 */
proto.getNext = function () {
	return this.model.getNext();
};


/**
 * @name Gallery#getPrevious
 *
 * @function
 *
 * @desc Retrieve the Gallery’s item that is before the currently
 *       selected item.
 *
 * If the Gallery can go “around the horn” with `options.endless = true`,
 * then there will always be a previous item. If the currently
 * selected item is the first in the array, then the
 * last item in the array will be returned.
 *
 * @returns {item} Gallery’s previous item.
 */
proto.getPrevious = function () {
	return this.model.getPrevious();
};


/**
 * @name Gallery#getSelectedIndex
 *
 * @function
 *
 * @desc Retrieve the index of the Gallery’s currently selected item.
 *
 * @returns {Integer} Currently selected item's index.
 */
proto.getSelectedIndex = function () {
	return this.model.indexOfSelected();
};


/**
 * @name Gallery#showNext
 *
 * @function
 *
 * @desc Show the Gallery’s next Keyframe in order of the
 *       array. If the Gallery can go “around the horn”
 *       first keyframe will be shown if {@link Gallery#getSelected}
 *       returns last Keyframe instance in array.
 *
 * @param {Object} [options]
 *        Options for {@link Gallery#show}.
 *
 * @returns {Promise} Promise that resolved after the next Keyframe
 *          is shown.
 */
proto.showNext = function (options) {
	var next = this.model.getNext();

	return this.show(next, options);
};


/**
 * @name Gallery#showPrevious
 *
 * @function
 *
 * @desc Show the Gallery’s previous Keyframe in order of the
 *       array. If the Gallery can go “around the horn”
 *       last keyframe will be shown if {@link Gallery#getSelected}
 *       returns first Keyframe instance in collection.
 *
 * @param {Object} [options]
 *        Options for {@link Gallery#show}.
 *
 * @returns {Promise} Promise that resolved after the previous Keyframe
 *          is shown.
 */
proto.showPrevious = function (options) {
	var previous = this.model.getPrevious();

	return this.show(previous, options);
};


proto.getLastIndex = function () {
	return this.model.count() - 1;
};

proto.getLast = function () {
	return this.model.getLast();
};


/**
 * @name Gallery#getFirst
 *
 * @function
 *
 * @desc Get the first keyframe in the gallery.
 *
 * @returns {Keyframe} First keyframe in the gallery.
 *
 */
proto.getFirst = function () {
	return this.model.at(0);
};

/**
 * @name Gallery#show
 *
 * @function
 * @fires Gallery#willShow
 * @fires Gallery#didShow
 *
 * @desc Shows a Keyframe.
 *
 * @param {Keyframe|String|Number} query
 *        The Keyframe to show. If argument is a string, will lookup Keyframe
 *        based on id. If argument is a number, will lookup Keyframe
 *        via index.
 *
 * @param {Object} [options]
 *        Options for the {@link Gallery#_trigger} event method, and the
 *        {@link Segue#segue} method.
 *
 * @param {Boolean} [options.silent]
 *        If `true`, the event won’t be fired.
 *
 * @throws {TypeError} Could not show Keyframe with supplied query. Query does not exist
 *         in Keyframes array.
 */
proto.show = function (indexOrID, options) {
	this.stateMachine.handleInput('onDraw', {
		query:indexOrID,
		options:options
	});
};

proto.clear = function () {
	this.stateMachine.handleInput('onClear');
};

proto.dealloc = function () {
	this.stateMachine.handleInput('onDealloc');
};

Gallery.create = require('./factory/create');


Gallery.extend = function (proto) {
	var parent = this;

	var Child = function () {
		parent.apply(this, arguments);
	};

	var childProto = objectCreate(this.prototype);

	Child.prototype = objectExtend(childProto, proto);

	objectExtend(Child, this);

	return Child;
};


module.exports = Gallery;



},{"./factory/create":665,"./model/GalleryCollection":671,"./states/factory":681,"ac-event-emitter":572,"ac-object/create":786,"ac-object/defaults":787,"ac-object/extend":788,"ac-routes":654,"ac-state-machine":659}],663:[function(require,module,exports){
'use strict';

var Gallery = require('./Gallery');
var Clip = require('ac-eclipse').Clip;
var setStyle = require('ac-dom-styles/setStyle');
var getDimensions = require('ac-dom-metrics/getDimensions');
var acdom_addEventListener = require('ac-dom-events/addEventListener');
var acdom_removeEventListener = require('ac-dom-events/removeEventListener');
var slideGalleryFeatureDetect = require('./SlideGallery/feature-detect');
var SlideGalleryTransformData = require('./model/SlideGalleryTransformData');

var ERR_NO_SLIDE_EL_SPECIFIED = 'Could not create SlideGallery: no `slideEl` option was specified';

var SlideGallery = Gallery.extend({

	_bounceInClip:null,
	_bounceOutClip:null,

	_getBounceInClip: function () {
		if (this._bounceInClip !== null) {
			return this._bounceInClip;
		}

		var to = this._getTransformStyles(this.getFirst(), this.getFirst(), {
			addDistance:getDimensions(this.options.el).width
		});

		var from = this._getTransformStyles(this.getFirst(), this.getLast());


		this._bounceInClip = new Clip(this.options.slideEl, this.getDuration() * this.count(), to, {
			ease:'linear',
			propsFrom:from
		});

		return this._bounceInClip;
	},

	_getBounceOutClip: function () {
		if (this._bounceOutClip !== null) {
			return this._bounceOutClip;
		}

		var to = this._getTransformStyles(this.getLast(), this.getFirst(), {
			addDistance:-getDimensions(this.options.el).width
		});

		var from = this._getTransformStyles(this.getLast(), this.getFirst());

		this._bounceOutClip = new Clip(this.options.slideEl, this.getDuration(), to, {

			ease:'linear',
			propsFrom:from
		});

		return this._bounceOutClip;
	},

	_renderProgress: function (clip, progress) {
		clip.setProgress(progress);
	},

	_clip:null,

	_toClip: function () {
		if (this._clip) {
			return this._clip;
		}

		var to = this._getTransformStyles(this.getLast(), this.getFirst());
		var from = this._getTransformStyles(this.getFirst(), this.getLast());

		this._clip = new Clip(this.options.slideEl, this.getDuration(), to, {
			ease:'linear',
			propsFrom: from
		});

		return this._clip;
	},

	initialize: function (options) {
		if (!options.slideEl) {
			throw new Error(ERR_NO_SLIDE_EL_SPECIFIED);
		}
	},

	drawBounceOutProgress: function (progress) {
		var clip = this._getBounceOutClip();
		this._renderProgress(clip, progress);
	},

	drawBounceInProgress: function (progress) {
		var clip = this._getBounceInClip();
		this._renderProgress(clip, progress);
	},

	drawProgress:function (progress) {
		var clip = this._toClip();
		return this._renderProgress(clip, progress);
	},

	drawInitial: function (initial) {
		this.drawSnap(initial);
	},

	drawSnap: function (incoming, outgoing, options) {
		var timeline = this._toClip();
		var incomingIndex = this.indexOf(incoming);
		var progress = incomingIndex / (this.count() - 1);
		timeline.setProgress(progress);
	},

	removeStyles: function () {
		setStyle(this.options.slideEl, {
			transition:null,
			transform:null
		});
	},

	drawResize: function (incoming, outgoing, options) {
		this._clip = null;
		this.drawSnap(incoming, outgoing, options);
	},

	_getTransitionProp: function () {
		if (slideGalleryFeatureDetect.canUseTransform()) {
			return 'transform';
		}

		return 'left';
	},

	// This is here because ac-dom-events doesn't correctly
	// add webkitTransitionEnd in phantomjs
	_transitionEndString: 'transitionend',

	_drawCSSTransition: function (styles, easing, duration) {
		var transitionProp = this._getTransitionProp();

		return new Promise(function (resolve, reject) {
			var onTransitionEnd = function (evt) {
				if (evt.target === this.options.slideEl) {
					setStyle(this.options.slideEl, {
						transition:null
					});

					acdom_removeEventListener(this.options.slideEl, this._transitionEndString, onTransitionEnd);

					resolve();
				}

			}.bind(this);

			acdom_addEventListener(this.options.slideEl, this._transitionEndString, onTransitionEnd);

			styles.transition = transitionProp + ' ' + duration + 's ' + easing;

			setStyle(this.options.slideEl, styles);

		}.bind(this));
	},

	_drawRAFTransition: function (styles, easing, duration) {
		return new Promise(function (resolve, reject) {
			var clip = new Clip(this.options.slideEl, duration, styles, {
				easing:easing,
				onComplete:resolve,
				inlineStyles:true
			});
			clip.play();

		}.bind(this));
	},

	_getTransformStyles: function (incoming, outgoing, options) {
		var transformModel = new SlideGalleryTransformData(this, incoming, outgoing, options);
		transformModel.calculate();
		transformModel.setStyles(this.didCalculateStyles(transformModel.styles, incoming, outgoing));

		return transformModel.renderStylesObject();

	},

	didCalculateStyles: function (styles, incoming, outgoing) {
		return styles;
	},

	draw: function (incoming, outgoing, options) {
		var duration = options.duration || this.getDuration();
		var easing = options.easing || this.getEasing();
		var styles = this._getTransformStyles(incoming, outgoing);

		if (slideGalleryFeatureDetect.canUseCSSTransitions()) {
			return this._drawCSSTransition(styles, easing, duration);
		} else {
			return this._drawRAFTransition(styles, easing, duration);
		}

	},

	destroy: function () {
		this.removeStyles();
	}

});


module.exports = SlideGallery;

},{"./Gallery":662,"./SlideGallery/feature-detect":664,"./model/SlideGalleryTransformData":673,"ac-dom-events/addEventListener":63,"ac-dom-events/removeEventListener":71,"ac-dom-metrics/getDimensions":80,"ac-dom-styles/setStyle":172,"ac-eclipse":482}],664:[function(require,module,exports){
'use strict';

var cssPropertyAvailable = require('ac-feature/cssPropertyAvailable');

module.exports = {

	canUseCSSTransitions: function () {
		return cssPropertyAvailable('transition');
	},

	canUseTransform: function () {
		return cssPropertyAvailable('transform');
	}

};

},{"ac-feature/cssPropertyAvailable":578}],665:[function(require,module,exports){
'use strict';

/**
 * Builds a gallery using options specified on instantiation.
 * @name builder
 * @module
 */

// dependencies
var GalleryCollection	 = require('./../model/GalleryCollection');
var defaults      		 = require('ac-object/defaults');
var isElement	     	 = require('ac-dom-nodes/isElement');

// Inputs
var pointerInput	 	 = require('./../inputs/pointer');
var triggerInput	 	 = require('./../inputs/Trigger');
var keyboardInput	 	 = require('./../inputs/Keyboard');
var engagementInput		 = require('./../inputs/Engagement');
var resizeInput		 	 = require('./../inputs/resize');


// Observer
var analyticsObserver	 = require('./../observer/analytics');
var triggerObserver 	 = require('./../observer/trigger');

// constants & configurables
var ERR_TRIGGER_SELECTOR_NOT_STRING = 'Could not create gallery: triggerSelector should be a string';
var ERR_MISSING_MODEL = 'Could not create gallery: no "model" was specified';

var defaultOptions = {
	keyboard: true,
	trigger:{
		events:['click']
	}
};

function createCollection(models, options) {
	options = options || {};
	options.models = models.map(function (model) {
		if (isElement(model)) { // Were we passed an element?
			return {
				id:model.id,
				element:model
			};  // coerce to a Model
		}

		return model;
	});

	return new GalleryCollection(options);
}

/**
 * @method
 *
 * @param {Object} [options]
 *        Gallery builder instantiation options.
 *
 * @param {Keyframe} [options.keyframes]
 *        Keyframes that the gallery will use to display its content. Should not be combined with options.keyframeElements.
 *
 * @param {(NodeList|Array)} [options.keyframeElements]
 *        List of elements to generate {@link Keyframe}s from. Specified in the form of a NodeList Object, or an Array. If passed as a NodeList, it will be converted to Array. Should not be combined with options.keyframes.
 *
 * @param {Boolean} [options.touch=false]
 *        Enable touch events for this gallery. If `true`, options.touchElement is required.
 *
 * @param {Element} [options.touchElement]
 *        Element to listen for touches on. Required if options.touch is `true`.
 *
 * @param {String} [options.triggerSelector]
 *        The css selector that matches all triggers for this gallery. If omitted, there will be no clickable trigger links for this gallery.
 *
 * @param {String} [options.keyboard=new ac-keyboard/Keyboard]
 *        The ac-keyboard/Keyboard instance to control this gallery. If omitted, a new Keyboard instance is created.
 *
 * @param {Object} [options.keyboardMap=defaultKeyboardMap]
 *        The keyboardMap to use for this gallery. By default, it’s the {@link defaultKeyboardMap}.
 *
 * @param {Object} [options.engagementElement]
 *        The element for which to determine user engagment for the gallery. If the user is not engaged with the gallery, the gallery will be locked.
 *
 * @param {Object} [options.analytics]
 *        Gallery options for analytics, sent as an object to all gallery tracking requests.
 *
 * @returns {Gallery} gallery
 *
 * @throws {TypeError}
 *        TODO, write up this
 *
 */
module.exports = function galleryCreate (options) {
	options = options || {};
	options = defaults(defaultOptions, options);

	if (!options.model) {
		throw new Error(ERR_MISSING_MODEL);
	}

	options.model = createCollection(options.model, {
		endless:options.endless
	});

	// create gallery
	var gallery = new this(options);

	var inputs = {};
	var observers = {};
	inputs.resize = resizeInput(gallery, options.resize);


	if (options.pointer) {
		var pointerOptions = options.pointer;
		pointerOptions.element = pointerOptions.el || gallery.el;

		inputs.pointer = pointerInput(gallery, pointerOptions);
	}

	// triggers
	if (options.triggerSelector) {
		if (typeof options.triggerSelector !== 'string') {
			throw new Error(ERR_TRIGGER_SELECTOR_NOT_STRING);
		} else {
			inputs.trigger = triggerInput(gallery, {
				selector:options.triggerSelector,
				events:options.trigger.events
			});

			observers.trigger = triggerObserver(gallery, {
				selector:options.triggerSelector
			});
		}
	}

	if (options.keyboard === true) {
		gallery.keyboard = keyboardInput(gallery);
	}

	var engagementElement = options.engagementElement || gallery.el;
	inputs.engagement = engagementInput(gallery, {
		el:engagementElement
	});


	var galleryName = gallery.id;

	if (gallery.el && gallery.el.getAttribute('data-analytics-id')) {
		galleryName = gallery.el.getAttribute('data-analytics-id');
	}


	var analyticsOptions = {
		galleryName:galleryName
	};

	analyticsObserver(gallery, analyticsOptions);
	gallery.inputs = inputs;
	gallery.observers = observers;


	return gallery;
};

},{"./../inputs/Engagement":666,"./../inputs/Keyboard":667,"./../inputs/Trigger":668,"./../inputs/pointer":669,"./../inputs/resize":670,"./../model/GalleryCollection":671,"./../observer/analytics":675,"./../observer/trigger":676,"ac-dom-nodes/isElement":443,"ac-object/defaults":787}],666:[function(require,module,exports){
'use strict';

var ElementTracker = require('ac-element-tracker').ElementTracker;
var objectCreate = require('ac-object/create');

var engagementObj = {

	handleEngagementChange: function (engaged) {
		this.stateMachine.handleInput('engagementChange', {
			engaged:engaged
		});
	},

	isNotEngaged: function () {
		this.handleEngagementChange(false);
	},

	isEngaged: function () {
		this.handleEngagementChange(true);
	},

	onEnterView: function () {
		this.isEngaged();
	},

	onExitView: function () {
		this.isNotEngaged();
	}
};


module.exports = function engagementInput (gallery, options) {
	options = options || {};
	var tracker = new ElementTracker();
	var trackedElement = tracker.addElement(options.el);

	var engagement = objectCreate(engagementObj);
	engagement.stateMachine = gallery.stateMachine;

	tracker.refreshElementState(trackedElement);

	if (trackedElement.inView) {
		engagement.onEnterView();
	} else {
		engagement.onExitView();
	}

	trackedElement.on('enterview', engagement.onEnterView, engagement);
	trackedElement.on('exitview', engagement.onExitView, engagement);

	tracker.start();

	gallery.once('destroy', function () {
		trackedElement.off('enterview', engagement.onEnterView, engagement);
		trackedElement.off('exitview', engagement.onExitView, engagement);
		tracker = null;
		trackedElement = null;
	});



	return engagement;
};

},{"ac-element-tracker":569,"ac-object/create":786}],667:[function(require,module,exports){
'use strict';

var acdom_addEventListener = require('ac-dom-events/addEventListener');
var acdom_removeEventListener = require('ac-dom-events/removeEventListener');
var objectCreate = require('ac-object/create');

var keyboardObj = {

	keyDown:function (evt) {
		this.stateMachine.handleInput('keydown', {
			interactionEvent:evt
		});
	}

};

module.exports = function keyboardInput (gallery, options) {
	options = options || {};

	var keyboard = objectCreate(keyboardObj);
	keyboard.stateMachine = gallery.stateMachine;

	// Declared this way so jasmine can spyon keyDown
	// keyDown.bind will not work because it gets bound
	// before the test has a chance to intercept
	var keyDown = function (e) {
		keyboard.keyDown(e);
	};


	acdom_addEventListener(document, 'keydown', keyDown);
	gallery.once('destroy', function () {
		acdom_removeEventListener(document, 'keydown', keyDown);
		keyDown = null;
	});

	return keyboard;

};

},{"ac-dom-events/addEventListener":63,"ac-dom-events/removeEventListener":71,"ac-object/create":786}],668:[function(require,module,exports){
'use strict';

var acdom_addEventListener = require('ac-dom-events/addEventListener');
var acdom_removeEventListener = require('ac-dom-events/removeEventListener');
var ac_dom_events = require('ac-dom-events');
var objectCreate = require('ac-object/create');
var matchesSelector = require('ac-dom-traversal/matchesSelector');
var ancestor = require('ac-dom-traversal/ancestor');

var triggerObj = {

	triggerInteraction: function (evt) {
		var evtTarget = ac_dom_events.target(evt);
		var target = null;


		if (matchesSelector(evtTarget, this.selector)) {
			target = evtTarget;
		} else if (matchesSelector(evtTarget, this.selector + ' *')) {
			target = ancestor(evtTarget, this.selector);
		}

		if(target) {
			ac_dom_events.preventDefault(evt);

			this.stateMachine.handleInput('trigger', {
				interactionEvent:evt,
				target:target
			});
		}
	}

};

module.exports = function triggerInput (gallery, options) {
	var trigger = objectCreate(triggerObj);
	trigger.selector = options.selector;
	trigger.stateMachine = gallery.stateMachine;

	var onTrigger = function (e) {
		trigger.triggerInteraction(e);
	};

	options.events.forEach(function (eventName) {
		acdom_addEventListener(document, eventName, onTrigger);
	});

	gallery.once('destroy', function () {
		options.events.forEach(function (eventName) {
			acdom_removeEventListener(document, eventName, onTrigger);
		});

		trigger = null;
	});


	return trigger;

};

},{"ac-dom-events":65,"ac-dom-events/addEventListener":63,"ac-dom-events/removeEventListener":71,"ac-dom-traversal/ancestor":449,"ac-dom-traversal/matchesSelector":452,"ac-object/create":786}],669:[function(require,module,exports){
'use strict';

var PointerMoveGesture = require('ac-gesture/PointerMove');
var objectCreate = require('ac-object/create');

var pointerInputObj = {

	onPointerMove: function (evt) {
		this.stateMachine.handleInput('pointerMove', {
			interactionEvent:evt
		});
	},

	onPointerDown: function (evt) {
		var stateData = {
			interactionEvent:evt,
			element:this.gesture.element
		};

		this.stateMachine.handleInput('pointerDown', stateData);
	},

	onPointerUp: function (evt) {
		this.stateMachine.handleInput('pointerUp', {
			interactionEvent:evt
		});
	}
};

var directionDecorator = {
	interactions:[],
	handledDown: false,
	isMovingHorizontal: function () {
		if (this.interactions.length < 4) {
			return null;
		}

		var first = this.interactions[0];
		var last = this.interactions[this.interactions.length - 1];

		var delta_x = last.pageX - first.pageX;
		var delta_y = last.pageY - first.pageY;
		var theta_radians = Math.atan2(delta_y, delta_x);
		var degrees = theta_radians * (180/Math.PI);
		var threshold = 75;
		var isHorizontal = Math.abs(degrees) < threshold || Math.abs(degrees) > (180 - threshold);

		return isHorizontal;
	},

	onPointerMove: function (evt) {

		if (this.interactions.length < 4) {
			this.interactions.push(evt);
			return;
		}

		if (this.isMovingHorizontal()) {
			if (!this.handledDown) {
				this.handledDown = true;
				this.parent.onPointerDown(this.interactions[0]);
			}

			this.parent.onPointerMove(evt);
		}
	},

	onPointerDown: function (evt) {
		this.interactions.push(evt);
	},

	onPointerUp: function (evt) {
		if (this.handledDown === true) {
			this.parent.onPointerUp(evt);
		}

		this.interactions = [];
		this.handledDown = false;
	}
};


module.exports = function pointerInput (gallery, options) {
	options = options || {};

	var gesture = PointerMoveGesture.create(options.element, options);
	var pointer = objectCreate(pointerInputObj);
	pointer.stateMachine = gallery.stateMachine;
	pointer.gesture = gesture;
	var directionLock = objectCreate(directionDecorator);
	directionLock.parent = pointer;


	gesture.on('start', function (e) {
		directionLock.onPointerDown(e);
	});

	gesture.on('move', function (e) {
		directionLock.onPointerMove(e);
	});

	gesture.on('end', function (e) {
		directionLock.onPointerUp(e);
	});

	gesture.on('cancel', function (e) {
		directionLock.onPointerUp(e);
	});

	gesture.activate();

	gallery.once('destroy', function () {
		gesture.off();
		gesture._removeAllListeners();
		gesture.destroy();
		gesture = null;
	});

	return directionLock;
};

},{"ac-gesture/PointerMove":610,"ac-object/create":786}],670:[function(require,module,exports){
'use strict';

var debounce = require('ac-function/debounce');
var acdom_addEventListener = require('ac-dom-events/addEventListener');
var acdom_removeEventListener = require('ac-dom-events/removeEventListener');
var objectCreate = require('ac-object/create');

var resizeObj = {
	resize:function (evt) {
		this.stateMachine.handleInput('resize', evt);
	}
};

module.exports = function (gallery, options) {
	options = options || {};

	if (typeof options.debounceTimeout === 'number') {
		options.debounceTimeout = options.debounceTimeout;
	} else {
		options.debounceTimeout = 300;
	}

	var resizeInput = objectCreate(resizeObj);
	resizeInput.stateMachine = gallery.stateMachine;


	var resizeHandler = debounce(function (evt) {
		resizeInput.resize(evt);
	}, options.debounceTimeout);

	acdom_addEventListener(window, 'resize', resizeHandler);
	function onGalleryDestroy () {
		acdom_removeEventListener(window, 'resize', resizeHandler);
		resizeHandler = null;
	}

	gallery.once('destroy', onGalleryDestroy);

	return resizeInput;
};

},{"ac-dom-events/addEventListener":63,"ac-dom-events/removeEventListener":71,"ac-function/debounce":606,"ac-object/create":786}],671:[function(require,module,exports){
'use strict';

var Collection = require('ac-mvc-collection').Collection;
var Model = require('ac-mvc-model').Model;
var objectCreate = require('ac-object/create');

function GalleryCollection () {
	Collection.apply(this, arguments);
	this._selected = null;
}


var proto = GalleryCollection.prototype = objectCreate(Collection.prototype);

proto.ModelType = Model;

proto.query = function (query) {
	var match;

	if (typeof query === 'number') {
		match = this.at(query);
	} else if (typeof query === 'string') {
		match = this.get(query);
	} else if (this.indexOf(query) !== -1) {
		match = query;
	}

	return match;
};

proto.isEndless = function () {
	return !!this.options.endless;
};

proto.getPrevious = function () {
	var lookupIndex = this.indexOf(this._selected) - 1;
	var previous;

	if (this.isEndless() === true && lookupIndex < 0) {
		lookupIndex = this.models.length - 1;
	}

	previous = this.models[lookupIndex];

	if (previous === undefined) {
		previous = null;
	}

	return previous;
};

proto.getNext = function () {
	var lookupIndex = this.indexOf(this._selected) + 1;
	var next;

	if (this.isEndless() === true && lookupIndex === this.models.length) {
		lookupIndex = 0;
	}

	next = this.at(lookupIndex);
	if (next === undefined) {
		next = null;
	}

	return next;

};

proto.getFirst = function () {
	return this.at(0);
};

proto.getLast = function () {
	return this.at(this.models.length - 1);
};

proto.count = function () {
	return this.models.length;
};

proto.setSelected = function (query) {
	this._selected = this.query(query);
};

proto.getSelected = function () {
	return this._selected;
};

proto.indexOfSelected = function () {
	return this.indexOf(this._selected);
};


module.exports = GalleryCollection;

},{"ac-mvc-collection":634,"ac-mvc-model":651,"ac-object/create":786}],672:[function(require,module,exports){
'use strict';


var INVALID_EVENT_DATA_ERR = 'Could not trigger event: Event data is invalid';

function GalleryEvent(type, data) {
	data = data || {};
	this.data = data || {};
	this.type = type;
}

function validateEventData (data) {
	if (!data || !data.incoming || !data.outgoing) {
		throw new TypeError(INVALID_EVENT_DATA_ERR);
	}
}

GalleryEvent.create = function (type, data) {
	return new GalleryEvent(type, data);
};


GalleryEvent.createWillShowEvent = function (data) {
	validateEventData(data);

	return new GalleryEvent('willShow', data);
};

GalleryEvent.createDidShowEvent = function (data) {
	validateEventData(data);

	return new GalleryEvent('didShow', data);
};


module.exports = GalleryEvent;

},{}],673:[function(require,module,exports){
'use strict';

var slideGalleryFeatureDetect = require('./../SlideGallery/feature-detect');
var getDimensions = require('ac-dom-metrics/getDimensions');


function SlideGalleryTransformData (gallery, incoming, outgoing, options) {
	this.gallery = gallery;
	this.incoming = incoming;
	this.outgoing = outgoing;
	this.options = options || {};
	this.styles = {};
}


var proto = SlideGalleryTransformData.prototype;

proto._getTranslateXDistance = function (slide) {
	var incomingIndex = this.gallery.indexOf(slide);
	var distance = 0;

	for(var i = 0; i < incomingIndex; i += 1) {
		distance += getDimensions(this.gallery.slideAt(i).get('element')).width;
	}

	return -distance;
};

proto._convertTranslateXToLeftIfNoTransformSupport = function () {
	if (!slideGalleryFeatureDetect.canUseTransform()) {
		this.styles.left = this.styles.transform.translateX;
		this.styles.transform = undefined;
	}
};

proto.calculate = function () {
	var distance = this._getTranslateXDistance(this.incoming);
	this.styles = this._buildTransformObject(distance);
};

proto.setStyles = function (styles) {
	this.styles = styles;
};

proto._buildTransformObject = function (value) {
	return {
		transform: {
			translateX:value,
			translateZ:0
		}
	};

};

proto._addUnits = function () {
	if (!/px/.test(this.styles.transform.translateX)) {
		this.styles.transform.translateX += 'px';
	}
};

proto.renderStylesObject = function () {
	if (typeof this.options.addDistance === 'number') {
		this.styles.transform.translateX = parseInt(this.styles.transform.translateX) + this.options.addDistance;
	}

	if (this.options.invert === true) {
		this.styles.transform.translateX = -(parseInt(this.styles.transform.translateX));
	}

	this._addUnits();
	this._convertTranslateXToLeftIfNoTransformSupport();


	return this.styles;

};


module.exports = SlideGalleryTransformData;

},{"./../SlideGallery/feature-detect":664,"ac-dom-metrics/getDimensions":80}],674:[function(require,module,exports){
'use strict';

function UserDrag (options) {
	this.options = options || {};

	this._interactions = [];
	this._particle = this.options.particle;
	this.pixelDistance = this.options.pixelDistance;
	this.distance = this.options.distance;
}

var proto = UserDrag.prototype;


proto.destroy = function () {
	this._particle = null;
};


proto._updateFromInteraction = function () {

	if (this._interactions.length < 2) {
		return;
	}

	var first = this._interactions[0];
	var last = this._interactions[1];

	var distance = -(last.pageX - first.pageX);
	var totalDistance = this.pixelDistance;

	var stopDiff = this.distance;
	var percentTravelled = distance / totalDistance;
	var progressPercent = (stopDiff * percentTravelled);


	this._particle.velocity = {
		x:progressPercent,
		y:progressPercent
	};

	this._particle.position.x += this._particle.velocity.x;
	this._particle.position.y += this._particle.velocity.y;


	this._removeInteraction();
};

proto._onUpdate = function (e) {
	this._updateFromInteraction();
};


proto._removeInteraction = function () {
	this._interactions.shift();
};

proto.addInteraction = function (e) {
	if (this._interactions.length === 2) {
		this._removeInteraction();
	}

	this._interactions.push(e);
	this._onUpdate();
};


proto.onPointerDown = function (e) {
	this.addInteraction(e);
};

proto.onPointerMove = function (e) {
	e.preventDefault();
	this.addInteraction(e);
};

proto.onPointerUp = function (e) {
	this._interactions = [];
};

proto.isMovingHorizontally = function () {
	if (this._interactions.length < 4) {
		return null;
	}

	var first = this._interactions[0];
	var last = this._interactions[this._interactions.length - 1];

	var delta_x = last.x - first.x;
	var delta_y = last.y - first.y;
	var theta_radians = Math.atan2(delta_y, delta_x);
	var degrees = theta_radians * (180/Math.PI);
	console.log(degrees);
	return (degrees < 15);
};

module.exports = UserDrag;

},{}],675:[function(require,module,exports){
'use strict';

var GalleryAnalytics;
try { GalleryAnalytics = require('ac-analytics').observer.Gallery; } catch (e) {}

module.exports = function analyticsObserver (gallery, analyticsOptions) {
	if (!GalleryAnalytics) {
		return;
	}

	var analytics = new GalleryAnalytics(gallery, analyticsOptions);

	gallery.once('destroy', function () {
		if (analytics.gallery) {
			analytics.removeListener();
		}

		analytics = null;
	});

};

},{"ac-analytics":"ac-analytics"}],676:[function(require,module,exports){
'use strict';

var objectCreate 		= require('ac-object/create');
var querySelectorAll 	= require('ac-dom-traversal/querySelectorAll');
var addClassName		= require('ac-classlist/add');
var removeClassName 	= require('ac-classlist/remove');

var CURRENT_CLASS_NAME = 'current';
var DISABLED_PADDLE_NAV_NAME = 'disabled';


var triggerObserver = {

	paintPaddleNavs: function (incoming, outgoing) {
		if (this.gallery.isEndless()) {
			return;
		}

		if (incoming === this.gallery.getFirst()) {
			this.disablePreviousPaddles();
		} else if (outgoing && outgoing === this.gallery.getFirst()) {
			this.enablePreviousPaddles();
		}

		if (incoming === this.gallery.getLast()) {
			this.disableNextPaddles();
		} else if (outgoing && outgoing === this.gallery.getLast()) {
			this.enableNextPaddles();
		}
	},

	generateFullSelector: function (galId, incomingId) {
		return this.selector + '[href="#' + galId + '/show/' + incomingId + '"]';
	},

	addClassNameToElements: function(elements, className) {
		elements.forEach(function (element) {
			addClassName(element, className);
		});
	},

	removeClassNameFromElements : function (elements, className) {
		elements.forEach(function (element) {
			removeClassName(element, className);
		});
	},

	getElementsPointingToSlide: function(slide) {
		var selector = this.generateFullSelector(this.gallery.id, slide.id);
		return querySelectorAll(selector);
	},

	getNextPaddleNavs: function () {
		var selector = this.selector + '[href="#' + this.gallery.id + '/next"]';
		return querySelectorAll(selector);
	},

	getPreviousPaddleNavs: function () {
		var selector = this.selector + '[href="#' + this.gallery.id + '/previous"]';
		return querySelectorAll(selector);
	},


	disableNextPaddles: function () {
		var paddleNavs = this.getNextPaddleNavs();
		this.addClassNameToElements(paddleNavs, DISABLED_PADDLE_NAV_NAME);
	},

	enableNextPaddles: function () {
		var paddleNavs = this.getNextPaddleNavs();
		this.removeClassNameFromElements(paddleNavs, DISABLED_PADDLE_NAV_NAME);
	},

	disablePreviousPaddles: function () {
		var paddleNavs = this.getPreviousPaddleNavs();
		this.addClassNameToElements(paddleNavs, DISABLED_PADDLE_NAV_NAME);
	},

	enablePreviousPaddles: function () {
		var paddleNavs = this.getPreviousPaddleNavs();
		this.removeClassNameFromElements(paddleNavs, DISABLED_PADDLE_NAV_NAME);
	},

	onWillShow: function (evt) {
		var elements = this.getElementsPointingToSlide(evt.incoming);
		this.addClassNameToElements(elements, CURRENT_CLASS_NAME);

		var outgoingElements = this.getElementsPointingToSlide(evt.outgoing);
		this.removeClassNameFromElements(outgoingElements, CURRENT_CLASS_NAME);


		if (this.gallery.isEndless()) {
			return;
		}

		if (evt.incoming === this.gallery.getFirst()) {
			this.disablePreviousPaddles();
		} else if (evt.outgoing === this.gallery.getFirst()) {
			this.enablePreviousPaddles();
		}

		if (evt.incoming === this.gallery.getLast()) {
			this.disableNextPaddles();
		} else if (evt.outgoing === this.gallery.getLast()) {
			this.enableNextPaddles();
		}

		this.paintPaddleNavs(evt.incoming, evt.outgoing);
	},

	onReady: function () {
		var selected = this.gallery.getSelected();
		var otherElements = querySelectorAll(this.selector);

		this.removeClassNameFromElements(otherElements, CURRENT_CLASS_NAME);

		var elements = this.getElementsPointingToSlide(selected);

		this.addClassNameToElements(elements, CURRENT_CLASS_NAME);


		this.paintPaddleNavs(selected);
	}

};


module.exports = function (gallery, options) {
	options = options || {};

	var observer = objectCreate(triggerObserver);
	observer.selector = options.selector;
	observer.gallery = gallery;

	gallery.on('willShow', observer.onWillShow, observer);
	gallery.once('ready', observer.onReady, observer);


	return observer;

};

},{"ac-classlist/add":53,"ac-classlist/remove":61,"ac-dom-traversal/querySelectorAll":453,"ac-object/create":786}],677:[function(require,module,exports){
'use strict';

var State = require('ac-state-machine').State;
var objectCreate = require('ac-object/create');
var stateFactory = require('./factory');

var GalleryState = function (gallery, options) {
	State.apply(this, arguments);
	this.gallery = gallery;
	this.options = options || {};
};

var proto = GalleryState.prototype = objectCreate(State.prototype);

proto.onDealloc = function (fsm, data) {
	fsm.changeState(stateFactory.create('dealloc', this.gallery), data);
};


module.exports = GalleryState;

},{"./factory":681,"ac-object/create":786,"ac-state-machine":659}],678:[function(require,module,exports){
'use strict';

var GalleryState = require('./GalleryState');
var objectCreate = require('ac-object/create');


var DeallocState = function () {
	GalleryState.apply(this, arguments);
};

var proto = DeallocState.prototype = objectCreate(GalleryState.prototype);

proto.name = 'dealloc';


proto.onEnter = function (fsm, data) {
	this.gallery.destroy();
	this.gallery.trigger('destroy');
	this.gallery.off();
};


module.exports = DeallocState;

},{"./GalleryState":677,"ac-object/create":786}],679:[function(require,module,exports){
'use strict';

var GalleryState = require('./GalleryState');
var objectCreate = require('ac-object/create');
var UserDrag = require('./../model/UserDrag');
var stateFactory = require('./factory');

function DraggingState () {
	GalleryState.apply(this, arguments);

	this.index = (typeof this.options.startIndex === 'number') ? this.options.startIndex : this.gallery.getSelectedIndex();
	this.count = this.gallery.count();
	this.stops = this._generateStops();
	this.particle = this.options.particle || this._createParticle();
	this.distance = this.stops[1];
}

var proto = DraggingState.prototype = objectCreate(GalleryState.prototype);

proto.name = 'dragging';

proto._createParticle = function () {
	return {
		position: {
			x:this.stops[this.index],
			y:this.stops[this.index]
		},
		mass:0.5
	};
};


proto._generateStops = function () {
	var count = this.count - 1;
	var stops = [];
	var i = 0;

	while(i <= count) {
		stops.push(i / count);
		i += 1;
	}

	return stops;

};

proto.onEnter = function (fsm, data) {

	if (fsm.previousState.name !== 'seeking') {

		this.userDragModel = new UserDrag({
			pixelDistance:data.element.offsetWidth,
			startIndex:this.startIndex,
			count:this.count,
			particle:this.particle,
			distance:this.distance
		});

		this.userDragModel.onPointerDown(data.interactionEvent);

		fsm.changeState(stateFactory.create('seeking', this.gallery), {
			progress:this.particle.position.x
		});
	}
};

proto.onExit = function (fsm, data) {
	if (fsm.currentState.name !== 'seeking') {
		this.userDragModel.destroy();

		this.userDragModel = null;
		this.boundOnPointerComplete = null;
		this.gallery = null;
	}

};

proto.pointerMove = function (fsm, data) {
	this.userDragModel.onPointerMove(data.interactionEvent);
	var position = this.particle.position;

	fsm.changeState(stateFactory.create('seeking', this.gallery), {
		progress:position.x
	});
};

proto.getNextPosition = function () {
	var currentPos = this.index;

	if (this.particle.velocity.x > 0) {
		currentPos += 1;
		if (currentPos >= this.stops.length) {
			currentPos = this.stops.length - 1;
		}

	} else {
		currentPos -= 1;

		if (currentPos < 0) {
			currentPos = 0;
		}
	}

	return this.stops[currentPos];
};

proto.getNextIndex = function () {
	return this.stops.indexOf(this.getNextPosition());
};

proto.pointerUp = function (fsm, data) {

	this.userDragModel.onPointerUp(data.interactionEvent);


	if (this.gallery.canSpring !== false) {
		fsm.changeState(stateFactory.create('springing', this.gallery, {
			particle:this.particle,
			equilibrium:this.getNextPosition(),
			index:this.getNextIndex(),
			interactionEvent:data.interactionEvent
		}), data);
	} else {
		data = data || {};
		data.incoming = this.gallery.slideAt(this.getNextIndex());
		data.outgoing = this.gallery.getSelected();

		fsm.changeState(stateFactory.create('drawing', this.gallery), data);
	}
};

module.exports = DraggingState;

},{"./../model/UserDrag":674,"./GalleryState":677,"./factory":681,"ac-object/create":786}],680:[function(require,module,exports){
'use strict';

var ac_console = require('ac-console');
var objectCreate = require('ac-object/create');

var GalleryState = require('./GalleryState');
var stateFactory = require('./factory');
var GalleryEvent = require('./../model/GalleryEvent');


var DrawingState = function () {
	GalleryState.apply(this, arguments);
	this._nextState = 'idle';
};


var proto = DrawingState.prototype = objectCreate(GalleryState.prototype);

proto.name = 'drawing';

proto.engagementChange = function (fsm, data) {
	this._nextState = 'not_engaged';
};

proto.onDealloc = function (fsm, data) {
	this._nextState = 'dealloc';
};

proto.onEnter = function (fsm, data) {
	var gallery = this.gallery;
	var incoming = data.incoming;
	var outgoing = data.outgoing;
	var options = data.options || {};
	var interactionEvent = options.interactionEvent || gallery.interactionEvent;

	var eventData = {
		incoming:incoming,
		outgoing:outgoing,
		interactionEvent:interactionEvent,
		options:options
	};

	var promise = Promise.resolve();

	if (incoming !== outgoing) {
		gallery.sendGalleryEvent(GalleryEvent.createWillShowEvent(eventData));

		promise = promise.then(gallery.beforeDraw.bind(gallery, incoming, outgoing, options))
					.then(gallery.draw.bind(gallery, incoming, outgoing, options))
					.then(gallery.afterDraw.bind(gallery, incoming, outgoing, options));
	} else {
		this._nextState = 'idle';
	}



	return promise.then(
		function () {
			fsm.changeState(stateFactory.create(this._nextState, gallery), {
				incoming:incoming,
				outgoing:outgoing,
				event:eventData
			});
		}.bind(this)

	)['catch'](function (err) {
		ac_console.log(err);
	});
};

proto.onExit = function (fsm, data) {
	var gallery = this.gallery;

	if (fsm.currentState.name !== 'dealloc' && gallery.getSelected() !== data.incoming) {
		gallery.model.setSelected(data.incoming);
		gallery.sendGalleryEvent(GalleryEvent.createDidShowEvent(data.event));
	}

	this._nextState = null;
};


module.exports = DrawingState;

},{"./../model/GalleryEvent":672,"./GalleryState":677,"./factory":681,"ac-console":422,"ac-object/create":786}],681:[function(require,module,exports){
'use strict';

var states;

module.exports = {
	create:function createState (name, gallery, options) {
		var Constructor = states[name];

		if (!Constructor) {
			throw new Error('Could not create state: state "' + name + '" not found');
		}

		return new Constructor(gallery, options);
	}
};

states = {
	initialize:require('./initialize'),
	idle:require('./idle'),
	not_engaged:require('./not_engaged'),
	seeking:require('./seeking'),
	resize:require('./resize'),
	dealloc:require('./dealloc'),
	drawing:require('./drawing'),
	dragging:require('./dragging'),
	springing:require('./springing')
};



},{"./dealloc":678,"./dragging":679,"./drawing":680,"./idle":682,"./initialize":683,"./not_engaged":684,"./resize":685,"./seeking":686,"./springing":687}],682:[function(require,module,exports){
'use strict';

var GalleryState = require('./GalleryState');
var objectCreate = require('ac-object/create');

var stateFactory = require('./factory');

var IdleState = function () {
	GalleryState.apply(this, arguments);
};

var proto = IdleState.prototype = objectCreate(GalleryState.prototype);

proto.name = 'idle';

proto.engagementChange = function (fsm, data) {
	if (data.engaged === false) {
		fsm.changeState(stateFactory.create('not_engaged', this.gallery), data);
	}
};

proto.seek = function (fsm, data) {
	fsm.changeState(stateFactory.create('seeking', this.gallery), data);
};

proto.trigger = function (fsm, data) {
	var target = data.target;
	this.gallery.interactionEvent = data.interactionEvent;
	this.gallery.routes.match(target.getAttribute('href'));
};

proto.keydown = function (fsm, data) {
	var originalEvt = data.interactionEvent;
	var keycode = ('which' in originalEvt) ? originalEvt.which : originalEvt.keyCode;

	if (keycode === 37) {
		this.gallery.showPrevious(data);
	} else if (keycode === 39) {
		this.gallery.showNext(data);
	}
};

proto.resize = function (fsm, data) {
	fsm.changeState(stateFactory.create('resize', this.gallery), data);
};

proto.onClear = function () {
	this.gallery.removeStyles();
};

proto.pointerDown = function (fsm, data) {
	fsm.changeState(stateFactory.create('dragging', this.gallery), data);
};

proto.seek = function (fsm, data) {
	fsm.changeState(stateFactory.create('seeking', this.gallery), data);
};

proto.onDraw = function (fsm, data) {
	var incoming = this.gallery.model.query(data.query);
	var outgoing = this.gallery.model.getSelected();
	var options = data.options || {};


	if (!incoming || incoming === outgoing) {
		return;
	}

	fsm.changeState(stateFactory.create('drawing', this.gallery), {
		incoming:incoming,
		outgoing:outgoing,
		options:options
	});
};


module.exports = IdleState;

},{"./GalleryState":677,"./factory":681,"ac-object/create":786}],683:[function(require,module,exports){
'use strict';

var GalleryState = require('./GalleryState');
var objectCreate = require('ac-object/create');
var GalleryEvent = require('./../model/GalleryEvent');

var stateFactory = require('./factory');


function InitializeState () {
	GalleryState.apply(this, arguments);
	this._engaged = true;
}

var proto = InitializeState.prototype = objectCreate(GalleryState.prototype);

proto.name = 'initialize';

proto.engagementChange = function (fsm, data) {
	this._engaged = data.engaged;
};

proto.onDraw = function (fsm, data) {
	var initial = this.gallery.model.query(data.query);
	var promise = this.gallery.drawInitial(initial);

	return Promise.resolve().then(promise)
		.then(function () {
			var stateName = 'idle';

			if (this._engaged === false) {
				stateName = 'not_engaged';
			}

			fsm.changeState(stateFactory.create(stateName, this.gallery));

		}.bind(this));
};

proto.onExit = function (fsm, data) {
	var galleryEvent = GalleryEvent.create('ready', {
		incoming:this.gallery.getSelected()
	});

	this.gallery.sendGalleryEvent(galleryEvent);
	this._engaged = null;
};


module.exports = InitializeState;

},{"./../model/GalleryEvent":672,"./GalleryState":677,"./factory":681,"ac-object/create":786}],684:[function(require,module,exports){
'use strict';

var GalleryState = require('./GalleryState');
var objectCreate = require('ac-object/create');

var stateFactory = require('./factory');


function NotEngagedState () {
	GalleryState.apply(this, arguments);
}

var proto = NotEngagedState.prototype = objectCreate(GalleryState.prototype);

proto.name = 'not_engaged';

proto.resize = function (fsm, data) {
	fsm.changeState(stateFactory.create('resize', this.gallery), data);
};

proto.engagementChange = function (fsm, data) {
	if (data.engaged === true) {
		fsm.changeState(stateFactory.create('idle', this.gallery));
	}
};


module.exports = NotEngagedState;

},{"./GalleryState":677,"./factory":681,"ac-object/create":786}],685:[function(require,module,exports){
'use strict';

var GalleryState = require('./GalleryState');
var GalleryEvent = require('./../model/GalleryEvent');
var objectCreate = require('ac-object/create');

var ResizeState = function () {
	GalleryState.apply(this, arguments);
};

var proto = ResizeState.prototype = objectCreate(GalleryState.prototype);

proto.name = 'resize';

proto.onEnter = function (fsm, data) {
	this.gallery.sendGalleryEvent(GalleryEvent.create('resizing'));

	var incoming = this.gallery.getSelected();

	Promise.resolve()
		.then(this.gallery.drawResize.bind(this.gallery, incoming))
		.then(function () {
			fsm.changeState(fsm.previousState, data);
		}.bind(this));
};

proto.onExit = function (fsm, data) {
	this.gallery.sendGalleryEvent(GalleryEvent.create('resized'));
};


module.exports = ResizeState;

},{"./../model/GalleryEvent":672,"./GalleryState":677,"ac-object/create":786}],686:[function(require,module,exports){
'use strict';

var GalleryState = require('./GalleryState');
var objectCreate = require('ac-object/create');
var GalleryEvent = require('./../model/GalleryEvent');


function SeekingState () {
	GalleryState.apply(this, arguments);
}

var proto = SeekingState.prototype = objectCreate(GalleryState.prototype);

proto.name = 'seeking';

proto.drawProgress = function (progress) {
	if (progress < 0) {
		return this.gallery.drawBounceInProgress(Math.abs(progress));
	} else if (progress > 1) {
		return this.gallery.drawBounceOutProgress(progress - 1);
	} else {
		return this.gallery.drawProgress(progress);
	}
};

proto.onEnter = function (fsm, data) {
	var seekData = {
		progress:data.progress
	};

	this.gallery.sendGalleryEvent(GalleryEvent.create('willseek', seekData));
	this.drawProgress(data.progress);
	this.gallery.sendGalleryEvent(GalleryEvent.create('didseek', seekData));
	fsm.changeState(fsm.previousState, data);
};

proto.onExit = function (fsm, data) {
	this.gallery = null;
};

module.exports = SeekingState;

},{"./../model/GalleryEvent":672,"./GalleryState":677,"ac-object/create":786}],687:[function(require,module,exports){
'use strict';

var GalleryState = require('./GalleryState');
var objectCreate = require('ac-object/create');
var stateFactory = require('./factory');
var Clock = require('ac-clock').Clock;
var ac_phycics_spring = require('ac-physics/spring');

function SpringingState () {
	GalleryState.apply(this, arguments);
	this.particle = this.options.particle;
	this.equilibrium = this.options.equilibrium;
	this.index = this.options.index;
	this.spring = ac_phycics_spring.create(this.particle, this.equilibrium);
	this.spring.stiffness = -60;
	this.spring.damping = -10;
	this.interactionEvent = null;

	this.clock = new Clock();
	this.clock.start();

	this.clock.on('update', this._clockUpdate, this);
	this.clock.on('draw', this._clockDraw, this);
}

var proto = SpringingState.prototype = objectCreate(GalleryState.prototype);

proto.name = 'springing';

proto.onEnter = function (fsm, data) {


	if (fsm.previousState.name !== 'seeking') {
		if (data.interactionEvent.originalEvent) {
			this.interactionEvent = data.interactionEvent.originalEvent;
		} else {
			this.interactionEvent = data.interactionEvent;
		}

		this._setLastPosition();
		this.fsm = fsm;
	}
};

proto.onExit = function (fsm, data) {

	if (fsm.currentState.name !== 'seeking') {
		this.clock.stop();
		this.clock.off();
		this.equilibrium = null;
		this.index = null;
		this.fsm = null;
		this.particle = null;
		this.spring = null;
		this.clock = null;
		this.lastPosition = null;
		this.interactionEvent = null;
	}
};


proto.pointerDown = function (fsm, data) {
	fsm.changeState(stateFactory.create('dragging', this.gallery, {
		particle:this.particle,
		startIndex:this.index
	}), data);
};

proto._clockUpdate = function (e) {
	var distance = Math.abs(this.particle.position.x - this.spring.equilibrium);

	if (e.fps === 0) {
		return;
	}

	if (distance > 0.0005) {
		this.spring.update(e);
	} else {
		this.particle.position.x = this.spring.equilibrium;
	}
};

proto._clockDraw = function (e) {
	var distance;

	if (this._shouldDraw()) {
		distance = Math.abs(this.particle.position.x - this.spring.equilibrium);

		this._setLastPosition();

		if (distance !== 0) {
			this.fsm.changeState(stateFactory.create('seeking', this.gallery), {
				progress:this.particle.position.x
			});
		} else {
			this.fsm.changeState(stateFactory.create('drawing', this.gallery), {
				incoming:this.gallery.slideAt(this.index),
				outgoing:this.gallery.getSelected(),
				options:{
					interactionEvent:this.interactionEvent
				}
			});
		}
	}
};

proto._setLastPosition = function () {
	this.lastPosition = {
		x:this.particle.position.x,
		y:this.particle.position.y
	};
};

proto._shouldDraw = function () {
	if (this.lastPosition.x === this.particle.position.x && this.lastPosition.y === this.particle.position.y) {
		return false;
	}

	return true;
};

module.exports = SpringingState;

},{"./GalleryState":677,"./factory":681,"ac-clock":418,"ac-object/create":786,"ac-physics/spring":653}],688:[function(require,module,exports){
'use strict';

var Request = require('./Request');
var XDRequest = require('./XDomain-request');
var URLParser = require('./URLParser');

/**
 * @constructor
 * @memberOf module:ac-ajax
 */
var Ajax = function() {};

/**
 * Reference to {@link module:ac-ajax.Request|Request} constructor so that it may be mocked in testing
 * @type {Class}
 * @private
 * @ignore
 */
Ajax._Request = Request;

Ajax.prototype = /** @lends module:ac-ajax.Ajax# */ {

	/**
	 * The default configuration for {@link module:ac-ajax.Request|Request}
	 * @type {Object}
	 * @property {Object} timeout The timeout duration
	 * @todo  Should this be moved into ./Request?
	 * @defaults
	 * @readOnly
	 * @private
	 * @ignore
	 */
	_defaults: {

		method: 'get',

		timeout: 5000

	},

	/**
	 * Combines any number of objects passed as arguments into a single object literal from left to right
	 * @return {Object} An object containing all the properties of the object passed as arguments
	 * @private
	 * @ignore
	 */
	_extend: function() {

		for (var i = 1; i < arguments.length; i++) {

			for (var key in arguments[i]) {

				if (arguments[i].hasOwnProperty(key)) {

					arguments[0][key] = arguments[i][key];

				}

			}

		}

		return arguments[0];

	},

	/**
	 * Combines the request defaults, user provided configuration and method specific constants into a single object literal
	 * @param  {Object} constants     Contains configurations that should not be overwritten for public methods like post, get, and head
	 * @param  {Object} configuration User provided request configuration
	 * @return {Object}               Combined configuration
	 * @private
	 * @ignore
	 */
	_getOptions: function(constants, configuration) {

		return this._extend({}, this._defaults, configuration, constants);

	},

	/**
	 * Returns true if the url provided is for a different origin than the host
	 * @param  {String}  url The url to check
	 * @return {Boolean}     True if is cross domain false if not
	 */
	_isCrossDomainRequest: function (url) {
		
		var urlParser = new URLParser();
		var currentOrigin = urlParser.parse(window.location.href).origin;
		var requestOrigin = urlParser.parse(url).origin;

		urlParser.destroy();

		return (requestOrigin !== currentOrigin);

	},

	/**
	 * Returns a {@link module:ac-ajax.Request|Request} instance with provided configuration
	 * @param  {Object} configuration Configuration for the {@link module:ac-ajax.Request|Request}
	 * @return {Object}               An instance of {@link module:ac-ajax.Request|Request}
	 * @public
	 * @example
	 * var ajax = require('ac-ajax');
	 * ajax.create({'url':'http://apple.com', 'method': 'get'}).send().then(successCallback, failureCallback);
	 */
	create: function(configuration) {

		return new Request(configuration);

	},

	/**
	 * Returns a <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a> that will resolve when the GET {@link module:ac-ajax.Request|Request} has resolved/rejected.
	 * @param  {Object} configuration Configuration for the {@link module:ac-ajax.Request|Request}
	 * @return {Object}               <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a>. Its important to note that the resolution of the promise returns an instance of <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest">XMLHttpRequest</a>
	 * @public
	 * @example
	 * var ajax = require('ac-ajax');
	 * ajax.cors({'url':'http://apple.com'}).then(successCallback, failureCallback);
	 */
	cors: function(configuration) {

		// Both XDomainRequest and a CORS friendly version of XMLHttpRequest exist
		// in IE10. So we should use XMLHttpRequest if at all possible.
		var RequestClient = (window.XDomainRequest && document.documentMode < 10) ? XDRequest : Request;

		return new RequestClient(configuration);

	},

	/**
	 * Returns a <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a> that will resolve when the GET {@link module:ac-ajax.Request|Request} has resolved/rejected.
	 * @param  {Object} configuration Configuration for the {@link module:ac-ajax.Request|Request}
	 * @return {Object}               <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a>. Its important to note that the resolution of the promise returns an instance of <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest">XMLHttpRequest</a>
	 * @public
	 * @example
	 * var ajax = require('ac-ajax');
	 * ajax.get({'url':'http://apple.com'}).then(successCallback, failureCallback);
	 */
	get: function(configuration) {
		var request;

		configuration = this._getOptions({

			method: 'get'

		}, configuration);

		if (this._isCrossDomainRequest(configuration.url)) {
			request = this.cors(configuration);
		} else {
			request = this.create(configuration);
		}

		return request.send();

	},

	/**
	 * Returns a <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a> that will resolve when the configured {@link module:ac-ajax.Request|Request} has resolved/rejected.
	 * @param  {Object} configuration Configuration for the {@link module:ac-ajax.Request|Request}
	 * @return {Object}               An instance of <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a> that when resolved returns an instance of <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest">XMLHttpRequest</a>
	 * @public
	 * @example
	 * var ajax = require('ac-ajax');
	 * ajax.get({'url':'http://apple.com'}).then(successCallback, failureCallback);
	 */
	getJSON: function(configuration) {

		return this.get(configuration).then(function(xhr) {
			return JSON.parse(xhr.responseText);
		});

	},

	/**
	 * Returns a <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a> that will resolve when the HEAD {@link module:ac-ajax.Request|Request} has resolved/rejected.
	 * @param  {Object} configuration The configuration for a {@link module:ac-ajax.Request|Request}
	 * @return {Object}               An instance of <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a> that when resolved returns an instance of <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest">XMLHttpRequest</a>
	 * @public
	 * @example
	 * var ajax = require('ac-ajax');
	 * ajax.head({'url':'http://apple.com'}).then(successCallback, failureCallback);
	 */
	head: function(configuration) {

		configuration = this._getOptions({

			method: 'head'

		}, configuration);

		return this.create(configuration).send();

	},

	/**
	 * Returns true if the url provided is for a different origin than the host
	 * @param  {String}  url The url to check
	 * @return {Boolean}     True if is cross domain false if not
	 */
	isCrossDomainRequest: function(url) {

		return this._isCrossDomainRequest(url);

	},

	/**
	 * Returns a <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a> that will resolve when the POST {@link module:ac-ajax.Request|Request} has resolved/rejected.
	 * @param  {Object} configuration Configuration for the {@link module:ac-ajax.Request|Request}
	 * @return {Object}               An instance of <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a> that when resolved returns an instance of <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest">XMLHttpRequest</a>
	 * @public
	 * @example
	 * var ajax = require('ac-ajax');
	 * ajax.post({'url':'http://apple.com'}).then(successCallback, failureCallback);
	 */
	post: function(configuration) {

		configuration = this._getOptions({

			method: 'post'

		}, configuration);

		return this.create(configuration).send();

	}

};

module.exports = Ajax;

},{"./Request":689,"./URLParser":690,"./XDomain-request":691}],689:[function(require,module,exports){
'use strict';

/**
 * A wrapper for <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest">XMLHttpRequest</a> that uses <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promises</a> for resolution.
 * @param {Object} configuration The configuration for the <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest">XMLHttpRequest</a>
 * @constructor
 * @memberOf module:ac-ajax
 */
var Request = function(configuration) {

	this._initialize(configuration);

};

/**
 * Returns a new object with the Request prototype
 * @return {Object} A new object with the Request prototype
 * @public
 */
Request.create = function() {

	var F = function() {};

	F.prototype = Request.prototype;

	return new F();

};

Request.prototype = /** @lends module:ac-ajax.Request# */ {

	/**
	 * Attaches the onreadystatechange handler to the instance xhr property which will resolve the instance {@link module:ac-ajax.Request|promise} if successful and reject instance {@link module:ac-ajax.Request|promise} if not
	 * @private
	 * @ignore
	 */
	_addReadyStateChangeHandler: function() {

		this.xhr.onreadystatechange = function(e) {

			if (this.xhr.readyState === 4) {

				clearTimeout(this._timeout);

				if (this.xhr.status >= 200 && this.xhr.status < 300) {

					this.resolve(this.xhr);

				} else {

					this.reject(this.xhr);

				}

			}

		}.bind(this);

	},

	/**
	 * Decorates the request with a <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a> object as well as the resolve and reject methods the <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a> supplies.
	 * @private
	 * @ignore
	 */
	_getPromise: function() {

		this.promise = new Promise(function(resolve, reject) {

			this.resolve = resolve;

			this.reject = reject;

		}.bind(this));

	},

	/**
	 * Returns a new instance of XMLHttpRequest
	 * @return {Object} An instance of XMLHttpRequest
	 * @private
	 * @ignore
	 */
	_getTransport: function() {

		return new XMLHttpRequest();

	},

	/**
	 * Sets up an <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest">XMLHttpRequest</a> using the provided configuration
	 * @param  {Object} configuration The configuration for the request
	 * @throws If not correctly configured
	 * @private
	 * @ignore
	 */
	_initialize: function(configuration) {

		// Validates configuration
		var errors = this._validateConfiguration(configuration);

		// Throws errors if something was wrong with the configuration
		if (errors) {
			throw errors;
		}

		this._configuration = configuration;

		/**
		 * Requests fail in IE 7-9 (and maybe later) if the method is not in all caps.
		 * Issue 30 : https://interactive-git.apple.com/Interactive-Interfaces/ac-ajax/issues/30
		 */
		var method = this._configuration.method.toUpperCase();

		this.xhr = this._getTransport();

		// Sets promise property as well as reject and resolve methods
		this._getPromise();

		this.xhr.open(method, this._configuration.url);

		this._setRequestHeaders(configuration.headers);

		this._addReadyStateChangeHandler();

	},

	/**
	 * If the instance has an xhr property its sent with any configured data
	 * @private
	 * @ignore
	 */
	_sendXHR: function() {

		if (this.xhr) {

			if (this._configuration && this._configuration.data) {

				this.xhr.send(this._configuration.data);

			} else {

				this.xhr.send();

			}

		}

	},

	/**
	 * Sets request headers using the provided headers array
	 * @param  {Array} headers An array of the headers to be used on the request
	 * @private
	 * @ignore
	 */
	_setRequestHeaders: function(headers) {

		if (headers) {

			headers.forEach(function(header) {
				this.xhr.setRequestHeader(header.name, header.value);
			}, this);

		}

	},

	/**
	 * Sets timeout on the request instance for the passed delay. Should the timeout expire the xhr will be aborted and the <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a> will be rejected
	 * @param  {Int} [delay] The timeout delay in milliseconds
	 * @private
	 * @ignore
	 */
	_setTimeout: function(delay) {

		if (!delay) {
			if (this._configuration && this._configuration.timeout) {
				delay = this._configuration.timeout;
			} else {
				clearTimeout(this._timeout);
				this._timeout = null;
			}
		}

		if (this._timeout !== null) {
			clearTimeout(this._timeout);
		}

		if (delay > 0) {
			this._timeout = setTimeout(function() {

				this.xhr.abort();
				this.reject();

			}.bind(this), delay);
		}

	},

	/**
	 * A timeout that causes the xhr to abort and promise to reject should it expire.
	 * @type {Int}
	 * @private
	 * @ignore
	 */
	_timeout: null,

	/**
	 * Validates the provided configuration and returns errors should something be incorrectly configured
	 * @param  {Object} configuration Configuration for the request
	 * @return {String}               The errors concatenated
	 * @private
	 * @ignore
	 */
	_validateConfiguration: function(configuration) {

		if (!configuration) {
			return 'Must provide a configuration object';
		}

		var errors = [];
		var headers = configuration.headers;

		if (!configuration.url) {
			errors.push('Must provide a url');
		}

		if (!configuration.method) {
			errors.push('Must provide a method');
		}

		if (headers) {

			if (!Array.isArray(headers)) {
				return 'Must provide an array of headers';
			}

			this._validateHeaders(headers, errors);
		}

		return errors.join(', ');

	},

	/**
	 * Validates headers to ensure both a name and value are present in each header, breaks if an error is detected
	 * @param  {Array} headers An array of the desired headers for the request
	 * @param  {Array} errors  An array of errors
	 * @private
	 * @ignore
	 */
	_validateHeaders: function(headers, errors) {

		for (var i = 0, len = headers.length; i < len; i++) {

			if (!headers[i].hasOwnProperty('name') || !headers[i].hasOwnProperty('value')) {
				errors.push('Must provide a name and value key for all headers');
				break;
			}
		}

	},

	/**
	 * An instance of <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a>
	 * @type {Object}
	 * @instance
	 * @public
	 */
	promise: null,

	/**
	 * The reject method of the {@link module:ac-ajax.Request|promise} property
	 * @type {Function}
	 * @instance
	 * @public
	 */
	reject: null,

	/**
	 * The resolve method of the {@link module:ac-ajax.Request|promise} property
	 * @type {Function}
	 * @instance
	 * @public
	 */
	resolve: null,

	/**
	 * Send the configured <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest">XMLHttpRequest</a>, adds a timeout if configured, and returns a <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a> that will resolve/reject once the request has finished.
	 * @return {Object} An instance of <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a>.
	 * @public
	 * @example
	 * var Request = require('Request');
	 * request = new Request({'url':'http://apple.com'});
	 * request.send().then(successCallback, failureCallback);
	 */
	send: function() {

		this._setTimeout();

		this._sendXHR();

		return this.promise;

	},

	/**
	 * An instance of <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest">XMLHttpRequest</a>
	 * @type {Object}
	 * @instance
	 * @public
	 */
	xhr: null

};

module.exports = Request;

},{}],690:[function(require,module,exports){
'use strict';

/**
 * @constructor
 * @memberOf module:ac-ajax
 */
var URLParser = function () {
	this.parser = null;
};

var proto = URLParser.prototype;

/**
 * Accepts a path, qualifies it and returns an object with URL parts as properties
 * @param  {String} path The path to parse as a URL
 * @return {Object} An object with URL parts as properties
 */
proto.parse = function (path) {
	var origin;
	var protocol;
	var hostname;
	var port;
	var search;

	if (typeof path !== 'string') {
		throw new TypeError(path + ' must be a string');
	}

	if (!this.parser) {
		this.parser = document.createElement('a');
	}

	this._qualifyPath(path);

	hostname = this.parser.hostname;
	protocol = this.parser.protocol;
	port = this._normalizePort(this.parser);
	origin = this.parser.origin || this._constructOriginString(this.parser, port);
	search = this.parser.search;

	return {
		originalPath: path,
		qualifiedPath: this.parser.href,
		protocol: protocol,
		hostname: hostname,
		origin: origin,
		port: port,
		search: search
	};

};

/**
 * Nullifies the created element reference to release it from memory
 */
proto.destroy = function () {
	this.parser = null;
};

proto._constructOriginString = function (parser, port) {
	var portString = port ? ':' + port : '';

		return parser.protocol + '//' + parser.hostname + portString;
};

proto._normalizePort = function (parser) {
	// if port is reported as '80' or '443' or '0' (phantomjs) it should not be showing up in the URL
	return (parser.port === '80' || parser.port === '443' || parser.port === '0') ? '' : parser.port;
};

/**
 * Ensures that the parser's `href` is a fully qualified URL
 * @param  {String} path path to qualify
 * @private
 * @ignore
 */
proto._qualifyPath = function (path) {
	this.parser.href = path;

	/**
	 * Coerce to fully qualifed path
	 *
	 * Ensures that non-fully-qualifed URLs are converted to fully qualifed URLs.
	 *
	 * At this point, if path is not fully qualified (http://www.apple.com/some/path)
	 * IE will unpredictably report this.parser.protocol as either "" or ":".
	 * This of course can cause many problems.
	 *
	 * The `href` property always reports a fully qualified path
	 * The `getAttribute('href')` method always reprots the exact value that was assignedto the href.
	 *
	 * So, set `this.parser.href` to `this.parser.href` to ensure we are always working
	 * with a fully qualified path.
	 *
	 */
	this.parser.href = this.parser.href;
};


module.exports = URLParser;

},{}],691:[function(require,module,exports){
'use strict';

var Request = require('./Request');

/**
 * A wrapper for <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/API/XDomainRequest">XDomainRequest</a> that uses <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promises</a> for resolution.
 * @param {Object} configuration The configuration for the <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/API/XDomainRequest">XDomainRequest</a>
 * @constructor
 * @memberOf module:ac-ajax
 */
var XDRequest = function(configuration) {

	Request.apply(this, arguments);

};

/**
 * Extends Request
 */
XDRequest.prototype = /** @lends module:ac-ajax.XDRequest# */ Request.create();

/**
 * Returns a new instance of XDomainRequest
 * @return {Object} An instance of XDomainRequest
 * @private
 * @ignore
 */
XDRequest.prototype._getTransport = function() {

	return new XDomainRequest();

};

/**
 * Attaches the statechange handlers for the XDomainRequest instance and will resolve instance {@link module:ac-ajax.Request|promise} if successful and reject instance {@link module:ac-ajax.Request|promise} if not
 * @private
 * @ignore
 */
XDRequest.prototype._addReadyStateChangeHandler = function() {

	this.xhr.ontimeout = function () {
		this.reject(this.xhr);
	}.bind(this);

	this.xhr.onerror = function () {
		this.reject(this.xhr);
	}.bind(this);

	this.xhr.onload = function () {
		this.resolve(this.xhr);
	}.bind(this);
};

/**
 * Sets timeout property on the XDomainRequest object. Should the timeout expire the xhr will be aborted and the <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a> will be rejected
 * @param  {Int} [delay] The timeout delay in milliseconds
 * @private
 * @ignore
 */
XDRequest.prototype._setTimeout = function(delay) {

	if (!delay) {
		if (this._configuration && this._configuration.timeout) {
			delay = this._configuration.timeout;
		}
	}

	if (delay > 0) {
		this.xhr.timeout = delay;
	}

};

/**
 * There is an issue with ie9 making multiple cross domain requests. ie will abort the request immediately. setTimeout will prevent the issuw. Please refer to https://developer.mozilla.org/en-US/docs/Web/API/XDomainRequest in the yellow noted section.
 * @ignore
 */
XDRequest.prototype._sendXHR = function () {

	setTimeout(function () {

		Request.prototype._sendXHR.call(this);

	}.bind(this), 0 );

};

module.exports = XDRequest;

},{"./Request":689}],692:[function(require,module,exports){
'use strict';

/**
 * An instance of Ajax
 * @module ac-ajax
 * @property Ajax {Class} A reference to the Ajax constructor
 * @property Request {Class} A reference to the Request constructor
 */
var Ajax = require('./ac-ajax/Ajax');
var Request = require('./ac-ajax/Request');

module.exports = new Ajax();
module.exports.Ajax = Ajax;
module.exports.Request = Request;
},{"./ac-ajax/Ajax":688,"./ac-ajax/Request":689}],693:[function(require,module,exports){
'use strict';

var Request = require('./Request');
var XDRequest = require('./XDomain-request');
var URLParser = require('./URLParser');

/**
 * @constructor
 * @memberOf module:ac-ajax
 */
var Ajax = function() {};

/**
 * Reference to {@link module:ac-ajax.Request|Request} constructor so that it may be mocked in testing
 * @type {Class}
 * @private
 * @ignore
 */
Ajax._Request = Request;

Ajax.prototype = /** @lends module:ac-ajax.Ajax# */ {

	/**
	 * The default configuration for {@link module:ac-ajax.Request|Request}
	 * @type {Object}
	 * @property {Object} timeout The timeout duration
	 * @todo  Should this be moved into ./Request?
	 * @defaults
	 * @readOnly
	 * @private
	 * @ignore
	 */
	_defaults: {

		method: 'get',

		timeout: 5000

	},

	/**
	 * Combines any number of objects passed as arguments into a single object literal from left to right
	 * @return {Object} An object containing all the properties of the object passed as arguments
	 * @private
	 * @ignore
	 */
	_extend: function() {

		for (var i = 1; i < arguments.length; i++) {

			for (var key in arguments[i]) {

				if (arguments[i].hasOwnProperty(key)) {

					arguments[0][key] = arguments[i][key];

				}

			}

		}

		return arguments[0];

	},

	/**
	 * Combines the request defaults, user provided configuration and method specific constants into a single object literal
	 * @param  {Object} constants     Contains configurations that should not be overwritten for public methods like post, get, and head
	 * @param  {Object} configuration User provided request configuration
	 * @return {Object}               Combined configuration
	 * @private
	 * @ignore
	 */
	_getOptions: function(constants, configuration) {

		return this._extend({}, this._defaults, configuration, constants);

	},

	/**
	 * Returns a {@link module:ac-ajax.Request|Request} instance with provided configuration
	 * @param  {Object} configuration Configuration for the {@link module:ac-ajax.Request|Request}
	 * @return {Object}               An instance of {@link module:ac-ajax.Request|Request}
	 * @public
	 * @example
	 * var ajax = require('ac-ajax');
	 * ajax.create({'url':'http://apple.com', 'method': 'get'}).send().then(successCallback, failureCallback);
	 */
	create: function(configuration) {

		return new Request(configuration);

	},

	/**
	 * Returns a <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a> that will resolve when the GET {@link module:ac-ajax.Request|Request} has resolved/rejected.
	 * @param  {Object} configuration Configuration for the {@link module:ac-ajax.Request|Request}
	 * @return {Object}               <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a>. Its important to note that the resolution of the promise returns an instance of <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest">XMLHttpRequest</a>
	 * @public
	 * @example
	 * var ajax = require('ac-ajax');
	 * ajax.cors({'url':'http://apple.com'}).then(successCallback, failureCallback);
	 */
	cors: function(configuration) {

		// Both XDomainRequest and a CORS friendly version of XMLHttpRequest exist
		// in IE10. So we should use XMLHttpRequest if at all possible.
		var RequestClient = (window.XDomainRequest && document.documentMode < 10) ? XDRequest : Request;

		return new RequestClient(configuration);

	},

	_isCrossDomainRequest: function (url) {
		var urlParser = new URLParser();
		var currentOrigin = urlParser.parse(window.location.href).origin;
		var requestOrigin = urlParser.parse(url).origin;

		urlParser.destroy();

		return (requestOrigin !== currentOrigin);

	},

	/**
	 * Returns a <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a> that will resolve when the GET {@link module:ac-ajax.Request|Request} has resolved/rejected.
	 * @param  {Object} configuration Configuration for the {@link module:ac-ajax.Request|Request}
	 * @return {Object}               <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a>. Its important to note that the resolution of the promise returns an instance of <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest">XMLHttpRequest</a>
	 * @public
	 * @example
	 * var ajax = require('ac-ajax');
	 * ajax.get({'url':'http://apple.com'}).then(successCallback, failureCallback);
	 */
	get: function(configuration) {
		var request;

		configuration = this._getOptions({

			method: 'get'

		}, configuration);

		if (this._isCrossDomainRequest(configuration.url)) {
			request = this.cors(configuration);
		} else {
			request = this.create(configuration);
		}

		return request.send();

	},

	/**
	 * Returns a <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a> that will resolve when the configured {@link module:ac-ajax.Request|Request} has resolved/rejected.
	 * @param  {Object} configuration Configuration for the {@link module:ac-ajax.Request|Request}
	 * @return {Object}               An instance of <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a> that when resolved returns an instance of <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest">XMLHttpRequest</a>
	 * @public
	 * @example
	 * var ajax = require('ac-ajax');
	 * ajax.get({'url':'http://apple.com'}).then(successCallback, failureCallback);
	 */
	getJSON: function(configuration) {

		return this.get(configuration).then(function(xhr) {
			return JSON.parse(xhr.responseText);
		});

	},

	/**
	 * Returns a <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a> that will resolve when the HEAD {@link module:ac-ajax.Request|Request} has resolved/rejected.
	 * @param  {Object} configuration The configuration for a {@link module:ac-ajax.Request|Request}
	 * @return {Object}               An instance of <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a> that when resolved returns an instance of <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest">XMLHttpRequest</a>
	 * @public
	 * @example
	 * var ajax = require('ac-ajax');
	 * ajax.head({'url':'http://apple.com'}).then(successCallback, failureCallback);
	 */
	head: function(configuration) {

		configuration = this._getOptions({

			method: 'head'

		}, configuration);

		return this.create(configuration).send();

	},

	/**
	 * Returns a <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a> that will resolve when the POST {@link module:ac-ajax.Request|Request} has resolved/rejected.
	 * @param  {Object} configuration Configuration for the {@link module:ac-ajax.Request|Request}
	 * @return {Object}               An instance of <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a> that when resolved returns an instance of <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest">XMLHttpRequest</a>
	 * @public
	 * @example
	 * var ajax = require('ac-ajax');
	 * ajax.post({'url':'http://apple.com'}).then(successCallback, failureCallback);
	 */
	post: function(configuration) {

		configuration = this._getOptions({

			method: 'post'

		}, configuration);

		return this.create(configuration).send();

	}

};

module.exports = Ajax;

},{"./Request":694,"./URLParser":695,"./XDomain-request":696}],694:[function(require,module,exports){
arguments[4][689][0].apply(exports,arguments)
},{"dup":689}],695:[function(require,module,exports){
arguments[4][690][0].apply(exports,arguments)
},{"dup":690}],696:[function(require,module,exports){
'use strict';

var Request = require('./Request');

/**
 * A wrapper for <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/API/XDomainRequest">XDomainRequest</a> that uses <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promises</a> for resolution.
 * @param {Object} configuration The configuration for the <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/API/XDomainRequest">XDomainRequest</a>
 * @constructor
 * @memberOf module:ac-ajax
 */
var XDRequest = function(configuration) {

	Request.apply(this, arguments);

};

/**
 * Extends Request
 */
XDRequest.prototype = /** @lends module:ac-ajax.XDRequest# */ Request.create();

/**
 * Returns a new instance of XDomainRequest
 * @return {Object} An instance of XDomainRequest
 * @private
 * @ignore
 */
XDRequest.prototype._getTransport = function() {

	return new XDomainRequest();

};

/**
 * Attaches the statechange handlers for the XDomainRequest instance and will resolve instance {@link module:ac-ajax.Request|promise} if successful and reject instance {@link module:ac-ajax.Request|promise} if not
 * @private
 * @ignore
 */
XDRequest.prototype._addReadyStateChangeHandler = function() {

	this.xhr.ontimeout = function () {
		this.reject(this.xhr);
	}.bind(this);

	this.xhr.onerror = function () {
		this.reject(this.xhr);
	}.bind(this);

	this.xhr.onload = function () {
		this.resolve(this.xhr);
	}.bind(this);
};

/**
 * Sets timeout property on the XDomainRequest object. Should the timeout expire the xhr will be aborted and the <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a> will be rejected
 * @param  {Int} [delay] The timeout delay in milliseconds
 * @private
 * @ignore
 */
XDRequest.prototype._setTimeout = function(delay) {

	if (!delay) {
		if (this._configuration && this._configuration.timeout) {
			delay = this._configuration.timeout;
		}
	}

	if (delay > 0) {
		this.xhr.timeout = delay;
	}

};

module.exports = XDRequest;

},{"./Request":694}],697:[function(require,module,exports){
arguments[4][692][0].apply(exports,arguments)
},{"./ac-ajax/Ajax":693,"./ac-ajax/Request":694,"dup":692}],698:[function(require,module,exports){
arguments[4][389][0].apply(exports,arguments)
},{"./ac-feature/cssPropertyAvailable":699,"./ac-feature/localStorageAvailable":700,"dup":389}],699:[function(require,module,exports){
arguments[4][390][0].apply(exports,arguments)
},{"dup":390}],700:[function(require,module,exports){
arguments[4][391][0].apply(exports,arguments)
},{"dup":391}],701:[function(require,module,exports){
(function (process,global){
/**
 * Shim for "fixing" IE's lack of support (IE < 9) for applying slice
 * on host objects like NamedNodeMap, NodeList, and HTMLCollection
 * (technically, since host objects have been implementation-dependent,
 * at least before ES6, IE hasn't needed to work this way).
 * Also works on strings, fixes IE < 9 to allow an explicit undefined
 * for the 2nd argument (as in Firefox), and prevents errors when
 * called on other DOM objects.
 *
 * @link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/slice
 */
(function () {
    'use strict';
    var _slice = Array.prototype.slice;

    try {
        // Can't be used with DOM elements in IE < 9
        _slice.call(document.documentElement);
    } catch (e) { // Fails in IE < 9
        // This will work for genuine arrays, array-like objects, 
        // NamedNodeMap (attributes, entities, notations),
        // NodeList (e.g., getElementsByTagName), HTMLCollection (e.g., childNodes),
        // and will not fail on other DOM objects (as do DOM elements in IE < 9)
        Array.prototype.slice = function (begin, end) {
            // IE < 9 gets unhappy with an undefined end argument
            end = (typeof end !== 'undefined') ? end : this.length;

            // For native Array objects, we use the native slice function
            if (Object.prototype.toString.call(this) === '[object Array]'){
                return _slice.call(this, begin, end); 
            }

            // For array like object we handle it ourselves.
            var i, cloned = [],
                size, len = this.length;

            // Handle negative value for "begin"
            var start = begin || 0;
            start = (start >= 0) ? start: len + start;

            // Handle negative value for "end"
            var upTo = (end) ? end : len;
            if (end < 0) {
                upTo = len + end;
            }

            // Actual expected size of the slice
            size = upTo - start;

            if (size > 0) {
                cloned = new Array(size);
                if (this.charAt) {
                    for (i = 0; i < size; i++) {
                        cloned[i] = this.charAt(start + i);
                    }
                } else {
                    for (i = 0; i < size; i++) {
                        cloned[i] = this[start + i];
                    }
                }
            }

            return cloned;
        };
    }
}());

/*
 * classList.js: Cross-browser full element.classList implementation.
 * 2012-11-15
 *
 * By Eli Grey, http://eligrey.com
 * Public Domain.
 * NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.
 */

/*global self, document, DOMException */

/*! @source http://purl.eligrey.com/github/classList.js/blob/master/classList.js*/

if (typeof document !== "undefined" && !("classList" in document.createElement("a"))) {

(function (view) {

"use strict";

if (!('HTMLElement' in view) && !('Element' in view)) return;

var
	  classListProp = "classList"
	, protoProp = "prototype"
	, elemCtrProto = (view.HTMLElement || view.Element)[protoProp]
	, objCtr = Object
	, strTrim = String[protoProp].trim || function () {
		return this.replace(/^\s+|\s+$/g, "");
	}
	, arrIndexOf = Array[protoProp].indexOf || function (item) {
		var
			  i = 0
			, len = this.length
		;
		for (; i < len; i++) {
			if (i in this && this[i] === item) {
				return i;
			}
		}
		return -1;
	}
	// Vendors: please allow content code to instantiate DOMExceptions
	, DOMEx = function (type, message) {
		this.name = type;
		this.code = DOMException[type];
		this.message = message;
	}
	, checkTokenAndGetIndex = function (classList, token) {
		if (token === "") {
			throw new DOMEx(
				  "SYNTAX_ERR"
				, "An invalid or illegal string was specified"
			);
		}
		if (/\s/.test(token)) {
			throw new DOMEx(
				  "INVALID_CHARACTER_ERR"
				, "String contains an invalid character"
			);
		}
		return arrIndexOf.call(classList, token);
	}
	, ClassList = function (elem) {
		var
			  trimmedClasses = strTrim.call(elem.className)
			, classes = trimmedClasses ? trimmedClasses.split(/\s+/) : []
			, i = 0
			, len = classes.length
		;
		for (; i < len; i++) {
			this.push(classes[i]);
		}
		this._updateClassName = function () {
			elem.className = this.toString();
		};
	}
	, classListProto = ClassList[protoProp] = []
	, classListGetter = function () {
		return new ClassList(this);
	}
;
// Most DOMException implementations don't allow calling DOMException's toString()
// on non-DOMExceptions. Error's toString() is sufficient here.
DOMEx[protoProp] = Error[protoProp];
classListProto.item = function (i) {
	return this[i] || null;
};
classListProto.contains = function (token) {
	token += "";
	return checkTokenAndGetIndex(this, token) !== -1;
};
classListProto.add = function () {
	var
		  tokens = arguments
		, i = 0
		, l = tokens.length
		, token
		, updated = false
	;
	do {
		token = tokens[i] + "";
		if (checkTokenAndGetIndex(this, token) === -1) {
			this.push(token);
			updated = true;
		}
	}
	while (++i < l);

	if (updated) {
		this._updateClassName();
	}
};
classListProto.remove = function () {
	var
		  tokens = arguments
		, i = 0
		, l = tokens.length
		, token
		, updated = false
	;
	do {
		token = tokens[i] + "";
		var index = checkTokenAndGetIndex(this, token);
		if (index !== -1) {
			this.splice(index, 1);
			updated = true;
		}
	}
	while (++i < l);

	if (updated) {
		this._updateClassName();
	}
};
classListProto.toggle = function (token, forse) {
	token += "";

	var
		  result = this.contains(token)
		, method = result ?
			forse !== true && "remove"
		:
			forse !== false && "add"
	;

	if (method) {
		this[method](token);
	}

	return !result;
};
classListProto.toString = function () {
	return this.join(" ");
};

if (objCtr.defineProperty) {
	var classListPropDesc = {
		  get: classListGetter
		, enumerable: true
		, configurable: true
	};
	try {
		objCtr.defineProperty(elemCtrProto, classListProp, classListPropDesc);
	} catch (ex) { // IE 8 doesn't support enumerable:true
		if (ex.number === -0x7FF5EC54) {
			classListPropDesc.enumerable = false;
			objCtr.defineProperty(elemCtrProto, classListProp, classListPropDesc);
		}
	}
} else if (objCtr[protoProp].__defineGetter__) {
	elemCtrProto.__defineGetter__(classListProp, classListGetter);
}

}(self));

}
/**
 * The DOM CustomEvent are events initialized by an application for any purpose.
 * https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent
 *
 * This is not compatible with IE < 9.
 *
 * @return {Function} CustomEvent constructor
 */

if (document.createEvent) {
	try {
		new window.CustomEvent('click');
	} catch (err) {
		window.CustomEvent = (function () {
			function CustomEvent(event, params) {
				params = params || {bubbles: false, cancelable: false, detail: undefined};
				var evt = document.createEvent('CustomEvent');
				evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);
				return evt;
			}
			CustomEvent.prototype = window.Event.prototype;
			return CustomEvent;
		}());
	}
}

/**
	Extend native objects to provide ECMAScript 5.1 functionality if it doesn't exist.
*/



if (!Function.prototype.bind) {
/**
	Creates a new function that, when called, itself calls this function in the context of the provided
	this value, with a given sequence of arguments preceding any provided when the new function was called.
	Arguments may be passed to bind as separate arguments following `thisObj`.
	@param {Object} thisObj The object that will provide the context of `this` for the called function.
*/
	Function.prototype.bind = function(originalContext){
		if (typeof this !== 'function') {
			throw new TypeError('Function.prototype.bind - what is trying to be bound is not callable');
		}
		var applicableArgs = Array.prototype.slice.call(arguments, 1);
		var functionToBind = this;
		var fnOriginalPrototype = function(){ };
		var fnBound = function() {
			return functionToBind.apply(
				(this instanceof fnOriginalPrototype && originalContext) ? this : originalContext,
				applicableArgs.concat(Array.prototype.slice.call(arguments))
			);
		}
		fnOriginalPrototype.prototype = this.prototype;
		fnBound.prototype = new fnOriginalPrototype();
		return fnBound;
	};
}



if (!Array.isArray) {
/**
	Returns true if an object is an array, false if it is not.
	@param {Object} object Object to test against.
	@name Array.isArray
*/
	Array.isArray = function isArray(object) {
		return (object && typeof object === 'object' && 'splice' in object && 'join' in object);
	};
}



if (!Array.prototype.every) {
/**
	Behaving in a similar yet opposite fashion to Array.prototype.some, Array.prototype.every tests whether
	all elements in the array pass the test implemented by the provided function. A return of false by the
	callback will immediately return false for the whole method.
	@param {Function} callback Function to test against. The callback should return a boolean value. Please
	note that 'falsy' values, e.g. no return, will evaluate to false.
	@param {Object} thisObj Object to use as `this` when executing the callback.
	@returns {Boolean} Returns true if all objects pass the test implemented by the provided function.
	@reference https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/every
*/
	Array.prototype.every = function every(callback, thisObj) {
		var arrayObject = Object(this);
		// Mimic ES5 spec call for interanl method ToUint32()
		var len = arrayObject.length >>> 0;
		var i;

		// Callback must be a callable function
		if (typeof callback !== 'function') {
			throw new TypeError(callback + ' is not a function');
		}

		for (i = 0; i < len; i += 1) {
			if (i in arrayObject && !callback.call(thisObj, arrayObject[i], i, arrayObject)) {
				return false;
			}
		}
		return true;
	};
}



if (!Array.prototype.filter) {
/**
	Tests all elements in an array and returns a new array filled with elements that pass the test.
	@param {Function} callback Function to test against. The callback must return a boolean value.
	@param {Object} thisObj Object to use as `this` when executing the callback.
	@returns {Array} Returns a new array populated with values from the original array that passed the test implemented by the provided function.
	@reference https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/filter
*/
	Array.prototype.filter = function filter(callback, thisObj) {
		var arrayObject = Object(this);
		// Mimic ES5 spec call for interanl method ToUint32()
		var len = arrayObject.length >>> 0;
		var i;
		var results = [];

		// Callback must be a callable function
		if (typeof callback !== 'function') {
			throw new TypeError(callback + ' is not a function');
		}

		for (i = 0; i < len; i += 1) {
			if (i in arrayObject && callback.call(thisObj, arrayObject[i], i, arrayObject)) {
				results.push(arrayObject[i]);
			}
		}

		return results;
	};
}



if (!Array.prototype.forEach) {
/**
	Executes a provided function once per array element.
	@param callback {Function} Object to test against.
	@param thisObj {Object} What the callback method is bound to.
*/
	Array.prototype.forEach = function forEach(callback, thisObj) {
		var arrayObject = Object(this);
		// Mimic ES5 spec call for interanl method ToUint32()
		var i;
		var currentValue;

		if (typeof callback !== 'function') {
			throw new TypeError('No function object passed to forEach.');
		}

		for (i = 0; i < this.length; i += 1) {
			currentValue = arrayObject[i];
			callback.call(thisObj, currentValue, i, arrayObject);
		}
	};
}



if (!Array.prototype.indexOf) {
/**
	Returns the first (least) index of an element within the array equal to the specified value, or -1 if none is found.
	@param searchElement {Object} Element to locate in the array.
	@param fromIndex {Number} Optional; the index at which to begin the search. Defaults to 0, i.e. the whole array will be searched. If the index is greater than or equal to the length of the array, -1 is returned, i.e. the array will not be searched. If negative, it is taken as the offset from the end of the array. Note that even when the index is negative, the array is still searched from front to back. If the calculated index is less than 0, the whole array will be searched.
*/
	Array.prototype.indexOf = function indexOf(searchElement, fromIndex) {
		var startIndex = fromIndex || 0;
		var currentIndex = 0;

		if (startIndex < 0) {
			startIndex = this.length + fromIndex - 1;
			if (startIndex < 0) {
				throw 'Wrapped past beginning of array while looking up a negative start index.';
			}
		}

		for (currentIndex = 0; currentIndex < this.length; currentIndex++) {
			if (this[currentIndex] === searchElement) {
				return currentIndex;
			}
		}

		return (-1);
	};
}



if (!Array.prototype.lastIndexOf) {
/**
	<p>Returns thelast index at which a given element can be found in the array, or -1 if it is not present.
	The array is searched backwards, starting at fromIndex.</p>
	<p><em>It should be noted that the Prototype library also implementes a version of this polyfill that doesn't behave
	according exactly to the ECMA-262 5.1 spec. Where this version will default the `fromIndex` paramater to the
	array's length if `fromIndex > array.length`, the Prototype version will not and as a result will return a different value.
	Care should be taken when using this library in conjunction with Prototype as Prototype's version will override
	this version in non-supporting browsers if it is included in the application ahead of ac_base.js.</em></p>

	@param {Object} value The element to locate in the array.
	@param {Number} fromIndex Optional; The index at which to start searching backwards. Defaults to the array's length.
		If negative, it is taken as the offset from the end of the array. If the index is 0, -1 is returned; the array
		will not be searched.
	@returns {Number} Returns the last index at which the element can be found. Else, returns -1.
*/
	Array.prototype.lastIndexOf = function lastIndexOf(value, fromIndex) {
		var arrayObj = Object(this);
		// Mimic ES5 spec call for interanl method ToUint32()
		var len = arrayObj.length >>> 0;
		var i;
		fromIndex = parseInt(fromIndex, 10);

		// Return -1 if the array has no length
		if (len <= 0) {
			return -1;
		}

		// Is fromIndex provided? Set i accordingly if it is
		i = (typeof fromIndex === 'number') ? Math.min(len - 1, fromIndex) : len - 1;

		// Handle negative indices
		i = i >= 0 ? i : len - Math.abs(i);

		// Search backwards through array
		for (; i >= 0; i -= 1) {
			if (i in arrayObj && value === arrayObj[i]) {
				return i;
			}
		}

		return -1;

	};
}



if (!Array.prototype.map) {
/**
	<p>Calls a provided callback function once for each element in an array, in order, and constructs a new array from the results</p>
	<p>Usage:<p>
	<pre>
	var mapArray = ['foo', 'bar', 'baz'];
	var mapFunction = function (value) {
		return value + '_cat';
	}
	console.log(mapArray.map(mapFunction));
	</pre>
	@param {Function} callback The function to execute on each element in the array
	@param {Object} thisObj Optional; The object to use as `this` when executing the callback
	@returns {Object} A new array containing the results from the callback function.
		Array elements will be in the same order as the original array.
*/
	Array.prototype.map = function map(callback, thisObj) {
		var arrayObj = Object(this);
		// Mimic ES5 spec call for interanl method ToUint32()
		var len = arrayObj.length >>> 0;
		var i;
		var result = new Array(len);

		if (typeof callback !== 'function') {
			throw new TypeError(callback + ' is not a function');
		}

		for (i = 0; i < len; i += 1) {
			if (i in arrayObj) {
				result[i] = callback.call(thisObj, arrayObj[i], i, arrayObj);
			}
		}

		return result;
	};
}



if (!Array.prototype.reduce) {
/**
	<p>Applies an accumulation function to every value in an array from left to right and returns a single value.</p>
	<p>Usage:</p>
	<pre>
	var reduceArray = [1, 2, 3, 4, 5];
	var reduceFunction = function (previousValue, currentValue, index, array) {
		return previousValue + currentValue;
	};
	console.log(reduceArray.reduce(reduceFunction));
	</pre>
	@param {Function} callback The function to execute on each value in the array.
		<p><code>callback</code> takes four arguments:</p>
		<dl>
			<dt><strong>previousValue</strong></dt>
			<dd>The value previously returned by the last invocation of the callback, or <code>initialValue</code>, if supplied.</dd>
			<dt><strong>currentValue</strong></dt>
			<dd>The current array value being processed.</dd>
			<dt><strong>index</strong></dt>
			<dd>The index of the current array value being processed in the array.</dd>
			<dt><strong>array</strong></dt>
			<dd>The array <code>reduce</code> was called upon.</dd>
		</dl>
	@param {Mixed} initialValue Optional; If provided, then the first time the callback is called <code>initialValue</code> will be used
		as the value for <code>previousValue</code> and <code>currentValue</code> will be equal to the first value in the array. If not
		provided then <code>previousValue</code> will be equal to the first value in the array and <code>currentValue</code> will be
		equal to the second.
	@returns {Mixed} Reduce returns a single value that is the result of the accumulation function applied to each array element.
*/
	Array.prototype.reduce = function reduce(callback, initialValue) {
		var arrayObj = Object(this);
		// Mimic ES5 spec call for interanl method ToUint32()
		var len = arrayObj.length >>> 0;
		var i = 0;
		var result;

		// Callback must be a callable function
		if (typeof callback !== 'function') {
			throw new TypeError(callback + ' is not a function');
		}

		if (typeof initialValue === 'undefined') {
			if (!len) {
				// No value to return if we have an empty array and no initialValue
				throw new TypeError('Reduce of empty array with no initial value');
			}
			result = arrayObj[0];
			// Start at second element when initialValue is not provided
			i = 1;
		} else {
			result = initialValue;
		}

		while (i < len) {
			if (i in arrayObj) {
				result = callback.call(undefined, result, arrayObj[i], i, arrayObj);
				i += 1;
			}
		}

		return result;
	};
}

if (!Array.prototype.reduceRight) {
/**
	<p>Applies an accumulation function to every element in an array from right to left and returns a single value.</p>
	<p>Usage:</p>
	<pre>
	var reduceRightArray = ['foo', 'bar', 'baz'];
	var reduceRightFn = function (previousValue, currentValue, index, array) {
		return previousValue + '_' + currentValue;
	}
	console.log(reduceRightArray.reduceRight(reduceRightFn));
	</pre>
	@param {Function} callback The function to execute on each value in the array.
		<p><code>callback</code> takes four arguments:</p>
		<dl>
			<dt><strong>previousValue</strong></dt>
			<dd>The value previously returned by the last invocation of the callback, or <code>initialValue</code>, if supplied.</dd>
			<dt><strong>currentValue</strong></dt>
			<dd>The current element being processed in the array.</dd>
			<dt><strong>index</strong></dt>
			<dd>The index of the current element being processed in the array.</dd>
			<dt><strong>array</strong></dt>
			<dd>The array <code>reduce</code> was called upon.</dd>
		</dl>
	@param {Mixed} initialValue Optional; If provided, then the first time the callback is called <code>initialValue</code> will be used
		as the value for <code>previousValue</code> and <code>currentValue</code> will be equal to the last value in the array. If not
		provided then <code>previousValue</code> will be equal to the last value in the array and <code>currentValue</code> will be
		equal to the second to last value.
	@returns {Mixed} Reduce returns a single value that is the result of the accumulation function applied to each array element.
*/
	Array.prototype.reduceRight = function reduceRight(callback, initialValue) {
		var arrayObj = Object(this);
		// Mimic ES5 spec call for interanl method ToUint32()
		var len = arrayObj.length >>> 0;
		var i = len - 1;
		var result;

		// Callback must be a callable function
		if (typeof callback !== 'function') {
			throw new TypeError(callback + ' is not a function');
		}

		if (initialValue === undefined) {
			if (!len) {
				// No value to return if we have an empty array and no initialValue
				throw new TypeError('Reduce of empty array with no initial value');
			}
			result = arrayObj[len - 1];
			// Start at second to last element when initialValue is not provided
			i = len - 2;
		} else {
			result = initialValue;
		}

		while (i >= 0) {
			if (i in arrayObj) {
				result = callback.call(undefined, result, arrayObj[i], i, arrayObj);
				i -= 1;
			}
		}

		return result;
	};
}



if (!Array.prototype.some) {
/**
	Essentially the opposite of Array.prototype.every, Array.prototype.some calls a provided callback function once
	for each element in an array, until the callback function returns true.
	@param {Function} callback The fucntion to execute on each element in the array. The return value must evaluate to
	a boolean true in order for the entire method to return true.
	@param {Object} thisObj Optional; The object to use as `this` when executing the callback
	@returns {Boolean} true if the callback returns a true value, otherwise false.
*/
	Array.prototype.some = function some(callback, thisObj) {
		var arrayObj = Object(this);
		// Mimic ES5 spec call for interanl method ToUint32()
		var len = arrayObj.length >>> 0;
		var i;

		if (typeof callback !== 'function') {
			throw new TypeError(callback + ' is not a function');
		}

		for (i = 0; i < len; i += 1) {
			if (i in arrayObj && callback.call(thisObj, arrayObj[i], i, arrayObj) === true) {
				return true;
			}
		}

		return false;
	};
}



if (!Date.now) {
/**
	Returns the number of milliseconds elapsed since January 1, 1970 00:00:00 UTC
	@returns {Integer} The number of milliseconds elapsed since January 1, 1970 00:00:00 UTC
*/
	Date.now = function now() {
		return new Date().getTime();
	};
}



if (!Date.prototype.toISOString) {
/**
	<p>Returns a string from a Date object formatted per the ISO 8601 Extended Format.</p>
	<p><em>Please note that the Prototype library also polyfills this method. However their polyfill
	does not entirely adhere to the ES5 spec. The Prototype version fails to include the milliseconds
	and does not provide support for the extended year format. Be aware that if the Prototype library
	is included ahead of ac_base.js in your application, Prototype's version will take precedence
	on non-supporting browsers.</em></p>
	@returns {String} Returns a date string formatted per the ISO 8601 Extended format.
*/
	Date.prototype.toISOString = function toISOString() {
		if (!isFinite(this)) {
			throw new RangeError('Date.prototype.toISOString called on non-finite value.');
		}

		var parts = {
			'year': this.getUTCFullYear(),
			'month': this.getUTCMonth() + 1,
			'day': this.getUTCDate(),
			'hours': this.getUTCHours(),
			'minutes': this.getUTCMinutes(),
			'seconds': this.getUTCSeconds(),
			'mseconds': (this.getUTCMilliseconds() / 1000).toFixed(3).substr(2, 3)
		};
		var prop;
		var prefix;

		// Pad single digits with a leading 0
		for (prop in parts) {
			if (parts.hasOwnProperty(prop) && prop !== 'year' && prop !== 'mseconds') {
				parts[prop] = String(parts[prop]).length === 1 ? '0' + String(parts[prop]) : String(parts[prop]);
			}
		}

		// Support for extended years per 15.9.1.15.1 (http://www.ecma-international.org/publications/files/ECMA-ST/Ecma-262.pdf)
		if (parts.year < 0 || parts.year > 9999) {
			prefix = parts.year < 0 ? '-' : '+';
			parts.year = prefix + String(Math.abs(parts.year / 1000000)).substr(2, 6);
		}

		return parts.year + '-' + parts.month + '-' + parts.day + 'T' + parts.hours + ':' + parts.minutes + ':' + parts.seconds + '.' + parts.mseconds + 'Z';
	};

}


if (!Date.prototype.toJSON) {
/**
	<p>Provides a String representation of a Date object for use by JSON.stringify</p>
	<p><strong>Note 1:</strong> The toJSON method is intentionally generic; it does not require that its `this` value be a Date object.
	Therefore, it can be transferred to other kinds of objects for use as a method. However, it does require that
	any such object have a <code>toISOString</code> method. Full info can be found in the ES5 spec (15.9.5.44):
	http://www.ecma-international.org/publications/files/ECMA-ST/Ecma-262.pdf</p>
	<p><strong>Note 2:</strong> The Prototype library also polyfills this method. However their polyfill
	does not adhere to the ES5 spec. The Prototype version fails to include the ignored <code>key</code> argument,
	and only returns a call to <code>Date.toISOString()</code>. This is quite different from the behavior defined in the ES5 spec.
	Be aware that if the Prototype library is included ahead of ac_base.js in your application, Prototype's version
	will take precedence on non-supporting browsers.</p>
	@param {Mixed} key The key argument is ignored, however an object is free to use the <code>key</code>
		argument to filter its stringification.
	@returns {String} Returns a date string formatted per the ISO 8601 Extended format for use with JSON.stringify
*/
	Date.prototype.toJSON = function (key) {
		var obj = Object(this);
		var prim;

		// These primitive related functions simulate the required call to the internal ToPrimitive() construct per the ES5 spec.
		var isPrimitive = function (input) {
			var type = typeof input;

			var types = [null, 'undefined', 'boolean', 'string', 'number'].some(function (value) {
				return value === type;
			});

			if (types) {
				return true;
			}

			return false;
		};

		var toPrimitive = function (input) {
			var value;

			if (isPrimitive(input)) {
				return input;
			}

			value = (typeof input.valueOf === 'function') ? input.valueOf() : (typeof input.toString === 'function') ? input.toString() : null;

			if (value && isPrimitive(value)) {
				return value;
			}

			throw new TypeError(input + ' cannot be converted to a primitive');
		};

		prim = toPrimitive(obj);

		if (typeof prim === 'number' && !isFinite(prim)) {
			return null;
		}

		if (typeof obj.toISOString !== 'function') {
			throw new TypeError('toISOString is not callable');
		}

		return obj.toISOString.call(obj);
	};
}




if (!String.prototype.trim) {
/**
	Removes whitespace from both ends of the string.
*/
	String.prototype.trim = function trim() {
		return this.replace(/^\s+|\s+$/g, '');
	};
}



if (!Object.keys) {
/**
	Returns an array of strings representing all the enumerable property names of the object.
	@param {Object} Object who's keys to return.
*/
	Object.keys = function keys(obj) {
		var keysArray = [];
		var currentKey;

		if ((!obj) || (typeof obj.hasOwnProperty !== 'function')) {
			throw 'Object.keys called on non-object.';
		}

		for (currentKey in obj) {
			if (obj.hasOwnProperty(currentKey)) {
				keysArray.push(currentKey);
			}
		}

		return keysArray;
	};
}

//= require ../src/extensions/ecma_script_5_shim.js

// == JSON ==
// Fallback (for IE) to have JSON.stringify and JSON.parse methods
//
// From: https://github.com/douglascrockford/JSON-js/blob/master/json2.js
//
/*********************** JSON ***********************/
if(typeof JSON == "undefined" || !('stringify' in JSON && 'parse' in JSON)) {
	if(!this.JSON) {
		this.JSON = {};
	}(function() {
		function f(n) {
			return n < 10 ? "0" + n : n;
		}
		// Date.toJSON used to be polyfilled here. A version that adheres more closely to ES5 spec
		// has been since added to ecma_script_5_shim.js rendering this version obsolete.
		if(typeof String.prototype.toJSON !== "function") {
			String.prototype.toJSON = Number.prototype.toJSON = Boolean.prototype.toJSON = function(key) {
				return this.valueOf();
			};
		}
		var cx = /[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
			escapable = /[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
			gap, indent, meta = {
				"\b": "\\b",
				"\t": "\\t",
				"\n": "\\n",
				"\f": "\\f",
				"\r": "\\r",
				'"': '\\"',
				"\\": "\\\\"
			},
			rep;

		function quote(string) {
			escapable.lastIndex = 0;
			return escapable.test(string) ? '"' + string.replace(escapable, function(a) {
				var c = meta[a];
				return typeof c === "string" ? c : "\\u" + ("0000" + a.charCodeAt(0).toString(16)).slice(-4);
			}) + '"' : '"' + string + '"';
		}
		function str(key, holder) {
			var i, k, v, length, mind = gap,
				partial, value = holder[key];
			if(value && typeof value === "object" && typeof value.toJSON === "function") {
				value = value.toJSON(key);
			}
			if(typeof rep === "function") {
				value = rep.call(holder, key, value);
			}
			switch(typeof value) {
			case "string":
				return quote(value);
			case "number":
				return isFinite(value) ? String(value) : "null";
			case "boolean":
			case "null":
				return String(value);
			case "object":
				if(!value) {
					return "null";
				}
				gap += indent;
				partial = [];
				if(Object.prototype.toString.apply(value) === "[object Array]") {
					length = value.length;
					for(i = 0; i < length; i += 1) {
						partial[i] = str(i, value) || "null";
					}
					v = partial.length === 0 ? "[]" : gap ? "[\n" + gap + partial.join(",\n" + gap) + "\n" + mind + "]" : "[" + partial.join(",") + "]";
					gap = mind;
					return v;
				}
				if(rep && typeof rep === "object") {
					length = rep.length;
					for(i = 0; i < length; i += 1) {
						k = rep[i];
						if(typeof k === "string") {
							v = str(k, value);
							if(v) {
								partial.push(quote(k) + (gap ? ": " : ":") + v);
							}
						}
					}
				} else {
					for(k in value) {
						if(Object.hasOwnProperty.call(value, k)) {
							v = str(k, value);
							if(v) {
								partial.push(quote(k) + (gap ? ": " : ":") + v);
							}
						}
					}
				}
				v = partial.length === 0 ? "{}" : gap ? "{\n" + gap + partial.join(",\n" + gap) + "\n" + mind + "}" : "{" + partial.join(",") + "}";
				gap = mind;
				return v;
			}
		}
		if(typeof JSON.stringify !== "function") {
			JSON.stringify = function(value, replacer, space) {
				var i;
				gap = "";
				indent = "";
				if(typeof space === "number") {
					for(i = 0; i < space; i += 1) {
						indent += " ";
					}
				} else {
					if(typeof space === "string") {
						indent = space;
					}
				}
				rep = replacer;
				if(replacer && typeof replacer !== "function" && (typeof replacer !== "object" || typeof replacer.length !== "number")) {
					throw new Error("JSON.stringify");
				}
				return str("", {
					"": value
				});
			};
		}
		if(typeof JSON.parse !== "function") {
			JSON.parse = function(text, reviver) {
				var j;

				function walk(holder, key) {
					var k, v, value = holder[key];
					if(value && typeof value === "object") {
						for(k in value) {
							if(Object.hasOwnProperty.call(value, k)) {
								v = walk(value, k);
								if(v !== undefined) {
									value[k] = v;
								} else {
									delete value[k];
								}
							}
						}
					}
					return reviver.call(holder, key, value);
				}
				text = String(text);
				cx.lastIndex = 0;
				if(cx.test(text)) {
					text = text.replace(cx, function(a) {
						return "\\u" + ("0000" + a.charCodeAt(0).toString(16)).slice(-4);
					});
				}
				if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g, "@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, "]").replace(/(?:^|:|,)(?:\s*\[)+/g, ""))) {
					j = eval("(" + text + ")");
					return typeof reviver === "function" ? walk({
						"": j
					}, "") : j;
				}
				throw new SyntaxError("JSON.parse");
			}
		}
	}());
} /*********************** JSON ***********************/
/**
	matchMedia() polyfill - Test a CSS media type/query in JS. Authors & copyright (c) 2012: Scott Jehl, Paul Irish, Nicholas Zakas. Dual MIT/BSD license
*/
window.matchMedia = window.matchMedia || (function (doc, undefined) {

	var bool, docElem = doc.documentElement,
	    refNode = docElem.firstElementChild || docElem.firstChild,

	// fakeBody required for <FF4 when executed in <head>
	fakeBody = doc.createElement('body'),
	     div = doc.createElement('div');

	div.id = 'mq-test-1';
	div.style.cssText = "position:absolute;top:-100em";
	fakeBody.style.background = "none";
	fakeBody.appendChild(div);

	return function (q) {

		div.innerHTML = '&shy;<style media="' + q + '"> #mq-test-1 { width:42px; }</style>';

		docElem.insertBefore(fakeBody, refNode);
		bool = div.offsetWidth === 42;
		docElem.removeChild(fakeBody);

		return {
			matches: bool,
			media: q
		};
	};

}(document));

/**
	http://paulirish.com/2011/requestanimationframe-for-smart-animating/
	http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating
	requestAnimationFrame polyfill by Erik Möller
	fixes from Paul Irish and Tino Zijdel
	Modified to implement Date.now()
*/
(function () {
	var lastTime = 0;
	var vendors = ['ms', 'moz', 'webkit', 'o'];
	for (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {
		window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];
		window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] || window[vendors[x] + 'CancelRequestAnimationFrame'];
	}

	if (!window.requestAnimationFrame) window.requestAnimationFrame = function (callback, element) {
		var currTime = Date.now();
		var timeToCall = Math.max(0, 16 - (currTime - lastTime));
		var id = window.setTimeout(function () {
			callback(currTime + timeToCall);
		}, timeToCall);
		lastTime = currTime + timeToCall;
		return id;
	};

	if (!window.cancelAnimationFrame) window.cancelAnimationFrame = function (id) {
		clearTimeout(id);
	};
}());

window.XMLHttpRequest = window.XMLHttpRequest || function () {	
	var request;
	try {
		request = new ActiveXObject("Msxml2.XMLHTTP");
	// Couldn’t get newer MS-proprietary ActiveX object
	} catch (exception) { 
		try {
			request = new ActiveXObject("Microsoft.XMLHTTP");
		// Total XMLHTTP fail
		/*jshint -W002 */
		} catch (exception) {
			request = false;
		}
	}
	return request;
};

!function(){var a,b,c,d;!function(){var e={},f={};a=function(a,b,c){e[a]={deps:b,callback:c}},d=c=b=function(a){function c(b){if("."!==b.charAt(0))return b;for(var c=b.split("/"),d=a.split("/").slice(0,-1),e=0,f=c.length;f>e;e++){var g=c[e];if(".."===g)d.pop();else{if("."===g)continue;d.push(g)}}return d.join("/")}if(d._eak_seen=e,f[a])return f[a];if(f[a]={},!e[a])throw new Error("Could not find module "+a);for(var g,h=e[a],i=h.deps,j=h.callback,k=[],l=0,m=i.length;m>l;l++)"exports"===i[l]?k.push(g={}):k.push(b(c(i[l])));var n=j.apply(this,k);return f[a]=g||n}}(),a("promise/all",["./utils","exports"],function(a,b){"use strict";function c(a){var b=this;if(!d(a))throw new TypeError("You must pass an array to all.");return new b(function(b,c){function d(a){return function(b){f(a,b)}}function f(a,c){h[a]=c,0===--i&&b(h)}var g,h=[],i=a.length;0===i&&b([]);for(var j=0;j<a.length;j++)g=a[j],g&&e(g.then)?g.then(d(j),c):f(j,g)})}var d=a.isArray,e=a.isFunction;b.all=c}),a("promise/asap",["exports"],function(a){"use strict";function b(){return function(){process.nextTick(e)}}function c(){var a=0,b=new i(e),c=document.createTextNode("");return b.observe(c,{characterData:!0}),function(){c.data=a=++a%2}}function d(){return function(){j.setTimeout(e,1)}}function e(){for(var a=0;a<k.length;a++){var b=k[a],c=b[0],d=b[1];c(d)}k=[]}function f(a,b){var c=k.push([a,b]);1===c&&g()}var g,h="undefined"!=typeof window?window:{},i=h.MutationObserver||h.WebKitMutationObserver,j="undefined"!=typeof global?global:void 0===this?window:this,k=[];g="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?b():i?c():d(),a.asap=f}),a("promise/config",["exports"],function(a){"use strict";function b(a,b){return 2!==arguments.length?c[a]:(c[a]=b,void 0)}var c={instrument:!1};a.config=c,a.configure=b}),a("promise/polyfill",["./promise","./utils","exports"],function(a,b,c){"use strict";function d(){var a;a="undefined"!=typeof global?global:"undefined"!=typeof window&&window.document?window:self;var b="Promise"in a&&"resolve"in a.Promise&&"reject"in a.Promise&&"all"in a.Promise&&"race"in a.Promise&&function(){var b;return new a.Promise(function(a){b=a}),f(b)}();b||(a.Promise=e)}var e=a.Promise,f=b.isFunction;c.polyfill=d}),a("promise/promise",["./config","./utils","./all","./race","./resolve","./reject","./asap","exports"],function(a,b,c,d,e,f,g,h){"use strict";function i(a){if(!v(a))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof i))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._subscribers=[],j(a,this)}function j(a,b){function c(a){o(b,a)}function d(a){q(b,a)}try{a(c,d)}catch(e){d(e)}}function k(a,b,c,d){var e,f,g,h,i=v(c);if(i)try{e=c(d),g=!0}catch(j){h=!0,f=j}else e=d,g=!0;n(b,e)||(i&&g?o(b,e):h?q(b,f):a===D?o(b,e):a===E&&q(b,e))}function l(a,b,c,d){var e=a._subscribers,f=e.length;e[f]=b,e[f+D]=c,e[f+E]=d}function m(a,b){for(var c,d,e=a._subscribers,f=a._detail,g=0;g<e.length;g+=3)c=e[g],d=e[g+b],k(b,c,d,f);a._subscribers=null}function n(a,b){var c,d=null;try{if(a===b)throw new TypeError("A promises callback cannot return that same promise.");if(u(b)&&(d=b.then,v(d)))return d.call(b,function(d){return c?!0:(c=!0,b!==d?o(a,d):p(a,d),void 0)},function(b){return c?!0:(c=!0,q(a,b),void 0)}),!0}catch(e){return c?!0:(q(a,e),!0)}return!1}function o(a,b){a===b?p(a,b):n(a,b)||p(a,b)}function p(a,b){a._state===B&&(a._state=C,a._detail=b,t.async(r,a))}function q(a,b){a._state===B&&(a._state=C,a._detail=b,t.async(s,a))}function r(a){m(a,a._state=D)}function s(a){m(a,a._state=E)}var t=a.config,u=(a.configure,b.objectOrFunction),v=b.isFunction,w=(b.now,c.all),x=d.race,y=e.resolve,z=f.reject,A=g.asap;t.async=A;var B=void 0,C=0,D=1,E=2;i.prototype={constructor:i,_state:void 0,_detail:void 0,_subscribers:void 0,then:function(a,b){var c=this,d=new this.constructor(function(){});if(this._state){var e=arguments;t.async(function(){k(c._state,d,e[c._state-1],c._detail)})}else l(this,d,a,b);return d},"catch":function(a){return this.then(null,a)}},i.all=w,i.race=x,i.resolve=y,i.reject=z,h.Promise=i}),a("promise/race",["./utils","exports"],function(a,b){"use strict";function c(a){var b=this;if(!d(a))throw new TypeError("You must pass an array to race.");return new b(function(b,c){for(var d,e=0;e<a.length;e++)d=a[e],d&&"function"==typeof d.then?d.then(b,c):b(d)})}var d=a.isArray;b.race=c}),a("promise/reject",["exports"],function(a){"use strict";function b(a){var b=this;return new b(function(b,c){c(a)})}a.reject=b}),a("promise/resolve",["exports"],function(a){"use strict";function b(a){if(a&&"object"==typeof a&&a.constructor===this)return a;var b=this;return new b(function(b){b(a)})}a.resolve=b}),a("promise/utils",["exports"],function(a){"use strict";function b(a){return c(a)||"object"==typeof a&&null!==a}function c(a){return"function"==typeof a}function d(a){return"[object Array]"===Object.prototype.toString.call(a)}var e=Date.now||function(){return(new Date).getTime()};a.objectOrFunction=b,a.isFunction=c,a.isArray=d,a.now=e}),b("promise/polyfill").polyfill()}();
}).call(this,require('_process'),typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"_process":796}],702:[function(require,module,exports){
/**
 * Provides the class {@link AssetLoader}.
 * @module ac-asset-loader
 * @since 1.0
 */

require('ac-polyfills');

module.exports.Asset              	= require('./ac-asset-loader/AssetLoader/Asset');
module.exports.Asset.Ajax           = require('./ac-asset-loader/AssetLoader/Asset/Ajax');
module.exports.Asset.Ajax.JSON      = require('./ac-asset-loader/AssetLoader/Asset/Ajax/JSON');
module.exports.Asset.Img            = require('./ac-asset-loader/AssetLoader/Asset/Img');
module.exports.Asset.Video          = require('./ac-asset-loader/AssetLoader/Asset/Video');
module.exports.Asset.Video.Element  = require('./ac-asset-loader/AssetLoader/Asset/Video/Element');
module.exports.Asset.Binary         = require('./ac-asset-loader/AssetLoader/Asset/Binary');
module.exports.Asset.Binary.Chunk   = require('./ac-asset-loader/AssetLoader/Asset/Binary/Chunk');
module.exports.AssetLoader          = require('./ac-asset-loader/AssetLoader');
module.exports.AssetLoader.Queue    = require('./ac-asset-loader/AssetLoader/Queue');

},{"./ac-asset-loader/AssetLoader":703,"./ac-asset-loader/AssetLoader/Asset":704,"./ac-asset-loader/AssetLoader/Asset/Ajax":705,"./ac-asset-loader/AssetLoader/Asset/Ajax/JSON":706,"./ac-asset-loader/AssetLoader/Asset/Binary":707,"./ac-asset-loader/AssetLoader/Asset/Binary/Chunk":708,"./ac-asset-loader/AssetLoader/Asset/Img":709,"./ac-asset-loader/AssetLoader/Asset/Video":712,"./ac-asset-loader/AssetLoader/Asset/Video/Element":713,"./ac-asset-loader/AssetLoader/Queue":714,"ac-polyfills":701}],703:[function(require,module,exports){
'use strict';

var proto;

var ac_Object    = require('ac-object');
var EventEmitter = require('ac-event-emitter').EventEmitter;

var Asset_Ajax      = require('./AssetLoader/Asset/Ajax');
var Asset_Ajax_JSON = require('./AssetLoader/Asset/Ajax/JSON');
var Asset_Img       = require('./AssetLoader/Asset/Img');
var Asset_Video     = require('./AssetLoader/Asset/Video');
var destroy         = require('../utils/destroy');
var Queue           = require('./AssetLoader/Queue');

var defaults = {
};

/**
 * Promises based asset loader to manage loading assets.
 * @class AssetLoader
 *
 * @param {Array|String} assets Url(s) of asset(s).
 * @param {String} [type='img'] Type of assets to load.
 *
 * @property {Array} _queue Array of Urls of assets to load.
 * @property {String} _type The type of assets being loaded, for example 'img'.
 * @property {Array} _assetsLoaded Array of DOM elements of the loaded assets. The order of which is the same as _queue.
 * @property {Integer} _assetsCountLoaded Number of assets currently loaded.
 * @property {Integer} _assetsResolvedCount Number of assets currently loaded or failed.
 * @property {defer.Deferred} _defer The AssetLoader Deferred object.
 *
 * @example
 * var AssetLoader = require('ac-asset/AssetLoader');
 * var loader = new AssetLoader(['http://images.apple.com/cn/osx/elcapitan-preview/static/zh_CN/scripts/img1.jpg', 'http://images.apple.com/cn/osx/elcapitan-preview/static/zh_CN/scripts/img2.jpg'], 'img');
 * loader.load().then(success, failure, progress);
 */
function AssetLoader(srcs, options) {
	this.options = ac_Object.defaults(defaults, options || {});

	var assets = this._generateAssets(srcs);

	this._queue = new Queue(assets, this.options);

	this._timeoutDuration = this.options.timeout;
	this._timeout = null;

	this._proxyListeners();
}

proto = AssetLoader.prototype = new EventEmitter();


/**
 * Initiates loading of all the assets.
 * @function AssetLoader#load
 *
 * @return {defer.Promise} Promise receives the following messages:
 *
 *  * **Resolved** ([*DOMElements*...]) on successful loading of all assets (Array of elements is in the same order as originally specified).
 *  * **Rejected** (*String*) as src on a failure to load an asset.
 */
proto.load = function () {

	if (this._timeoutDuration) {
		this._timeout = window.setTimeout(this._onTimeout.bind(this), this._timeoutDuration);
	}

	return this._queue.start();
};

proto._clearTimeout = function () {
	window.clearTimeout(this._timeout);
	this._timeout = null;
};

proto.pause = function () {
	this._clearTimeout();

	return this._queue.pause();
};

proto.destroy = function () {
	destroy(this, true);
};

proto._onTimeout = function () {
	this._queue.abort();
	this._queue.destroy();
	this.trigger('timeout');
};

proto._generateAssets = function (srcs) {
	if (this._boundGenerateAsset === undefined) {
		this._boundGenerateAsset = this._generateAsset.bind(this);
	}

	srcs = [].concat(srcs);

	var assets = srcs.map(this._boundGenerateAsset);

	return assets;
};

/**
 * @inner
 *
 * @desc generate a single Asset instance from a source
 *
 * @param {Mixed} src Asset instance or an object that represents the source of an Asset
 * @param {Integer} index The index of this item
 *
 * @return {Asset | null} The Asset for the provided source
 *
 */
proto._generateAsset = function (src, index) {
	// If it’s already an Asset
	if (AssetLoader.isValidAsset(src)) {
		src.index = index;
		return src;
	}

	if (typeof src !== 'string' || src === '') {
		return null;
	}

	if (!!src.match(/\.json$/)) {
		return new Asset_Ajax_JSON(src, index);
	}

	if (!!src.match(/\.(xml|txt)$/)) {
		return new Asset_Ajax(src, index);
	}

	// TODO Support video

	return new Asset_Img(src, index);
};

/**
 * @inner
 *
 * @description Pass the events from the queue, which is private, to the AssetLoader instance.
 * Allows us to hook into these events as well, and potentially modify the data.
 *
 */
proto._proxyListeners = function () {
	this._boundOnResolved = this._onResolved.bind(this);
	this._boundOnRejected = this._onRejected.bind(this);
	this._boundOnProgress = this._onProgress.bind(this);

	this._queue.on('resolved', this._boundOnResolved);
	this._queue.on('rejected', this._boundOnRejected);
	this._queue.on('progress', this._boundOnProgress);
};

/**
 * @inner
 *
 * @description  When the queue resolves
 */
proto._onResolved = function (data) {
	this._clearTimeout();
	this.trigger('loaded', data);
};

/**
 * @inner
 *
 * @description When the queue gets rejected
 *
 */
proto._onRejected = function (data) {
	this.trigger('error', data);
};

/**
 * @inner
 *
 * @description When the queue finishes loading a single Asset
 *
 */
proto._onProgress = function (data) {
	this.trigger('progress', data);
};


/**
 * Determines whether a passed object matches the API for a valid Asset Object
 * @param  {Object}  asset Object to check to see if it is valid as an Asset
 * @return {Boolean}
 */
AssetLoader.isValidAsset = function (asset) {
	return !!(asset && (typeof asset.load === 'function') && (typeof asset.destroy === 'function'));
};


/**
 * Determines whether a passed object matches the API for a valid AssetLoader Object
 * @param  {Object}  assetLoader Object to check to see if it is valid as an AssetLoader
 * @return {Boolean}
 */
AssetLoader.isValidAssetLoader = function (assetLoader) {
	return !!(assetLoader && (typeof assetLoader.load === 'function') && (typeof assetLoader.pause === 'function') && (typeof assetLoader.destroy === 'function'));
};


module.exports = AssetLoader;

},{"../utils/destroy":715,"./AssetLoader/Asset/Ajax":705,"./AssetLoader/Asset/Ajax/JSON":706,"./AssetLoader/Asset/Img":709,"./AssetLoader/Asset/Video":712,"./AssetLoader/Queue":714,"ac-event-emitter":726,"ac-object":760}],704:[function(require,module,exports){
'use strict';

var proto;

var Deferred = require('ac-deferred').Deferred;
var EventEmitter = require('ac-event-emitter').EventEmitter;

var destroy = require('../../utils/destroy');

/**
 * @class AssetLoader.Asset
 */
function Asset(src, index) {
	this.src = src;
	this.index = index;
	this.data = null;

	this._boundOnLoad  = this._onLoad.bind(this);
	this._boundOnError = this._onError.bind(this);
}

proto = Asset.prototype = new EventEmitter();

proto.load = function () {
	this._load();
};


/**
 * @inner
 *
 * Make Asset garbage collection-friendly
 *
 */
proto.destroy = function () {
	destroy(this);
};


/**
 * @inner
 *
 * Stubbed for inheritance
 *
 */
proto._load = function () {
	// Stubbed data for testing
	this.data = {
		src: this.src
	};

	window.setTimeout(this._onLoad.bind(this), 20);
};


/**
 * @inner
 *
 * Ran when the _load method completes successfully
 *
 */
proto._onLoad = function () {
	this.trigger('loaded', this);
};


/**
 * @inner
 *
 * Ran when the _load method errs out
 *
 */
proto._onError = function () {
	this.trigger('error', this.data);
};

module.exports = Asset;

},{"../../utils/destroy":715,"ac-deferred":723,"ac-event-emitter":726}],705:[function(require,module,exports){
'use strict';

var proto;

var ac_Ajax   = require('ac-ajax');
var ac_Object = require('ac-object');
var Super     = require('../Asset');

/**
 * @class AssetLoader.Asset.Ajax
 */
function Ajax(src, index) {
	Super.apply(this, arguments);
}

proto = Ajax.prototype = ac_Object.create(Super.prototype);

/**
 * @inner
 */
proto._load = function () {
	ac_Ajax.get({
		'url': this.src
	}).then(this._boundOnLoad, this._boundOnError);
};

/**
 * @inner
 */
proto._onLoad = function (xhr) {
	this.data = xhr.response;

	Super.prototype._onLoad.call(this);
};

module.exports = Ajax;

},{"../Asset":704,"ac-ajax":697,"ac-object":760}],706:[function(require,module,exports){
'use strict';

var proto;

var ac_Object = require('ac-object');
var Super     = require('../Ajax');

/**
 * @class AssetLoader.Asset.Ajax.Asset_JSON
 */
function Asset_JSON(src) {
	Super.apply(this, arguments);
}

proto = Asset_JSON.prototype = ac_Object.create(Super.prototype);

/**
 * @inner
 */
proto._onLoad = function (xhr) {
	try {
		Super.prototype._onLoad.call(this, {
			response: JSON.parse(xhr.response)
		});
	} catch (err) {
		this._onError(err);
	}
};

module.exports = Asset_JSON;

},{"../Ajax":705,"ac-object":760}],707:[function(require,module,exports){
'use strict';

var ac_Ajax   = require('ac-ajax');
var ac_Object = require('ac-object');
var Chunk     = require('./Binary/Chunk');
var Super     = require('./../Asset');

var defaults = {
	chunkSize: 1024 * 1024 // 1mb
};

function Binary(src, options) {
	Super.apply(this, arguments);

	this.options = ac_Object.defaults(defaults, options || {});

	this._totalSize = null;
	this._rangeObjects = {};
	this._contentType = null;
	this._request = null;
	this._numLoaded = 0;
	this._numRanges = 0;
}

var proto = Binary.prototype = ac_Object.create(Super.prototype);


proto.pause = function () {
	var lower;

	// If there is an active xhr request (for metadata)
	if (this._request !== null) {
		this._request.xhr.abort();
	}

	for(lower in this._rangeObjects) {
		if(this._rangeObjects[lower].isLoaded() === false) {
			this._rangeObjects[lower].pause();
		}
	}
};


proto._load = function () {
	if (this._boundQueueRangeRequests === undefined) {
		this._boundQueueRangeRequests = this._queueRangeRequests.bind(this);
	}

	// If we don’t have metadata yet
	if (this._totalSize === null) {
		this._getMetaData().then(this._boundQueueRangeRequests);

	// If we already have metada, for instance if this was paused and started again
	} else {
		this._queueRangeRequests();
	}
};


proto._getOrCreateRangeObject = function (lower) {
	var range = this._rangeObjects[lower.toString()];
	var byteLength;
	var upperRange;


	if (range === undefined) {
		byteLength = (this.options.chunkSize - 1);
		upperRange = lower + byteLength;


		if (upperRange > this._totalSize) {
			byteLength = null;
		}


		range = this._rangeObjects[lower.toString()] = new Chunk(this.src, {
			start: lower,
			length: byteLength
		});

		this._numRanges += 1;
	}

	return range;
};


proto._onRangeLoad = function () {
	this._numLoaded += 1;

	if (this._numLoaded === this._numRanges) {
		this._afterAllChunksLoaded();
	}
};

proto._queueRangeRequests = function () {
	var upperRange;
	var promises = [];
	var promise;
	var upperRangeString;
	var range;

	for(var i = 0; i < this._totalSize; i += this.options.chunkSize) {
		range = this._getOrCreateRangeObject(i);

		range.on('loaded', this._onRangeLoad, this);

		range.load();
	}
};


proto._afterAllChunksLoaded = function () {
	var blob;

	var chunks = [];

	for(var lower in this._rangeObjects) {
		chunks.push(this._rangeObjects[lower].data);
	}

	blob = new Blob(chunks, {
		type: this._contentType
	});

	this.trigger('loaded', blob);
};


proto._afterHeadRequest = function (responseData) {
	this._totalSize = parseInt(responseData.getResponseHeader(['Content-Length']));
	this._contentType = responseData.getResponseHeader(['Content-Type']);
	this._request = null;
};


proto._getMetaData = function () {
	if (!this._boundAfterHeadRequest) {
		this._boundAfterHeadRequest = this._afterHeadRequest.bind(this);
	}

	this._request = ac_Ajax.create({
		method: 'HEAD',
		url: this.src,
		timeout: 2 * 1000 // 2s
	});

	return this._request.send().then(this._boundAfterHeadRequest, this._boundOnError);

};


module.exports = Binary;

},{"./../Asset":704,"./Binary/Chunk":708,"ac-ajax":697,"ac-object":760}],708:[function(require,module,exports){
'use strict';

var proto;

var ac_Ajax   = require('ac-ajax');
var ac_Object = require('ac-object');

var Super = require('../../Asset');

var defaults = {
	start: 0,
	length: null
};

function Chunk(src, options) {
	Super.apply(this, arguments);

	this.options = ac_Object.defaults(defaults, options || {});

	this._request = null;
	this.data = null;
}

proto = Chunk.prototype = ac_Object.create(Super.prototype);

proto.pause = function () {
	if (this._request !== null) {
		this._request.xhr.abort();
		this._request = null;
	}
};


proto.isLoaded = function () {
	return (this.data !== null);
};


proto._load = function () {

	this._request = ac_Ajax.create({
		url: this.src + '?' + this._buildQueryString(),
		method: 'get',
		timeout: 30 * 1000, // 30s
		headers: [{
			name:'Range',
			value:this._buildRangeString()
		}]
	});

	this._request.xhr.responseType = 'arraybuffer';

	this._request.send()
		.then(this._boundOnLoad);
};


proto._onLoad = function (xhr) {
	this.data = xhr.response;
	this._request = null;

	Super.prototype._onLoad.call(this, this.data);
};


proto._buildRangeString = function () {
	var rangeString = 'bytes=' + this.options.start + '-';

	if (this.options.length !== null) {
		rangeString += (this.options.start + this.options.length);
	}

	return rangeString;
};


proto._buildQueryString = function () {
	var queryString = this.options.start.toString();

	if (this.options.length !== undefined) {
		queryString += (this.options.start + this.options.length);
	}

	return queryString;
};


module.exports = Chunk;

},{"../../Asset":704,"ac-ajax":697,"ac-object":760}],709:[function(require,module,exports){
'use strict';

var proto;

var ac_Object = require('ac-object');
var Super     = require('../Asset');

/**
 * @class AssetLoader.Asset.Img
 */
function Img(src, index) {
	Super.apply(this, arguments);
}

proto = Img.prototype = ac_Object.create(Super.prototype);

/**
 * @inner
 */
proto._load = function () {
	var img = new Image();

	this.data = img;

	this._boundOnLoad = this._onLoad.bind(this);

	img.onload = this._boundOnLoad;
	img.onerror = this._boundOnError;

	img.src = this.src;
};

module.exports = Img;

},{"../Asset":704,"ac-object":760}],710:[function(require,module,exports){
'use strict';

var ac_Ajax = require('ac-ajax').Ajax,
	ac_Object = require('ac-object'),
	Chunk = require('./SplitFile/Chunk'),
	Asset = require('../Asset');

var proto;

var defaults = {
	splitManifestTimeout: 5000,
	splitChunkTimeout: null
};

var SplitFile = function( src, options ) {
	Asset.apply( this, arguments );

	// add a trailing slash to src if not added
	if ( src.lastIndexOf('/') !== src.length - 1 ) {
		src = src + '/';
	}

	this.options = ac_Object.extend(defaults, options || {});
	this._manifestPath = src + 'manifest.json';
	this._ajax = new ac_Ajax();
	this._request = null;
	this._chunksLoaded = 0;
	this._chunksLen = null;

	this._chunks = [];

	this._boundOnManifestLoaded = this._onManifestLoaded.bind( this );
};

proto = SplitFile.prototype = ac_Object.create( Asset.prototype );

proto._load = function() {
	var config = {
		method: 'get',
		url: this._manifestPath,
		timeout: this.options.manifestTimeout
	};

	this._request = this._ajax.create( config );
	this._request.send().then( this._boundOnManifestLoaded );
};

proto._onManifestLoaded = function( xhr ) {
	// save manifest data
	this._manifest = JSON.parse( xhr.responseText );

	// save the number of files we request
	this._chunksLen = this._manifest.files.length;

	// create (or get) chunks and request them
	var i,
		files = this._manifest.files,
		file,
		len = this._chunksLen;
	for ( i = 0; i < len; i++ ) {
		file = this._getOrCreateChunkObject( files[ i ], i );
		file.once( 'loaded', this._onChunkLoaded, this );
		file.load();
	}

	this._request = null;
	this._ajax = null;
};

proto._getOrCreateChunkObject = function( file, idx ) {
	var opts = this.options.splitChunkTimeout ? { timeout: this.options.splitChunkTimeout } : null;

	// file chunk objects are stored by their path
	if ( !this._chunks[ idx ] ) {
		var path = file.path;

		if ( !path.match(/(^http(s?))/)) {
			path = this.src + '/' + path;
		} else if ( !!this.src.match(/(^http(s?))/)) {
			var pathSlashIdx = path.indexOf( '/', 10 );
			var srcSlashIdx = this.src.indexOf( '/', 10 );

			path = this.src.substring(0, srcSlashIdx) + path.substring(pathSlashIdx);
		}

		this._chunks[ idx ] = new Chunk( path, opts );
	}

	return this._chunks[ idx ];
};

proto._onChunkLoaded = function() {
	this._chunksLoaded++;

	if ( this._chunksLoaded === this._chunksLen ) {

		var i,
			len = this._chunks.length,
			chunkData = [];
		for ( i = 0; i < len; i++ ) {
			chunkData.push( this._chunks[ i ].data );
			// remove any old bindings on the chunks
			this._chunks[ i ].off();
		}

		// create a Blob that refers to the data object
		this.data = new Blob( chunkData, {
			type: this._manifest.mimeType
		});

		//cleanup old data
		chunkData = this._chunks = null;

		// trigger complete
		this.trigger( 'loaded', this.data );
	}
};

// actually more of a kill everything method
proto.pause = function () {
	if (this._request !== null) {
		if (this._request.xhr !== null) {
			this._request.xhr.abort();
		}
		this._request = null;
	}
	this.data = null;
	this._chunks = null;
};


module.exports = SplitFile;

},{"../Asset":704,"./SplitFile/Chunk":711,"ac-ajax":697,"ac-object":760}],711:[function(require,module,exports){
'use strict';

var proto;

var ac_Ajax   = require('ac-ajax');
var ac_Object = require('ac-object');

var Asset = require('../../Asset');

var defaults = {
	timeout: 30 * 1000 // 30s
};

function Chunk(src, options) {
	Asset.apply(this, arguments);

	this.options = ac_Object.extend(defaults, options || {});

	this._request = null;
	this.data = null;
}

proto = Chunk.prototype = ac_Object.create( Asset.prototype );

proto.pause = function () {
	if (this._request !== null) {
		this._request.xhr.abort();
		this._request = null;
	}
};


proto.isLoaded = function () {
	return (this.data !== null);
};


proto._load = function () {

	this._request = ac_Ajax.create({
		url: this.src,
		method: 'get',
		timeout: this.options.timeout
	});

	this._request.xhr.responseType = 'arraybuffer';

	this._request.send()
		.then(this._boundOnLoad);
};


proto._onLoad = function (xhr) {
	this.data = xhr.response;
	this._request = null;

	Asset.prototype._onLoad.call(this, this.data);
};

module.exports = Chunk;

},{"../../Asset":704,"ac-ajax":697,"ac-object":760}],712:[function(require,module,exports){
'use strict';

var proto;

var ac_Feature         = require('ac-feature');
var ac_Object          = require('ac-object');
var Binary             = require('./Binary');
var Super              = require('../Asset');
var VideoElementLoader = require('./Video/Element');
var SplitFile		   = require('./SplitFile');

var defaults = {
	chunkSize: 1024 * 1024, // 1mb,
	forceElementLoading : false,
	split : false
};

function Video (src, options) {
	Super.apply(this, arguments);

	this.options = ac_Object.defaults(defaults, options || {});

	this._binary = this.options.binary || this._createAssetType();

}

proto = Video.prototype = ac_Object.create(Super.prototype);

proto._canUseBlob = function () {
	return (
		window.Blob !== undefined &&
		window.URL !== undefined &&
		typeof window.URL.createObjectURL === 'function' &&
		ac_Feature.isDesktop() === true
	);
};

proto._createAssetType = function () {
	if (this._canUseBlob() && this.options.forceElementLoading !== true ) {

		if ( this.options.split ) {
			return new SplitFile( this.src, this.options );
		}

		return  new Binary(this.src, this.options);
	}

	return new VideoElementLoader(this.src, this.options);

};

proto._load = function () {
	this._binary.on('loaded', this._boundOnLoad);
	this._binary.on('error', this._boundOnError);

	this._binary.load();
};

proto._onLoad = function (data) {
	var video = data;
	// if this is a Blob and not a native load
	if ( data instanceof window.Blob ) {
		video = this.options.element;

		if (!video) {
			video = document.createElement('video');
		}

		if (video.getAttribute('type') !== data.type) {
			video.setAttribute('type', data.type);
		}

		video.src = window.URL.createObjectURL(data);
	}

	Super.prototype._onLoad.call(this, video);
};

proto.pause = function () {
	this._binary.pause();
};

proto.destroy = function () {
	this._binary.destroy();

	Super.prototype.destroy.call(this);
};

module.exports = Video;

},{"../Asset":704,"./Binary":707,"./SplitFile":710,"./Video/Element":713,"ac-feature":698,"ac-object":760}],713:[function(require,module,exports){
'use strict';

var ac_Feature = require('ac-feature');
var ac_Object  = require('ac-object');
var round      = require('./../../../../utils/round');
var Super      = require('./../../Asset');

var defaults = {};

function VideoElementLoader (src, options) {
	Super.apply(this, arguments);

	this.options = ac_Object.defaults(defaults, options || {});
	this._boundOnVideoProgress = null;
	this._boundOnTimeUpdate = null;
	this._boundOnCanPlayThrough = null;
	this._videoDuration = null;

};

var proto = VideoElementLoader.prototype = ac_Object.create(Super.prototype);


proto._onVideoProgress = function (e) {

	if (this.data && this.data.buffered.length > 0 && this._videoDuration && round(this.data.buffered.end(0), 4) === round(this._videoDuration, 4)) {

		this._unbindEvent('canplaythrough', this._boundOnCanPlayThrough);
		this._unbindEvent('timeupdate', this._boundOnTimeUpdate);
		this._unbindEvent('progress', this._boundOnVideoProgress);
		this._unbindEvent('loadedmetadata', this._boundMetaDataLoaded);

		this._boundOnVideoProgress = null;
		this.data.muted = false;

		this._onLoad();

	}
};

proto._onTimeUpdate = function (e) {
	this.data.pause();
	this.data.currentTime = 0;
	this.data.removeEventListener('timeupdate', this._boundOnTimeUpdate);
	this._boundOnTimeUpdate = null;
};

proto._onCanPlayThrough = function (e) {

	if (this._boundOnTimeUpdate === null) {
		this._boundOnTimeUpdate = this._onTimeUpdate.bind(this);
	}

	if (ac_Feature.isDesktop()) {
		this.data.addEventListener('timeupdate', this._boundOnTimeUpdate);

		this.data.play();
	}

	this._unbindEvent('canplaythrough', this._boundOnCanPlayThrough);
	this._boundOnCanPlayThrough = null;
};

proto._onMetaDataLoaded = function (e) {
	this._videoDuration = this.data.duration;
	this._onVideoProgress(e);
};

proto._load = function () {

	this.data = this.options.element;

	if (!this.data) {
		this.data = document.createElement('video');
	}

	this.data.muted = true;

	if (this.options.type) {
		this.data.setAttribute('type', this.options.type);
	}

	if (this._boundOnVideoProgress === null) {
		this._boundOnVideoProgress = this._onVideoProgress.bind(this);
		this._boundOnCanPlayThrough = this._onCanPlayThrough.bind(this);
		this._boundMetaDataLoaded = this._onMetaDataLoaded.bind(this);

		this.data.addEventListener('progress', this._boundOnVideoProgress);
		this.data.addEventListener('canplaythrough', this._boundOnCanPlayThrough);
		this.data.addEventListener('loadedmetadata', this._boundMetaDataLoaded);
	}

	this.data.setAttribute('preload', 'auto');

	this.data.src = this.src;
	this.data.load();

};

proto._unbindEvent = function (eventName, handler) {
	if (typeof handler === 'function') {
		this.data.removeEventListener(eventName, handler);
	}
};

proto.pause = function () {
	this._unbindEvent('canplaythrough', this._boundOnCanPlayThrough);
	this._unbindEvent('timeupdate', this._boundOnTimeUpdate);
	this._unbindEvent('progress', this._boundOnVideoProgress);
	this._unbindEvent('loadedmetadata', this._boundMetaDataLoaded);

	this._boundOnVideoProgress = null;
	this._boundOnCanPlayThrough = null;
	this._boundOnTimeUpdate = null;
	this._boundMetaDataLoaded = null;


	this.data.removeAttribute('src');
	this.data = undefined;

	this.trigger('pause');
};


module.exports = VideoElementLoader;

},{"./../../../../utils/round":716,"./../../Asset":704,"ac-feature":698,"ac-object":760}],714:[function(require,module,exports){
'use strict';

var proto;

var ac_Object    = require('ac-object');
var Deferred     = require('ac-deferred').Deferred;
var EventEmitter = require('ac-event-emitter').EventEmitter;

var destroy = require('../../utils/destroy');

var defaults = {
	threads: 4
};


/**
 * Promises based asset loader to manage loading assets.
 * @class AssetLoader.Queue
 *
 */
function Queue(assets, options) {
	this.options = ac_Object.defaults(defaults, options || {});

	// Store list of assets as src queue
	this._queue = assets;

	this._active = [];

	// Set the number of open threads to the number of allowed threads
	this._allowedThreads = this.options.threads;
	this._availableThreads = this._allowedThreads;

	// Store a deferred object for when the whole queue is loaded
	this._deferred = new Deferred();

	// Store data for when we resolve
	this._data = [];

	// Starts paused
	this.paused = true;
	this.loaded = false;

	// Expose promise
	this.promise = this._deferred.promise();
}

proto = Queue.prototype = new EventEmitter();


proto.start = function () {
	var availableThreads = this._availableThreads;
	var i;

	this.paused = false;

	// If there are more threads than assets, then we don't need extra threads to kick off
	if (availableThreads > this._queue.length) {
		availableThreads = this._queue.length;
	}

	// Start a thread for each available one
	for (i = 1; i <= availableThreads; i++) {
		this._startNewThread();
	}

	return this.promise;
};


proto.pause = function () {
	this.paused = true;
	var toRemove = [];

	this._active.forEach(function (asset, index) {
		if (typeof asset.pause === 'function') {
			this._queue.unshift(asset); // pop it back on the queue
			this._releaseThread();
			asset.off('loaded');
			asset.off('error');
			asset.pause();
			toRemove.push(index);
		}
	}, this);


	toRemove.forEach(function (assetIndex) {
		this._active.splice(assetIndex, 1);
	}, this);

};


/**
 * @todo if there are threads open, they will err out on resolve/reject
 * How do we nullify the promise?
 */
proto.destroy = function () {
	// Pause loading
	this.pause();

	destroy(this);
};


proto._startNewThread = function () {
	// Get the next src in the queue
	var asset = this._queue.shift();

	// Reserve a thread for this asset
	this._occupyThread();

	// Load the asset
	if (asset && typeof asset.load === 'function') {
		var onLoad = function (data) {
			this._onProgress(data);
			this._active.splice(this._active.indexOf(asset), 1);
			asset.off('error', onError);
		};

		var onError = function (data) {
			this._onError();
			asset.off('loaded', onLoad);
		};


		asset.once('loaded', onLoad, this);
		asset.once('error', onError, this);

		asset.load();

	// If the asset is invalid, reject it
	} else {
		this._onError();
	}

	this._active.push(asset);
};


/**
 * @inner
 *
 * Ran when all assets are loaded
 *
 */
proto._onResolved = function () {
	if (this._errored) {
		return false;
	}

	this._deferred.resolve(this._data);
	this.trigger('resolved', this._data);
};


/**
 * @inner
 *
 * Ran when a single source fails
 *
 */
proto._onError = function (data) {
	if (this._errored) {
		return false;
	}

	this._errored = true;
	this._deferred.reject(data);

	this.trigger('rejected', data);
};


proto.abort = function () {
	this._deferred.reject();
};


/**
 * @inner
 *
 * Ran as the `resolved` method of a promise. Stores that promise’s data in an array.
 *
 */
proto._onProgress = function (asset) {
	if (this._errored) {
		return false;
	}

	this._releaseThread();
	this._data[asset.index] = asset.data;

	this.trigger('progress', asset.data);

	// If there are no more items in the queue
	if (this._queue.length <= 0) {
		// And all of our threads have finished working
		if (this._availableThreads >= this._allowedThreads) {
			this._onResolved();

		// If we have threads that we are waiting to come back
		// } else {
		}

	} else if (!this.paused && !this._errored) {
		this._startNewThread();
	}
};


/**
 * @inner
 *
 * Reserves a thread for a loadMethod call
 *
 */
proto._occupyThread = function () {
	this._availableThreads--;

	if (this._availableThreads < 0) {
		throw 'AssetLoader.Queue: Available thread count cannot be negative.';
	}
};


/**
 * @inner
 *
 * Frees up a thread allowing another src to get loaded
 *
 */
proto._releaseThread = function () {
	this._availableThreads++;

	if (this._availableThreads > this._allowedThreads) {
		throw 'AssetLoader.Queue: Available thread count cannot be more than allowed thread amount.';
	}
};

module.exports = Queue;

},{"../../utils/destroy":715,"ac-deferred":723,"ac-event-emitter":726,"ac-object":760}],715:[function(require,module,exports){
'use strict';

module.exports = function destroy(self, destroyChildren) {

	// Remove all event listeners
	if (typeof self.off === 'function') {
		self.off();
	}

	// don't try to destry an object that has already been destroyed
	function propertiesAreNull (obj) {
		var allNull = true;
		for (var prop in obj) {
			if (obj.hasOwnProperty(prop)) {
				if (obj[prop] !== null) {
					allNull = false;
					break;
				}
			}
		}

		return allNull;
	}

	window.setTimeout(function () {
		var instanceProp;

		// nullify all instance variables
		for (instanceProp in self) {
			if (self.hasOwnProperty(instanceProp)) {
				if (destroyChildren &&
					self[instanceProp] &&
					typeof self[instanceProp].destroy === 'function' &&
					!propertiesAreNull(self[instanceProp])
				) {
					self[instanceProp].destroy();
				}

				self[instanceProp] = null;
			}
		}
	});
};

},{}],716:[function(require,module,exports){
'use strict';

/**
 * Utility for rounding numbers
 *
 */

module.exports = function (number, digits) {
	return Math.round(number * Math.pow(10, digits)) / Math.pow(10, digits);
};

},{}],717:[function(require,module,exports){
arguments[4][203][0].apply(exports,arguments)
},{"./ac-clock/Clock":718,"./ac-clock/ThrottledClock":719,"./ac-clock/sharedClockInstance":720,"dup":203}],718:[function(require,module,exports){
arguments[4][204][0].apply(exports,arguments)
},{"ac-event-emitter":726,"dup":204}],719:[function(require,module,exports){
arguments[4][205][0].apply(exports,arguments)
},{"./sharedClockInstance":720,"ac-event-emitter":726,"dup":205}],720:[function(require,module,exports){
arguments[4][206][0].apply(exports,arguments)
},{"./Clock":718,"dup":206}],721:[function(require,module,exports){
/**
 * More or less follows this specification: 
 * http://wiki.commonjs.org/wiki/Promises/A
 * Other references: 
 * http://en.wikipedia.org/wiki/Futuresandpromises
 * http://livedocs.dojotoolkit.org/dojo/Deferred
 * http://www.sitepen.com/blog/2010/05/03/robust-promises-with-dojo-deferred-1-5/
 * http://api.jquery.com/category/deferred-object/
 *
 * Understanding Deferreds
 * ====================================
 * var asyncTask = function() { 
 *      var def = new Deferred(); 
 *
 *      setTimeout(function() { 
 *          def.resolve(1); 
 *      }, 1000); 
 *      
 *      return def.promise(); 
 *  }
 *  
 *  var haveAllData = Deferred.when(1, asyncTask());
 *  
 *  haveAllDataPromise.then(function(data) { 
 *      var result = data[0] + data[1];
 *      console.log(result); // logs 2
 *      return result; 
 *  }).then(function(data) {
 *      console.log(data * 2); // logs 4
 *  })
 *   
 */
(function (root, factory) {
    if (typeof exports === "object" && exports) {
        module.exports = factory; // CommonJS
    } else if (typeof define === "function" && define.amd) {
        define(factory); // AMD
    } else {
        root.Deferred = factory; // <script>
    }
}(this, (function() {
    'use strict';

    var exports = {};

    var statuses, each, CallbackContainer, funcOrEmpty, Deferred, Promise, promiseProto, passThrough;

    statuses = {
        0: 'pending',
        1: 'resolved',
        2: 'rejected'
    };

    // Used to loop through the pending promises for a given deferred.
    // promises must be fulfilled in order
    each = function(type, data) {
        var i, pending, length, callbackObj, callbackResult;

        if(this._status !== 0) { 
            if(console && console.warn) {
                console.warn('Trying to fulfill more than once.');
            }
            return false; 
        }

        // store the data for promises after fulfillment  
        this.data = data; 

        // reference to array of pending promises
        pending = this.pending;
        length = pending.length;

        for(i = 0; i < length; i++) {
            callbackObj = pending[i];

            // If callback of type (resolve, reject, progress) exists, invoke it.
            if(callbackObj[type]) {
                callbackResult = callbackObj[type](data);
            }
            
            // Pipe whatever is returned from the callback to the 
            // callback's deferred. This enables chaining. 
            if(typeof callbackResult === 'object' && callbackResult.hasOwnProperty('then') && callbackResult.hasOwnProperty('status')) {
                callbackResult.then(function(data) {
                    callbackObj.deferred.resolve(data);
                }, function(data) {
                    callbackObj.deferred.reject(data);
                }, function(data) {
                    callbackObj.deferred.progress(data);
                });
            }
            else {
                callbackObj.deferred[type](callbackResult || undefined);
            }

        }

        // if we are not updating progress, remove all the pending promises
        // as they have been now fulfilled or rejected and they cannot be fullfilled/rejected
        // more than once.
        if(type !== 'progress') {
            pending = [];
        }
        
        return true;
    };


    /**
     * Creates a Promise object
     * @name Promise
     */
    Promise = function(then, status) {
        this.then = then;
        this.status = status;
    };

    promiseProto = Promise.prototype;

    /* 
     * Shorthands for success, fail, and progress.
     * passThrough is used to pipe data through for chaining
     */
    passThrough = function(value) {
        return value;
    };

    promiseProto.success = function(callback, context) {
        return this.then(callback.bind(context), passThrough, passThrough);
    };

    promiseProto.fail = function(callback, context) {
        return this.then(passThrough, callback.bind(context), passThrough);
    };

    promiseProto.progress = function(callback, context) {
        return this.then(passThrough, passThrough, callback.bind(context));
    };

    funcOrEmpty = function(func) {
        if(typeof func !== 'function') {
            return function() {};
        }
        return func;
    };

    CallbackContainer = function(success, error, progress) {
        this.resolve = funcOrEmpty(success);
        this.reject = funcOrEmpty(error);
        this.progress = funcOrEmpty(progress);
        this.deferred = new Deferred();
    };

    /**
     * Creates a Deferred object
     * @class Asynch operation? Make a promise that you'll get that data in the future.
     * @name Deferred
     */
    Deferred = function() {
        // promises that are waiting to be fulfilled
        this.pending = [];

        this._status = 0; // initially pending

        // consumer access to then (does this need anything else?)
        this._promise = new Promise(this.then.bind(this), this.status.bind(this));
    };
    
    Deferred.prototype = /** @lends Deferred.prototype */ {
        /**
         * Gets the status of the deferred. 
         * Possible statuses: pending, resolved, rejected, canceled
         */
        status: function() {
            return statuses[this._status];
        },
        /**
         * Returns the promise object associated with a given deferrred instance. A promise can 
         * observe the deferred, but cannot resolve it.  
         */
        promise: function() {
            return this._promise;
        },
        /**
         * Alerts anyone that is listening for updates on a promise.
         * @param [update] Update data to send to listeners
         */
        progress: function(update) {
            each.call(this, 'progress', update);
            return this._promise;
        },
        /**
         * Called when the deferred task is complete and successful. 
         * @param [value] Data resulting from the deferred task
         */
        resolve: function(value) {
            each.call(this, 'resolve', value);
            if(this._status === 0) {
                this._status = 1;
            }
            return this._promise;
        },
        /**
         * Called when the deferred task errors out.
         * @param [error] Error message to pass to listeners
         */
        reject: function(error) {
            each.call(this, 'reject', error);
            if(this._status === 0) {
                this._status = 2;
            }
            return this._promise;
        },
        /**
         * Used to set callbacks on the deferred. This method is exposed to other code
         * through the promises object. 
         * @param {Function} [success] Invoked when a deferred is resolved
         * @param {Function} [error] Invoked when a deferred is rejected
         * @param {Function} [progress] May be invoked when progress is made on a deferred task
         */
        then: function(success, error, progress) {
            var result, callbackObject;

            callbackObject = new CallbackContainer(success, error, progress);

            if(this._status === 0) {
                this.pending.push(callbackObject);
            }
            else if(this._status === 1 && typeof success === 'function') {
                result = success(this.data);
                if(typeof result === 'object' && result.hasOwnProperty('then') && result.hasOwnProperty('status')) {
                    result.then(function(data) {
                        callbackObject.deferred.resolve(data);
                    }, function(data) {
                        callbackObject.deferred.reject(data);
                    }, function(data) {
                        callbackObject.deferred.progress(data);
                    });
                }
                else {
                    callbackObject.deferred.resolve(result);
                }
            }
            else if(this._status === 2 && typeof error === 'function') {
                result = error(this.data);
                callbackObject.deferred.reject(result);
            }

            return callbackObject.deferred.promise();

        }
    };

    /**
     * Execute code when all deferred tasks have completed. 
     * Accepts regular variables and promises. Returns a new promise.
     * @name when
     * @function
     *
     * @example
     * var promise = Deferred.when(1, asynchRequest());
     * promise.then(function(a, b) {
     *  console.log(a + b); // 1 + data returned from server
     * }
     */
    var when = function() {
        var values, deferred, pending, success, fail;

        values = [].slice.call(arguments);
        deferred = new Deferred();
        pending = 0;

        success = function(value) {
            pending--;

            var i = values.indexOf(this);
            values[i] = value;

            if(pending === 0) {
                deferred.resolve(values);
            }
        };

        fail = function(error) {
            deferred.reject(error);
        };

        values.forEach(function(value) {
            if(value.then) {
                pending++;
            }
        });

        values.forEach(function(value) {
            if(value.then) {
                value.then(success.bind(value), fail);
            }
        });

        return deferred.promise();
    };

    Deferred.when = when;

    exports.Deferred = Deferred;

    return exports;

}())));

},{}],722:[function(require,module,exports){

"use strict";
/**
 * @name defer.Deferred
 * @class Deferred object.
 * <pre>Deferred = require('defer/Deferred');</pre>
 * <p>API based off a subset of <a href="https://github.com/cujojs/when">when.js</a>.
 * <p>This is the interface we provide, however implementation is provided by a 3rd party library such as jett, when or jQuery.<br/>
 * @see <a href="https://github.com/cujojs/when">when.js</a>
 * @see <a href="http://api.jquery.com/category/deferred-object">jQuery Deferred Object</a>
 * @description Deferred constructor. (see example usage below)
 * @example var deferred = new Deferred();
 *
 * // Some async operation
 * setTimeout(function () {
 *     deferred.resolve();
 * },2000);
 *
 * // Pass the promise on
 * return deferred.promise();
 */

function Deferred() {}

Deferred.prototype = {
    /**
     *  @name defer.Deferred#resolve
     *  @description Signals resolution of the deferred (as per when.js spec)
     *  @return {defer.Promise}
     *  @function
     */
    'resolve' : function resolve() {
        this._defer.resolve.apply(this._defer, Array.prototype.slice.call(arguments));
        return this.promise();
    },
    /**
     *  @name defer.Deferred#reject
     *  @description Signals rejection of the deferred (as per when.js spec)
     *  @return {defer.Promise}
     *  @function
     */
    'reject' : function reject() {
        this._defer.reject.apply(this._defer, Array.prototype.slice.call(arguments));
        return this.promise();
    },
    /**
     *  @name defer.Deferred#progress
     *  @description Signals progression of the deferred (as per when.js spec)
     *  @deprecated as of 1.2.0, since it is not part of the A+ spec. Recommend using ac-event-emitter for progress signaling.
     *  @return {defer.Promise}
     *  @function
     */
    'progress' : function progress() {
        var message = 'ac-defer.progress is deprecated since it is not part of the A+ spec. Recommend using ac-event-emitter for progress signaling';
        console.warn(message);
        this._defer.progress.apply(this._defer, Array.prototype.slice.call(arguments));
        return this.promise();
    },
    /**
     *  @name defer.Deferred#then
     *  @description Attach callbacks to the deferred
     *  @param {Function} success
     *  @param {Function} failure
     *  @param {Function} progress
     *  @return {defer.Promise}
     *  @function
     */
    'then' : function then() {
        this._defer.then.apply(this._defer, Array.prototype.slice.call(arguments));
        return this.promise();
    },
    /**
     *  @name defer.Deferred#promise
     *  @description gets the deferred promise (as per jQuery spec)
     *  @return {defer.Promise}
     *  @function
     */
    'promise' : function promise() {
        return this._defer.promise.apply(this._defer, Array.prototype.slice.call(arguments));
    }

    /**
    * @name defer.Deferred.join
    * @static
    * @description Return a {@link defer.Promise} that will resolve only once all the inputs have resolved. The resolution value of the returned promise will be an array containing the resolution values of each of the inputs.
    * @example var joinedPromise = Deferred.join(promiseOrValue1, promiseOrValue2, ...);
    *
    * @example // largerPromise will resolve to the greater of two eventual values
    * var largerPromise = defer.join(promise1, promise2).then(function (values) {
    *     return values[0] > values[1] ? values[0] : values[1];
    * });
    * @function
    * @param {defer.Promise} promiseOrValue1
    * @param {defer.Promise} promiseOrValue2 ...
    * @return {defer.Promise}
    * @see defer.Deferred#all
    */
    /**
    * @name defer.Deferred.all
    * @static
    * @description Return a {@link defer.Promise} that will resolve only once all the items in array have resolved. The resolution value of the returned promise will be an array containing the resolution values of each of the items in array.
    * @example var promise = Deferred.all(arrayOfPromisesOrValues);
    * @function
    * @param {Array} arrayOfPromisesOrValues Array of {@link defer.Promise} or values
    * @return {defer.Promise}
    * @see defer.Deferred#join
    */

};

module.exports = Deferred;

},{}],723:[function(require,module,exports){
'use strict';
/**
* @name interface.smartsign
* @inner
* @namespace Provides {@link defer} object using Smartsign's implementation.
* <br/>
* @description Provides {@link defer} object using Smartsign's implementation.
*/
var proto = new (require('./ac-deferred/Deferred'))(),
    SmartsignDeferred = require('smartsign-deferred').Deferred;

function Deferred() {
    this._defer = new SmartsignDeferred();
}

Deferred.prototype = proto;

module.exports.join = function join() {
    return SmartsignDeferred.when.apply(null, [].slice.call(arguments));
};

module.exports.all = function all(arrayOfPromises) {
    return SmartsignDeferred.when.apply(null, arrayOfPromises);
};

module.exports.Deferred = Deferred;
},{"./ac-deferred/Deferred":722,"smartsign-deferred":721}],724:[function(require,module,exports){
arguments[4][295][0].apply(exports,arguments)
},{"./ac-dom-emitter/DOMEmitter":725,"dup":295}],725:[function(require,module,exports){
/*global module */
'use strict';
var proto;

var EventEmitter = require('ac-event-emitter').EventEmitter;

/**
 * @name .DOMEmitter
 * @class DOMEmitter
 * <pre>DOMEmitter = require('/DOMEmitter');</pre>
 */


function DOMEmitter( el ) {
    if ( el === null ) {
        return;
    }
    this.el = el;
    this._bindings = {};
    this._eventEmitter = new EventEmitter();
}


proto = DOMEmitter.prototype;

proto._parseEventNames = function( evt ) {
    // handle any undefined/nulls and send em back
    if ( !evt ) {
        return [ evt ];
    }
    return evt.split(' ');
};

proto._onListenerEvent = function( evtName, e ) {
    this.trigger( evtName, e, false );
};

proto._setListener = function( evt ) {
    this._bindings[ evt ] = this._onListenerEvent.bind( this, evt );
    this._addEventListener( evt, this._bindings[ evt ] );
};

proto._removeListener = function( evt ) {
    this._removeEventListener( evt, this._bindings[ evt ] );
    delete this._bindings[ evt ];
};

proto._addEventListener = function( evt, func, useCapture ) {
    if ( this.el.addEventListener ) {
        this.el.addEventListener( evt, func, useCapture );
    } else if ( this.el.attachEvent ) {
        this.el.attachEvent( 'on' + evt, func );
    } else {
        target[ 'on' + evt ] = func;
    }
    return this;
};

proto._removeEventListener = function( evt, func, useCapture ) {
   if ( this.el.removeEventListener ) {
        this.el.removeEventListener( evt, func, useCapture );
    } else {
        this.el.detachEvent( 'on' + evt, func );
    }

    return this;
};

proto.on = function( evts, callback, context ) {
    evts = this._parseEventNames( evts );
    evts.forEach( function( callback, context, evt ) {

        if ( !this.has( evt ) ) {
            this._setListener( evt );
        }
        this._eventEmitter.on( evt, callback, context );

    }.bind( this, callback, context ));

    return this;
};

proto.off = function( evts, callback, context ) {
    var args = Array.prototype.slice.call( arguments, 0 );
    evts = this._parseEventNames( evts );
    evts.forEach( function( callback, context, args, evt ) {

        // Handle unbinding all events ( this.off(); )
        if ( args.length === 0 ) {
            this._eventEmitter.off();

            // for each event, unbind it
            var i;
            for ( i in this._bindings ) {
                if ( this._bindings.hasOwnProperty( i ) ) {
                    this._removeListener( i );
                }
            }
            return;
        }

        this._eventEmitter.off( evt, callback, context );

        // for specific events
        if ( !this.has( evt ) ) {
            this._removeListener( evt );
        }
            
    }.bind( this, callback, context, args ));

    return this;
};

proto.once = function( evts, callback, context ) {
    evts = this._parseEventNames( evts );
    evts.forEach( function( callback, context, evt ) {
        
        if ( !this.has( evt ) ) {
            this._setListener( evt );
        }
    
        this._eventEmitter.once.call( this, evt, callback, context );

    }.bind( this, callback, context ));

    return this;
};

proto.has = function( evt ) {
    if ( this._eventEmitter && this._eventEmitter.has( evt ) ) {
        return true;
    }
    return false;
};

proto.trigger = function( evts, data, doNotPropogate ) {
    evts = this._parseEventNames( evts );
    evts.forEach( function( data, doNotPropogate, evt ) {
        this._eventEmitter.trigger( evt, data, doNotPropogate );
    }.bind( this, data, doNotPropogate ));

    return this;
    
};

proto.destroy = function() {
    this.off();
    this.el = this._eventEmitter = this._bindings = null;
};

module.exports = DOMEmitter;
},{"ac-event-emitter":726}],726:[function(require,module,exports){
arguments[4][135][0].apply(exports,arguments)
},{"./ac-event-emitter/EventEmitter":727,"dup":135}],727:[function(require,module,exports){
arguments[4][136][0].apply(exports,arguments)
},{"dup":136}],728:[function(require,module,exports){
module.exports.playerFactory = require("./ac-flow-x/flow/playerFactory");
module.exports.Flow = require("./ac-flow-x/flow/FlowController");
module.exports.SyncPlayer = require("./ac-flow-x/flow/SyncPlayer");
module.exports.MaskedFlow = require("./ac-flow-x/flow/MaskedFlow");

},{"./ac-flow-x/flow/FlowController":730,"./ac-flow-x/flow/MaskedFlow":732,"./ac-flow-x/flow/SyncPlayer":734,"./ac-flow-x/flow/playerFactory":757}],729:[function(require,module,exports){
/*global module */
"use strict";
var proto,
    DEBUG = false,
    Deferred = require('ac-deferred').Deferred,
    All = require('ac-deferred').all,
    EventEmitter = require('ac-event-emitter').EventEmitter,
    AC_FlowCompositorKeyframes = require('./compositor/decorator/Keyframe'),
    AC_FlowCompositorSuperframes = require('./compositor/decorator/Superframe'),
    AC_FlowCompositorSuperKeyframes = require('./compositor/decorator/SuperKeyframe'),
    AC_FlowCompositorSequenceCache= require('./compositor/decorator/Cache'),
    AC_FlowCompositorBenchmark  = require('./compositor/decorator/Benchmark');

/**
 *  @name flow.Flow
 *  @class Flow object.
 *  <pre>Flow = require('flow/Flow');</pre>
 *  @param {flow.compositor} compositor
 */
function Flow (compositor, options) {
    EventEmitter.call( this );
    this._compositor = compositor;
    this.options = options || {};

    this.gotoFrame;
}

proto = Flow.prototype = new EventEmitter( null );

proto._gotoImageFrame = function( nextFrame ) {
    if (this._rendering) {
        return (new Deferred()).resolve();
    } else if (this._currentFrame === nextFrame) {
        return (new Deferred()).resolve();
    }

    this._rendering = true;
    if (DEBUG) {
        console.groupCollapsed('gotoFrame:' + nextFrame + ' currentFrame:' + this._currentFrame);
    }
    return this._compositor.compositeFrames(this._currentFrame, nextFrame).then(function () {
        this._rendering = false;
        this._currentFrame = nextFrame;
        if (DEBUG) {
            console.groupEnd();
        }
    }.bind(this));
};

proto._gotoBinaryFrame = function( nextFrame ) {

    //return this._gotoImageFrame( nextFrame );
    if (this._currentFrame === nextFrame) {
        return (new Deferred()).resolve();
    }

    // under construction!

    // Render the frames required
    return this._compositor.compositeFrames( this._currentFrame, nextFrame ).then( function( compositedFrame ) {
        // if a frame is returned, apply it
        if ( compositedFrame ) {
            this._compositor.applyBinaryFrame( compositedFrame );
        }
        this._currentFrame = nextFrame;
        this.trigger('composite');
    }.bind( this ) );
};

/**
 *    @name flow.Flow#init
 *    @description Loads the flow
 *    @function
 */
proto.init = function (element) {
    var canvas;
    if (element.nodeName === 'CANVAS') {
        canvas = element;
    } else {
        canvas = document.createElement('canvas');
        element.appendChild(canvas);
    }

    // map gotoFrame to the correct type
    if ( this.options.renderType === 'binary' ) {
        this.gotoFrame = this._gotoBinaryFrame;
    } else if ( this.options.renderType === 'default' ) {
        this.gotoFrame = this._gotoImageFrame;
    }

    // Compositor loads keyframes, then manifest
    return this._compositor.init(canvas)
        // When manifest has loaded
        .then(function (flowData) {
            // Load the diff images and decorate compositor
            return All([this._compositor.createDiffRender(flowData)
                .then(this._decorateCompositor.bind(this))]);
        }.bind(this));
};

proto._decorateCompositor = function () {
    var compositor = this._compositor,
        flowData = this._compositor._diffRender.flowData,
        canvas = this._compositor.canvas;

    // binary render options
    if ( this.options.renderType === 'binary' ) {
        // put decorators here

    // traditional flow render options
    } else {
        // Has superframes
        if (flowData.superframeFrequency) {
            compositor = new AC_FlowCompositorSuperframes(compositor, flowData.superframeFrequency);
        }

        // Has Keyframes
        if (flowData.version === 3) {
            compositor = new AC_FlowCompositorKeyframes(compositor);
        }

        // Has SuperKeyframes
        if (flowData.version === 3 && flowData.superframeFrequency) {
            compositor = new AC_FlowCompositorSuperKeyframes(compositor);
        }

        // Enable keyframeCache
        if (this.options.keyframeCache) {
            compositor = new AC_FlowCompositorSequenceCache(compositor, this.options.keyframeCache);
        }

        // Enable benchmarking
        if (this.options.benchmark) {
            compositor = new AC_FlowCompositorBenchmark(compositor);
        }
    }

    // If there's no decorating to be done, resolve the promise.
    if (compositor === this._compositor) {
        return (new Deferred()).resolve();
    } else {
        this._compositor = compositor;
        return this._compositor.init(canvas);
    }
};


// Escape hatch for non ecmascript 5 browsers
if (typeof Object.defineProperties !== 'function') {
    return function () {};
}

Object.defineProperties(proto, {
    '_currentFrame' : {
        value : 0,
        enumerable : false,
        writable : true
    },
    /**
     *    @name flow.FlowPlayer#frameCount
     *    @description Frame count (read only) (nonstandard)
     */
    'frameCount' : {
        get : function () {
            return this._compositor.frameCount;
        },
        enumerable : true
    }
});

module.exports = Flow;

},{"./compositor/decorator/Benchmark":737,"./compositor/decorator/Cache":738,"./compositor/decorator/Keyframe":739,"./compositor/decorator/SuperKeyframe":740,"./compositor/decorator/Superframe":741,"ac-deferred":723,"ac-event-emitter":726}],730:[function(require,module,exports){
/*global module */
"use strict";
var proto,
	Flow = require('./Flow'),
	FlowPlayer = require('./Player'),
	LoadController = require('./LoadController'),
	BinaryCompositor = require('./compositor/BinaryCompositor'),
	DefaultCompositor = require('./compositor/Sequence');

var dataOptionDefaults = {
	fileFormat : 'jpg',
	baseName : 'flow',
	imageUrlPattern : '###',
	startframeFileFormat : null, // `null` to use fileFormat
	endframeFileFormat : null, // `null` to use fileFormat
	basePath: null, // use as basepath for all assets if provided
	manifestPath : null, // `null` to default to basepath
	manifestFileFormat: 'json',
	diffPath : null, // `null` to default to basepath
	framePath : null // `null` to default to basepath
};

var optionDefaults = {
	superframes : false,
	reversable : false,
	keyframeCache : 8,
	benchmark : false,
	preload : true,
	multithread : false,
	preventDraw : false,
	renderType : 'default'
};

var FlowController = function( options, dataOptions ) {
	options = options || {};
	dataOptions = dataOptions || {};

	this._flow = null;
	this._compositor = null;
	this._oader = null;

	// set defaults if not set
	this.options = this._setDefaults( options, optionDefaults );
	this._dataOptions = this._setDefaults( dataOptions, dataOptionDefaults );

	// handle element creation if no element exists
	if ( !this.options.element ) {
		this.options.element = document.createElement('canvas');
	}

	// set flow
	this._flow = this._createFlow( this._compositor, this.options, this._dataOptions );

	// set FlowPlayer options on object
	FlowPlayer.call( this, this.options.element, this._flow );

	// handle loading immediately if needed
	if ( this.options.preload ) {
		this.load();
	}

};

proto = FlowController.prototype = new FlowPlayer( null );

proto.destroy = function() {
	this.pause();
	this.off();
	this._flow.off();

	this._flow = this._nullProperties( this._flow );
	this._nullProperties( this );
};

proto._nullProperties = function( obj ) {
	var i;
	for ( i in obj ) {
		if ( obj.hasOwnProperty( i ) ) {
			obj[ i ] = null;
		}
	}
	return obj;
};

proto._createFlow = function( compositor, options, dataOptions ) {
	var assetPaths = this._assembleAssetPaths(dataOptions);
	var keyframes = [ assetPaths.startframe, assetPaths.endframe ];

	this.loader = new LoadController( this, assetPaths.manifest, keyframes, assetPaths.imageUrlPattern );

	// load correct compositor
	if ( options.renderType === 'binary' ) {
		this._compositor = new BinaryCompositor( keyframes, assetPaths.imageUrlPattern, this.loader, options.multithread, options.preventDraw );
	} else {
		this._compositor = new DefaultCompositor( keyframes, assetPaths.imageUrlPattern, this.loader );
	}

	// return a flow with the correct compositor and options
	return new Flow( this._compositor, options );
};

proto._assembleAssetPaths = function (dataOptions) {
	// use basePath by default
	// override basePath with explicitly provided asset paths
	var basePath = dataOptions.basePath ? this._forceTrailingSlash(dataOptions.basePath) : null;
	var framePath = dataOptions.framePath ? this._forceTrailingSlash(dataOptions.framePath) : null;
	var diffPath = dataOptions.diffPath ? this._forceTrailingSlash(dataOptions.diffPath) : null;
	var manifestPath = dataOptions.manifestPath ? this._forceTrailingSlash(dataOptions.manifestPath) : null;
	var baseName = dataOptions.baseName + '_';
	var paths = {};

	paths.startframe = (framePath || basePath) + baseName + 'startframe.' + (dataOptions.startframeFileFormat || dataOptions.fileFormat);
	paths.endframe = (framePath || basePath) + baseName + 'endframe.' + (dataOptions.endframeFileFormat || dataOptions.fileFormat);
	paths.imageUrlPattern = (diffPath || basePath) + baseName + dataOptions.imageUrlPattern + '.' + dataOptions.fileFormat;
	paths.manifest = (manifestPath || basePath) + baseName + 'manifest.' + dataOptions.manifestFileFormat;

	return paths;
};

proto._forceTrailingSlash = function (path) {
	if ( path.lastIndexOf('/') !== path.length - 1 ) {
		path =  path + '/';
	}
	return path;
};


proto._setDefaults = function( source, defaults ) {
	var option;
	for ( option in defaults ) {
		if ( defaults.hasOwnProperty( option ) ) {
			if ( typeof source[ option ] === 'undefined' ) {
				source[ option ] = defaults[ option ];
			}
		}
	}
	return source;
};

module.exports = FlowController;

},{"./Flow":729,"./LoadController":731,"./Player":733,"./compositor/BinaryCompositor":735,"./compositor/Sequence":736}],731:[function(require,module,exports){
/*global module */
"use strict";
var proto,
	AssetLoader = require('ac-asset-loader').AssetLoader,
	EventEmitter = require('ac-event-emitter').EventEmitter,
	DataLoader = require('./data/provider/Async'),
	Deferred = require('ac-deferred').Deferred,
	All = require('ac-deferred').all;

var events = {
	start : 'start',
	pause : 'pause',
	error : 'error',
	complete : 'loaded',
	destroy : 'destroy'
};

var LoadController = function( flow, manifestUrl, keyframeUrls, imageUrlPattern ) {
	this._flow = flow;
	this._manifestUrl = manifestUrl;
	this._keyframeUrls = keyframeUrls;
	this._imageUrlPattern = imageUrlPattern;

	// keep state variables for progress
	this.state = {
		manifestLoaded : false,
		keyframesLoaded : false,
		diffsLoaded : false,
		diffCountLoaded : 0,
		totalDiffs : null
	};

	this.assets = {
		keyframes : null,
		manifest : null,
		diffs : null
	};

	// set up an object where promises are held
	this._promises = {};
	this._loaders = {};
	this._activeLoaders = [];
	this._resumeQueue = [];
	this._paused = true;
	this._shouldPause = false;

	// bind instance functions to handle calling within scope of this object
	this._boundOnManifestLoaded = this._onManifestLoaded.bind( this );
	this._boundOnKeyframesLoaded = this._onKeyframesLoaded.bind( this );
	this._boundOnDiffsLoaded = this._onDiffsLoaded.bind( this );
	this._boundOnManifestAndKeyframesLoaded = this._onManifestAndKeyframesLoaded.bind( this );
	this._boundOnComplete = this._onComplete.bind( this );
};

proto = LoadController.prototype = new EventEmitter( null );

proto.setManifestUrl = function( manifestUrl ) {
	this._manifestUrl = manifestUrl;
	return this;
};

proto.setKeyframeUrls = function( keyframeUrls ) {
	this._keyframeUrls = keyframeUrls;
	return this;
};

proto.setImageUrlPattern = function( imageUrlPattern ) {
	this._imageUrlPattern = imageUrlPattern;
	return this;
};

proto.load = function() {
	// in case we have to resume instead of simply starting fresh
	if ( this._paused && ( this._activeLoaders.length > 0 || this._resumeQueue.length > 0 ) ) {
		this._resume();
		return;
	}

	// start loading from the beginning
	this._flow.load().then(this._boundOnComplete);

	return;
/*
	// TODO: DEPRECATED, but might still be useful..?
	if ( !this.state.manifestLoaded ) {
		this.loadManifest();
	}

	if ( !this.state.keyframesLoaded ) {
		this.loadKeyframes();
	}

	All([ this._promises.manifest, this._promises.keyframes ])
		.then( this._boundOnManifestAndKeyframesLoaded )
		.then( this._boundOnComplete );
*/
};

proto.pause = function() {
	this._shouldPause = true;

	var i,
		len = this._activeLoaders.length;
	for( i = 0; i < len; i++ ) {
		this._activeLoaders[ i ].pause();
	}
	this._paused = true;
};

proto.destroy = function() {
	var loadersProp,
		promisesProp,
		instanceProp;

	// trigger a destroy event before everything gets unbound
	this.trigger( events.destroy );

	// remove all bindings from this object
	this.off();

	// stop all AssetLoader instances
	for ( loadersProp in this._loaders ) {
		if ( this._loaders.hasOwnProperty( loadersProp ) ) {
			// TODO: what is the API for this?
			//this._loaders[ loadersProp ].reject();
		}
	}

	// reject all promises
	for ( promisesProp in this._promises ) {
		if ( this._promises.hasOwnProperty( promisesProp ) ) {
			if ( this._promises[ promisesProp ].promise().status() === 'pending' ) {
				this._promises[ promisesProp ].reject();
			}
		}
	}

	// remove all instance variables
	for ( instanceProp in this ) {
		if ( this.hasOwnProperty( instanceProp ) ) {
			this[ instanceProp ] = null;
		}
	}
};

proto._resume = function() {
	this._shouldPause = false;

	var i,
		loaderLen = this._activeLoaders.length;
	for( i = 0; i < loaderLen; i++ ) {
		this._activeLoaders[ i ].load();
	}

	var j,
		resumeLen = this._resumeQueue.length;
	for( j = 0; j < resumeLen; j++ ) {
		this._resumeQueue[ j ].call( this );
	}
	this._resumeQueue = [];

	this._paused = false;
};

proto.loadManifest = function() {
	this._promises.manifest = this._promises.manifest || new Deferred();
	var promise = this._promises.manifest.promise();

	if ( this._shouldPause ) {
		this._resumeQueue.push( this.loadManifest );
		return promise;
	}

	if ( this.assets.manifest ) {
		return this._promises.manifest.resolve( this.assets.manifest );
	}

	this._paused = false;
	this._loaders.manifest = new DataLoader( this._getManifestAssetsData() );
	this._activeLoaders.push( this._loaders.manifest );

	this._loaders.manifest.load().then( this._boundOnManifestLoaded );
	return promise;
};

proto.loadKeyframes = function() {
	this._promises.keyframes = this._promises.keyframes || new Deferred();
	var promise = this._promises.keyframes.promise();

	if ( this._shouldPause ) {
		this._resumeQueue.push( this.loadKeyframes );
		return promise;
	}

	if ( this.assets.keyframes ) {
		return this._promises.keyframes.resolve( this.assets.keyframes );
	}

	this._paused = false;
	this._loaders.keyframes = new AssetLoader( this._getKeyframesAssetsData() );
	this._activeLoaders.push( this._loaders.keyframes );

	this._loaders.keyframes.load().then( this._boundOnKeyframesLoaded );
	return promise;
};

proto.loadDiffs = function() {
	this._promises.diffs = this._promises.diffs || new Deferred();
	var promise = this._promises.diffs.promise();

	if ( this._shouldPause ) {
		this._resumeQueue.push( this.loadDiffs );
		return promise;
	}

	if ( this.assets.diffs ) {
		return this._promises.diffs.resolve( this.assets.diffs );
	}

	this._paused = false;
	this._loaders.diffs = new AssetLoader( this._getDiffsAssetsData() );
	this._activeLoaders.push( this._loaders.diffs );

	this._loaders.diffs.load().then( this._boundOnDiffsLoaded );
	return promise;
};

proto._getManifestAssetsData = function() {
	return this._manifestUrl;
};

proto._getKeyframesAssetsData = function() {
	return this._keyframeUrls;
};

proto._getDiffsAssetsData = function() {
	var imageCount = this.assets.manifest.imagesRequired,
		imageUrls = [],
		i,
		num,
		maskSize = this._imageUrlPattern.match(/#/g).length;

	for( i = 1 ; i <= imageCount; i++ ) {
		num = '0000' + i;
		num = num.substring( num.length - maskSize );
		imageUrls.push( this._imageUrlPattern.replace(/#{2,}/g,num ) );
	}

	return imageUrls;
};

proto._onManifestLoaded = function( manifest ) {
	if (this.assets) {
		this.assets.manifest = manifest;
		this.state.manifestLoaded = true;
		this._paused = true;
		this._removeFromActiveLoaders( this._loaders.manifest );
		this._promises.manifest.resolve( this.assets.manifest );
	}
};

proto._onKeyframesLoaded = function( keyframes ) {
	if (this.assets) {
		this.assets.keyframes = keyframes;
		this.state.keyframeLoaded = true;
		this._paused = true;
		this._removeFromActiveLoaders( this._loaders.keyframes );
		this._promises.keyframes.resolve( this.assets.keyframes );
	}
};

proto._onDiffsLoaded = function( diffs ) {
	if (this.assets) {
		this.assets.diffs = diffs;
		this.state.diffsLoaded = true;
		this._paused = true;
		this._removeFromActiveLoaders( this._loaders.diffs );
		this._promises.diffs.resolve( this.assets.diffs );
	}
};

proto._onManifestAndKeyframesLoaded = function() {
	if ( !this.state.diffsLoaded ) {
		this.loadDiffs();
	}
	return this._promises.diffs;
};

proto._removeFromActiveLoaders = function( obj ) {
	var i,
		len = this._activeLoaders.length;
	for ( i = 0; i < len; i++ ) {
		if ( this._activeLoaders[ i ] === obj ) {
			this._activeLoaders.splice( i, 1 );
			return;
		}
	}
};

proto._onComplete = function() {
	this.trigger( events.complete );
};

module.exports = LoadController;

},{"./data/provider/Async":749,"ac-asset-loader":702,"ac-deferred":723,"ac-event-emitter":726}],732:[function(require,module,exports){
/*global module */
"use strict";
var proto,
	Flow = require('./FlowController'),
	SyncPlayer = require('./SyncPlayer'),
	Deferred = require('ac-deferred').Deferred,
	All = require('ac-deferred').all;

var defaultOptions = {
	preventDraw : true,
	renderType : 'binary'
};

function MaskedFlow ( sourcePath, maskPath, sourceOptions, maskOptions, sourceFileOptions, maskFileOptions ) {
	
	// force default options for these flows
	sourceOptions = this._setDefaultOptions( sourceOptions );
	maskOptions = this._setDefaultOptions( maskOptions );

	this.flow = new Flow( sourcePath, sourceOptions, sourceFileOptions );
	this.mask = new Flow( maskPath, maskOptions, maskFileOptions );

	SyncPlayer.apply( this, [ this.flow, this.mask ] );

	this._flowDefer = null;
	this._maskDefer = null;

	this._boundOnSyncRender = this._onSyncRender.bind( this );
	this._boundOnFlowTimeUpdate = this._onFlowTimeUpdate.bind( this );
	this._boundOnMaskTimeUpdate = this._onMaskTimeUpdate.bind( this );

	this.flow._flow.on( 'composite', this._boundOnFlowTimeUpdate );
	this.mask._flow.on( 'composite', this._boundOnMaskTimeUpdate );

	this._bindSyncRender();
}

proto = MaskedFlow.prototype = new SyncPlayer( null );

proto._setDefaultOptions = function( options ) {
	options = options || {};

	var i;
	for ( i in defaultOptions ) {
		if ( defaultOptions.hasOwnProperty( i ) ) {

			if ( typeof options[ i ] === 'undefined' ) {
				options[ i ] = defaultOptions[ i ];
			}

		}
	}

	return options;
};

proto._bindSyncRender = function() {
	this._flowDefer = new Deferred();
	this._maskDefer = new Deferred();

	All( [ this._flowDefer, this._maskDefer ] ).then( this._boundOnSyncRender );
};

proto._onFlowTimeUpdate = function() {
	if( this._flowDefer ) {
		this._flowDefer.resolve();
	}
};

proto._onMaskTimeUpdate = function() {
	if( this._maskDefer ) {
		this._maskDefer.resolve();
	}
};

proto._onSyncRender = function() {
	this._flowDefer = this._maskDefer = null;
	this._applyMask();
	this._bindSyncRender();
};

proto._applyMask = function() {
	if ( !this.flow._compositor.imageData ) {
		return;
	}

	var flowData = this.flow._compositor.imageData.data,
		maskData = this.mask._compositor.imageData.data,
		i,
		len = flowData.length;

	for ( i = 0; i < len; i+=4 ) {
		flowData[ i + 3 ] = maskData[ i ];
	}

	this.flow._compositor.applyBinaryFrame( { buf8 : flowData }, true );
};

module.exports = MaskedFlow;

},{"./FlowController":730,"./SyncPlayer":734,"ac-deferred":723}],733:[function(require,module,exports){
/*global module */
"use strict";
var proto,
    DEBUG = false,
    Deferred = require('ac-deferred').Deferred,
    DOMEmitter = require('ac-dom-emitter').DOMEmitter;

function FlowPlayer (element, flow) {
    this._flow = flow;
    this._domEmitter = new DOMEmitter( element );
    this._frameRate = 30;
    this.element = element;
    this.paused = true;
    this.loop = false;
    this._boundAdvanceTimeToGlobal = this._advanceToTimeGlobal.bind( this );
    this._onBoundGlobalTimeUpdate = this._onGlobalTimeUpdate.bind( this );
    this._onBoundLocalTimeUpdate =  this._onLocalTimeUpdate.bind( this );
}

proto = FlowPlayer.prototype;

proto._timeToFrame = function (localTime) {
    var frame;
    frame = Math.round(localTime / this.duration * this._flow.frameCount);
    frame = frame % (this._flow.frameCount + 1);
    return (frame < 0) ? this._flow.frameCount + frame : frame;
};

proto._advanceToTimeGlobal = function (globalTime) {
    this._prevTime = this._prevTime || globalTime;
    this._currentTime += ((globalTime - this._prevTime) / 1000) * this.playbackRate;

    this._prevTime = globalTime;
    this._pauseAfterRender = false;

    var nextFrame = this._timeToFrame(this._currentTime);

    if (!this.loop) {
        if (this.playbackRate > 0 && this._currentTime > this.duration) {
            nextFrame = this._flow.frameCount;
            this._currentTime = this.duration;
            this._pauseAfterRender = true;
        } else if (this.playbackRate < 0 && this._currentTime < 0) {
            nextFrame = 0;
            this._currentTime = 0;
            this._pauseAfterRender = true;
        }
    } else {
        this._currentTime = (this.duration + this._currentTime) % this.duration;
    }

    if (!this.paused && !this.seeking) {
        return this._flow.gotoFrame(nextFrame).then( this._onBoundGlobalTimeUpdate );
    } else {
        return (new Deferred()).reject();
    }
};

proto._onGlobalTimeUpdate = function() {
    this.trigger('timeupdate');
    if (this._pauseAfterRender) {
        this.paused = true;
        this.trigger('ended');
    } else {
        this._requestAnimationFrame = window.requestAnimationFrame(this._boundAdvanceTimeToGlobal);
    }
};

proto._onLocalTimeUpdate = function() {
    this.seeking = false;
    this.trigger('timeupdate');
    this.trigger('seeked');
    this._requestAnimationFrame = window.requestAnimationFrame(this._boundAdvanceTimeToGlobal);
};

proto._advanceToTimeLocal = function (t) {
    if (!this.seeking) {
        this.seeking = true;
        this.trigger('seeking');
        this._currentTime = 1 * t;
        this._prevTime = null;
        window.cancelAnimationFrame(this._requestAnimationFrame);
        this._flow.gotoFrame(this._timeToFrame(t)).then( this._onBoundLocalTimeUpdate );
    }
    if (DEBUG) {
      console.log('advance to time ' + t + ' from ' + this._currentTime);
    }
};

/**
 *  @name flow.Player#load
 *  @description Loads the flow
 *  @function
 */
proto.load = function () {
    this.trigger('loadstart');
    return this._flow.init(this.element)
        .then(this.trigger.bind(this, 'canplaythrough'));
};

/**
 *  @name flow.Player#play
 *  @description Starts flow playback
 *  @function
 */
proto.play = function () {
    if (this.paused) {
        this.paused = false;
        /**
         *  @name flow.Player#play
         *  @description Fired when playback is commenced.
         *  @event
         */
        this.trigger('play');
        this._prevTime = null;
        this._requestAnimationFrame = window.requestAnimationFrame( this._boundAdvanceTimeToGlobal );
    }
    return this;
};

/**
 *  @name flow.Player#pause
 *  @description Pauses flow playback
 *  @function
 */
proto.pause = function () {
    if (!this.paused) {
        this.paused = true;
        window.cancelAnimationFrame(this._requestAnimationFrame);
        /**
         *  @name FlowPlayer#pause
         *  @description Fired when playback is paused.
         *  @event
         */
        this.trigger('pause');
    }
    return this;
};

/**
 *  @name flow.Player#on
 *  @description Adds event listener to player's DOM Element.
 *  @function
 */
proto.on = function () {
    this._domEmitter.on.apply( this._domEmitter, arguments );
};

proto.once = function () {
    this._domEmitter.once.apply( this._domEmitter, arguments );
};

proto.trigger = function () {
    this._domEmitter.trigger.apply( this._domEmitter, arguments );
};

proto.off = function () {
    this._domEmitter.off.apply( this._domEmitter, arguments );
};

proto.setRenderOperation = function( renderOperation ) {
    if ( this._flow && this._flow._compositor && this._flow._compositor._diffRender ) {
        this._flow._compositor._diffRender.renderOperation = renderOperation;
    }

    return this;
};

proto.setBeforeRenderOperation = function( beforeRenderOperation ) {
    if ( this._flow && this._flow._compositor && this._flow._compositor._diffRender ) {
        this._flow._compositor._diffRender.beforeRenderOperation = beforeRenderOperation;
    }
};

proto.setBeforeDrawOperation = function( beforeDrawOperation ) {
    if ( this._flow && this._flow._compositor ) {
        this._flow._compositor.beforeDrawOperation = beforeDrawOperation;
    }
};

proto.setAfterDrawOperation = function( afterDrawOperation ) {
    if ( this._flow && this._flow._compositor ) {
        this._flow._compositor.afterDrawOperation = afterDrawOperation;
    }
};

// Escape hatch for non ecmascript 5 browsers
if (typeof Object.defineProperties !== 'function') {
    return function () {};
}


Object.defineProperties(proto, {
    '_currentTime' : {
        value : 0,
        enumerable : false,
        writable : true
    },
    '_playbackRate' : {
        value : 1,
        enumerable : false,
        writable : true
    },
    /**
     *  @name flow.Player#currentTime
     *  @description Current time
     */
    'currentTime' : {
        get : function () {
            return this._currentTime * 1;
        },
        set : proto._advanceToTimeLocal,
        enumerable : true
    },
    'frameRate' : {
        get : function () {
            return this._frameRate;
        },
        set : function (fr) {
            if (isFinite(fr)) {
                this._frameRate = fr;
                this.trigger('durationchange');
            }
        },
        enumerable : true
    },
    /**
     *  @name flow.Player#playbackRate
     *  @description Current playback rate
     */
    'playbackRate' : {
        get : function () {
            return this._playbackRate * 1;
        },
        set : function (r) {
            /**
             *  @name flow.Player#ratechange
             *  @description Fired when playback rate changed.
             *  @event
             */
           if(isFinite(r)) {
                this._playbackRate = 1 * r;
                this.trigger('ratechange');
            }
        },
        enumerable : true
    },
    /**
     *  @name flow.Player#duration
     *  @description Flow duration (seconds) (read only)
     */
    'duration' : {
        get : function () {
            return this._flow.frameCount / this.frameRate;
        },
        enumerable : true
    }
});

module.exports = FlowPlayer;
},{"ac-deferred":723,"ac-dom-emitter":724}],734:[function(require,module,exports){
/*global module */
"use strict";
var proto,
	Deferred = require('ac-deferred').Deferred,
	All = require('ac-deferred').all;

function SyncPlayer () {
	this.flows = Array.prototype.slice.call( arguments, 0 );
}

proto = SyncPlayer.prototype;

proto.on = function() {
	return this._each( 'on', arguments );
};

proto.off = function() {
	return this._each( 'off', arguments );
};

proto.load = function() {
	var defer = new Deferred(),
		promises = [],
		i,
		len = this.flows.length,
		flow;

	for ( i = 0; i < len; i++ ) {
		flow = this.flows[ i ];
		promises.push( flow.load() );
	}

	All( promises ).then( defer.resolve.bind( defer ) );

	return defer.promise();
};

proto.play = function() {
	return this._each( 'play', arguments );
};

proto.pause = function() {
	return this._each( 'pause', arguments );
};

proto.destroy = function() {
	this._each( 'destroy', arguments );

	var i;
	for ( i in this ) {
		if ( this.hasOwnProperty( i ) ) {
			if ( this[ i ] instanceof Deferred ) {
				this[ i ].reject();
			}
			this[ i ] = null;
		}
	}
};

proto.setRenderOperation = function() {
	return this._each( 'setRenderOperation', arguments );
};

proto.setBeforeRenderOperation = function() {
	return this._each( 'setBeforeRenderOperation', arguments );
};

proto.setBeforeDrawOperation = function() {
    return this._each( 'setBeforeDrawOperation', arguments );
};

proto.setAfterDrawOperation = function() {
    return this._each( 'setAfterDrawOperation', arguments );
};

proto._dispatchEvent = function (type) {
    return this._each( '_dispatchEvent', arguments );
};


proto._advanceToTimeGlobal = function () {
    return this._each( '_advanceToTimeGlobal', arguments );
};

proto._advanceToTimeLocal = function () {
    return this._each( '_advanceToTimeLocal', arguments );
};

proto._each = function( method, args ) {
	args = Array.prototype.slice.call( args, 0 );

	var i,
		len = this.flows.length,
		flow;

	for ( i = 0; i < len; i++ ) {
		flow = this.flows[ i ];
		flow[ method ].apply( flow, args );
	}

	return this;
};

Object.defineProperties(proto, {
    '_currentTime' : {
        value : 0,
        enumerable : false,
        writable : true
    },
    '_playbackRate' : {
        value : 1,
        enumerable : false,
        writable : true
    },
    '_loop' : {
        value : false,
        enumerable : false,
        writable : true
    },
    /**
     *  @name flow.Player#currentTime
     *  @description Current time
     */
    'currentTime' : {
        get : function () {
            return this._currentTime * 1;
        },
        set : proto._advanceToTimeLocal,
        enumerable : true
    },
    'frameRate' : {
        get : function () {
            return this._frameRate;
        },
        set : function (fr) {
            if (isFinite(fr)) {
                this._frameRate = fr;
                this._dispatchEvent('durationchange');
            }
        },
        enumerable : true
    },
    /**
     *  @name flow.Player#playbackRate
     *  @description Current playback rate
     */
    'playbackRate' : {
        get : function () {
            return this._playbackRate * 1;
        },
        set : function (r) {
            /**
             *  @name flow.Player#ratechange
             *  @description Fired when playback rate changed.
             *  @event
             */
           if(isFinite(r)) {
                this._playbackRate = 1 * r;
               	this.flows.forEach( function( playbackRate, flow ) {
               		flow.playbackRate = playbackRate;
               	}.bind( this, this._playbackRate ))
            }
        },
        enumerable : true
    },
    /**
     *  @name flow.Player#duration
     *  @description Flow duration (seconds) (read only)
     */
    'duration' : {
        get : function () {
            return this._flow[ 0 ].frameCount / this.frameRate;
        },
        enumerable : true
    },
    'loop' : {
        get : function () {
            return this._loop;
        },
        set : function (bool) {
            if ( typeof bool === 'boolean' ) {
                this._loop = bool;
                this.flows.forEach( function( loop, flow ) {
                    flow.loop = loop;
                }.bind( this, this._loop ) );
            }
        },
        enumerable : true
    }
});

module.exports = SyncPlayer;
},{"ac-deferred":723}],735:[function(require,module,exports){
/*global module */
"use strict";
var proto,
	DEBUG = false,
	AC_BinaryDiffRender = require('../diff/BinaryRender'),
	AC_BinaryMultithreadDiffRender = require('../diff/BinaryMultithreadRender'),
	Deferred = require('ac-deferred').Deferred;


var BinaryCompositor = function( keyframes, imageUrlPattern, loadController, useMultithreading, preventDraw ) {
	this._keyframes = keyframes;
	this._imageUrlPattern = imageUrlPattern;
	this._loadController = loadController;
	this._useMultithreading = useMultithreading;
	this._preventDraw = preventDraw;
};

proto = BinaryCompositor.prototype;

proto._getURLObject = function() {
	return window.URL || window.webkitURL || null;
};

proto._supportsMultithread = function() {
	if ( this._getURLObject() && window.Worker && window.Blob ) {
        return true;
    }
    return false;
};

proto._initDiffRender = function (images) {
	this._images = images;
	this.canvas.height = images[0].height;
	this.canvas.width = images[0].width;
	this.applyFrame(images[0]);
};

proto.init = function (canvas) {
	this.canvas = canvas || document.createElement('canvas');
	this.context = canvas.getContext('2d');

	return this._loadController
	// Load keyframes
	.loadKeyframes()

	// Then set up canvas dimensions and draw keyframe
	.then(this._initDiffRender.bind(this))

	// Then load manifest, changing promise returned to that of the AJAX adapter
	// In flow.Flow#init, this creats the diffRenderer, which then loads the diff images
	.then(this._loadController.loadManifest.bind(this._loadController));
};


proto.createDiffRender = function (flowData) {
	if ( this._useMultithreading && this._supportsMultithread() ) {
		this._diffRender = new AC_BinaryMultithreadDiffRender(flowData, this._imageUrlPattern);
	} else {
		this._diffRender = new AC_BinaryDiffRender(flowData, this._imageUrlPattern, this._loadController);
	}
	return this._diffRender.init();
};


proto.applyFrame = function (image) {
	// apply images
	var context = this.context,
		binaryFrame;
	context.drawImage(image, 0, 0);
	if ( this._diffRender ) {
		this._diffRender.forceBinaryComposite();
		binaryFrame = this._diffRender.forceKeyframeRender( this.canvas, this.context );
		if ( !this.imageData ) {
			this.imageData = this.context.createImageData( binaryFrame.width, binaryFrame.height );
		}

		this.imageData.data.set( binaryFrame.buf8 );
	}

	// force a filter if a filter on the content if a filter exists 
	/*
	if ( this._diffRender && AC_BinaryDiffRender.prototype._filterImageData !== this._diffRender._filterImageData ) {
		this.applyBinaryFrame( this._diffRender.forceKeyframeRender( this.canvas, this.context ) );
	}
	*/
	//return this.canvas;
};

proto.applyBinaryFrame = function (binaryFrame, force) {
	if ( !this.imageData ) {
		this.imageData = this.context.createImageData( binaryFrame.width, binaryFrame.height );
	}

	// see if we need to do a beforeDrawOperation
	if ( this._beforeDrawOperation ) {
		binaryFrame = this._beforeDrawOperation( binaryFrame );
	}

	this.imageData.data.set( binaryFrame.buf8 );

	if ( !this._preventDraw || force ) {
		this.context.putImageData( this.imageData, 0, 0 );
	}

	// see if we need to do an afterDrawOperation
	if ( this._afterDrawOperation ) {
		binaryFrame = this._afterDrawOperation( binaryFrame );
	}
};

proto.calculateRenderCount = function (fromFrame, toFrame) {
	var count = 0;

	// if our from-to path requries us to cross the beginning or end boundaries
	if (Math.abs(toFrame - fromFrame) >= toFrame) {
		fromFrame = 1;
		count = 1;
	} else if (Math.abs(toFrame - fromFrame) >= (this.frameCount - toFrame) && this._images[1]) {
		fromFrame = this.frameCount - 2;
		count = 1;
	}

	if (toFrame > 0 && toFrame < this.frameCount - 1) {
		return Math.abs(fromFrame - toFrame) + count;
	} else {
		return count;
	}
};

proto.compositeFrames = function (fromFrame, toFrame) {
	var deferred = new Deferred(),
		binaryFrame;
	
	toFrame = (this.frameCount < toFrame) ? this.frameCount - 1 : (toFrame < 0) ? 0 : toFrame;
	fromFrame = (this.frameCount - 2 < fromFrame) ? this.frameCount - 2 : (fromFrame < 0) ? 0 : fromFrame;

	var inc,
		binaryFramePromise,
		binaryFrame;

	// check if toFrame is closer to start or end of flow than the fromFrame
	if (Math.abs(toFrame - fromFrame) >= toFrame) {
		fromFrame = 1;
		if (DEBUG) {
			console.log('applying start keyframe');
		}

		this.applyFrame(this._images[0]);
		return deferred.resolve(); // TODO: Is this needed?
	} else if (Math.abs(toFrame - fromFrame) >= (this.frameCount - toFrame) && this._images[1]) {
		fromFrame = this.frameCount - 2;
		if (DEBUG) {
			console.log('applying end keyframe');
		}
		this.applyFrame(this._images[1]);
		return deferred.resolve(); // TODO: Is this needed?
	}

	inc = (fromFrame > toFrame) ? -1 : (fromFrame < toFrame) ? 1 : 0;

	//setTimeout( function() {
		if (toFrame > 0 && toFrame < this.frameCount - 1) {
			
			while (fromFrame !== toFrame) {
				//deferred.progress(fromFrame);
				binaryFramePromise = this._diffRender.renderDiff(this.canvas, fromFrame, this.context);
				fromFrame += inc;
				//deferred.progress(fromFrame);
			}
		}

		if ( binaryFramePromise ) {
			binaryFramePromise.then( deferred.resolve.bind( deferred ) );
		} else {
			deferred.resolve();
		}

	//}.bind( this ), 100 );

	return deferred.promise();

};

// Escape hatch for non ecmascript 5 browsers
if (typeof Object.defineProperties !== 'function') {
	return function () {};
}


Object.defineProperties(proto, {
	/**
	 *	@name flow.compositor.Sequence#frameCount
	 *	@description Number of frames in the flow
	 */
	frameCount: {
		get: function () {
			return this._diffRender.frames.length + 2;
		},
		enumerable: true
	},
	/**
	 *	@name flow.compositor.Sequence#canvas
	 *	@description Compositing canvas
	 */
	canvas: {
		get: function () {
			return this._canvas;
		},
		set: function (canvas) {
			return this._canvas = canvas;
		},
		enumerable: true
	},
	/**
	 *	@name flow.compositor.Sequence#mainCompositor
	 *	@description Used by decorators to reference this top level compositor instance
	 **/
	mainCompositor: {
		get: function () {
			var compositor = this;
			while (compositor._compositor) {
				compositor = compositor._compositor;
			}
			return compositor;
		},
		enumerable: true
	},

	'_beforeDrawOperation' : {
		value : undefined,
		enumerable : false,
		writable : true
	},

	'_afterDrawOperation' : {
		value : undefined,
		enumerable : false,
		writable : true
	},

	'beforeDrawOperation' : {
		get : function() {
			return this._beforeDrawOperation;
		},
		set : function( beforeDrawOperation ) {
			if ( typeof beforeDrawOperation === 'function' ) {
				this._beforeDrawOperation = beforeDrawOperation;
				return;
			}
			this._beforeDrawOperation = undefined;
		},
		enumerable : true
	},

	'afterDrawOperation' : {
		get : function() {
			return this._afterDrawOperation;
		},
		set : function( afterDrawOperation ) {
			if ( typeof afterDrawOperation === 'function' ) {
				this._afterDrawOperation = afterDrawOperation;
				return;
			}
			this._afterDrawOperation = undefined;
		},
		enumerable : true
	}
});

module.exports = BinaryCompositor;

},{"../diff/BinaryMultithreadRender":751,"../diff/BinaryRender":752,"ac-deferred":723}],736:[function(require,module,exports){
/*global module */
"use strict";

// DEBUG CODE
var count = 0,
	countTarget;

function countUp() {
	if ( !countTarget ) {
		countTarget = document.getElementById( 'counter' );
	}

	count++;
	countTarget.textContent = count;
}

var proto,
	DEBUG = false,
	AC_FlowDiffRender = require('../diff/Render'),
	Deferred = require('ac-deferred').Deferred;

/**
 *	@name flow.compositor.Sequence
 *	@description Implements {FlowCompositor}
 *	@param {Array} keyframes urls to start image and end keyframe images
 *	@param {String} imageUrlPattern diff image pattern
 *	@param {flow.data.Provider} flowDataProvider A source for providing the {@link flow.data.Manifest}
 *	@augments flow.compositor
 *	@class Base flow compositor
*/
function FlowCompositorSequence (keyframes, imageUrlPattern, loadController, renderType) {
	this._keyframes = keyframes;
	this._imageUrlPattern = imageUrlPattern;
	this._loadController = loadController;
	this._renderType = renderType || 'default';
}

proto = FlowCompositorSequence.prototype;

/**
 *	@name flow.compositor.Sequence#__initDiffRender
 *	@description Loads flow manifest data, called after successful loading of first and last keyframe images.
 *	@param {Array} images Keyframe images.
 *	@return {defer.Promise}
 *	@private
 *	@function
 */
proto._initDiffRender = function(images) {
	this._images = images;
	this.canvas.height = images[0].height;
	this.canvas.width = images[0].width;
	this.applyFrame(images[0]);
	return new Deferred().resolve();
};

/**
 *	@name flow.compositor.Sequence#init
 *	@description initialize compositor
 *	@function
 *	@param {canvas} canvas compositing canvas
 *	@return {defer.Promise} Resolved when initialization is complete.
 */
proto.init = function (canvas) {
	this.canvas = canvas || document.createElement('canvas');
	this.context = canvas.getContext('2d');

	return this._loadController
	// Load keyframes
	.loadKeyframes()

	// Then set up canvas dimensions and draw keyframe
	.then(this._initDiffRender.bind(this))

	// Then load manifest, changing promise returned to that of the AJAX adapter
	// In flow.Flow#init, this creats the diffRenderer, which then loads the diff images
	.then(this._loadController.loadManifest.bind(this._loadController))
};

/**
 * @name flow.compositor.Sequence#createDiffRender
 * @description creates the a diff render object for the compositor
 * @param {Object} flowData Data from the manifest
 * @return {defer.Promise} Resolved when the diff render object has loaded and stored the diff images
 */
proto.createDiffRender = function (flowData) {
	this._diffRender = new AC_FlowDiffRender(flowData, this._imageUrlPattern, this._loadController);
	return this._diffRender.init();
};

/**
 *	@name flow.compositor.Sequence#applyFrame
 *	@description Applies a single pre-rendered image to the composition.
 *	@function
 *	@param {image|canvas} image the image to draw.
 */
proto.applyFrame = function (image) {
	// apply images
	var context = this.context;
	context.drawImage(image, 0, 0);
	//return this.canvas;
};

/**
 *	@name flow.compositor.Sequence#calculateRenderCount
 *	@description Calculates the number of renders required to get from fromFrame to toFrame.
 *	@param {Int} fromFrame start frame
 *	@param {Int} toFrame end frame
 *	@function
 *	@return {Int} Number of renders required to get from fromFrame to toFrame
 */
proto.calculateRenderCount = function (fromFrame, toFrame) {
	var count = 0;

	// if our from-to path requries us to cross the beginning or end boundaries
	if (Math.abs(toFrame - fromFrame) >= toFrame) {
		fromFrame = 1;
		count = 1;
	} else if (Math.abs(toFrame - fromFrame) >= (this.frameCount - toFrame) && this._images[1]) {
		fromFrame = this.frameCount - 2;
		count = 1;
	}

	if (toFrame > 0 && toFrame < this.frameCount - 1) {
		return Math.abs(fromFrame - toFrame) + count;
	} else {
		return count;
	}
};

/**
 *	@name flow.compositor.Sequence#compositeFrames
 *	@description composite frames from fromFrame to toFrame
 *	@param {Int} fromFrame start frame
 *	@param {Int} toFrame end frame
 *	@function
 *	@return {defer.Promise} resolved when compositing of frames is complete
 */
proto.compositeFrames = function (fromFrame, toFrame) {
	var deferred = new Deferred();

	toFrame = (this.frameCount < toFrame) ? this.frameCount - 1 : (toFrame < 0) ? 0 : toFrame;
	fromFrame = (this.frameCount - 2 < fromFrame) ? this.frameCount - 2 : (fromFrame < 0) ? 0 : fromFrame;

	var inc;

	if (DEBUG) {
		console.groupCollapsed('Rendering diff frames: ' + fromFrame + '...' + toFrame);
	}

	// check if toFrame is closer to start or end of flow than the fromFrame
	if (Math.abs(toFrame - fromFrame) >= toFrame) {
		fromFrame = 1;
		if (DEBUG) {
			console.log('applying start keyframe');
		}
		this.applyFrame(this._images[0]);
	} else if (Math.abs(toFrame - fromFrame) >= (this.frameCount - toFrame) && this._images[1]) {
		fromFrame = this.frameCount - 2;
		if (DEBUG) {
			console.log('applying end keyframe');
		}
		this.applyFrame(this._images[1]);
	}

	inc = (fromFrame > toFrame) ? -1 : (fromFrame < toFrame) ? 1 : 0;

	if (toFrame > 0 && toFrame < this.frameCount - 1) {
		while (fromFrame !== toFrame) {
			//deferred.progress(fromFrame);
			this._diffRender.renderDiff(this.canvas, fromFrame);
			fromFrame += inc;
			//deferred.progress(fromFrame);
		}
	}
	if (DEBUG) {
		console.groupEnd();
	}
	deferred.resolve(fromFrame);

	return deferred.promise();
};


// Escape hatch for non ecmascript 5 browsers
if (typeof Object.defineProperties !== 'function') {
	return function () {};
}


Object.defineProperties(proto, {
	/**
	 *	@name flow.compositor.Sequence#frameCount
	 *	@description Number of frames in the flow
	 */
	frameCount: {
		get: function () {
			return this._diffRender.frames.length + 2;
		},
		enumerable: true
	},
	/**
	 *	@name flow.compositor.Sequence#canvas
	 *	@description Compositing canvas
	 */
	canvas: {
		get: function () {
			return this._canvas;
		},
		set: function (canvas) {
			return this._canvas = canvas;
		},
		enumerable: true
	},
	/**
	 *	@name flow.compositor.Sequence#mainCompositor
	 *	@description Used by decorators to reference this top level compositor instance
	 **/
	mainCompositor: {
		get: function () {
			var compositor = this;
			while (compositor._compositor) {
				compositor = compositor._compositor;
			}
			return compositor;
		},
		enumerable: true
	}
});

module.exports = FlowCompositorSequence;

},{"../diff/Render":754,"ac-deferred":723}],737:[function(require,module,exports){
/*global module */
"use strict";
var proto,
	AC_Benchmarker = require('../../../stats/Benchmark');

/**
 *	@name flow.compositor.decorator.Benchmark
 *	@description Decorates a {flow.compositor} Implements {flow.compositor}
 *	@param {flow.compositor} slaveCompositor Flow compositor fall back to.
 *	@augments flow.compositor
 *	@class Times how long compositing actions take to complete.
 */
function FlowCompositorDecoratorBenchmark(slaveCompositor) {
	this._compositor = slaveCompositor;
}

proto = FlowCompositorDecoratorBenchmark.prototype;

/**
 *	@name flow.compositor.decorator.Benchmark#init
 *	@description Initialize compositor and records the time to complete.
 *	@function
 *	@param {Canvas} canvas Compositing canvas
 *	@return {defer.Promise} resolved when initialization is complete.
 */
proto.init = function (canvas) {
	var benchmark = new AC_Benchmarker('init');
	benchmark.start();
	return this._compositor.init.apply(this._compositor, arguments)
		.then(benchmark.end.bind(benchmark));
};

/**
 *	@name flow.compositor.decorator.Benchmark#applyFrame
 *	@description Applies a single pre-rendered image to the composition. Records the time to complete composite.
 *	@function
 *	@param {image|canvas} image The image to draw.
 */
proto.applyFrame = function () {
	var benchmark = new AC_Benchmarker('applyFrame');
	benchmark.start();
	this._compositor.applyFrame.apply(this._compositor, arguments);
	benchmark.end.bind(benchmark);
};

/**
 *	@name flow.compositor.decorator.Benchmark#calculateRenderCount
 *	@description Calculates the number of renders required to get from fromFrame to toFrame.
 *	@param {Int} fromFrame start frame
 *	@param {Int} toFrame end frame
 *	@function
 *	@return {Int} Number of renders required to get from fromFrame to toFrame
 *	@augments FlowCompositorSequence#calculateRenderCount
 */
proto.calculateRenderCount = function () {
	return this._compositor.calculateRenderCount.apply(this._compositor, arguments);
};

/**
 *	@name flow.compositor.decorator.Benchmark#compositeFrames
 *	@description Composite frames from fromFrame to toFrame
 *	@function
 *	@param {Int} fromFrame start frame
 *	@param {Int} toFrame end frame
 *	@return {defer.Promise} resolved when compositing of frames is complete
 */
proto.compositeFrames = function () {
	var benchmark = new AC_Benchmarker('renderFrames');
	benchmark.start();
	return this._compositor.compositeFrames.apply(this._compositor, arguments)
		.then(benchmark.end.bind(benchmark));
};


// Escape hatch for non ecmascript 5 browsers
if (typeof Object.defineProperties !== 'function') {
	return function () {};
}


Object.defineProperties(proto, {
	frameCount: {
		get : function () {
			return this._compositor.frameCount;
		},
		enumerable : true
	},
	canvas: {
		get : function () {
			return this._compositor.canvas;
		},
		set : function (canvas) {
			return this._compositor.canvas = canvas;
		},
		enumerable : true
	}
});

FlowCompositorDecoratorBenchmark.prototype = proto;

module.exports = FlowCompositorDecoratorBenchmark;
},{"../../../stats/Benchmark":758}],738:[function(require,module,exports){
/*global module */
"use strict";
var proto,
	DEBUG = false;

function FlowCompositorDecoratorCache(slaveCompositor, keyframeInterval) {
	this._compositor = slaveCompositor;
	this._keyframeInterval = keyframeInterval || 8;
	this._keyframes = [];
}

proto = FlowCompositorDecoratorCache.prototype;

/**
 *	@private
 */
proto._getClosestKeyframe = function (toFrame) {

	var keyframeOffset = toFrame % this._keyframeInterval,
		targetKeyframe = Math.floor(toFrame / this._keyframeInterval) + ((keyframeOffset > (this._keyframeInterval / 2)) ? 1 : 0);

	return targetKeyframe;
};

/**
 *	@private
 */
proto._getFrameFromKeyframe = function (targetKeyframe) {
	return targetKeyframe * this._keyframeInterval;
};

/**
 *	@private
 */
proto._saveKeyframe = function (frame) {
	var keyframeCanvas,
		keyframe = Math.floor(frame / this._keyframeInterval);
	if (frame % this._keyframeInterval === 0 && !this._keyframes[keyframe]) {
		if (DEBUG) {
			console.log('saving keyframe ' + frame);
		}
		keyframeCanvas = document.createElement('canvas');
		keyframeCanvas.width = this._compositor.canvas.width;
		keyframeCanvas.height = this._compositor.canvas.height;
		keyframeCanvas.getContext('2d').drawImage(this._compositor.canvas, 0, 0);
		this._keyframes[keyframe] = keyframeCanvas;
	}
};

/**
 *	@name flow.compositor.decorator.Cache#init
 *	@description initialize compositor
 *	@function
 *	@param {canvas} canvas compositing canvas
 *	@return {defer.Promise} resolved when initialization is complete.
 */
proto.init = function (canvas) {
	return this._compositor.init.apply(this._compositor, arguments);
};

/**
 *	@name flow.compositor.decorator.Cache#applyFrame
 *	@description Applies a single pre-rendered image to the composition.
 *	@function
 *	@param {image|canvas} image the image to draw.
 */
proto.applyFrame = function () {
	this._compositor.applyFrame.apply(this._compositor, arguments);
};

/**
 *	@name flow.compositor.decorator.Cache#calculateRenderCount
 *	@description Calculates the number of renders required to get from fromFrame to toFrame.
 *	@param {Int} fromFrame start frame
 *	@param {Int} toFrame end frame
 *	@function
 *	@return {Int} Number of renders required to get from fromFrame to toFrame
 */
proto.calculateRenderCount = function (fromFrame, toFrame) {
	fromFrame = this._getFrameFromKeyframe(this._getClosestKeyframe(toFrame));
	return this._compositor.calculateRenderCount(fromFrame, toFrame) + 1;
};

/**
 *	@name flow.compositor.decorator.Cache#compositeFrames
 *	@description composite frames from fromFrame to toFrame
 *	@param {Int} fromFrame start frame
 *	@param {Int} toFrame end frame
 *	@function
 *	@return {defer.Promise} resolved when compositing of frames is complete
 */
proto.compositeFrames = function (fromFrame, toFrame) {
	var targetKeyframe = this._getClosestKeyframe(toFrame);
	if (DEBUG) {
		console.groupCollapsed('Rendering frames: ' + fromFrame + '...' + toFrame);
	}

	if (this._keyframes[targetKeyframe] && (this._compositor.calculateRenderCount(fromFrame, toFrame) > this.calculateRenderCount(fromFrame, toFrame))) {
		fromFrame = this._getFrameFromKeyframe(targetKeyframe);
		if (DEBUG) {
			console.log('applying prerendered keyframe: '+ fromFrame);
		}
		this.applyFrame(this._keyframes[targetKeyframe]);
		return this._compositor.compositeFrames(fromFrame, toFrame)
			.then(
				function compositeFramesResolved() { if (DEBUG) { console.groupEnd(); }});
	} else {
		return this._compositor.compositeFrames(fromFrame, toFrame)
			.then(
				function compositeFramesResolved() {  if (DEBUG) { console.groupEnd(); }},
				null,
				this._saveKeyframe.bind(this));
	}
};


// Escape hatch for non ecmascript 5 browsers
if (typeof Object.defineProperties !== 'function') {
	return function () {};
}


Object.defineProperties(proto, {
	frameCount: {
		get: function () {
			return this._compositor.frameCount;
		},
		enumerable: true
	},
	canvas: {
		get: function () {
			return this._compositor.canvas;
		},
		set: function (canvas) {
			return this._compositor.canvas = canvas;
		},
		enumerable: true
	}
});

module.exports = FlowCompositorDecoratorCache;
},{}],739:[function(require,module,exports){
/*global module */
"use strict";
var proto,
	DEBUG = false,
	AC_FlowKeyframeRender = require('../../keyframe/Render'),
	Deferred = require('ac-deferred').Deferred;

/**
 *	@name flow.compositor.decorator.Keyframe
 *	@description Implements {FlowCompositor}
 *	@param {flow.compositor} slaveCompositor Flow compositor to decorate
 *	@augments flow.compositor
 *	@class Support for manifest version 3 keyframe image diffs
*/
function FlowCompositorDecoratorKeyframe (slaveCompositor) {
	this._compositor = slaveCompositor;
	this._flowDataProvider = this.mainCompositor._loadController._loaders.manifest;
}

proto = FlowCompositorDecoratorKeyframe.prototype;

/**
 *	@name flow.compositor.decorator.Keyframe#init
 *	@description initialize compositor
 *	@function
 *	@param {canvas} canvas compositing canvas
 *	@return {defer.Promise} resolved when initialization is complete.
 */
proto.init = function (canvas) {
	this._keyframeDiffRender = new AC_FlowKeyframeRender(this._flowDataProvider._data, this.mainCompositor._imageUrlPattern);
	// this._compositor.init(canvas);
	return this._keyframeDiffRender.init();
};

/**
 *	@name flow.compositor.decorator.Keyframe#applyFrame
 *	@description Applies a single pre-rendered image to the composition.
 *	@function
 *	@param {image|canvas} image the image to draw.
 */
proto.applyFrame = function (image) {
	return this._compositor.applyFrame.apply(this._compositor, arguments);
};

/**
 *	@name flow.compositor.decorator.SuperKeyframe#applyKeyframe
 *	@descripiton Applies a keyframe image to the canvas
 *	@function
 *	@param {Number} frame The framenumber of the keyframe to render
 **/
proto.applyKeyframe = function (frame, subRect) {
	this._keyframeDiffRender.renderKeyframe(this.canvas, frame, subRect);
};

/**
 *	@name flow.compositor.decorator.Keyframe#compositeFrames
 *	@description composite frames from fromFrame to toFrame
 *	@param {Int} fromFrame start frame
 *	@param {Int} toFrame end frame
 *	@function
 *	@return {defer.Promise} resolved when compositing of frames is complete
 */
proto.compositeFrames = function (fromFrame, toFrame) {
	if (!this._isKeyframeDiff(toFrame - 1)) {
		return this._compositor.compositeFrames.apply(this._compositor, arguments);
	}

	var deferred = new Deferred();

	if (DEBUG) {
		console.groupCollapsed('Rendering keyframe diff image: ' + (fromFrame - 1));
	}

	this.applyKeyframe(toFrame - 1);

	if (DEBUG) {
		console.groupEnd();
	}

	deferred.resolve(fromFrame - 1);

	return deferred.promise();
};

/**
 *	@name flow.compositor.decorator.Keyframe#_isKeyframeDiff
 *	@description Is the given frame a keyframe diff image?
 *	@param {Nubmer} frame The non-frameCount relative frame number
 *	@function
 *	@return {Boolean}
 **/
proto._isKeyframeDiff = function (frame) {
	return frame in this._keyframeDiffRender._loader._keyframes;
};

/**
 *	@name flow.compositor.decorator.Keyframe#calculateRenderCount
 *	@description Calculates the number of renders required to get from fromFrame to toFrame.
 *	@param {Int} fromFrame frameCount relative start frame
 *	@param {Int} toFrame frameCount relative end frame
 *	@function
 *	@return {Int} Number of renders required to get from fromFrame to toFrame
 */
proto.calculateRenderCount = function (fromFrame, toFrame) {
	return this._compositor.calculateRenderCount.apply(this._compositor, arguments);
};


// Escape hatch for non ecmascript 5 browsers
if (typeof Object.defineProperties !== 'function') {
	return function () {};
}


Object.defineProperties(proto, {
	/**
	 *	@name flow.compositor.decorator.Keyframe#frameCount
	 *	@description Number of frames in the flow
	 */
	frameCount: {
		get: function () {
			return this._compositor.frameCount;
		},
		enumerable: true
	},
	/**
	 *	@name flow.compositor.decorator.Keyframe#canvas
	 *	@description Compositing canvas
	 */
	canvas: {
		get: function () {
			return this._compositor.canvas;
		},
		set: function (canvas) {
			return this._compositor.canvas = canvas;
		},
		enumerable: true
	},
	/**
	 *	@name flow.compositor.decorator.Keyframe#mainCompositor
	 *	@description The top level compositor instance
	 **/
	mainCompositor: {
		get: function () {
			return this._compositor.mainCompositor;
		},
		enumerable: true
	}
});

module.exports = FlowCompositorDecoratorKeyframe;
},{"../../keyframe/Render":756,"ac-deferred":723}],740:[function(require,module,exports){
/*global module */
"use strict";
var proto,
	DEBUG = false,
	Deferred = require('ac-deferred').Deferred;

function FlowCompositorDecoratorSuperKeyframe (slaveCompositor) {
	this._compositor = slaveCompositor;
	this._frames = this.mainCompositor._loadController._loaders.manifest._data.frames;
	this._superframeInterval = this.mainCompositor._diffRender.flowData.superframeFrequency;
}

proto = FlowCompositorDecoratorSuperKeyframe.prototype;

/**
 *	@name flow.compositor.decorator.SuperKeyframe#init
 *	@description initialize compositor
 *	@function
 *	@param {canvas} canvas compositing canvas
 *	@return {defer.Promise} resolved when initialization is complete.
 */
proto.init = function (canvas) {
	return this._compositor.init.apply(this._compositor, arguments);
};

/**
 *	@name flow.compositor.decorator.SuperKeyframe#applyFrame
 *	@description Applies a single pre-rendered image to the composition.
 *	@function
 *	@param {image|canvas} image the image to draw.
 */
proto.applyFrame = function (image) {
	return this._compositor.applyFrame.apply(this._compositor, arguments);
};


/**
 *	@name flow.compositor.decorator.SuperKeyframe#applyKeyframe
 *	@descripiton Applies a keyframe image to the canvas
 *	@function
 *	@param {Number} frame The framenumber of the keyframe to render
 *	@param {boolean|null} Optional. Whether or not to have drawImage() draw the keyframe diff image as sub-rectangle.
 **/
proto.applyKeyframe = function (frame, subRect) {
	this._compositor.applyKeyframe.apply(this._compositor, arguments);
};

/**
 *	@name flow.compositor.decorator.SuperKeyframe#compositeFrames
 *	@description composite frames from fromFrame to toFrame
 *	@param {Int} fromFrame start frame
 *	@param {Int} toFrame end frame
 *	@function
 *	@return {defer.Promise} resolved when compositing of frames is complete
 */
proto.compositeFrames = function (fromFrame, toFrame) {
	// Remember - The overall timeline starts at frame 0 and ends at this.frameCount.
	// frame 0 is start keyframe, this.frameCount is endframe
	// Our array of frames is zero indexed, but does not include the key/endframes so
	// its length is two less than this.frameCount and the fromFrame and toFrame params
	// will be offset by +1 from the internal frames array.
	var subRect, shortestRenderFrame,
		deferred = new Deferred();

	if (toFrame < 1 || toFrame > this.frameCount - 2) {
		return this._compositor.compositeFrames.apply(this._compositor, arguments);
	}

	// Don't mess around. Draw frame if toFrame is a superKeyframe
	if (this._isKeyframeDiff(toFrame - 1)) {
		// Only draw the entire keyframe image if toFrame is not a neighbor of fromFrame
		subRect = Math.abs(fromFrame - toFrame) === 1 ? true : false;

		if (DEBUG) {
			console.groupCollapsed('Drawing superKeyframe image: ' + (toFrame - 1));
		}

		this.applyKeyframe(toFrame - 1, subRect);

		if (DEBUG) {
			console.groupEnd();
		}

		deferred.resolve(fromFrame - 1);
		return deferred.promise();
	}

	// if render distance is greater than superframeInterval, look for superkeyframes
	if (Math.abs(toFrame - fromFrame) > this._superframeInterval) {
		shortestRenderFrame = this._getShortestRender(fromFrame, toFrame);

		// if the shortest render path is from a superKeyframe
		if (this._isKeyframeDiff(shortestRenderFrame - 1) || shortestRenderFrame <= 0 || shortestRenderFrame >= this.frameCount - 2) {
			return this._compositeFromSuperKeyframe(shortestRenderFrame, toFrame);
		}
	}

	if (DEBUG) {
		console.log('SuperKeyframe compositor handing off to slave compositor: fromFrame:' + fromFrame + ' toFrame:' + toFrame);
	}
	// render frame via superFrame compositor
	return this._compositor.compositeFrames.apply(this._compositor, [fromFrame, toFrame]);
};


/**
 *	@name flow.compositor.decorator.SuperKeyframe#_getShortestRender
 *	@description Finds the shortest render path between the two given frames via superKeyframes or superFrames
 *	@function
 *	@param {Int} fromFrame The frameCount relative frame to begin the search from
 *	@param {Int} toFrame The frameCount relative frame to render to
 *	@return {Int} The frameCount relative frame form which the shortest render path is possible.
 **/
proto._getShortestRender = function (fromFrame, toFrame) {
	var renderCount = this._compositor.calculateRenderCount,
		closestSuperKeyframe = this._getClosestSuperKeyframe(toFrame - 1),
		superKeyframeRenders = renderCount.apply(this._compositor, [closestSuperKeyframe, toFrame]) + 1,
		fromFrameRenders = renderCount.apply(this._compositor, [fromFrame, toFrame]);

		if (superKeyframeRenders <= fromFrameRenders) {
			return closestSuperKeyframe;
		} else {
			return fromFrame;
		}
};


/**
 *	@name flow.compositor.decorator.SuperKeyframe#_compositeFromSuperKeyframe
 *	@description Handles compositing to a specified frame from its closest superKeyframe
 *	@funciton
 *	@param {Int} superKeyframe The frame number of the closestSuperkeyframe
 *	@param {Int} toFrame The frame number of the frame to composite to
 *	@return {defer.Promise} resolved when compositing of frames is complete
 **/
proto._compositeFromSuperKeyframe = function (superKeyframe, toFrame) {
	var ctx = this.canvas.getContext('2d'),
		img = (superKeyframe <= 0) ? this.mainCompositor._images[0] : (superKeyframe >= this.frameCount - 2 ? this.mainCompositor._images[1] : this._frames[superKeyframe - 1].image),
		promise;

	// draw the superKeyframe to the canvas as a base to composite the remaing frames from
	if (DEBUG) {
		console.log('Drawing superKeyframe for composite base: superKeyframe ' + (superKeyframe - 1));
	}
	ctx.drawImage(img, 0, 0);

	// composite the remaining frames via superframe compositor
	return this._compositor.compositeFrames.call(this._compositor, superKeyframe, toFrame);
};


/**
 *	@name flow.compositor.decorator.SuperKeyframe#_getClosestSuperframe
 *	@description Finds the closest superframe to the given frame
 *	@param {Int} fromFrame Frame to start from
 *	@return {Int} the closest superframe
 *	@function
 **/
proto._getClosestSuperFrame = function (fromFrame) {
	return Math.round(fromFrame / this._superframeInterval) * this._superframeInterval;
};


/**
 *	@name flow.compositor.decorator.SuperKeyframe#_getClosestSuperKeyframe
 *	@description Finds the closest superKeyframe to the given frame.
 *	@function
 *	@param {Int} fromFrame The frame
 *	@return {Int} The frame number of the closest superKeyframe in a zero-indexed context
 *	where the key/endframes are the first and last frames respectively.
 **/
proto._getClosestSuperKeyframe = function (fromFrame) {
	var before, after, keyframe, i, len = this._frames.length;

	if (fromFrame < len + 1 && fromFrame > 0) {
		// backwards
		i = fromFrame - 1;
		while (i >= 0) {
			if (this._frames[i].type === 'keyframe') {
				before = i + 1;
				break;
			}
			i -= 1;
		}

		// forwards
		i = fromFrame + 1;
		while (i <= len - 1) {
			if (this._frames[i].type === 'keyframe') {
				after = i + 1;
				break;
			}
			i += 1;
		}
	}

	before = before ? before : 0;
	after = after ? after : this.frameCount;
	keyframe = (fromFrame - before) < (after - fromFrame) ? before : after;
	return keyframe;
};


/**
 *	@name flow.compositor.decorator.Keyframe#_isKeyframeDiff
 *	@description Is the given frame a keyframe diff image?
 *	@param {Nubmer} frame The frame number in the this._frames array
 *	@function
 *	@return {Boolean}
 **/
proto._isKeyframeDiff = function (frame) {
	return this._compositor._isKeyframeDiff.apply(this._compositor, arguments);
};


// Escape hatch for non ecmascript 5 browsers
if (typeof Object.defineProperties !== 'function') {
	return function () {};
}


Object.defineProperties(proto, {
	/**
	 *	@name flow.compositor.decorator.SuperKeyframe#frameCount
	 *	@description Number of frames in the flow
	 */
	frameCount: {
		get: function () {
			return this._compositor.frameCount;
		},
		enumerable: true
	},
	/**
	 *	@name flow.compositor.decorator.SuperKeyframe#canvas
	 *	@description Compositing canvas
	 */
	canvas: {
		get: function () {
			return this._compositor.canvas;
		},
		set: function (canvas) {
			return this._compositor.canvas = canvas;
		},
		enumerable: true
	},
	/**
	 *	@name flow.compositor.decorator.SuperKeyframe#mainCompositor
	 *	@description The top level compositor instance
	 **/
	mainCompositor: {
		get: function () {
			return this._compositor.mainCompositor;
		},
		enumerable: true
	}
});

module.exports = FlowCompositorDecoratorSuperKeyframe;
},{"ac-deferred":723}],741:[function(require,module,exports){
/*global module */
"use strict";
var proto,
	DEBUG = false;

function FlowCompositorDecoratorSuperframe(slaveCompositor, superframeInterval) {
	this._compositor = slaveCompositor;
	this._superframeInterval = superframeInterval || 4;
}

proto = FlowCompositorDecoratorSuperframe.prototype;

proto._getClosestSuperframe = function (fromFrame) {
	return Math.round(fromFrame / this._superframeInterval) * this._superframeInterval;
};

/**
 *	@name flow.compositor.decorator.Superframe#init
 *	@description Initialize compositor
 *	@function
 *	@param {canvas} canvas compositing canvas
 *	@return {defer.Promise} resolved when initialization is complete.
 */
proto.init = function (canvas) {
	this._screenCanvas = canvas;
};

/**
 *	@name flow.compositor.decorator.Superframe#applyFrame
 *	@description Applies a single pre-rendered image to the composition.
 *	@function
 *	@param {image|canvas} image the image to draw.
 */
proto.applyFrame = function () {
	this._compositor.applyFrame.apply(this._compositor, arguments);
};


/**
 *	@name flow.compositor.decorator.Superframe#calculateRenderCount
 *	@description Calculates the number of renders required to get from fromFrame to toFrame.
 *	@param {Int} fromFrame start frame
 *	@param {Int} toFrame end frame
 *	@function
 *	@return {Int} Number of renders required to get from fromFrame to toFrame
 */
proto.calculateRenderCount = function (fromFrame, toFrame) {
	var interFrame = this._getClosestSuperframe(fromFrame);
	if (Math.abs(interFrame - toFrame) > this._superframeInterval / 2) {
		fromFrame = interFrame + ((fromFrame > toFrame) ? -1 : 1) * this._superframeInterval;
		return this.calculateRenderCount(fromFrame, toFrame) + 1;
	} else {
		return Math.abs(interFrame - toFrame) + 1;
	}
};

/**
 *	@name flow.compositor.decorator.Superframe#compositeFrames
 *	@description Composite frames from fromFrame to toFrame
 *	@function
 *	@param {Int} fromFrame start frame
 *	@param {Int} toFrame end frame
 *	@return {defer.Promise} resolved when compositing of frames is complete
 */
proto.compositeFrames = function (fromFrame, toFrame) {
	var promise,
		interFrame;

	if (toFrame <= 0 || toFrame >= this.frameCount - 2) {
		this._compositor.compositeFrames(fromFrame, toFrame);
	}

	if (fromFrame > this.frameCount - 2) {
		fromFrame = this.frameCount - 2;
	} else if (fromFrame <= 0) {
		fromFrame = 1;
	}

	interFrame = this._getClosestSuperframe(fromFrame);
	if (DEBUG) {
		console.groupCollapsed('Rendering : ' + fromFrame + '...' + toFrame);
	}

	if (this._compositor.calculateRenderCount(fromFrame, toFrame) > this.calculateRenderCount(fromFrame, toFrame)) {
		if (DEBUG) {
			console.groupCollapsed('Rendering (superframe) : ' + interFrame);
		}
		promise = this._compositor.compositeFrames(interFrame, interFrame)
			.then(function compositeFramesResolved() {
				if (DEBUG) {
					console.groupEnd();
				}
				// fromFrame = interFrame + ((fromFrame > toFrame) ? -1 : 1) * this._superframeInterval;
				// return this.compositeFrames(fromFrame, toFrame);
				var nextSuperFrame = interFrame + ((fromFrame > toFrame) ? -1 : 1) * this._superframeInterval;
				this._compositor.compositeFrames(interFrame, nextSuperFrame).then(function () {
					return this.compositeFrames(nextSuperFrame, toFrame);
				}.bind(this));
			}.bind(this));
	} else {
		if (DEBUG) {
			console.groupCollapsed('Rendering (final frames) : ' + fromFrame + '...' + toFrame);
		}
		promise = this._compositor.compositeFrames(fromFrame, toFrame)
			.then(function compositeFramesResolved() {
				if (DEBUG) {
					console.groupEnd();
				}
			}.bind(this));
	}

	promise.then(function compositeFramesResolved() {
		if (DEBUG) {
			console.groupEnd();
		}
	}.bind(this));

	return promise;
};


// Escape hatch for non ecmascript 5 browsers
if (typeof Object.defineProperties !== 'function') {
	return function () {};
}


Object.defineProperties(proto, {
	/**
	 *	@name flow.compositor.decorator.Superframe#frameCount
	 *	@description Number of frames in the flow
	 */
	frameCount: {
		get: function () {
			return this._compositor.frameCount;
		},
		enumerable : true
	},
	/**
	 *	@name flow.compositor.decorator.Superframe#canvas
	 *	@description Compositing canvas
	 */
	canvas: {
		get: function () {
			return this._compositor.canvas;
		},
		set: function (canvas) {
			return this._compositor.canvas = canvas;
		},
		enumerable: true
	},
	/**
	 *	@name flow.compositor.decorator.Superframe#mainCompositor
	 *	@description The top level compositor instance
	 **/
	mainCompositor: {
		get: function () {
			return this._compositor.mainCompositor;
		},
		enumerable: true
	}
});

module.exports = FlowCompositorDecoratorSuperframe;
},{}],742:[function(require,module,exports){
/*global module */
"use strict";
var proto,
	EventEmitter = require('ac-event-emitter').EventEmitter,
	MultithreadProcess = require('./MultithreadProcess'),
	MultithreadProcessInterface = require('./MultithreadProcessInterface');

// requires a function that will be executed by the thread
var MultithreadController = function( func ) {
	EventEmitter.call( this );
	this._function = func;
};

proto = MultithreadController.prototype = new EventEmitter(null);

proto.exec = function( args, options ) {
    options = options || {};
    // if the thread has not been previously executed, compile a processURL ( a new 'JS' file )
    if ( !this._processURL ) {
        this._processURL = this._createThreadProcessURL( this._function );
    }

    // if there is a process running, but it hasn't been resolved yet, kill the process
    if ( this._process ) {
        this.terminateProcess();
    }

    // if a previous, idle process doesn't exist, create a new one
    if ( !this._process ) {
        // start a new Worker process and bind messages to it
        this._process = new window.Worker( this._processURL );
        // TODO: Will leaving onmessage as bound after thread deletion cause a memory leak?
        this._process.onmessage = this._onMessage.bind( this );
    }
    
    // if transfer ownership is true, we transfer the args over to the thread
    // NOTE: args must be an object for ownership to be transferred
    var ownershipContext;
    if ( options.transfer ) {
        ownershipContext = [ args ];
    }

    // posting a message to the thread starts it up
    this._process.postMessage( args, ownershipContext );

    // return self
    return this;

};

proto.run = function( msg, data, options ) {
	options = options || {};

	var post = {
		name : msg,
		data : data || {}
	};

	var ownershipContext;
	if ( options.transfer ) {
		ownershipContext = [ post ];
	}

	this._process.postMessage( post, ownershipContext );
	this.trigger( msg, data );
};

proto.destroy = function() {
    // Terminate process
    this.terminateProcess();
    // Remove references
    this._function = null;
    this._processURL = null;
    return this;
};

proto.terminateProcess = function() {
    // Terminate process
    if ( this._process ) {
        this._process.terminate();
        this._process = null;
    }
    return this;
};

proto._createThreadProcessURL = function( func ) {
    var funcStr = this._compileProcess( func ),
        blob = new window.Blob( [ funcStr ], { type : 'text/javascript' } );

    return this._getURLObject().createObjectURL( blob );
};

proto._getURLObject = function() {
    return window.URL || window.webkitURL || null;
};

proto._compileProcess = function( func ) {
    var threadProcess = MultithreadProcess.toString();

    var delegateRegExp = /(['|"]){{INTERFACE}}\1/,
        processRegExp = /(['|"]){{PROCESS}}\1/;

    threadProcess = threadProcess.replace(delegateRegExp, '(' + MultithreadProcessInterface.toString() +')();' );
    threadProcess = threadProcess.replace(processRegExp, func.toString() );

    var prefix = '(',
        suffix = ')();';

    return prefix + threadProcess + suffix;
};

proto._handleTrigger = function( evt, data ) {
	this.trigger( evt, data );
};

proto._onMessage = function( obj ) {

	if ( !obj.data ) {
		return;
	}

	var evt = obj.data.evt,
		data = obj.data.data;

	// handle events
	if ( evt === '__trigger__' ) {
		this._handleTrigger( data.trigger, data.data );
	}

	return this;
};

module.exports = MultithreadController;
},{"./MultithreadProcess":743,"./MultithreadProcessInterface":744,"ac-event-emitter":726}],743:[function(require,module,exports){
/*global module */
"use strict";
var MultithreadProcess = function() {

	var Process = '{{PROCESS}}',
        delegate = '{{INTERFACE}}';

    // "this" refers to the global scope of the worker method technically, but that's OK
    this.processInstance;

    this.onmessage = function( Process, workerGlobalScope, message ) {
    	message = message || {};

    	if ( !workerGlobalScope.processInstance ) {
    		workerGlobalScope.processInstance = new Process( this );
    	} else {
    		// refers to .post API in the controller interface
    		workerGlobalScope.processInstance._onMessage( message.data.name, message.data.data );
    	}
    }.bind( delegate, Process, this );
};

module.exports = MultithreadProcess;
},{}],744:[function(require,module,exports){
/*global module */
"use strict";
var MultithreadProcessInterface = function() {

    return {

        trigger : function( msg, data, options ) {
            var post = {
                trigger : msg,
                data : data
            };

            this._post( '__trigger__', post, options );
        },

        _post : function( evt, data, options ) {
            options = options || {};

            var ownershipContext,
                message = {
                evt : evt,
                data : data
            };

            if ( options.transfer ) {
                ownershipContext = [ data ];
            }

            postMessage( message, ownershipContext );
        }

    }

};

module.exports = MultithreadProcessInterface;
},{}],745:[function(require,module,exports){
// Defines the functions that the ProcessDelegate of the thread can execute. Must be self-contained
// "this" API is defined by MultithreadProcessInterface
//
//
// Also, since we're defining an object that will be stringified, it cannot have a prototype
// and instead need variables defined as instance vars

/*global module */
"use strict";
var proto;

var MultithreadRenderer = function( api ) {
	// interface is the MultithreadProcessInterface
	this._interface = api;
	
	this.trigger = function( msg, data, options ) {
		this._interface.trigger( msg, data, options );
		return this;
	};

	this.renderFrameDiffs = function( data ) {
		var binaryFrame = data.binaryFrame,
			compositingData = data.compositingData,
			frame = data.frameData,
			sourceImagesData = data.sourceImagesData,
			len = frame.length,
			i;

		for ( i = 0; i < len; i++ ) {
			binaryFrame = this._applyBlocksToBinaryFrame( binaryFrame, frame[ i ], sourceImagesData,compositingData );
		}

		this.trigger( 'frameReady', binaryFrame );
	};

	this._applyBlocksToBinaryFrame = function( binaryFrame, range, sourceImagesData, compositingData ) {

		var currentBlock = range.block,
			diffIndex = Math.floor(currentBlock / compositingData.blocksPerFullDiff),
			diffWidth = compositingData.imageWidth,
			rangeLength = range.length,
			columnsInCanvas = compositingData.columnsInCanvas,
			canvasWidth = compositingData.canvasWidth,
			blockInDiff = currentBlock % compositingData.blocksPerFullDiff,
			columnsPerDiff = diffWidth / compositingData.blockSize;

		var diffX = ( blockInDiff % columnsPerDiff ) * compositingData.blockSize,
			diffY = Math.floor( blockInDiff / (columnsPerDiff || 1 ) ) * compositingData.blockSize,
			canvasX = ( range.location % columnsInCanvas ) * compositingData.blockSize,
			canvasY = Math.floor( range.location / columnsInCanvas ) * compositingData.blockSize;

		var x,
			y,
			idx,
			sourceImageData,
			diffArrayIndex,
			canvasArrayIndex,
			blockRunWidth,
			blockRunCount;

		while( rangeLength > 0 ) {

			blockRunWidth = Math.min( ( rangeLength * compositingData.blockSize ), canvasWidth - canvasX, diffWidth - diffX );
			blockRunCount = blockRunWidth / compositingData.blockSize;

			// draw here
			
			// 32 bit rendering 
			sourceImageData = sourceImagesData[ diffIndex ];

			for ( y = 0; y < compositingData.blockSize; y++ ) {
				// for however long the string of pixels are ( x-coordinate )
				for ( x = 0; x < blockRunWidth; x++ ) {
					// get the pixels from the source (rgba values)
					diffArrayIndex = ( diffY + y ) * diffWidth + ( diffX + x );
					canvasArrayIndex = ( canvasY + y ) * canvasWidth + ( canvasX + x );

					binaryFrame.buf32[ canvasArrayIndex ] = sourceImageData[ diffArrayIndex ];
				}
			}

			rangeLength -= blockRunCount;

			if ( rangeLength > 0 ) {

				// We're ready to move to the next row if we've already placed a row of blocks and have more to go!
				if ( ( diffX += blockRunWidth ) >= diffWidth ) {
					diffX = 0;
					diffY += compositingData.blockSize;
				}

				// If we've reached the end of the diffImage, we need to move onto the next one.
				if ( ( blockInDiff += blockRunCount ) >= compositingData.blocksPerFullDiff ) {
					// Reset to 0 and increment the image number
					blockInDiff = 0;
					diffX = 0;
					diffY = 0;
					diffIndex += 1;

					// Last diff image can be a smaller size
					if ( diffIndex === compositingData.imagesRequired - 1 ) {
						diffWidth = compositingData.imageWidth;
					}
				}

				// Move the canvas location if we've drawn to the end of the canvas
				if ( ( canvasX += blockRunWidth ) >= canvasWidth ) {
					canvasX = 0;
					canvasY += compositingData.blockSize;
				}

				// Move our temporary current block cursor to the next block in our range
				currentBlock += blockRunCount;

			}
		}
		return binaryFrame;
	
	};

	this._onMessage = function( msg, data ) {
		
		if ( typeof this[ msg ] === 'function' ) {
			this[ msg ]( data );
		}
		
	};
};

module.exports = MultithreadRenderer;
},{}],746:[function(require,module,exports){
/*global module */
"use strict";

function FlowDataBlock (location, length) {
	this.location = location;
	this.length = length;
}

module.exports = FlowDataBlock;
},{}],747:[function(require,module,exports){
/*global module */
"use strict";

function FlowDataManifest () {
}

module.exports = FlowDataManifest;
},{}],748:[function(require,module,exports){
/*global module */
"use strict";
var AC_FlowDataManifest = require('./Manifest'),
	AC_FlowDataBlock = require('./Block'),
	blockCount;

var flowDataProcessor = {
	/**
	 *	@name flow.data.processor#parseData
	 *	@description Parse flow data
	 *	@param {Object} raw flow data
	 *	@function
	 *	@returns {flow.data.Manifest} Flow manifest object.
	 */
	parseData: function (data) {
		blockCount = 0;
		var frames = data.frames.map(this._parseFrame, this);
		return Object.create(AC_FlowDataManifest.prototype, {
			version: { value : data.version },
			framecount : { value : data.frameCount },
			blockSize : { value : data.blockSize },
			imagesRequired : { value : data.imagesRequired },
			reversible : { value : data.reversible },
			superframeFrequency : { value : data.superframeFrequency },
			frames : { value : frames }
		});
	},

	/**
	 *	@name flow.data.processor#_valueForCharAt
	 *	@description How to parse Base64 numbers
	 *	@param {String} str Base64 encoded string
	 *	@param {Int} location Location to begin parsing
	 *	@return {Int} Decimal value
	 *	@function
	 *	@private
	 *	@throws {Invalid Bas64 character} if character is invalid.
	 */
	_valueForCharAt: function (str, location) {
		var code = str.charCodeAt(location);

		// A-Z
		if (code > 64 && code < 91) {
			return code - 65;
		}

		// a-z
		if (code > 96 && code < 123) {
			return code - 71;
		}

		// 0-9
		if (code > 47 && code < 58) {
			return code + 4;
		}

		// +
		if (code === 43) {
			return 62;
		}

		// /
		if (code === 47) {
			return 63;
		}

		// huh?
		throw 'Invalid Bas64 character: ' + str.charAt(location);
	},

	/**
	 *	@name flow.data.processor#_createNumberFromBase64Range
	 *	@description Allow numbers bigger than 64 to be defined in Base64 format by using a range of 2-3 numbers together.
	 *	@param {String} str Base64 encoded string
	 *	@param {Int} location Location to begin parsing
	 *	@param {Int} length Number of blocks to parse
	 *	@return {Int} Decimal value
	 *	@function
	 *	@private
	 */
	_createNumberFromBase64Range: function (str, location, length) {
		var numberToReturn = 0,
			currentValue;

		while (length--) {
			currentValue = this._valueForCharAt(str, location++);
			numberToReturn += (currentValue << length * 6);
		}

		return numberToReturn;
	},

	/**
	 *	@name flow.data.processor#_parseFrame
	 *	@description Parses a single frame
	 *	@param {String} range Base64 encoded frame data
	 *	@return {Array} Array of FlowDataBlocks
	 *	@function
	 *	@private
	 */
	_parseFrame: function (range) {
		var i,
			frame = [],
			range = range.value || range,
			length, location;

		// Parse each range that comprises this frame
		for (i = 0; i < range.length; i += 5) {

			// Location is first 3 characters
			location = this._createNumberFromBase64Range(range, i, 3);
			// Length is second 2 characters
			length = this._createNumberFromBase64Range(range, i + 3, 2);

			//Add an Object that defines the length and location of the range
			frame.push(Object.create(AC_FlowDataBlock.prototype,{
				location: { value : location, enumerable: true },
				length: { value : length, enumerable: true },
				block: { value : (blockCount+=length) - length, enumerable: true }
			}));
		}

		// Add this frame's range data to the list of frames
		return frame;
	}
};

module.exports = flowDataProcessor;
},{"./Block":746,"./Manifest":747}],749:[function(require,module,exports){
/*global module */
"use strict";
var proto,
    AssetLoader = require('ac-asset-loader').AssetLoader,
    flowDataProcessorJSON = require('../processor');

function FlowDataProviderAsync(url) {
    this._assetLoader = new AssetLoader([url]);
}

proto = FlowDataProviderAsync.prototype;

/**
 *    @name flow.data.provider.Async#load
 *    @function
 *    @returns {defer.Promise} Resolves with {@link flow.data.Manifest}.
 */
proto.load = function () {
    return this._assetLoader.load()
        .then(function (data) {
            var processedData;
            if (data && data.length) {
                processedData = flowDataProcessorJSON.parseData(data[0]);
                this._data = processedData;
            }
            return processedData;
        }.bind(this));
};

module.exports = FlowDataProviderAsync;

},{"../processor":748,"ac-asset-loader":702}],750:[function(require,module,exports){
/*global module */
"use strict";
var proto,
	Deferred = require('ac-deferred').Deferred;

var BinaryLoader = function( srcArr ) {
	// TODO: Proper Array-type check
	if ( typeof srcArr === 'string' ) {
		srcArr = [ srcArr ];
	}

	this.srcArr = srcArr;

};

proto = BinaryLoader.prototype;

proto._request = function( src ) {
		
	var deferred = new Deferred();

	// create a request for the asset via XHR
	var xhr = new XMLHttpRequest();

	// add a callback to load
	xhr.addEventListener( 'load', function() {
		var arrayBuffer = xhr.response;
		deferred.resolve( arrayBuffer );
	});


	// set responseType
	xhr.responseType = 'arrayBuffer';
	// open the request
	xhr.open('get', src, true );
	// send the request
	xhr.send();

	// return a promise
	return deferred.promise();
};

proto.load = function() {

	this._deferred = new Deferred();

	var deferreds = [];

	var i,
		arr = this.srcArr,
		len = arr.length;
	for ( i = 0; i < len; i++ ) {
		deferreds.push( this._request( arr[ i ] ) );
	}

	Deferred.all( deferreds ).then( function( data ) {
		this._deferred.resolve( data );
	}.bind( this ));

	return this._deferred.promise();
};

module.exports = BinaryLoader;
},{"ac-deferred":723}],751:[function(require,module,exports){
/*global module */
"use strict";
var DEBUG = false;

var proto,
	AC_FlowDiffLoader = require('./Loader'),
	Deferred = require('ac-deferred').Deferred,
	MultithreadController = require('../compositor/multithread/MultithreadController'),
	MultithreadRenderer = require('../compositor/multithread/MultithreadRenderer');

function BinaryMultithreadDiffRender (flowData, imageUrlPattern) {
	this.flowData = flowData;
	this.flowData.imageUrlPattern = imageUrlPattern;
	this.ArrayBufferCompositor = document.createElement('canvas');
	this.ArrayBufferCompositorContext = this.ArrayBufferCompositor.getContext('2d');
	this.sourceImagesData = {};

	this._processor = new MultithreadController( MultithreadRenderer );
	this._processor.exec();
	window.processor = this._processor;
};

proto = BinaryMultithreadDiffRender.prototype;

/**
 *	@description Stores images after init is complete
 *	@function
 *	@private
 */
proto._storeImages = function (images) {
	if (DEBUG) {
		console.log('loaded images');
	}
	this.images = images;
	this._blocksPerFullDiff = (images[0].width / this.flowData.blockSize) * (images[0].height / this.flowData.blockSize);
	return (new Deferred()).resolve();
};

proto._getImageDataAsArrayBuffer = function( img, width, height ) {
	height = height || width;
	this.ArrayBufferCompositor.width = width;
	this.ArrayBufferCompositor.height = height;
	this.ArrayBufferCompositorContext.drawImage( img, 0, 0 );
	var result = new Uint32Array( this.ArrayBufferCompositorContext.getImageData(0, 0, width, height).data.buffer );
	//TODO: Is it worth clearing the canvas after getting data?
	return result;
};

proto._processDataConstants = function() {
	this._compositingConstants = {
		images : []
	};

	// set image width for each flow image
	var i,
		len = this.images.length;
	for ( i = 0; i < len; i++ ) {
		this._compositingConstants.images[ i ] = {};
		this._compositingConstants.images[ i ].width = this.images[ i ].width;
	}

	return (new Deferred()).resolve();
};

proto._setFrameRequirements = function( frame ) {
	// Determine which images are needed to render the frame

	var firstBlock = frame[ 0 ],
		lastBlock = frame[ frame.length - 1 ];

	var firstImageIdx = this._getImageIndexOfBlock( firstBlock.block ),
		lastImageIdx = this._getImageIndexOfBlock( lastBlock.block + lastBlock.length );

	// This loop is able to remove old image data by replaceing this.sourceImagesData at the end		
	var i,
		localImageCache = {};

	for ( i = firstImageIdx; i < lastImageIdx + 1; i++ ) {

		if ( this.sourceImagesData[ i ] ) {
			localImageCache[ i ] = this.sourceImagesData[ i ];
		} else {
			localImageCache[ i ] = this._getImageDataAsArrayBuffer( this.images[ i ], this.images[ i ].width );
		}
	}

	this.sourceImagesData = localImageCache;

	return localImageCache;
};

proto._getImageIndexOfBlock = function( blockId ) {
	return Math.floor( blockId / this._blocksPerFullDiff );
};

proto._setCompositingData = function( canvas, context ) {
	// Shared data that can be declared once per pre-render
	
	this._compositingData = {
		imageWidth : this._compositingConstants.images[ 0 ].width,
		canvasWidth : context.canvas.width,
		canvasHeight : context.canvas.height,
		blocksPerFullDiff : this._blocksPerFullDiff,
		blockSize : this.flowData.blockSize,
		imagesRequired : this.flowData.imagesRequired
	};

	// It is faster to getImageData once and apply it to a new Uiunt8ClampedArray if lots of manipulation occurs
	var firstImageData = context.getImageData( 0, 0, this._compositingData.canvasWidth, this._compositingData.canvasHeight ).data;

	this._compositingData.columnsInCanvas = this._compositingData.canvasWidth / this.flowData.blockSize,
	this._compositingData.imageData = new Uint8ClampedArray( firstImageData );
};

proto._createBinaryFrame = function( imageData, width, height ) {
	return {
		buf8 : imageData,
		buf32 : new Uint32Array( imageData.buffer ),
		width : width,
		height : height
	};
};

proto._getBinaryImageArrayLength = function( compositingData ) {
	return compositingData.canvasWidth;
};


proto._compositeBinaryFrame = function( frame, compositingData ) {
	var i,
		len = frame.length,
		deferred = new Deferred();
	
	var sourceImagesData = this._setFrameRequirements( frame );
	
	//framesSetPromise.then( function() {

		var binaryFrame;
		if ( this._lastBinaryFrame ) {
			binaryFrame = this._lastBinaryFrame;
		} else {
			binaryFrame = this._createBinaryFrame( compositingData.imageData, compositingData.canvasWidth, compositingData.canvasHeight );
		}

		this._processor.run( 'renderFrameDiffs', {
			binaryFrame : binaryFrame,
			frameData : frame,
			compositingData : compositingData,
			sourceImagesData: sourceImagesData
		});

		this._processor.once( 'frameReady', deferred.resolve.bind( deferred ) );



	//}.bind( this ) );

/*
	for ( i = 0; i < len; i++ ) {
		binaryFrame = this._applyBlocksToBinaryFrame( binaryFrame, frame[ i ], compositingData );
	}
*/	
	return deferred.promise();
};

proto._getSourceImageAs32Bit = function( diffIndex ) {
	return new Uint32Array( this.sourceImagesData[ diffIndex ].data.buffer );
};


proto._applyBlocksToBinaryFrame = function( binaryFrame, range, compositingData ) {

	var currentBlock = range.block,
		diffIndex = Math.floor(currentBlock / this._blocksPerFullDiff),
		diffWidth = this._compositingConstants.images[ diffIndex ].width,
		rangeLength = range.length,
		columnsInCanvas = compositingData.columnsInCanvas,
		canvasWidth = compositingData.canvasWidth,
		blockInDiff = currentBlock % this._blocksPerFullDiff,
		columnsPerDiff = diffWidth / this.flowData.blockSize;

	var diffX = ( blockInDiff % columnsPerDiff ) * this.flowData.blockSize,
		diffY = Math.floor( blockInDiff / (columnsPerDiff || 1 ) ) * this.flowData.blockSize,
		canvasX = ( range.location % columnsInCanvas ) * this.flowData.blockSize,
		canvasY = Math.floor( range.location / columnsInCanvas ) * this.flowData.blockSize;

	var x,
		y,
		idx,
		sourceImageData,
		diffArrayIndex,
		canvasArrayIndex,
		blockRunWidth,
		blockRunCount;

	while( rangeLength > 0 ) {

		blockRunWidth = Math.min( ( rangeLength * this.flowData.blockSize ), canvasWidth - canvasX, diffWidth - diffX );
		blockRunCount = blockRunWidth / this.flowData.blockSize;

		// draw here
		
		// 32 bit rendering 
		sourceImageData = this.sourceImagesData[ diffIndex ];

		for ( y = 0; y < this.flowData.blockSize; y++ ) {
			// for however long the string of pixels are ( x-coordinate )
			for ( x = 0; x < blockRunWidth; x++ ) {
				// get the pixels from the source (rgba values)
				diffArrayIndex = ( diffY + y ) * diffWidth + ( diffX + x );
				canvasArrayIndex = ( canvasY + y ) * canvasWidth + ( canvasX + x );
				
				binaryFrame.buf32[ canvasArrayIndex ] = sourceImageData[ diffArrayIndex ];
			}
		}

		rangeLength -= blockRunCount;

		if ( rangeLength > 0 ) {

			// We're ready to move to the next row if we've already placed a row of blocks and have more to go!
			if ( ( diffX += blockRunWidth ) >= diffWidth ) {
				diffX = 0;
				diffY += this.flowData.blockSize;
			}

			// If we've reached the end of the diffImage, we need to move onto the next one.
			if ( ( blockInDiff += blockRunCount ) >= this._blocksPerFullDiff ) {
				// Reset to 0 and increment the image number
				blockInDiff = 0;
				diffX = 0;
				diffY = 0;
				diffIndex += 1;

				// Last diff image can be a smaller size
				if ( diffIndex === this.flowData.imagesRequired - 1 ) {
					diffWidth = this._compositingConstants.images[ diffIndex ].width;
				}
			}

			// Move the canvas location if we've drawn to the end of the canvas
			if ( ( canvasX += blockRunWidth ) >= canvasWidth ) {
				canvasX = 0;
				canvasY += this.flowData.blockSize;
			}

			// Move our temporary current block cursor to the next block in our range
			currentBlock += blockRunCount;

		}
	}
	return binaryFrame;
	
};

/**
 *	@name flow.diff.Render#init
 *	@description Creates a {@link flow.diff.Loader} and loads images matching the <i>imageUrlPattern</i>
 *	@return {defer.Promise}
 *	@function
 */
proto.init = function () {
	console.log('LOADED BINARY');
	if (DEBUG) {
		console.log('load images');
	}
	return new AC_FlowDiffLoader(this.flowData.imageUrlPattern, this.flowData.imagesRequired)
		.load({ binary : true })
		.then(this._storeImages.bind(this))
		.then(this._processDataConstants.bind(this));
};

/**
 *	@name flow.diff.Render#renderDiff
 *	@param canvas {Canvas} The canvas to draw to.
 *	@param frame {Int} The frame number to draw.
 *	@description Draws a frame to the canvas.
 *	@function
 */
proto.renderDiff = function (canvas, frame) {
	
	var context = canvas.getContext('2d'),
		deferred = new Deferred();

	if ( !this._compositingData ) {
		this._setCompositingData( canvas, context );
	}

	frame -= 1;
	if (DEBUG) {
		this._frameToRender = frame;
		//console.log('applying diff frame : ' + (frame + 1));
	}

	// composite a binary frame		
	var binaryFramePromise = this._compositeBinaryFrame( this.frames[ frame ], this._compositingData );
	
	binaryFramePromise.then( function( deferred, binaryFrame ) {
		// save the last frame
		this._lastBinaryFrame = binaryFrame;
		deferred.resolve( binaryFrame );
	}.bind( this, deferred ) );

	return deferred.promise();

}; 

proto.getBinaryDataFromFlowDataBlock = function( flowDataBlock ) {

};

// Escape hatch for non ecmascript 5 browsers
if (typeof Object.defineProperties !== 'function') {
	return function () {};
}


Object.defineProperties(proto, {
	/**
	 *	@name flow.diff.Render#frames
	 *	@description mapped to flowData.frames
	 */
	'frames' : {
		get : function () {
			return this.flowData.frames;
		},
		set : function (frames) {
			this.flowData.frames = frames;
		},
		enumerable : true
	}
});

module.exports = BinaryMultithreadDiffRender;
},{"../compositor/multithread/MultithreadController":742,"../compositor/multithread/MultithreadRenderer":745,"./Loader":753,"ac-deferred":723}],752:[function(require,module,exports){
/*global module */
"use strict";
var proto,
	DEBUG = false,
	Deferred = require('ac-deferred').Deferred;

function BinaryDiffRender (flowData, imageUrlPattern, loadController) {
	this.flowData = flowData;
	this.flowData.imageUrlPattern = imageUrlPattern;
	this._loadController = loadController;
	this.ArrayBufferCompositor = document.createElement('canvas');
	this.ArrayBufferCompositorContext = this.ArrayBufferCompositor.getContext('2d');
	this.sourceImagesData = {};
	this._forceBinaryComposite = true;
};

proto = BinaryDiffRender.prototype;

/**
 *	@description Stores images after init is complete
 *	@function
 *	@private
 */
proto._storeImages = function (images) {
	if (DEBUG) {
		console.log('loaded images');
	}
	this.images = images;
	this._blocksPerFullDiff = (images[0].width / this.flowData.blockSize) * (images[0].height / this.flowData.blockSize);
	return (new Deferred()).resolve();
};

proto._getImageDataAsArrayBuffer = function( img, width, height ) {
	height = height || width;
	if ( this.ArrayBufferCompositor.width !== width ) {
		this.ArrayBufferCompositor.width = width;	
	}

	if ( this.ArrayBufferCompositor.height !== height ) {
		this.ArrayBufferCompositor.height = height;	
	}
	
	this.ArrayBufferCompositorContext.drawImage( img, 0, 0 );
	var result = {
		buf8 : this.ArrayBufferCompositorContext.getImageData(0, 0, width, height).data
	};

	result.buf32 = new Uint32Array( result.buf8.buffer );
	//TODO: Is it worth clearing the canvas after getting data?
	//this.ArrayBufferCompositorContext.clearRect(0, 0, width, height);
	return result;
};

proto._processDataConstants = function() {
	this._compositingConstants = {
		images : []
	};

	// set image width for each flow image
	var i,
		len = this.images.length;
	for ( i = 0; i < len; i++ ) {
		this._compositingConstants.images[ i ] = {};
		this._compositingConstants.images[ i ].width = this.images[ i ].width;
	}

	return (new Deferred()).resolve();
};

proto._setFrameRequirements = function (frame) {
	// Determine which images are needed to render the frame
	var firstBlock = frame[ 0 ],
		lastBlock = frame[ frame.length - 1 ];

	var firstImageIdx = this._getImageIndexOfBlock( firstBlock.block ),
		lastImageIdx = this._getImageIndexOfBlock( lastBlock.block + lastBlock.length ),
		targetIdx = lastImageIdx + 1;

	// This loop is able to remove old image data by replaceing this.sourceImagesData at the end		
	var i,
		localImageCache = {};
	for ( i = firstImageIdx; i < targetIdx; i++ ) {
		if ( this.sourceImagesData[ i ] ) {
			localImageCache[ i ] = this.sourceImagesData[ i ];
		} else {
			localImageCache[ i ] = this._getImageDataAsArrayBuffer( this.images[ i ], this.images[ i ].width );
		}
	}

	this.sourceImagesData = localImageCache;

};

proto._getImageIndexOfBlock = function( blockId ) {
	return Math.floor( blockId / this._blocksPerFullDiff );
};

proto._setCompositingData = function( canvas, context ) {
	// Shared data that can be declared once per pre-render
	
	this._compositingData = {
		imageWidth : this._compositingConstants.images[ 0 ].width,
		canvasWidth : context.canvas.width,
		canvasHeight : context.canvas.height
	};

	// It is faster to getImageData once and apply it to a new Uiunt8ClampedArray if lots of manipulation occurs
	var firstImageData = context.getImageData( 0, 0, this._compositingData.canvasWidth, this._compositingData.canvasHeight ).data;

	this._compositingData.columnsInCanvas = this._compositingData.canvasWidth / this.flowData.blockSize,
	this._compositingData.imageData = new Uint8ClampedArray( firstImageData );
};

proto._createBinaryFrame = function( imageData, width, height ) {
	return {
		buf8 : imageData,
		buf32 : new Uint32Array( imageData.buffer ),
		width : width,
		height : height
	};
};

proto._getBinaryImageArrayLength = function( compositingData ) {
	return compositingData.canvasWidth;
};


proto._compositeBinaryFrame = function( frame, compositingData ) {
	var i,
		len = frame.length;
	
	this._setFrameRequirements( frame );
	
	var binaryFrame;
	// did we apply a keyframe? if so, we need to reset the current binary frame
	if ( this._lastBinaryFrame && !this._forceBinaryComposite ) {
		binaryFrame = this._lastBinaryFrame;
	} else {
		binaryFrame = this._createBinaryFrame( compositingData.imageData, compositingData.canvasWidth, compositingData.canvasHeight );
		
		// if we have a filter, we need to save a clean copy of the image data as well
		if ( this._renderOperation ) {
			this._cleanBinaryFrame = this._cloneBinaryFrame( binaryFrame );
			binaryFrame = this.forceApplyFilter( binaryFrame, compositingData );
		} else if ( this._cleanBinaryFrame ) {
			this._cleanBinaryFrame = null;
		}

		// creating a binary frame should force the renderer to not have to do it again
		this._forceBinaryComposite = false;
	}

	// see if we need to do a beforeRenderOperation
	if ( this._beforeRenderOperation ) {
		binaryFrame = this._beforeRenderOperation( binaryFrame );
	}

	for ( i = 0; i < len; i++ ) {
		binaryFrame = this._applyBlocksToBinaryFrame( binaryFrame, frame[ i ], compositingData );
	}

	return binaryFrame;
};


proto._applyBlocksToBinaryFrame = function( binaryFrame, range, compositingData ) {

	var blockSize = this.flowData.blockSize,
		blocksPerFullDiff = this._blocksPerFullDiff,
		totalImagesRequired = this.flowData.imagesRequired,
		currentBlock = range.block,
		diffIndex = Math.floor(currentBlock / blocksPerFullDiff),
		diffWidth = this._compositingConstants.images[ diffIndex ].width,
		rangeLength = range.length,
		columnsInCanvas = compositingData.columnsInCanvas,
		canvasWidth = compositingData.canvasWidth,
		canvasHeight = compositingData.canvasHeight,
		blockInDiff = currentBlock % blocksPerFullDiff,
		columnsPerDiff = diffWidth / blockSize;

	var diffX = ( blockInDiff % columnsPerDiff ) * blockSize,
		diffY = Math.floor( blockInDiff / (columnsPerDiff || 1 ) ) * blockSize,
		canvasX = ( range.location % columnsInCanvas ) * blockSize,
		canvasY = Math.floor( range.location / columnsInCanvas ) * blockSize;

	var x,
		y,
		currentCanvasX,
		currentCanvasY,
		idx,
		sourceImageData,
		diffArrayIndex,
		canvasArrayIndex,
		blockRunWidth,
		blockRunCount;

	while( rangeLength > 0 ) {

		blockRunWidth = Math.min( ( rangeLength * blockSize ), canvasWidth - canvasX, diffWidth - diffX );
		blockRunCount = blockRunWidth / blockSize;

		// draw here
		
		// 32 bit rendering 
		sourceImageData = this.sourceImagesData[ diffIndex ];

		for ( y = 0; y < blockSize; y++ ) {
			// for however long the string of pixels are ( x-coordinate )
			for ( x = 0; x < blockRunWidth; x++ ) {
				// get the pixels from the source (rgba values)
				currentCanvasX = canvasX + x;
				currentCanvasY = canvasY + y;
				diffArrayIndex = ( diffY + y ) * diffWidth + ( diffX + x );
				canvasArrayIndex = currentCanvasY * canvasWidth + currentCanvasX;
				
				if ( this._renderOperation ) {
					this._cleanBinaryFrame.buf32[ canvasArrayIndex ] = sourceImageData.buf32[ diffArrayIndex ];
					sourceImageData = this._renderOperation( sourceImageData, ( diffArrayIndex * 4 ), currentCanvasX, currentCanvasY, canvasWidth, canvasHeight );
				}
				
				binaryFrame.buf32[ canvasArrayIndex ] = sourceImageData.buf32[ diffArrayIndex ];

			}
		}

		rangeLength -= blockRunCount;

		if ( rangeLength > 0 ) {

			// We're ready to move to the next row if we've already placed a row of blocks and have more to go!
			if ( ( diffX += blockRunWidth ) >= diffWidth ) {
				diffX = 0;
				diffY += blockSize;
			}

			// If we've reached the end of the diffImage, we need to move onto the next one.
			if ( ( blockInDiff += blockRunCount ) >= blocksPerFullDiff ) {
				// Reset to 0 and increment the image number
				blockInDiff = 0;
				diffX = 0;
				diffY = 0;
				diffIndex += 1;

				// Last diff image can be a smaller size
				if ( diffIndex === totalImagesRequired - 1 ) {
					diffWidth = this._compositingConstants.images[ diffIndex ].width;
				}
			}

			// Move the canvas location if we've drawn to the end of the canvas
			if ( ( canvasX += blockRunWidth ) >= canvasWidth ) {
				canvasX = 0;
				canvasY += blockSize;
			}

			// Move our temporary current block cursor to the next block in our range
			currentBlock += blockRunCount;

		}
	}
	return binaryFrame;
	
};

proto._cloneBinaryFrame = function( binaryFrame ) {
	var bufferCopy = binaryFrame.buf8.buffer.slice(0);

	return {
		buf8 : new Uint8ClampedArray( bufferCopy ),
		buf32 : new Uint32Array( bufferCopy ),
		width : binaryFrame.width,
		height : binaryFrame.height
	};
};

/**
 *	@name flow.diff.Render#init
 *	@description Creates a {@link flow.diff.Loader} and loads images matching the <i>imageUrlPattern</i>
 *	@return {defer.Promise}
 *	@function
 */
proto.init = function () {
	if (DEBUG) {
		console.log('load images');
	}

	return this._loadController
		.loadDiffs()
		.then(this._storeImages.bind(this))
		.then(this._processDataConstants.bind(this));
};

/**
 *	@name flow.diff.Render#renderDiff
 *	@param canvas {Canvas} The canvas to draw to.
 *	@param frame {Int} The frame number to draw.
 *	@description Draws a frame to the canvas.
 *	@function
 */
proto.renderDiff = function (canvas, frame, context) {
	
	var context = context || canvas.getContext('2d');

	if ( !this._compositingData || this._forceBinaryComposite ) {
		this._setCompositingData( canvas, context );
	}

	frame -= 1;
	if (DEBUG) {
		this._frameToRender = frame;
		//console.log('applying diff frame : ' + (frame + 1));
	}

	// composite a binary frame		
	var binaryFrame = this._compositeBinaryFrame( this.frames[ frame ], this._compositingData );
	
	// save the last frame
	this._lastBinaryFrame = binaryFrame;

	return new Deferred().resolve( binaryFrame );

};

proto.forceBinaryComposite = function() {
	this._forceBinaryComposite = true;
	return this;
};

proto.forceApplyFilter = function( binaryFrame, compositingData ) {
	if ( this._renderOperation ) {
		var i, x, y, currentX, currentY,
			canvasWidth = compositingData.canvasWidth,
			canvasHeight = compositingData.canvasHeight,
			len = binaryFrame.buf32.length;
		
		for ( i = 0; i < len; i++ ) {
			x = i % canvasWidth;
			if ( i > 0 ) {
				y = Math.floor( i / canvasWidth );
			} else {
				y = 0;
			}
			binaryFrame = this._renderOperation( binaryFrame, ( i * 4 ), x, y, canvasWidth, canvasHeight );
		}
		
	}
	return binaryFrame;
};

proto.forceKeyframeRender = function( canvas, context ) {
	this._setCompositingData( canvas, context );

	var compositingData = this._compositingData,
		binaryFrame = this._createBinaryFrame( compositingData.imageData, compositingData.canvasWidth, compositingData.canvasHeight );

	if ( this._renderOperation ) {
		this._cleanBinaryFrame = this._cloneBinaryFrame( binaryFrame );
		binaryFrame = this.forceApplyFilter( binaryFrame, compositingData );
	}

	return binaryFrame;

};

// Escape hatch for non ecmascript 5 browsers
if (typeof Object.defineProperties !== 'function') {
	return function () {};
}


Object.defineProperties(proto, {
	/**
	 *	@name flow.diff.Render#frames
	 *	@description mapped to flowData.frames
	 */
	'frames' : {
		get : function () {
			return this.flowData.frames;
		},
		set : function (frames) {
			this.flowData.frames = frames;
		},
		enumerable : true
	},

	'_beforeRenderOperation' : {
		value : undefined,
		enumerable : false,
		writable : true
	},

	'_renderOperation' : {
		value : undefined,
		enumerable : false,
		writable : true
	},

	'beforeRenderOperation' : {
		get : function() {
			return this._beforeRenderOperation;
		},
		set : function( beforeRenderOperation ) {
			if ( typeof beforeRenderOperation === 'function' ) {
				this._beforeRenderOperation = beforeRenderOperation;
				return;
			}
			this._beforeRenderOperation = undefined;
		},
		enumerable : true
	},

	'renderOperation' : {
		get : function() {
			return this._renderOperation;
		},
		set : function( renderOperation ) {
			if ( typeof renderOperation === 'function' ) {
				this.forceBinaryComposite();
				this._renderOperation = renderOperation;
				return;
			}
			this._renderOperation = undefined;
			this.forceBinaryComposite();
		},
		enumerable : true
	}
});

module.exports = BinaryDiffRender;

},{"ac-deferred":723}],753:[function(require,module,exports){
/*global module */
"use strict";
var proto,
	AC_AssetLoader = require('ac-asset-loader').AssetLoader,
	BinaryLoader = require('./BinaryLoader');

function FlowDiffLoader (imageUrlPattern, imageCount) {
	var i, s, maskSize = imageUrlPattern.match(/#/g).length;

	this.imagesUrls = [];

	if (!imageCount) {
		throw new Error('0 images provided');
	}

	for(i=1; i<=imageCount; i++) {
		s = '0000' + i;
		s = s.substring(s.length - maskSize);
		this.imagesUrls.push(imageUrlPattern.replace(/#{2,}/g,s));
	}
}

proto = FlowDiffLoader.prototype;

/**
 *	@name flow.diff.Loader#load
 *	@return {defer.Promise} resolved when diff images are all loaded.
 *	@function
 */
proto.load = function ( options ) {
	options = options || {};
	return new AC_AssetLoader(this.imagesUrls).load();
};

module.exports = FlowDiffLoader;
},{"./BinaryLoader":750,"ac-asset-loader":702}],754:[function(require,module,exports){
/*global module */
"use strict";
var proto,
	DEBUG = false,
	Deferred = require('ac-deferred').Deferred;

function FlowDiffRender (flowData, imageUrlPattern, loadController) {
	this.flowData = flowData;
	this.flowData.imageUrlPattern = imageUrlPattern;
	this._loadController = loadController;
}

proto = FlowDiffRender.prototype;

/**
 *	@description Stores images after init is complete
 *	@function
 *	@private
 */
proto._storeImages = function (images) {
	if (DEBUG) {
		console.log('loaded images');
	}
	this.images = images;
	this._blocksPerFullDiff = (images[0].width / this.flowData.blockSize) * (images[0].height / this.flowData.blockSize);
	return (new Deferred()).resolve();
};

/**
 *	@description Apply a single range from a frame
 *	@function
 *	@private
 */
// Method ported from AC.Flow 1.0
proto._applyDiffRange = function (context, range) {
	// Calculate everything we need to place the image data
	var currentBlock = range.block,
		remainingLength = range.length,
		columnsInCanvas = context.canvas.width / this.flowData.blockSize,
		diffIndex = Math.floor(currentBlock / this._blocksPerFullDiff),
		diffWidth = this.images[diffIndex].width,
		blockInDiff = currentBlock % this._blocksPerFullDiff,
		columnsPerDiff = diffWidth / this.flowData.blockSize,
		diffX = (blockInDiff % columnsPerDiff) * this.flowData.blockSize,
		diffY = Math.floor(blockInDiff / (columnsPerDiff || 1)) * this.flowData.blockSize,
		canvasX = (range.location % columnsInCanvas) * this.flowData.blockSize,
		canvasY = Math.floor(range.location / columnsInCanvas) * this.flowData.blockSize,
		blockRunWidth,
		blockRunCount;

	// We can't place all the blocks at once if they are not all in the same row on the diff image or the canvas
	// So we need to deal with as many blocks at once as we can until we run out of blocks that need to be placed.
	while (remainingLength) {
		//console.log(remainingLength);
		// Smallest value of these numbers is how many blocks we can place from our current block
		// * To total remaining blocks to place in this range * the width of one block
		// * The remaining pixels from our start location on the canvas to the end of the canvas
		// * The remaining pixels from our start location on the diff to the end of the diff
		blockRunWidth = Math.min((remainingLength * this.flowData.blockSize), context.canvas.width - canvasX, diffWidth - diffX);

		// From there we can calculate how many of the blocks we can place at one time
		blockRunCount = blockRunWidth / this.flowData.blockSize;

		if (DEBUG) {
			if (typeof this.renderDebugger !== 'undefined' && this._frameToRender > 0) {
				this.renderDebugger.registerComparison(this._frameToRender, {
					image: diffIndex,
					block: currentBlock,
					x: diffX,
					y: diffY
				});
			}
		}

		// Draw image data to canvas. This is not theoretically rendered on the screen until javascript has finished processing
		// This would be when the setTimeout for the next frame happens
		context.drawImage(this.images[diffIndex], diffX, diffY, blockRunWidth, this.flowData.blockSize, canvasX, canvasY, blockRunWidth, this.flowData.blockSize);


		// Remove the number of blocks that were placed from the tally of blocks left to place
		remainingLength -= blockRunCount;


		// If we haven't finished all our block placement yet, prepare for the next go
		if (remainingLength) {

			// We're ready to move to the next row if we've already placed a row of blocks and have more to go!
			if ((diffX += blockRunWidth) >= diffWidth) {
				diffX = 0;
				diffY += this.flowData.blockSize;
			}

			// If we've reached the end of the diffImage, we need to move onto the next one.
			if ((blockInDiff += blockRunCount) >= this._blocksPerFullDiff) {
				// Reset to 0 and increment the image number
				blockInDiff = 0;
				diffX = 0;
				diffY = 0;
				diffIndex += 1;

				// Last diff image can be a smaller size
				if (diffIndex === this.flowData.imagesRequired - 1) {
					diffWidth = this.images[diffIndex].width;
				}
			}

			// Move the canvas location if we've drawn to the end of the canvas
			if ((canvasX += blockRunWidth) >= context.canvas.width) {
				canvasX = 0;
				canvasY += this.flowData.blockSize;
			}

			// Move our temporary current block cursor to the next block in our range
			currentBlock += blockRunCount;
		}
	}
};

/**
 *	@name flow.diff.Render#init
 *	@description Creates a {@link flow.diff.Loader} and loads images matching the <i>imageUrlPattern</i>
 *	@return {defer.Promise}
 *	@function
 */
proto.init = function () {
	if (DEBUG) {
		console.log('load images');
	}
	return this._loadController
		.loadDiffs()
		.then(this._storeImages.bind(this));
};

/**
 *	@name flow.diff.Render#renderDiff
 *	@param canvas {Canvas} The canvas to draw to.
 *	@param frame {Int} The frame number to draw.
 *	@description Draws a frame to the canvas.
 *	@function
 */
proto.renderDiff = function (canvas, frame) {
	var context = canvas.getContext('2d');

	frame -= 1;
	if (DEBUG) {
		this._frameToRender = frame;
		console.log('applying diff frame : ' + (frame + 1));
	}
	this.frames[frame].forEach(function forEach(block) {
		this._applyDiffRange(context, block);
	}.bind(this));

	//return canvas;
};


// Escape hatch for non ecmascript 5 browsers
if (typeof Object.defineProperties !== 'function') {
	return function () {};
}


Object.defineProperties(proto, {
	/**
	 *	@name flow.diff.Render#frames
	 *	@description mapped to flowData.frames
	 */
	'frames' : {
		get : function () {
			return this.flowData.frames;
		},
		set : function (frames) {
			this.flowData.frames = frames;
		},
		enumerable : true
	}
});

module.exports = FlowDiffRender;
},{"ac-deferred":723}],755:[function(require,module,exports){
/*global module */
"use strict";
var proto,
	AC_AssetLoader = require('ac-asset-loader').AssetLoader,
	Deferred = require('ac-deferred').Deferred;

function FlowKeyframeLoader (imageUrlPattern, manifestData) {
	var s, maskSize = imageUrlPattern.match(/#/g).length;

	this._keyframes = {};

	// i.e. test_key_###.jpg
	imageUrlPattern = imageUrlPattern.replace(/([^#]+)(#+)(\..*)/, '$1key_$2$3');
	this._imageUrls = [];

	if (manifestData.frames) {
		manifestData.frames.forEach(function (frame, i) {
			if (frame.type === 'keyframe') {
				s = '0000' + i;
				s = s.substring(s.length - maskSize);
				this._imageUrls.push(imageUrlPattern.replace(/#+/g, s));
				this._keyframes[i] = frame;
			}
		}.bind(this));
	}

}

proto = FlowKeyframeLoader.prototype;

/**
 *	@name flow.keyframe.Loader#load
 *	@return {defer.Promise} resolved when keyframe images are all loaded.
 *	@function
 */
proto.load = function () {
	if (this._imageUrls.length > 0) {
		return new AC_AssetLoader(this._imageUrls).load();
	}
	return (new Deferred()).resolve();
};


// Escape hatch for non ecmascript 5 browsers
if (typeof Object.defineProperties !== 'function') {
	return function () {};
}


Object.defineProperties(proto, {
	'keyframes' : {
		get : function () {
			return this._keyframes;
		},
		enumerable : true

	}
});

module.exports = FlowKeyframeLoader;
},{"ac-asset-loader":702,"ac-deferred":723}],756:[function(require,module,exports){
/*global module */
"use strict";
var proto,
	DEBUG = false,
	AC_FlowKeyframeLoader = require('./Loader');

function FlowKeyframeRender (flowData, imageUrlPattern) {
	this.flowData = flowData;
	this.flowData.imageUrlPattern = imageUrlPattern;
}

proto = FlowKeyframeRender.prototype;

/**
 *	@description Stores images after init is complete
 *	@function
 *	@private
 */
proto._storeImages = function (images) {
	var i = 0, image;

	if (images && images.length > 0) {
		if (DEBUG) {
			console.log('loaded keyframe diff images');
		}

		for (var keyframe in this._loader._keyframes) {
			if (this._loader._keyframes.hasOwnProperty(keyframe)) {
				image = images[i];
				this._loader._keyframes[keyframe].image = image;
				i += 1;
			}
		}
	}

	if (DEBUG) {
		if (!images || images.length === 0) {
			console.log('no keyframe diff images to load');
		}
	}
};


/**
 *	@name flow.keyframe.Render#init
 *	@description Creates a {@link flow.diff.Loader} and loads images matching the <i>imageUrlPattern</i>
 *	@return {defer.Promise}
 *	@function
 */
proto.init = function () {
	if (DEBUG) {
		console.log('loading keyframe diff images');
	}
	this._loader = new AC_FlowKeyframeLoader(this.flowData.imageUrlPattern, this.flowData);
	return this._loader.load()
		.then(this._storeImages.bind(this));
};

/**
 *	@name flow.keyframe.Render#renderKeyframe
 *	@param canvas {Canvas} The canvas to draw to.
 *	@param frame {Int} The frame number to draw.
 *	@param subRect {Boolean} Whether or not to draw the image as a sub-rectangle
 *	@description Draws a frame to the canvas.
 *	@function
 */
proto.renderKeyframe = function (canvas, frame, subRect) {
	var context = canvas.getContext('2d'),
		kf = this._loader.keyframes[frame],
		img = kf.image,
		x = kf.x,
		y = kf.y,
		w = kf.width,
		h = kf.height;

	if (DEBUG) {
		console.log('applying keyframe diff image: ' + frame);
		console.log('x:' + x + ' y:' + y + ' w:' + w + ' h:' + h);
	}

	if (subRect === true) {
		if (DEBUG) {
			console.log('drawing superKeyframe sub-rectangle');
		}
		context.drawImage(img, x, y, w, h, x, y, w, h);
	} else if (this.flowData.reversible) {
		if (DEBUG) {
			console.log('drawing superKeyframe full image');
		}
		context.drawImage(img, 0, 0);
	} else {
		if (DEBUG) {
			console.log('drawing keyframe full image');
		}
		context.drawImage(img, x, y, w, h);
	}
};

module.exports = FlowKeyframeRender;
},{"./Loader":755}],757:[function(require,module,exports){
/*global module */
"use strict";

function flowPlayerFactory (element, keyframes, imageUrlPattern, dataUrl, options) {
	var compositor, flowPlayer, dataLoader, renderType;

	options = options || {};
	options = {
		keyframeCache: (typeof options.keyframeCache === 'undefined') ? 8 : options.keyframeCache,
		benchmark: (typeof options.benchmark === 'undefined') ? false : options.benchmark,
		preload: (typeof options.preload === 'undefined') ? true : options.preload,
		renderType : options.renderType || 'default',
		multithread : options.multithread || false
	};

	keyframes = keyframes || [element.getAttribute('data-start-frame')];
	if (element.getAttribute('data-end-frame')) {
		keyframes.push(element.getAttribute('data-end-frame'));
	}

	imageUrlPattern = imageUrlPattern || element.getAttribute('data-image-url-pattern');

	// If dataUrl is a string then we assume it's a URL otherwise we treat it as an object.
	dataLoader = (typeof dataUrl === 'string') ? new FlowDataProviderAsync(dataUrl) : new FlowDataProviderSync(dataUrl);

	if ( options.renderType === 'binary' ) {
		compositor = new AC_BinaryCompositor(keyframes, imageUrlPattern, dataLoader, options.multithread);
	} else if ( options.renderType === 'default' ) {
		compositor = new AC_FlowCompositorSequence(keyframes, imageUrlPattern, dataLoader);
	}

	flowPlayer = new AC_FlowPlayer(element, new AC_Flow(compositor, options));

	if (options.preload) {
		flowPlayer.load();
	}

	return flowPlayer;
}

module.exports = flowPlayerFactory;

},{}],758:[function(require,module,exports){
/*global module */
"use strict";
var proto;

function Benchmark (name) {
	this.name = name;
}

proto = Benchmark.prototype;

proto.start = function () {
	if (DEBUG) {
		console.log('▼▼▼ start ' + this.name + ' benchmark');
		this.startTime  = new Date().getTime();
		console.time(this.name);
	}
};

proto.end = function () {
	if (DEBUG) {
		this.endTime  = new Date().getTime();
		console.log('▲▲▲ end ' + this.name + ' benchmark ' + (this.endTime - this.startTime)/1000 + ' sec');
		console.time(this.timeEnd);
	}
};

module.exports = Benchmark;
},{}],759:[function(require,module,exports){
arguments[4][1][0].apply(exports,arguments)
},{"dup":1}],760:[function(require,module,exports){
arguments[4][375][0].apply(exports,arguments)
},{"./ac-object/clone":761,"./ac-object/create":762,"./ac-object/defaults":763,"./ac-object/extend":764,"./ac-object/getPrototypeOf":765,"./ac-object/isDate":766,"./ac-object/isEmpty":767,"./ac-object/isRegExp":768,"./ac-object/toQueryParameters":769,"dup":375}],761:[function(require,module,exports){
arguments[4][376][0].apply(exports,arguments)
},{"./extend":764,"dup":376}],762:[function(require,module,exports){
arguments[4][377][0].apply(exports,arguments)
},{"dup":377}],763:[function(require,module,exports){
arguments[4][378][0].apply(exports,arguments)
},{"./extend":764,"dup":378}],764:[function(require,module,exports){
arguments[4][379][0].apply(exports,arguments)
},{"dup":379}],765:[function(require,module,exports){
arguments[4][380][0].apply(exports,arguments)
},{"dup":380}],766:[function(require,module,exports){
arguments[4][381][0].apply(exports,arguments)
},{"dup":381}],767:[function(require,module,exports){
arguments[4][382][0].apply(exports,arguments)
},{"dup":382}],768:[function(require,module,exports){
arguments[4][383][0].apply(exports,arguments)
},{"dup":383}],769:[function(require,module,exports){
arguments[4][384][0].apply(exports,arguments)
},{"dup":384,"qs":759}],770:[function(require,module,exports){
'use strict';

var create = require('./ac-media-object/create');
var cname = require('./ac-media-object/cname');

module.exports = {
	create: create,
	cname: cname
};

},{"./ac-media-object/cname":780,"./ac-media-object/create":781}],771:[function(require,module,exports){
'use strict';

var EventEmitter = require('ac-event-emitter').EventEmitter;
var eventNames = require('../eventNames');
var propertiesAreNull  = require('../utils/propertiesAreNull');

var DEFAULT_PRIORITY = 2;

function LoadingQueue () {
	this._items = [];
	this._loadingItem = null;
	this._active = false;
}


var proto = LoadingQueue.prototype = new EventEmitter();

proto.load = function () {
	this._active = true;
	return this._loadNext();
};

proto._loadNext = function () {
	if (this._items.length === 0) {
		return;
	}

	this._loadingItem = this._items.shift();
	this._loadItem(this._loadingItem);
};

proto._loadItem = function (item) {
	var promise;
	this._loadingItem = item;

	if (item && item.asset && !propertiesAreNull(item.asset)) {
		item.asset.on(eventNames.loaded, this._itemLoaded.bind(this, item));
		item.asset.load();
	} else if (this._active) {
		this._loadNext();
	}

	return promise;
};

proto._itemLoaded = function (item, binaries) {
	this.trigger(eventNames.progress, {
		asset:item.asset,
		binaries:binaries
	});

	if (this._active === true) {
		this._loadNext();
	}
};

proto.pause = function () {
	if (this._loadingItem) {
		this._loadingItem.asset.pause();
		this._items.unshift(this._loadingItem);
		this._loadingItem = null;
	}

	this._active = false;
};

proto.getItems = function () {
	return this._items;
};

proto.remove = function (asset) {
	var wasActive = this._active;
	var i;
	var item;
	var index = null;

	if (this._loadingItem && this._loadingItem.asset === asset) {
		item = this._loadingItem;
		this.pause();

	}

	for(i = 0; i < this._items.length; i += 1) {
		if (this._items[i].asset === asset) {
			item = this._items[i];
			index = i;
			break;
		}
	}

	item.asset.destroy();
	if (index !== null) {
		this._items.splice(index, 1);
	}

	if (wasActive && this._active === false) {
		this.load();
	}

};

proto.add = function (asset, priority) {
	var wasActive = this._active;
	var shouldPause = true;
	priority = (typeof priority === 'number') ? priority : DEFAULT_PRIORITY;

	if (this._loadingItem && this._loadingItem.priority <= priority) {
		shouldPause = false;
	}

	if (shouldPause === true) {
		this.pause();
	}

	this._items.push({
		asset:asset,
		priority:priority
	});

	this._sort();

	if (wasActive && this._active === false) {
		this.load();
	}
};

proto._sort = function () {
	this._items.sort(function (a, b) {
		if (a.priority < b.priority) {
			return -1;
		}

		return 1;

	});
};


var singleton = new LoadingQueue();

// Load automatically as loadObjects are added
singleton.load();

// Expose constructor
singleton.LoadingQueue = LoadingQueue;

module.exports = singleton;

},{"../eventNames":782,"../utils/propertiesAreNull":784,"ac-event-emitter":726}],772:[function(require,module,exports){
'use strict';

var ac_Element   = require('ac-base').Element;
var ac_Object    = require('ac-object');
var ac_Ajax      = require('ac-ajax');
var destroy      = require('../utils/destroy');
var EventEmitter = require('ac-event-emitter').EventEmitter;
var eventNames   = require('../eventNames');
var Loader       = require('./MediaObject/Loader');
var QueuedLoader = require('./MediaObject/Loader/QueuedLoader');
var View         = require('./MediaObject/View');

var proto;

/**
 * @name MediaObject.MediaObject
 * @class MediaObject
 * <pre>MediaObject = require('ac-media-object');</pre>
 *
 * Available user defined options:
 *
 * options:
 *   type: 'h264 || flow'
 *   autoplay: false,
 *   preload: false,
 *   fadeToEndframe: false,
 *   transitionDuration: 0.4,
 *   frameRate: 24,
 *   queueLoading: false, // Whether or not to use page-level loading queue for loading this media
 *   loadPriority: null // `null` means to use LoadingQueue default priority. Only used when `queueLoading` is `true`
 *
 *   // Flow specific
 *   superframes : false,
 *   reversable : false,
 *   keyframeCache : 8,
 *   benchmark : false,
 *   multithread : false,
 *   preventDraw : false,
 *   renderType : 'default'
 *
 *
 * mediaSrc:
 *   basePath: null, // use as basepath for all assets if provided
 *   filename: 'filename', // filename used for video
 *   fileFormat : 'jpg', // defaults to jpg for flow, mp4 for video
 *   posterframeSrc: '.posterframe',
 *   endstateSrc: '.endstate',
 *
 *   // video specific:
 *   splitFileLoading: false,
 *
 *
 *   // flow specific
 *   baseName : 'flow',
 *   imageUrlPattern : '###',
 *   startframeFileFormat : null, // `null` to use fileFormat
 *   endframeFileFormat : null, // `null` to use fileFormat
 *   manifestPath : null, // `null` to default to basepath
 *   manifestFileFormat: 'json',
 *   diffPath : null, // `null` to default to basepath
 *   framePath : null // `null` to default to basepath
 */

var defaultOptions = {
	preload: false,
	autoplay: false,
	fadeToEndframe: false,
	transitionDuration: 0.4,
	frameRate: 24,
	queueLoading: false,
	loadPriority: null
};

var defaultMediaSrcOptions = {
	posterframeSrc: '.posterframe',
	endstateSrc: '.endstate'
};


var MediaObject = function (container, mediaSrc, options) {
	this.container = ac_Element.getElementById(container);

	if (!this.container) {
		throw 'MediaObject: requires valid DOM Node for ‘container’';
	}

	// Setup options
	this.options = ac_Object.defaults(defaultOptions, options || {});
	this.mediaSrc = ac_Object.defaults(defaultMediaSrcOptions, mediaSrc || {});

	if (this.mediaSrc.basePath) {
		this.mediaSrc.basePath = this._forceTrailingSlash(this.mediaSrc.basePath);
	}

	// media properties
	this._media = null;
	this._mediaElement = null;
	this._mediaEmitter = null;
	this._loadObject = null;
	this._totalFrames = null;
	this.duration = null;
	this.ended = false;

	this.loader = null;

	// Define remaining properties
	this.dataOptionsAttribute = 'mediaObject';
	this.dataAssetOptionsAttribute = 'mediaObject-asset';
	this.ready = false;

	// update options from container's data attribute
	this._updateOptionsFromDataAttribute();

	this._mediaExistsSrc = this._constructMediaExistsSrc();

	this.view = new View(this);

	// load now if preload or autoplay is true
	if (this.options.preload === true || this.options.autoplay === true) {
		this.load();
	}

};

proto = MediaObject.prototype = new EventEmitter();


/**
 * Handle pre-enhancement tasks if necessary. Call enhance from view
 */

proto.enhance = function () {
	if (!this.view.enhanced) {

		this._generate();

		this.view.enhance().then(function () {
			this.trigger(eventNames.enhance, this);
		}.bind(this));
	}
};

proto.degrade = function () {
	if (this._media) {
		this.pause();
	}
	if (this.view) {
		this.view.degrade();
		this.trigger(eventNames.degrade, this);
	}

};


/**
 * MediaObject setup stuff
 *
 * Always call after mediaObject._loadObject is created in sub-classes
 *
 */
proto._generate = function () {
	if (this.loader === null) {
		if (this.options.queueLoading) {
			this.loader = new QueuedLoader(this._loadObject, this.options.loadPriority);

			// Expose prioritization method
			this.prioritize = this.loader.prioritize.bind(this.loader);
		} else {
			this.loader = new Loader(this._loadObject);
		}

		this._addEventListeners();
	}
};

proto._forceTrailingSlash = function (path) {
	if (path && path.lastIndexOf('/') !== path.length - 1) {
		path =  path + '/';
	}
	return path;
};

proto._updateOptionsFromDataAttribute = function () {
	var options = this._parseDataAttributeOptions(this.container, this.dataOptionsAttribute);
	var mediaSrc = this._parseDataAttributeOptions(this.container, this.dataAssetOptionsAttribute);
	ac_Object.defaults(this.options, options || {});
	ac_Object.defaults(this.mediaSrc, mediaSrc || {});
};

// parse options from a data-attribute string
// returns an object with options
// assumes string is colon/comma separated
// e.g. data-foo="color:blue,format:landscape"
proto._parseDataAttributeOptions = function (element, dataAttribute) {
	element = ac_Element.getElementById(element);
	var data = element.getAttribute('data-' + dataAttribute);
	var options;
	var optionsObj = {};
	var splitOption;

	if (data && data.length > 0) {
		options = data.split(',');
		if (options && options.length > 0) {
			options.forEach(function (option) {
				splitOption = option.split(':');
				optionsObj[splitOption[0]] = splitOption[1];
			});
		}
	}

	return optionsObj;
};

proto._constructMediaExistsSrc = function () {
	var path = '';

	var basePath = this.mediaSrc.basePath ? this._forceTrailingSlash(this.mediaSrc.basePath) : '';

	// split file videos take only the basepath to the source.
	// Other videos require the full path including filename.
	if (this.mediaSrc.splitFileLoading === true) {
		path = basePath;
	} else {
		path = basePath + this.mediaSrc.filename + '.' + this.mediaSrc.fileFormat;
	}

	return path;
};

/**
 * playback/control
 */

proto.load = function () {
	if (this.loader === null || this.loader.loaded !== true) {
		this._generate();

		this.trigger(eventNames.loadstart, this);

		this._load();

		return this.loader.load();
	}
};

proto._load = function () {
	this.once(eventNames.loaded, this._onReady, this);
};

proto.play = function (playbackRate) {
	if (!this.ready) {
		this.load();
		this.options.autoplay = true;
		return;
	}

	if (!this._media.paused) {
		return false;
	}

	this._play(playbackRate);

	this.trigger(eventNames.play, this);
};

proto._play = function (playbackRate) {
	if (this.ready && this._media !== null) {
		if (typeof playbackRate === 'number') {
			this.setPlaybackRate(playbackRate);
		}

		this._media.play();
	}
};


proto.pause = function () {
	if (this._media.paused) {
		return false;
	}

	this._pause();

	this.trigger(eventNames.pause, this);
};

proto._pause = function () {
	this._media.pause();
};


proto.reset = function () {
	this._reset();
};

proto._reset = function () {
	// don't try to set time unless media is ready
	if (this.ready) {
		this.setTime(0);
	}
};


proto.stop = function () {
	this.options.autoplay = false;
	this._stop();

	this.trigger(eventNames.stop, this);
};

proto._stop = function () {
	this._pause();
	this.reset();
};


proto.setTime = function (time) {
	if (time < 0) {
		time = 0;
	}

	if (time > this.duration) {
		time = this.duration;
	}

	return this._media.currentTime = time;
};

proto.goToFrame = function (frame) {
	var time = frame / this.options.frameRate;
	return this.setTime(time);
};

proto.goToDurationPercent = function (pct) {
	// pct expected to be an integer between 0 & 1
	var time = pct * this.duration;
	return this.setTime(time);
};

proto.currentFrame = function() {
	return Math.floor(this.currentTime() * this.options.frameRate);
};

proto.currentTime = function() {
	return this._media.currentTime;
};


proto.getCurrentTime = function () {
	return this._media.currentTime;
};

proto.getPlaybackRate = function () {
	return this._media.playbackRate;
};

proto.setPlaybackRate = function (value) {
	return this._media.playbackRate = value;
};

/**
 * MediaObject foundational functionality
 */

proto._addEventListeners = function () {
	this._mediaEmitter.on(eventNames.ended, this._onEnded, this);
	this.loader.once(eventNames.loaded, this._onLoad, this);
	this.loader.once(eventNames.errored, this._onError, this);
};


proto.destroy = function () {
	this.trigger(eventNames.destroy, this);

	// kill bound events from object's emitter
	this._mediaEmitter.off();

	destroy(this, true);
};


proto._getTotalFrames = function () {
	return this.duration * this.options.frameRate;
};


proto.mediaExists = function () {

	this._request = ac_Ajax.create({
		method: 'HEAD',
		url: this._mediaExistsSrc,
		timeout: 2000
	});

	return this._request.send();
};

/**
 * Event callbacks
 */

proto._onReady = function () {
	this.ready = true;

	/**
	 * @todo  Worth updating?
	 */
	this.duration = this._media.duration;
	this._totalFrames = this._getTotalFrames();

	// Set duration, update if it changes
	this._mediaEmitter.on('durationchange', function () {
		this.duration = this._media.duration;
		this._totalFrames = this._getTotalFrames();
	}, this);

	this.trigger(eventNames.ready, this);

	if (this.options.autoplay === true) {
		this.options.autoplay = false;

		if (this.view.enhanced === false) {
			this.enhance();
		}
		this.play();
	}
};

proto._onEnded = function () {
	this.ended = true;
	this.trigger(eventNames.ended, this);
};

proto._onLoad = function () {
	this.loaded = true;

	this.trigger(eventNames.loaded, this);
};

proto._onError = function () {
	this.degrade();
};



module.exports = MediaObject;

},{"../eventNames":782,"../utils/destroy":783,"./MediaObject/Loader":774,"./MediaObject/Loader/QueuedLoader":775,"./MediaObject/View":777,"ac-ajax":692,"ac-base":2,"ac-event-emitter":726,"ac-object":760}],773:[function(require,module,exports){
'use strict';

// Workaround for an issue in flow using Object.create
// https://interactive-git.apple.com/Interactive-Interfaces/ac-media-object/issues/116
try { var ac_Flow = require('ac-flow-x').Flow; } catch (err) {}

var ac_Object  = require('ac-object');
var eventNames = require('../../eventNames');
var Super      = require('../MediaObject');

var proto;

var defaultOptions = {
};

var defaultMediaSrcOptions = {
};

var Flow = function (container, mediaSrc, options) {
	mediaSrc = ac_Object.defaults(defaultMediaSrcOptions, mediaSrc || {});
	options = ac_Object.defaults(defaultOptions, options || {});

	// default options
	this.canvas = null;

	// call the super constructor
	Super.apply(this, arguments);
};

proto = Flow.prototype = ac_Object.create(Super.prototype);

proto._generate = function () {
	if (this._media !== null || ac_Flow === undefined) {
		return;
	}

	var flow;
	var canvas = document.createElement('canvas');

	// manually duplicating these options for now until we find a better solution
	var flowOptions = {
		element: canvas,
		preload: false, // always false, because MediaObject controls all flow loading.
		superFrames: this.options.superFrames || false,
		reversable: this.options.reversable || false,
		keyframeCache: this.options.keyframeCache || false,
		benchmark: this.options.benchmark || false,
		multithread: this.options.multithread || false,
		preventDraw: this.options.preventDraw || false,
		renderType: this.options.renderType || 'default'
	};

	var mediaSrc = {
		basePath: this.mediaSrc.basePath || null,
		baseName: this.mediaSrc.filename || 'flow',
		imageUrlPattern: this.mediaSrc.imageUrlPattern || '###',
		fileFormat: this.mediaSrc.fileFormat || 'jpg',
		startframeFileFormat: this.mediaSrc.startframeFileFormat || null,
		endframeFileFormat: this.mediaSrc.endframeFileFormat || null,
		manifestPath: this.mediaSrc.manifestPath || null,
		manifestFileFormat: this.mediaSrc.manifestFileFormat || 'json',
		diffPath: this.mediaSrc.diffPath || null,
		framePath: this.mediaSrc.framePath || null
	};

	flow = new ac_Flow(flowOptions, mediaSrc);
	flow.frameRate = this.options.frameRate;

	// media properties
	this._media = flow;
	this._mediaElement = flow.element;
	this._mediaEmitter = flow;
	this._loadObject = flow.loader;


	Super.prototype._generate.call(this);

	return this.mediaObject;
};


proto._constructMediaExistsSrc = function () {
	var path = '';

	var basePath = this.mediaSrc.basePath ? this._forceTrailingSlash(this.mediaSrc.basePath) : null;
	var baseName = this.mediaSrc.filename ? this.mediaSrc.filename + '_' : '_';
	var manifestPath = this.mediaSrc.manifestPath ? this._forceTrailingSlash(this.mediaSrc.manifestPath) : null;
	path = (manifestPath || basePath) + baseName + 'manifest.' + (this.mediaSrc.manifestFileFormat || 'json');

	return path;
};

proto._load = function () {
	this._mediaEmitter.once('canplaythrough', this._onReady, this);
};

module.exports = Flow;


},{"../../eventNames":782,"../MediaObject":772,"ac-flow-x":728,"ac-object":760}],774:[function(require,module,exports){

'use strict';

var destroy            = require('../../utils/destroy');
var propertiesAreNull  = require('../../utils/propertiesAreNull');
var EventEmitter       = require('ac-event-emitter').EventEmitter;
var eventNames         = require('../../eventNames');

var proto;

var Loader = function (loadObject) {
	this.loadObject = loadObject;
	this.loaded = false;

	this.loadObject.once(eventNames.loaded, this._onLoad, this);
	this.loadObject.once(eventNames.errored, this._onError, this);
};

proto = Loader.prototype = new EventEmitter();

proto.load = function () {
	if (!this.loaded) {
		return this._load();
	}
};

proto.pause = function () {
	if (!this.loaded) {
		this.loadObject.pause();
	}
};

proto._load = function () {
	return this.loadObject.load();
};

proto._onLoad = function () {
	this.loaded = true;

	this.trigger(eventNames.loaded);
};

proto._onError = function () {
	this.trigger(eventNames.errored);
};

proto.destroy = function () {
	if (!propertiesAreNull(this.loadObject)) {
		// stop and destroy the loader
		this.pause();
		if (typeof this.loadObject.destroy === 'function') {
			this.loadObject.destroy();
		}
	}

	destroy(this, false);
};

module.exports = Loader;

},{"../../eventNames":782,"../../utils/destroy":783,"../../utils/propertiesAreNull":784,"ac-event-emitter":726}],775:[function(require,module,exports){
'use strict';

var ac_Object    = require('ac-object');
var eventNames   = require('../../../eventNames');
var loadingQueue = require('../../LoadingQueue');
var Super        = require('../Loader');

var proto;

var QueuedLoader = function (loadObject, priority) {
	this.priority = priority;

	// call the super constructor
	Super.apply(this, [loadObject]);
};

proto = QueuedLoader.prototype = ac_Object.create(Super.prototype);

proto.prioritize = function (priority) {
	this.priority = priority;

	// TODO how to reprioritize loadingQueue
	this.loadObject.pause();
	loadingQueue.remove(this.loadObject);

	this.load();
};

proto._load = function () {
	// For reprioritization, don’t create a new promise
	if (this.promise) {
		loadingQueue.add(this.loadObject, this.priority);

	// Return a promise to be resolved when we have loaded
	} else {
		this.promise = new Promise(function(resolve, reject) {
			// When this item is loaded, resolve promise
			this.loadObject.once(eventNames.loaded, resolve);

			// If this item can’t load, reject!
			this.loadObject.once(eventNames.errored, reject);

			loadingQueue.add(this.loadObject, this.priority);
		}.bind(this));
	}

	return this.promise;
};


module.exports = QueuedLoader;

},{"../../../eventNames":782,"../../LoadingQueue":771,"../Loader":774,"ac-object":760}],776:[function(require,module,exports){
'use strict';

var ac_Environment = require('ac-base').Environment;
var ac_Object      = require('ac-object');
var AssetLoader    = require('ac-asset-loader').AssetLoader;
var Deferred       = require('ac-deferred').Deferred;
var deferred_all   = require('ac-deferred').all;
var DOMEmitter     = require('ac-dom-emitter').DOMEmitter;
var eventNames     = require('../../eventNames');
var Super          = require('../MediaObject');
var VideoAsset     = require('ac-asset-loader').Asset.Video;

var proto;

var defaultOptions = {
	loop: false
};

var defaultMediaSrcOptions = {
	filename: 'h264',
	fileFormat: 'mp4',
	splitFileLoading: false
};

var Video = function (container, mediaSrc, options) {
	mediaSrc = ac_Object.defaults(defaultMediaSrcOptions, mediaSrc || {});
	options = ac_Object.defaults(defaultOptions, options || {});

	// call the super constructor
	Super.call(this, container, mediaSrc, options);
};

proto = Video.prototype = ac_Object.create(Super.prototype);

proto._generate = function () {
	if (this._media !== null) {
		return;
	}
	var video = document.createElement('video');
	var assetOptions = {
		element: video,
		forceElementLoading: this.options.forceElementLoading,
		split: this.mediaSrc.splitFileLoading
	};
	var src = this._mediaExistsSrc;
	var videoAsset = new VideoAsset(src, assetOptions);
	var assetLoader = new AssetLoader(videoAsset);

	if (this.options.loop === true) {
		video.setAttribute('loop', 'true');
	}

	this._media = video;
	this._mediaElement = video;
	this._mediaEmitter = new DOMEmitter(video);
	this._loadObject = assetLoader;


	Super.prototype._generate.call(this);
};

proto._triggerEndedWhilePlayingInReverse = function () {
	if (this._media.currentTime === 0) {
		this._media.pause();
		this.trigger(eventNames.ended, this);
		this._mediaEmitter.off('timeupdate', this._triggerEndedWhilePlayingInReverse);
	}
};

proto._hidePosterOnTimeupdate = function () {
	if (this._media.currentTime > 0) {
		this.view.hideCoverElement(this.view.posterframe);
		this._mediaEmitter.off('timeupdate', this._hidePosterOnTimeupdate);
	}
};

proto._load = function () {
	var forceLoadedMetadataInterval;
	// Need to wait for metadataloaded, which happens after blob is set as src of video tag
	// Loaded happens before this is chunk loading scenario
	// So we wait for both instead
	// https://interactive-git.apple.com/Interactive-Interfaces/ac-media-object/issues/57
	var deferred_loadedmetadata = new Deferred();
	var deferred_loaded = new Deferred();

	if (typeof this._boundOnReady !== 'function') {
		this._boundOnReady = this._onReady.bind(this);
	}

	this._mediaEmitter.once('loadedmetadata', function () {
		// If the force interval is active, clear it!
		if (forceLoadedMetadataInterval) {
			window.clearInterval(forceLoadedMetadataInterval);
		}

		deferred_loadedmetadata.resolve();
	}, this);

	this.once(eventNames.loaded, function () {
		deferred_loaded.resolve();

		// This is to get around a strange bug in Safari using blobs as media source.
		// For some reason, on rare occasions, the `loadedmetadata` event does not fire
		// But touching the `duration` property seems to reliably get around this issue.
		// Maybe it just wastes enough cycles to avoid a race condition?
		// https://interactive-git.apple.com/Interactive-Interfaces/ac-media-object/issues/80
		if (ac_Environment.Browser.name === 'Safari' && !!this._media.src.match(/^blob/) && deferred_loadedmetadata.promise().status() === 'pending') {
			forceLoadedMetadataInterval = window.setInterval(function () {
				if ( !this._media || !this._media.duration ) {
					return true;
				}
				return isNaN(this._media.duration);
			}.bind(this), 20);

			// Give up if we don't have `loadedmetadata` firing within 7s of `loaded` firing
			window.setTimeout(function () {
				window.clearInterval(forceLoadedMetadataInterval);
			}, 7000);
		}
	}, this);

	return deferred_all([deferred_loadedmetadata.promise(), deferred_loaded.promise()]).then(this._boundOnReady);
};

proto._play = function (playbackRate) {
	this._mediaEmitter.on('timeupdate', this._hidePosterOnTimeupdate, this);

	Super.prototype._play.apply(this, arguments);

	if (this.getPlaybackRate() < 0) {
		this._mediaEmitter.on('timeupdate', this._triggerEndedWhilePlayingInReverse, this);
	}
};

proto._stop = function () {
	// remove timeUpdateListener just in case we stop before play begins
	this._mediaEmitter.off('timeupdate', this._hidePosterOnTimeupdate);
	this._mediaEmitter.off('timeupdate', this._triggerEndedWhilePlayingInReverse);

	Super.prototype._stop.call(this);
};

proto._onReady = function () {
	Super.prototype._onReady.call(this);

	// Release bound function for garbage collection
	this._boundOnReady = null;
};

module.exports = Video;

},{"../../eventNames":782,"../MediaObject":772,"ac-asset-loader":702,"ac-base":2,"ac-deferred":723,"ac-dom-emitter":724,"ac-object":760}],777:[function(require,module,exports){
'use strict';

var ac_Element = require('ac-base').Element;
var eventNames = require('../../eventNames');
var AssetLoader = require('ac-asset-loader').AssetLoader;
var Deferred = require('ac-deferred').Deferred;
var all = require('ac-deferred').all;

var imgPathPattern = /\w+\.(?:jpg|png)$/;
var classNames = {
	posterframe: 'mediaObject-posterframe',
	endstate: 'mediaObject-endstate'
};

function View (mediaObject) {
	this.container = mediaObject.container;
	this.mediaObject = mediaObject;
	this.enhanced = false;
	this.posterframe = null;
	this.endstate = null;

	this.mediaObject.on(eventNames.play, this._onPlay, this);
	this.mediaObject.on(eventNames.pause, this._onPause, this);
	this.mediaObject.on(eventNames.ended, this._onEnded, this);
}

var proto = View.prototype;

proto.enhance = function () {
	var promise = new Deferred();
	var endstatePromise;
	var posterPromise;

	var posterSuccess = function (elm) {
		this.posterframe = elm || null;
	}.bind(this);

	var endstateSuccess = function (elm) {
		this.endstate = elm || null;
	}.bind(this);

	var allSuccess = function () {
		// if mediaObject has been degraded before load is completed we don't want to enhance
		if (this.mediaObject && this.mediaObject._mediaElement) {
			ac_Element.addClassName(this.container, 'mediaObject-enhanced');
			ac_Element.addClassName(this.mediaObject._mediaElement, 'mediaObject-element');
			this.enhanced = true;
			window.requestAnimationFrame( function() {
				if (this.mediaObject && this.mediaObject._mediaElement) {
					this.hideCoverElement(this.endstate);
					this._inject();

					ac_Element.setStyle( this.mediaObject._mediaElement, {
						visibility : 'hidden'
					});

					window.requestAnimationFrame( function() {
						if (this.mediaObject && this.mediaObject._mediaElement) {
							ac_Element.getBoundingBox( this.mediaObject._mediaElement );
							ac_Element.setStyle( this.mediaObject._mediaElement, {
								visibility : 'visible'
							});
							promise.resolve();
						}
					}.bind( this ));
				}
			}.bind( this ));
		}
	}.bind(this);

	if (!this.enhanced) {

		// we need some promises here in case we're loading images
		posterPromise = this._createCoverElement(this.mediaObject.mediaSrc.posterframeSrc, classNames.posterframe);
		endstatePromise = this._createCoverElement(this.mediaObject.mediaSrc.endstateSrc, classNames.endstate);
		posterPromise.then(posterSuccess);
		endstatePromise.then(endstateSuccess);

		// wait for both cover elements to come back before doing anything else
		all([posterPromise, endstatePromise]).then(allSuccess);

	} else {
		promise.reject();
	}

	return promise;
};

proto.degrade = function () {
	this.showCoverElement(this.endstate, false);

	window.requestAnimationFrame(function () {
		this._remove();
		this.posterframe = null;
		this.endstate = null;
		this.enhanced = false;

		ac_Element.addClassName(this.container, 'mediaObject-degraded');

		this.mediaObject.destroy();
	}.bind(this));
};


proto._createCoverElement = function (src, cls) {
	var element;
	var promise;

	// if source is an image path
	if (imgPathPattern.test(src)) {
		promise = this._loadImage(src, cls);

	// else assume it's a css selector
	} else {
		element = ac_Element.select(src, this.container);
		promise = new Deferred().resolve(element);
	}

	return promise;
};


proto._loadImage = function (src, cls) {
	var loader = new AssetLoader([src]);

	function success (imgs) {
		var img = imgs[0];
		img.width = img.width;
		img.height = img.height;
		img.alt = '';
		img.className = cls;

		return img;
	}

	return loader.load().then(success);
};


proto._inject = function () {
	ac_Element.insert(this.mediaObject._mediaElement, this.container);

	// insert posterframe and endstate if they exist and are not already in DOM
	[this.posterframe, this.endstate].forEach(function (member) {
		if (member && !this.container.contains(member)) {
			ac_Element.insert(member, this.container);
		}
	}, this);

};

proto._remove = function () {
	var elements = [this.mediaObject._mediaElement];

	// only remove elements that we've inserted
	if (!imgPathPattern.test(this.mediaObject.posterframeSrc)) {
		elements.push(this.posterframe);
	}

	elements.forEach(function (elm) {
		if (ac_Element.isElement(elm) && this.container.contains(elm)) {
			this.container.removeChild(elm);
		}
	}, this);
};

proto.hideCoverElements = function () {
	this.hideCoverElement(this.posterframe);
	this.hideCoverElement(this.endstate);
};

proto.hideCoverElement = function (element, withTransition) {
	if (element) {
		if (withTransition) {
			this._addOpacityTransition(element);
		} else {
			this._removeTransition(element);
		}

		window.requestAnimationFrame(function () {
			ac_Element.setStyle(element, { opacity: 0, zIndex: 1 });
		}.bind(this));
	}
};

proto.showCoverElement = function (element, withTransition) {

	var transitionCallback = function () {
		this._removeTransition.bind(this, element);
		ac_Element.removeVendorPrefixEventListener(element, 'transitionEnd', transitionCallback);
	}.bind(this);

	if (element) {
		if (withTransition) {
			this._addOpacityTransition(element);
			ac_Element.addVendorPrefixEventListener(element, 'transitionEnd', transitionCallback);
		} else {
			this._removeTransition(element);
		}

		window.requestAnimationFrame(function () {
			ac_Element.setStyle(element, { opacity: 1, zIndex: 1001 });
		}.bind(this));
	}
};


proto._removeTransition = function (element) {
	ac_Element.setVendorPrefixStyle(element, 'transition', 'none');
};

proto._addOpacityTransition = function (element) {
	ac_Element.setVendorPrefixStyle(element, 'transition', 'opacity ' + this.mediaObject.options.transitionDuration + 's ease-out');
};


/**
 * onEvent methods
 */

proto._onPlay = function () {
	ac_Element.removeClassName(this.container, 'mediaObject-ended');
	ac_Element.addClassName(this.container, 'mediaObject-playing');
	this.hideCoverElements();
};

proto._onPause = function () {
	ac_Element.removeClassName(this.container, 'mediaObject-playing');
};

proto._onEnded = function () {
	ac_Element.removeClassName(this.container, 'mediaObject-playing');
	ac_Element.addClassName(this.container, 'mediaObject-ended');

	if (this.endstateElement) {
		this.showCoverElement(this.endstate, false);
	}
};

module.exports = View;

},{"../../eventNames":782,"ac-asset-loader":702,"ac-base":2,"ac-deferred":723}],778:[function(require,module,exports){
'use strict';

var ImageOverlayController = require('./KeyframeOnPause/ImageOverlayController');

var proto,
	ac_Object = require('ac-object'),
	Clock = require('ac-clock');

var defaultOptions = {
	overlayLoadDelay : 250,
	overlayClassName : 'image-overlay',
	overlayDirPath : './overlay',
	overlayPrefix : 'image_',
	overlayPattern : '####',
	overlayFileType : 'png',
	clock : Clock
};

var KeyframeOnPause = function() {

};

proto = KeyframeOnPause.prototype;

proto.decorate = function( mediaObject, objectOptions ) {

	var options = ac_Object.defaults( defaultOptions, objectOptions );
	mediaObject.keyframeOnPauseController = new ImageOverlayController( mediaObject, options );

	mediaObject.container.appendChild( mediaObject.keyframeOnPauseController.el );

	return mediaObject;
};

module.exports = new KeyframeOnPause();

},{"./KeyframeOnPause/ImageOverlayController":779,"ac-clock":717,"ac-object":760}],779:[function(require,module,exports){
'use strict';

var proto,
	EventEmitter = require('ac-event-emitter').EventEmitter,
	DOMEmitter = require('ac-dom-emitter').DOMEmitter;

var ImageOverlayController = function( mediaObject, options ) {
	this.mediaObject = mediaObject;
	this.options = options;

	this.active = false;
	this.el = this._createOverlay();

	this._overlaySetTime = null;

	this._setEventTarget();
	this._bindEvents();
};

proto = ImageOverlayController.prototype;

proto.applyOverlay = function( frameIdx ) {
	frameIdx = frameIdx || this.mediaObject.currentFrame();
	var imagePath = this._getImagePath( frameIdx ),
		containerDimensions = this._getContainerDimensions( this.mediaObject.container );

	this.el.style.backgroundImage = 'url(' + imagePath + ')';
	this.el.style.backgroundSize = containerDimensions.width + 'px ' + containerDimensions.height + 'px';
	this.active = true;
	this.mediaObject.trigger( 'overlay-applied' );
};

proto.removeOverlay = function() {
	this.el.style.backgroundImage = 'inherit';
	this.active = false;
	this.mediaObject.trigger( 'overlay-removed' );
};

proto._createOverlay = function() {
	var overlay = document.createElement('div');
	overlay.className = this.options.overlayClassName;
	return overlay;
};

proto._onMetadataLoaded = function() {
	var width = this.mediaObject.width,
		height = this.mediaObject.height;

	this.el.style.width = width;
	this.el.style.height = height;
};

proto._getContainerDimensions = function( el ) {
	el = el || this.mediaObject.container;

	var result = {
		width : el.offsetWidth,
		height : el.offsetHeight
	},
		boundingClientRect;

	if ( !result.width || !result.height ) {
		boundingClientRect = el.getBoundingClientRect();
		result.width = boundingClientRect.width;
		result.height = boundingClientRect.height;
	}

	return result;
};

proto._getImagePath = function( frameIdx ) {

	var dirPath = this.options.overlayDirPath,
		fileType = this.options.overlayFileType,
		prefix = this.options.overlayPrefix,
		pattern = this.options.overlayPattern,
		patternLen = pattern.length,
		idxStr = frameIdx + '',
		idxLen = idxStr.length;

	while( idxLen < patternLen ) {
		idxStr = '0' + idxStr;
		idxLen++;
	}

	return dirPath + '/' + prefix + idxStr + '.' + fileType;
};

proto._bindEvents = function() {
	this._eventsTarget.on('timeupdate pause', this._onMediaObjectScrub, this );
	this._eventsTarget.on('play', this._onMediaObjectPlay, this );
	this.options.clock.on('draw', this._clockApplyImageOverlay, this );
};

// upgrade video types to have a DOMEmitter
proto._setEventTarget = function() {
	this._eventsTarget = this.mediaObject._mediaEmitter;
};

proto._onMediaObjectPlay = function() {
	this.removeOverlay();
};

proto._onMediaObjectScrub = function() {
	this._debounceImageOverlay();
};

proto._debounceImageOverlay = function() {
	this._overlaySetTime = Date.now() + this.options.overlayLoadDelay ;
};

proto._clockApplyImageOverlay = function() {
	if ( !this.mediaObject._media.paused || !this._overlaySetTime || this._overlaySetTime > Date.now() ) {
		return;
	}

	this._overlaySetTime = null;
	this.applyOverlay();
};

module.exports = ImageOverlayController;

},{"ac-dom-emitter":724,"ac-event-emitter":726}],780:[function(require,module,exports){
'use strict';

// Let CNAMER manually cname blank gif image path
var prefix = (function () {
	var sampleURL = 'http://images.apple.com/global/elements/blank.gif';

	// Strip the sample image and leave only / or absolute path to http://images.apple.com/
	return sampleURL.replace(/global\/.*/, '');
}());

module.exports = function cname(url) {
	// Accepts absolute path, but will ignore it
	if (!!url.match(/(^http(s?))/)) {
		return url;
	}

	// Only update root-relative URLs.
	if (url.match(/^\/(?!\/)/)) {
		// Strip first character if it is slash (which it should be) and prefix with cnamed prefix string
		url = prefix + url.replace(/^\//, '');

		// Strip /105/ if it is not the root
		url = url.replace(/(^.+)(\/105\/)/, '$1/');
	}

	return url;
};

},{}],781:[function(require,module,exports){
'use strict';

var Flow = require('./MediaObject/Flow');
var Video = require('./MediaObject/Video');
var KeyframeOnPause = require('./MediaObject/decorators/KeyframeOnPause');

module.exports = function create (container, mediaSrc, options) {
	options = options || {};

	var object = null;

	if (options.type === 'h264') {
		object = new Video(container, mediaSrc, options);
	}

	if (options.type === 'flow') {
		object = new Flow(container, mediaSrc, options);
	}

	// set up decoractors
	if ( options.keyframeOverlay ) {
		object = KeyframeOnPause.decorate( object, options.keyframeOverlay );
	}

	return object;

};

},{"./MediaObject/Flow":773,"./MediaObject/Video":776,"./MediaObject/decorators/KeyframeOnPause":778}],782:[function(require,module,exports){
'use strict';

module.exports = {
	degrade: 'degrade',
	destroy: 'destroy',
	ended: 'ended',
	enhance: 'enhance',
	errored: 'error',
	loaded: 'loaded',
	loadstart: 'loadstart',
	pause: 'pause',
	play: 'play',
	progress: 'progress',
	ready: 'ready',
	stop: 'stop'
};

},{}],783:[function(require,module,exports){
'use strict';

var propertiesAreNull = require('./propertiesAreNull');

module.exports = function destroy(self, destroyChildren) {

	// Remove all event listeners
	if (typeof self.off === 'function') {
		self.off();
	}

	window.setTimeout(function () {
		var instanceProp;

		// nullify all instance variables
		for (instanceProp in self) {
			if (self.hasOwnProperty(instanceProp)) {
				if (destroyChildren &&
					self[instanceProp] &&
					typeof self[instanceProp].destroy === 'function' &&
					!propertiesAreNull(self[instanceProp])
				) {
					self[instanceProp].destroy();
				}

				self[instanceProp] = null;
			}
		}
	});
};

},{"./propertiesAreNull":784}],784:[function(require,module,exports){
'use strict';

// Are an object's properties all === null?
module.exports = function propertiesAreNull (obj) {
	var allNull = true;
	for (var prop in obj) {
		if (obj.hasOwnProperty(prop)) {
			if (obj[prop] !== null) {
				allNull = false;
				break;
			}
		}
	}

	return allNull;
};

},{}],785:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var extend = require('./extend');
var hasOwnProp = Object.prototype.hasOwnProperty;
var deepClone = function (dest, source) {
	var prop;
	for (prop in source) {
		// Anything that does not prototype Object will not have this method
		if (hasOwnProp.call(source, prop)) {
			if (source[prop] === null) {
				dest[prop] = null;
			}
			else if (typeof source[prop] === 'object') {
				dest[prop] = Array.isArray(source[prop]) ? [] : {};
				deepClone(dest[prop], source[prop]);
			}
			else {
				dest[prop] = source[prop];
			}
		}
	}
	return dest;
};

/**
 * @name module:ac-object.clone
 *
 * @function
 * 
 * @desc Create a new Object that has the same properties as the original.
 *
 * @param {Object} object
 *        The Object to make a clone of.
 *
 * @param {Boolean} [deep=false]
 *        If `true` the clone will be deep. Defaults to shallow.
 *
 * @returns {Object} The cloned object.
 */
module.exports = function clone (object, deep) {
	if (deep) {
		return deepClone({}, object);
	}
	return extend({}, object);
};

},{"./extend":788}],786:[function(require,module,exports){
arguments[4][377][0].apply(exports,arguments)
},{"dup":377}],787:[function(require,module,exports){
arguments[4][378][0].apply(exports,arguments)
},{"./extend":788,"dup":378}],788:[function(require,module,exports){
arguments[4][379][0].apply(exports,arguments)
},{"dup":379}],789:[function(require,module,exports){
arguments[4][380][0].apply(exports,arguments)
},{"dup":380}],790:[function(require,module,exports){
/**
 * @module ac-object
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

module.exports = {
	clone: require('./clone'),
	create: require('./create'),
	defaults: require('./defaults'),
	extend: require('./extend'),
	getPrototypeOf: require('./getPrototypeOf'),
	isDate: require('./isDate'),
	isEmpty: require('./isEmpty'),
	isRegExp: require('./isRegExp'),
	toQueryParameters: require('./toQueryParameters')
};

},{"./clone":785,"./create":786,"./defaults":787,"./extend":788,"./getPrototypeOf":789,"./isDate":791,"./isEmpty":792,"./isRegExp":793,"./toQueryParameters":795}],791:[function(require,module,exports){
arguments[4][381][0].apply(exports,arguments)
},{"dup":381}],792:[function(require,module,exports){
arguments[4][382][0].apply(exports,arguments)
},{"dup":382}],793:[function(require,module,exports){
arguments[4][383][0].apply(exports,arguments)
},{"dup":383}],794:[function(require,module,exports){
arguments[4][1][0].apply(exports,arguments)
},{"dup":1}],795:[function(require,module,exports){
arguments[4][384][0].apply(exports,arguments)
},{"dup":384,"qs":794}],796:[function(require,module,exports){
// shim for using process in browser

var process = module.exports = {};
var queue = [];
var draining = false;

function drainQueue() {
    if (draining) {
        return;
    }
    draining = true;
    var currentQueue;
    var len = queue.length;
    while(len) {
        currentQueue = queue;
        queue = [];
        var i = -1;
        while (++i < len) {
            currentQueue[i]();
        }
        len = queue.length;
    }
    draining = false;
}
process.nextTick = function (fun) {
    queue.push(fun);
    if (!draining) {
        setTimeout(drainQueue, 0);
    }
};

process.title = 'browser';
process.browser = true;
process.env = {};
process.argv = [];
process.version = ''; // empty string to avoid regexp issues
process.versions = {};

function noop() {}

process.on = noop;
process.addListener = noop;
process.once = noop;
process.off = noop;
process.removeListener = noop;
process.removeAllListeners = noop;
process.emit = noop;

process.binding = function (name) {
    throw new Error('process.binding is not supported');
};

// TODO(shtylman)
process.cwd = function () { return '/' };
process.chdir = function (dir) {
    throw new Error('process.chdir is not supported');
};
process.umask = function() { return 0; };

},{}],797:[function(require,module,exports){
if (!Array.prototype.filter) {
/**
	Tests all elements in an array and returns a new array filled with elements that pass the test.
	@param {Function} callback Function to test against. The callback must return a boolean value.
	@param {Object} thisObj Object to use as `this` when executing the callback.
	@returns {Array} Returns a new array populated with values from the original array that passed the test implemented by the provided function.
	@reference https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/filter
*/
	Array.prototype.filter = function filter(callback, thisObj) {
		var arrayObject = Object(this);
		// Mimic ES5 spec call for interanl method ToUint32()
		var len = arrayObject.length >>> 0;
		var i;
		var results = [];

		// Callback must be a callable function
		if (typeof callback !== 'function') {
			throw new TypeError(callback + ' is not a function');
		}

		for (i = 0; i < len; i += 1) {
			if (i in arrayObject && callback.call(thisObj, arrayObject[i], i, arrayObject)) {
				results.push(arrayObject[i]);
			}
		}

		return results;
	};
}
},{}],798:[function(require,module,exports){
if (!Array.prototype.indexOf) {
/**
	Returns the first (least) index of an element within the array equal to the specified value, or -1 if none is found.
	@param searchElement {Object} Element to locate in the array.
	@param fromIndex {Number} Optional; the index at which to begin the search. Defaults to 0, i.e. the whole array will be searched. If the index is greater than or equal to the length of the array, -1 is returned, i.e. the array will not be searched. If negative, it is taken as the offset from the end of the array. Note that even when the index is negative, the array is still searched from front to back. If the calculated index is less than 0, the whole array will be searched.
*/
	Array.prototype.indexOf = function indexOf(searchElement, fromIndex) {
		var startIndex = fromIndex || 0;
		var currentIndex = 0;

		if (startIndex < 0) {
			startIndex = this.length + fromIndex - 1;
			if (startIndex < 0) {
				throw 'Wrapped past beginning of array while looking up a negative start index.';
			}
		}

		for (currentIndex = 0; currentIndex < this.length; currentIndex++) {
			if (this[currentIndex] === searchElement) {
				return currentIndex;
			}
		}

		return (-1);
	};
}
},{}],799:[function(require,module,exports){
/**
 * Shim for "fixing" IE's lack of support (IE < 9) for applying slice
 * on host objects like NamedNodeMap, NodeList, and HTMLCollection
 * (technically, since host objects have been implementation-dependent,
 * at least before ES6, IE hasn't needed to work this way).
 * Also works on strings, fixes IE < 9 to allow an explicit undefined
 * for the 2nd argument (as in Firefox), and prevents errors when
 * called on other DOM objects.
 *
 * @link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/slice
 */
(function () {
    'use strict';
    var _slice = Array.prototype.slice;

    try {
        // Can't be used with DOM elements in IE < 9
        _slice.call(document.documentElement);
    } catch (e) { // Fails in IE < 9
        // This will work for genuine arrays, array-like objects, 
        // NamedNodeMap (attributes, entities, notations),
        // NodeList (e.g., getElementsByTagName), HTMLCollection (e.g., childNodes),
        // and will not fail on other DOM objects (as do DOM elements in IE < 9)
        Array.prototype.slice = function (begin, end) {
            // IE < 9 gets unhappy with an undefined end argument
            end = (typeof end !== 'undefined') ? end : this.length;

            // For native Array objects, we use the native slice function
            if (Object.prototype.toString.call(this) === '[object Array]'){
                return _slice.call(this, begin, end); 
            }

            // For array like object we handle it ourselves.
            var i, cloned = [],
                size, len = this.length;

            // Handle negative value for "begin"
            var start = begin || 0;
            start = (start >= 0) ? start: len + start;

            // Handle negative value for "end"
            var upTo = (end) ? end : len;
            if (end < 0) {
                upTo = len + end;
            }

            // Actual expected size of the slice
            size = upTo - start;

            if (size > 0) {
                cloned = new Array(size);
                if (this.charAt) {
                    for (i = 0; i < size; i++) {
                        cloned[i] = this.charAt(start + i);
                    }
                } else {
                    for (i = 0; i < size; i++) {
                        cloned[i] = this[start + i];
                    }
                }
            }

            return cloned;
        };
    }
}());
},{}],800:[function(require,module,exports){
arguments[4][135][0].apply(exports,arguments)
},{"./ac-event-emitter/EventEmitter":801,"dup":135}],801:[function(require,module,exports){
arguments[4][136][0].apply(exports,arguments)
},{"dup":136}],802:[function(require,module,exports){
arguments[4][203][0].apply(exports,arguments)
},{"./ac-clock/Clock":803,"./ac-clock/ThrottledClock":804,"./ac-clock/sharedClockInstance":805,"dup":203}],803:[function(require,module,exports){
arguments[4][204][0].apply(exports,arguments)
},{"ac-event-emitter":800,"dup":204}],804:[function(require,module,exports){
arguments[4][205][0].apply(exports,arguments)
},{"./sharedClockInstance":805,"ac-event-emitter":800,"dup":205}],805:[function(require,module,exports){
arguments[4][206][0].apply(exports,arguments)
},{"./Clock":803,"dup":206}],806:[function(require,module,exports){
/** 
 * @module ac-deferredqueue
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

module.exports = {
	DeferredQueue: require('./ac-deferredqueue/DeferredQueue'),
	Action: require('./ac-deferredqueue/Action')
};

},{"./ac-deferredqueue/Action":807,"./ac-deferredqueue/DeferredQueue":808}],807:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name module:ac-deferredqueue.Action
 * @class
 * 
 * @desc An instance of an action that is intended to be ran
 * 
 * @param {Function} [func]
 * 
 * @param {Object} [options]
 *        Options to initialize the instance with
 * 
 * @param {Integer} [options.delay=0]
 *        The delay, in seconds, to wait between running actions.
 */
function Action(func, options) {
	if (typeof func !== 'function') {
		throw new TypeError('Deferred Queue func must be a function.');
	}

	this._options = options || {};
	this._options.delay = this._options.delay || 0;
	this.__func = func;
}

var proto = Action.prototype;

/**
 * @name module:ac-deferredqueue.Action#run
 *
 * @function
 * 
 * @desc Run this func
 */
proto.run = function () {
	var func = this.__func;

	// Run with optional delay
	if (typeof this._options.delay === 'number' && this._options.delay > 0) {
		window.setTimeout(function () {
			func();
		}, this._options.delay * 1000);
	} else {
		func();
	}
};

module.exports = Action;

},{}],808:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var Action = require('./Action');

/**
 * @name module:ac-deferredqueue.DeferredQueue
 * @class
 *
 * @desc Store functions in queue to be ran later, in sequence.
 * 
 * @param {Object} [options]
 *        Options to initialize the instance with
 *        
 * @param {Boolean} [options.autoplay=false]
 *        Whether or not to play when the first action is added,
 *        if not already playing.
 *        
 * @param {Boolean} [options.asynchronous=false]
 *        If true, wait for didFinish method to be called before
 *        continuing to run next method.
 */
function DeferredQueue(options) {
	// Setup options
	this._options = options || {};
	this._options.autoplay = this._options.autoplay || false;
	this._options.asynchronous = this._options.asynchronous || false;
	this._isPlaying = false;
	this._isRunningAction = false;
	this._queue = [];

	// Make sure didFinish is always bound correctly
	this.didFinish = this.__didFinish.bind(this);
}

var proto = DeferredQueue.prototype;

/**
 * @name module:ac-deferredqueue.DeferredQueue#add
 *
 * @function
 * 
 * @desc Add an action to the end of the queue
 * 
 * @param {Function} func
 * 
 * @param {Integer} [delay=0]
 */
proto.add = function (func, delay) {
	var options = {};
	var action;

	if (delay > 0) {
		options.delay = delay;
	}

	// Create an Action to run
	action = new Action(func, options);

	// Add to end of the queue
	this._queue.push(action);

	// Autoplay if applicable
	if (!this._isPlaying && this._options.autoplay === true) {
		this.start();
	}
	else if (this._isPlaying) {
		this.__runNextAction();
	}
};

/**
 * @name module:ac-deferredqueue.DeferredQueue#remove
 *
 * @function
 * 
 * @desc Remove an action from the queue
 * 
 * @param {Action} action
 */
proto.remove = function (action) {
	this._queue = this._queue.filter(function (item) {
		return item !== action;
	});
};

/**
 * @name module:ac-deferredqueue.DeferredQueue#start
 * 
 * @function
 * 
 * @desc Run the queue, in order of what was added first.
 * 
 * @returns {void}
 */
proto.start = function () {
	if (this._isPlaying) {
		return false;
	}

	this._isPlaying = true;
	this.__runNextAction();
};

/**
 * @name module:ac-deferredqueue.DeferredQueue#stop
 *
 * @function
 * 
 * @desc Stop running through the queue. Still finishes any
 *       actions that were already running.
 * 
 * returns {void}
 */
proto.stop = function () {
	if (!this._isPlaying) {
		return false;
	}

	this._isPlaying = false;
};

/**
 * @name module:ac-deferredqueue.DeferredQueue#clear
 *
 * @function
 * 
 * @desc Clear out the queue, stop replacement
 * 
 * @returns {void}
 */
proto.clear = function () {
	this._queue = [];
	this.stop();
};

/**
 * @ignore
 * @name module:ac-deferredqueue.DeferredQueue#__didFinish
 *
 * @function
 * @private
 *
 * @desc If this is an asynchronous queue, wait for the previous action to
 *       finish before we run the next one.
 */
proto.__didFinish = function () {
	this._isRunningAction = false;
	this.__runNextAction();
};

/**
 * @ignore
 * @name module:ac-deferredqueue.DeferredQueue#__runNextAction
 *
 * @function
 * @private
 */
proto.__runNextAction = function () {
	// Must be running to run next
	if (!this._isPlaying) {
		return false;
	}

	// Make sure that our queue has stuff in it and we’re not waiting for a didFinish
	if (this._queue.length && !this._isRunningAction) {

		// Get the next action at the front of the queue
		var action = this._queue.shift();

		// Run the action
		action.run();

		// Don’t allow us to run two at the same time
		if (this._options.asynchronous === true) {
			this._isRunningAction = true;

			// Don’t run next action yet! Wait for didFinish to be called
			return;
		}

		this.__runNextAction();
	}
};

module.exports = DeferredQueue;

},{"./Action":807}],809:[function(require,module,exports){
arguments[4][1][0].apply(exports,arguments)
},{"dup":1}],810:[function(require,module,exports){
arguments[4][375][0].apply(exports,arguments)
},{"./ac-object/clone":811,"./ac-object/create":812,"./ac-object/defaults":813,"./ac-object/extend":814,"./ac-object/getPrototypeOf":815,"./ac-object/isDate":816,"./ac-object/isEmpty":817,"./ac-object/isRegExp":818,"./ac-object/toQueryParameters":819,"dup":375}],811:[function(require,module,exports){
arguments[4][376][0].apply(exports,arguments)
},{"./extend":814,"dup":376}],812:[function(require,module,exports){
arguments[4][377][0].apply(exports,arguments)
},{"dup":377}],813:[function(require,module,exports){
arguments[4][378][0].apply(exports,arguments)
},{"./extend":814,"dup":378}],814:[function(require,module,exports){
arguments[4][379][0].apply(exports,arguments)
},{"dup":379}],815:[function(require,module,exports){
arguments[4][380][0].apply(exports,arguments)
},{"dup":380}],816:[function(require,module,exports){
arguments[4][381][0].apply(exports,arguments)
},{"dup":381}],817:[function(require,module,exports){
arguments[4][382][0].apply(exports,arguments)
},{"dup":382}],818:[function(require,module,exports){
arguments[4][383][0].apply(exports,arguments)
},{"dup":383}],819:[function(require,module,exports){
arguments[4][384][0].apply(exports,arguments)
},{"dup":384,"qs":809}],820:[function(require,module,exports){
arguments[4][295][0].apply(exports,arguments)
},{"./ac-dom-emitter/DOMEmitter":821,"dup":295}],821:[function(require,module,exports){
arguments[4][296][0].apply(exports,arguments)
},{"ac-event-emitter":822,"dup":296}],822:[function(require,module,exports){
arguments[4][135][0].apply(exports,arguments)
},{"./ac-event-emitter/EventEmitter":823,"dup":135}],823:[function(require,module,exports){
arguments[4][136][0].apply(exports,arguments)
},{"dup":136}],824:[function(require,module,exports){
module.exports.ValueSmoother = require('./ac-value-smoother/ValueSmoother');

},{"./ac-value-smoother/ValueSmoother":825}],825:[function(require,module,exports){
'use strict';

/**
 * Instantiate `Smoother`
 * 
 * @param {Number} poolSize default set to `this.sampling` don't have to set this exlicitly unless you debug
 */

function ValueSmoother(poolSize) {
	poolSize = poolSize || this.sampling;

	this.pool = new Array(poolSize);

	this.raw = 0.0;
	this.value = 0.0;
}

var proto = ValueSmoother.prototype;

proto.sampling = 3; // Magic number, looks best for now.

/**
 * Returns smoothed value
 *
 * @param {Number} v latest input value
 * @param {Boolean} skipTrack (optional) flag if we should track value
 * @return {Number} smoothed value over history
 *
 * @api public
 */

proto.smooth = function(v, skipTrack) {

	var value = 0;
	var l = this.pool.length;

	if(typeof this.pool[l - this.sampling] !== 'undefined') {

		// Average the pool for our interest
		for(var i = this.sampling; i > 0; i--) {
			value += this.pool[l - i];
		}
		value += v;
		value /= (this.sampling + 1);

	} else {
		value = v;
	}

	if(!skipTrack) {
		this.raw = v;
		this._track(value, true);	
	}

	return value;
};

/**
 * Track value to build history
 *
 * @param {Number} v value to track
 * @param {Boolean} isSmoothed
 *
 * @api private
 */

proto._track = function(v, isSmoothed) {

	if(isSmoothed) {
		this.value = v;	
	} else {
		this.raw = this.value = v;
	}

	/**
	 * TODO: Any better way to make this push in/out faster?
	 */
	this.pool.push(v);
	this.pool.shift();
};

/**
 *  Expose `Smoother`
 */

module.exports = ValueSmoother;

},{}],826:[function(require,module,exports){
arguments[4][88][0].apply(exports,arguments)
},{"dup":88}],827:[function(require,module,exports){
arguments[4][89][0].apply(exports,arguments)
},{"dup":89}],828:[function(require,module,exports){
arguments[4][90][0].apply(exports,arguments)
},{"dup":90}],829:[function(require,module,exports){
arguments[4][91][0].apply(exports,arguments)
},{"dup":91}],830:[function(require,module,exports){
arguments[4][92][0].apply(exports,arguments)
},{"dup":92}],831:[function(require,module,exports){
arguments[4][93][0].apply(exports,arguments)
},{"dup":93}],832:[function(require,module,exports){
arguments[4][94][0].apply(exports,arguments)
},{"dup":94}],833:[function(require,module,exports){
arguments[4][95][0].apply(exports,arguments)
},{"dup":95}],834:[function(require,module,exports){
arguments[4][96][0].apply(exports,arguments)
},{"./ELEMENT_NODE":831,"./internal/isNodeType":840,"ac-polyfills/Array/prototype.filter":797,"ac-polyfills/Array/prototype.slice":799,"dup":96}],835:[function(require,module,exports){
arguments[4][97][0].apply(exports,arguments)
},{"./COMMENT_NODE":827,"./DOCUMENT_FRAGMENT_NODE":828,"./DOCUMENT_NODE":829,"./DOCUMENT_TYPE_NODE":830,"./ELEMENT_NODE":831,"./TEXT_NODE":832,"./createDocumentFragment":833,"./filterByNodeType":834,"./insertAfter":836,"./insertBefore":837,"./insertFirstChild":838,"./insertLastChild":839,"./isComment":842,"./isDocument":843,"./isDocumentFragment":844,"./isDocumentType":845,"./isElement":846,"./isNode":847,"./isNodeList":848,"./isTextNode":849,"./remove":850,"./replace":851,"dup":97}],836:[function(require,module,exports){
arguments[4][98][0].apply(exports,arguments)
},{"./internal/validate":841,"dup":98}],837:[function(require,module,exports){
arguments[4][99][0].apply(exports,arguments)
},{"./internal/validate":841,"dup":99}],838:[function(require,module,exports){
arguments[4][100][0].apply(exports,arguments)
},{"./internal/validate":841,"dup":100}],839:[function(require,module,exports){
arguments[4][101][0].apply(exports,arguments)
},{"./internal/validate":841,"dup":101}],840:[function(require,module,exports){
arguments[4][102][0].apply(exports,arguments)
},{"../isNode":847,"dup":102}],841:[function(require,module,exports){
arguments[4][103][0].apply(exports,arguments)
},{"../COMMENT_NODE":827,"../DOCUMENT_FRAGMENT_NODE":828,"../ELEMENT_NODE":831,"../TEXT_NODE":832,"./isNodeType":840,"dup":103}],842:[function(require,module,exports){
arguments[4][104][0].apply(exports,arguments)
},{"./COMMENT_NODE":827,"./internal/isNodeType":840,"dup":104}],843:[function(require,module,exports){
arguments[4][105][0].apply(exports,arguments)
},{"./DOCUMENT_NODE":829,"./internal/isNodeType":840,"dup":105}],844:[function(require,module,exports){
arguments[4][106][0].apply(exports,arguments)
},{"./DOCUMENT_FRAGMENT_NODE":828,"./internal/isNodeType":840,"dup":106}],845:[function(require,module,exports){
arguments[4][107][0].apply(exports,arguments)
},{"./DOCUMENT_TYPE_NODE":830,"./internal/isNodeType":840,"dup":107}],846:[function(require,module,exports){
arguments[4][108][0].apply(exports,arguments)
},{"./ELEMENT_NODE":831,"./internal/isNodeType":840,"dup":108}],847:[function(require,module,exports){
arguments[4][109][0].apply(exports,arguments)
},{"dup":109}],848:[function(require,module,exports){
arguments[4][110][0].apply(exports,arguments)
},{"dup":110}],849:[function(require,module,exports){
arguments[4][111][0].apply(exports,arguments)
},{"./TEXT_NODE":832,"./internal/isNodeType":840,"dup":111}],850:[function(require,module,exports){
arguments[4][112][0].apply(exports,arguments)
},{"./internal/validate":841,"dup":112}],851:[function(require,module,exports){
arguments[4][113][0].apply(exports,arguments)
},{"./internal/validate":841,"dup":113}],852:[function(require,module,exports){
arguments[4][114][0].apply(exports,arguments)
},{"./ac-dom-traversal/ancestor":853,"./ac-dom-traversal/ancestors":854,"./ac-dom-traversal/children":855,"./ac-dom-traversal/filterBySelector":856,"./ac-dom-traversal/firstChild":857,"./ac-dom-traversal/lastChild":860,"./ac-dom-traversal/matchesSelector":861,"./ac-dom-traversal/nextSibling":862,"./ac-dom-traversal/nextSiblings":863,"./ac-dom-traversal/previousSibling":864,"./ac-dom-traversal/previousSiblings":865,"./ac-dom-traversal/querySelector":866,"./ac-dom-traversal/querySelectorAll":867,"./ac-dom-traversal/shims/ie":868,"./ac-dom-traversal/siblings":869,"dup":114}],853:[function(require,module,exports){
arguments[4][115][0].apply(exports,arguments)
},{"./helpers/validate":859,"./matchesSelector":861,"ac-dom-nodes":835,"dup":115}],854:[function(require,module,exports){
arguments[4][116][0].apply(exports,arguments)
},{"./helpers/validate":859,"./matchesSelector":861,"ac-dom-nodes":835,"dup":116}],855:[function(require,module,exports){
arguments[4][117][0].apply(exports,arguments)
},{"./filterBySelector":856,"./helpers/validate":859,"ac-dom-nodes":835,"dup":117}],856:[function(require,module,exports){
arguments[4][118][0].apply(exports,arguments)
},{"./helpers/validate":859,"./matchesSelector":861,"dup":118}],857:[function(require,module,exports){
arguments[4][119][0].apply(exports,arguments)
},{"./children":855,"./helpers/validate":859,"dup":119}],858:[function(require,module,exports){
arguments[4][120][0].apply(exports,arguments)
},{"dup":120}],859:[function(require,module,exports){
arguments[4][121][0].apply(exports,arguments)
},{"ac-dom-nodes":835,"dup":121}],860:[function(require,module,exports){
arguments[4][122][0].apply(exports,arguments)
},{"./children":855,"./helpers/validate":859,"dup":122}],861:[function(require,module,exports){
arguments[4][123][0].apply(exports,arguments)
},{"./helpers/nativeMatches":858,"./helpers/validate":859,"ac-dom-nodes":835,"dup":123}],862:[function(require,module,exports){
arguments[4][124][0].apply(exports,arguments)
},{"./helpers/validate":859,"./matchesSelector":861,"ac-dom-nodes":835,"dup":124}],863:[function(require,module,exports){
arguments[4][125][0].apply(exports,arguments)
},{"./helpers/validate":859,"./matchesSelector":861,"ac-dom-nodes":835,"dup":125}],864:[function(require,module,exports){
arguments[4][126][0].apply(exports,arguments)
},{"./helpers/validate":859,"./matchesSelector":861,"ac-dom-nodes":835,"dup":126}],865:[function(require,module,exports){
arguments[4][127][0].apply(exports,arguments)
},{"./helpers/validate":859,"./matchesSelector":861,"ac-dom-nodes":835,"dup":127}],866:[function(require,module,exports){
arguments[4][128][0].apply(exports,arguments)
},{"./helpers/validate":859,"dup":128}],867:[function(require,module,exports){
arguments[4][129][0].apply(exports,arguments)
},{"./helpers/validate":859,"dup":129}],868:[function(require,module,exports){
arguments[4][130][0].apply(exports,arguments)
},{"../helpers/nativeMatches":858,"../helpers/validate":859,"../vendor/sizzle/sizzle":870,"ac-dom-nodes":835,"dup":130}],869:[function(require,module,exports){
arguments[4][131][0].apply(exports,arguments)
},{"./children":855,"./helpers/validate":859,"dup":131}],870:[function(require,module,exports){
arguments[4][132][0].apply(exports,arguments)
},{"dup":132}],871:[function(require,module,exports){
arguments[4][133][0].apply(exports,arguments)
},{"./ac-dom-emitter/DOMEmitter":872,"dup":133}],872:[function(require,module,exports){
arguments[4][134][0].apply(exports,arguments)
},{"ac-dom-events":826,"ac-dom-traversal":852,"ac-event-emitter":822,"dup":134}],873:[function(require,module,exports){
arguments[4][137][0].apply(exports,arguments)
},{"./ac-shared-instance/SharedInstance":874,"dup":137}],874:[function(require,module,exports){
arguments[4][138][0].apply(exports,arguments)
},{"dup":138}],875:[function(require,module,exports){
arguments[4][139][0].apply(exports,arguments)
},{"./ac-window-delegate/WindowDelegate":878,"./ac-window-delegate/WindowDelegateCustomEvent":879,"./ac-window-delegate/WindowDelegateOptimizer":880,"dup":139}],876:[function(require,module,exports){
arguments[4][140][0].apply(exports,arguments)
},{"ac-event-emitter":822,"dup":140}],877:[function(require,module,exports){
arguments[4][141][0].apply(exports,arguments)
},{"ac-event-emitter":822,"dup":141}],878:[function(require,module,exports){
arguments[4][142][0].apply(exports,arguments)
},{"./CustomEventController":876,"./OptimizerController":877,"./optimizers/optimizers":883,"./queries/queries":892,"ac-dom-emitter":871,"ac-shared-instance":873,"dup":142}],879:[function(require,module,exports){
arguments[4][143][0].apply(exports,arguments)
},{"ac-event-emitter":822,"dup":143}],880:[function(require,module,exports){
arguments[4][144][0].apply(exports,arguments)
},{"ac-event-emitter":822,"dup":144}],881:[function(require,module,exports){
arguments[4][145][0].apply(exports,arguments)
},{"../../WindowDelegateOptimizer":880,"../../queries/queries":892,"dup":145}],882:[function(require,module,exports){
arguments[4][146][0].apply(exports,arguments)
},{"../../WindowDelegateOptimizer":880,"../../queries/queries":892,"dup":146}],883:[function(require,module,exports){
arguments[4][147][0].apply(exports,arguments)
},{"./events/resize":881,"./events/scroll":882,"dup":147}],884:[function(require,module,exports){
arguments[4][148][0].apply(exports,arguments)
},{"dup":148}],885:[function(require,module,exports){
arguments[4][149][0].apply(exports,arguments)
},{"dup":149}],886:[function(require,module,exports){
arguments[4][150][0].apply(exports,arguments)
},{"dup":150}],887:[function(require,module,exports){
arguments[4][151][0].apply(exports,arguments)
},{"dup":151}],888:[function(require,module,exports){
arguments[4][152][0].apply(exports,arguments)
},{"dup":152}],889:[function(require,module,exports){
arguments[4][153][0].apply(exports,arguments)
},{"dup":153}],890:[function(require,module,exports){
arguments[4][154][0].apply(exports,arguments)
},{"dup":154}],891:[function(require,module,exports){
arguments[4][155][0].apply(exports,arguments)
},{"dup":155}],892:[function(require,module,exports){
arguments[4][156][0].apply(exports,arguments)
},{"./methods/clientHeight":884,"./methods/clientWidth":885,"./methods/innerHeight":886,"./methods/innerWidth":887,"./methods/maxScrollX":888,"./methods/maxScrollY":889,"./methods/scrollX":890,"./methods/scrollY":891,"dup":156}],893:[function(require,module,exports){
/** 
 * @module ac-scroll-time-update
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

module.exports = {
	ScrollTimeUpdate: require('./ac-scroll-time-update/ScrollTimeUpdate'),
	ElementScrollTimeUpdate: require('./ac-scroll-time-update/ElementScrollTimeUpdate')
};

},{"./ac-scroll-time-update/ElementScrollTimeUpdate":894,"./ac-scroll-time-update/ScrollTimeUpdate":895}],894:[function(require,module,exports){
'use strict';

var ScrollTimeUpdate = require('./ScrollTimeUpdate'),
	WindowDelegate = require('ac-window-delegate').WindowDelegate;

var proto;

var ElementScrollTimeUpdate = function( el, options ) {
	options = options || {};
	this.el = el;
	this._updateOnResize = false;

	ScrollTimeUpdate.call( this, 0, 0, options );
	this.setOffsets();

	this._clock.on( 'update', this._onResizeClockUpdate, this );
	this._clock.on( 'draw', this._onResizeClockDraw, this );
	WindowDelegate.on( 'resize orientationchange', this._onResize, this );
};

proto = ElementScrollTimeUpdate.prototype = new ScrollTimeUpdate( null );

proto.setOffsets = function() {
	var boundingBox = this.el.getBoundingClientRect(),
		scrollOffset = WindowDelegate.scrollY(),
		min = boundingBox.top + scrollOffset,
		max = boundingBox.bottom + scrollOffset;

	if ( this.options.startInView ) {
		min = min - WindowDelegate.innerHeight();
	}

	if ( typeof this.options.offsetTop === 'function' ) {
		min = min + this.options.offsetTop();
	} else if ( typeof this.options.offsetTop === 'number' ) {
		min = min + this.options.offsetTop;
	}

	if ( typeof this.options.offsetBottom === 'function' ) {
		max = max - this.options.offsetBottom();
	} else if ( typeof this.options.offsetBottom === 'number' ) {
		max = max - this.options.offsetBottom;
	}

	this.min = min;
	this.max = max;
	this._distance = this.max - this.min;
	
	return this;
};

proto._onResize = function() {
	this._updateOnResize = true;
};

proto._onResizeClockUpdate = function() {
	if ( !this._updateOnResize ) {
		return;
	}
	this.setOffsets();
};

proto._onResizeClockDraw = function() {
	if ( !this._updateOnResize ) {
		return;
	}
	this.setCurrentTime();
	this._updateOnResize = false;
};

module.exports = ElementScrollTimeUpdate;

},{"./ScrollTimeUpdate":895,"ac-window-delegate":875}],895:[function(require,module,exports){
'use strict';

var proto,
	EventEmitter = require('ac-event-emitter').EventEmitter,
	Clock = require('ac-clock'),
	WindowDelegate = require('ac-window-delegate').WindowDelegate,
	ValueSmoother = require('ac-value-smoother').ValueSmoother,
	DOMEmitter = require('ac-dom-emitter').DOMEmitter;

var ScrollTimeUpdate = function( min, max, options ) {
	// set min to return here if null. useful for extending this module
	if ( min === null ) {
		return;
	}

	// call EventEmitter for extending prototype
	EventEmitter.call( this );
	this.options = options || {};

	// set instance variables
	this.min = min;
	this.max = max;
	this._distance = max - min;
	this._clock = this.options.clock || Clock;
	this._emitter = WindowDelegate;
	this._lastTime = null;
	this._timeObj = null;

	/*
	 * if an element exists, this means that we are going to create a ScrollTimeUpdate instance
	 * for the element instead of using the window. this probably assumes that the element you
	 * pass in is some kind of overflow:scrolling; element
	 */
	if ( this.options.el ) {
		this._target = this.options.el;
		this._emitter = new DOMEmitter( this.options.el );
	}

	// set state variables
	this._shouldUpdate = false;
	this._shouldDraw = false;
	this._didInitializeSmoothing = false;

	// on scroll, handle debouncing the scroll to work better with the clock instance
	this._emitter.on('scroll', this._debounceTimeUpdate, this );

	// add an event to the clock to handle updating values on clock updates
	this._clock.on( 'update', this._onClockUpdate, this );
	// add an event to the clock to handle clockDraw, when it's about to draw
	this._clock.on( 'draw', this._onClockDraw, this );

	/*
	 * if smoothing is enabled, we have additional setup
	 */

	if ( this.options.smooth ) {
		this._enableSmoothing( true );
	}
};

// extend prototype
proto = ScrollTimeUpdate.prototype = new EventEmitter( null );

// set the current time of the content ( e.time )
proto.setCurrentTime = function( currentTime, force ) {
	currentTime = currentTime || this._getCalculatedCurrentTime();

	// don't trigger unless the time is different than the previous time
	if ( currentTime === this._lastTime) {
		return;
	}

	// save the time as an object
	this._timeObj = {
		time : currentTime,
		lastTime : this._lastTime
	};

	// trigger an update event
	this._triggerUpdate();

	// if force, draw right away. else, put on queue for next draw cycle
	if ( force ) {
		this._triggerDraw();
	} else {
		this._shouldDraw = true;
	}

	// save the last time
	this._lastTime = currentTime;
};

// helper to start the clock instance
proto.start = function() {
	this._clock.start();
};

// helper to stop the clock instance
proto.stop = function() {
	this._clock.stop();
};

proto.setSmoothing = function( bool ) {
	if ( typeof bool !== 'boolean' ) {
		return;
	}

	if ( bool ) {
		this._enableSmoothing();
		return;
	}
	this._disableSmoothing();
};

// get the current time ( between 0 and 1 ) of where the time should be, depending on the min and max values
proto._getCalculatedCurrentTime = function() {
	var scrollY = WindowDelegate.scrollY(),
		min = this.min,
		max = this.max,
		distance = this._distance;

	// get element scroll top value if an element is being used instead of WindowDelegate
	if ( this._target ) {
		scrollY = this._target.scrollTop;
	}

	// if we're below the min value, set the min value
	if ( scrollY < min ) {
		scrollY = min;
	}

	// if we're above the max value, set the max value
	if ( scrollY > max ) {
		scrollY = max;
	}

	// return from 0 to 1 what the value should be
	return ( scrollY - min ) / ( distance );
};

// handle only letting a events get passed to the clock if there are currently no other events being queued
proto._debounceTimeUpdate = function() {
	this._shouldUpdate = true;
};

proto._triggerUpdate = function() {
	// trigger an internal update event
	this.trigger( '_update', this._timeObj );

	// if we're smoothing the values, we will handle the broadcast seperately later
	if ( !this.options.smooth ) {
		this.trigger( 'update', this._timeObj );
	}
};

proto._triggerDraw = function() {
	// trigger an internal draw event
	this.trigger( '_draw', this._timeObj );

	// if we're smoothing the values, we will handle the broadcast seperately later
	if ( !this.options.smooth ) {
		this.trigger( 'draw', this._timeObj );
	}
};

proto._onClockUpdate = function() {
	if ( !this._shouldUpdate ) {
		return;
	}

	this.setCurrentTime();
	this._shouldUpdate = false;
};

proto._onClockDraw = function() {
	if ( !this._shouldDraw ) {
		return;
	}

	this._triggerDraw();
	this._shouldDraw = false;
};

proto._initializeSmoothing = function() {
	this.options.smoothingPrecision = this.options.smoothingPrecision || 4;
	this.options.smoothingPoolSize = this.options.smoothingPoolSize || ValueSmoother.prototype.sampling;

	this._smoother = new ValueSmoother( this.options.smoothingPoolSize );
	
	this._smoothedValues = this._lastSmoothedValues = this._lastUpdateEvent = {
		time : null,
		lastTime : null
	};

	this._didUpdateSmootherTrack = false;
	this._shouldUpdateAndDraw = false;
	this._didInitializeSmoothing = true;
};

proto._enableSmoothing = function( force ) {
	if ( !this._didInitializeSmoothing ) {
		this._initializeSmoothing();
	}

	// if smoothing is already active, don't bind again (unless force is active)
	if ( !this.options.smooth || force ) {
		this.on( '_update', this._updateSmoothing, this );
		this._clock.on( 'update', this._smoothOnUpdate, this );
		this._clock.on( 'draw', this._smoothOnDraw, this );
		this.options.smooth = true;
	}
};

proto._disableSmoothing = function() {
	this.off( '_update', this._updateSmoothing, this );
	this._clock.off( 'update', this._smoothOnUpdate, this );
	this._clock.off( 'draw', this._smoothOnDraw, this );
	this.options.smooth = false;
};

proto._updateSmoothing = function( e ) {
	e.lastTime = e.lastTime || 0;

	this._lastUpdateEvent = e;
	this._didUpdateSmootherTrack = true;
};

proto._smoothOnUpdate = function() {
	var shouldUpdate = (
		this._didUpdateSmootherTrack ||
		this._lastSmoothedValues.time !== this._smoothedValues.time ||
		this._lastSmoothedValues.lastTime !== this._smoothedValues.lastTime
	 );

	if ( !shouldUpdate ) {
		this._shouldUpdateAndDraw = false;
		return;
	}

	this._didUpdateSmootherTrack = false;

	var lastTime = this._lastUpdateEvent.lastTime,
		smoothedValues = {};

	smoothedValues.lastTime = this._smoothedValues.time;
	smoothedValues.time = this._smoother.smooth( this._lastUpdateEvent.time ); // e.time from ScrollTimeUpdate

	if ( smoothedValues.lastTime === null ) {
		smoothedValues.lastTime = parseFloat( lastTime.toFixed( this.options.smoothingPrecision ) );
	}

	smoothedValues.time = parseFloat( smoothedValues.time.toFixed( this.options.smoothingPrecision ) );
	smoothedValues.lastTime = smoothedValues.lastTime;

	this._lastSmoothedValues = this._smoothedValues;
	this._smoothedValues = smoothedValues;

	this._shouldUpdateAndDraw = true;
	this.trigger( 'update', this._smoothedValues );
};

proto._smoothOnDraw = function( e ) {
	if ( !this._shouldUpdateAndDraw ) {
		return;
	}
	
	this.trigger('draw', this._smoothedValues );
	this._shouldUpdateAndDraw = false;

};

module.exports = ScrollTimeUpdate;

},{"ac-clock":802,"ac-dom-emitter":820,"ac-event-emitter":822,"ac-value-smoother":824,"ac-window-delegate":875}],896:[function(require,module,exports){
arguments[4][295][0].apply(exports,arguments)
},{"./ac-dom-emitter/DOMEmitter":897,"dup":295}],897:[function(require,module,exports){
arguments[4][725][0].apply(exports,arguments)
},{"ac-event-emitter":898,"dup":725}],898:[function(require,module,exports){
arguments[4][135][0].apply(exports,arguments)
},{"./ac-event-emitter/EventEmitter":899,"dup":135}],899:[function(require,module,exports){
arguments[4][136][0].apply(exports,arguments)
},{"dup":136}],900:[function(require,module,exports){
exports.ScrollView = require('./ac-scrollview/ScrollView');

},{"./ac-scrollview/ScrollView":907}],901:[function(require,module,exports){
function InputDecorator () { }

InputDecorator.prototype = {
    on: function () {
        return this._parent.on.apply(this._parent, arguments);
    },

    off: function () {
        return this._parent.off.apply(this._parent, arguments);
    },

    trigger: function () {
        return this._parent.trigger.apply(this._parent, arguments);
    },

    once: function () {
        return this._parent.once.apply(this._parent, arguments);
    },

    setEnabled: function (enable) {
        this._parent.setEnabled.apply(this._parent, arguments);
    },

    isEnabled: function () {
        return this._parent.isEnabled.apply(this._parent, arguments);
    }
};

module.exports = InputDecorator;
},{}],902:[function(require,module,exports){
var constrainValue = function (value, max) {
    return Math.max(0, Math.min(value, max));
};

var calculateOverscrollAmount = function (position, scrollDistance) {
    var overscroll = { x: 0, y: 0 };
    
    if (position.x < 0) {
        overscroll.x = -position.x;
    }
    else if (position.x > scrollDistance.x) {
        overscroll.x = scrollDistance.x - position.x;
    }

    if (position.y < 0) {
        overscroll.y = -position.y;
    }
    else if (position.y > scrollDistance.y) {
        overscroll.y = scrollDistance.y - position.y;
    }

    return overscroll;
};

var constrainToScrollBounds = function (position, scrollDistance) {
    position.x = constrainValue(position.x, scrollDistance.x);
    position.y = constrainValue(position.y, scrollDistance.y);

    return position;  
};

var halfInputIfOutsideOfScrollBounds = function(previousPosition, position, scrollDistance) {
    var overscroll = calculateOverscrollAmount(position, scrollDistance);

    if (overscroll.x !== 0) {
        position.x = previousPosition.x + ((position.x - previousPosition.x) * 0.5);
    }

    if (overscroll.y !== 0) {
        position.y = previousPosition.y + ((position.y - previousPosition.y) * 0.5);
    }

    return position;
};

module.exports = {
    calculateOverscrollAmount: calculateOverscrollAmount,
    constrainValue: constrainValue,
    constrainToScrollBounds: constrainToScrollBounds,
    halfInputIfOutsideOfScrollBounds: halfInputIfOutsideOfScrollBounds
};
},{}],903:[function(require,module,exports){
var BaseInputDecorator = require('./BaseInputDecorator');
var DIRECTION_LOCK_THRESHOLD = 4;

function DirectionalLock (input) {
    this._parent = input;
    this._currentAxis = undefined;
}

var proto = DirectionalLock.prototype = new BaseInputDecorator();

proto.inputStart = function (x, y, timeStamp, e) {
    this._currentAxis = false;
    this._firstTouch = {
        x: x,
        y: y
    };
    this._parent.inputStart.apply(this._parent, arguments);
};

proto.inputMove = function (x, y, timeStamp, e) {
    if (!this._currentAxis) {
        if (Math.abs(x - this._firstTouch.x) > DIRECTION_LOCK_THRESHOLD) {
            this._currentAxis = 'x';
        }
        else if (Math.abs(y - this._firstTouch.y) > DIRECTION_LOCK_THRESHOLD) {
            this._currentAxis = 'y';
        }
    }

    if (this._currentAxis === 'x') {
        y = this._firstTouch.y;
    }
    else if (this._currentAxis === 'y') {
        x = this._firstTouch.x;
    }

    this._parent.inputMove.apply(this._parent, arguments);
};

proto.inputEnd = function (timeStamp, e) {
    this._parent.inputEnd.apply(this._parent, arguments);
};

module.exports = DirectionalLock;

},{"./BaseInputDecorator":901}],904:[function(require,module,exports){
var assign = require('./utilities').assign;

var Constraints = require('./Constraints');
var fastFivePointPrecision = require('./utilities').fastFivePointPrecision;

var FRAME_TIME = (1000/60); // 60 frames per second 

var defaults = {
	friction: {
		x: 0.95,
		y: 0.95
	},
	outOfBounds: {
		deceleration: 0.05,
		acceleration: 0.1
	}
};

/**
 * Calculates various things related to inertia 
 * @constructor
 * @param {object} config - friction, outOfBounds
 */
function InertiaCalculator (options) {

	this.options = assign({}, defaults, options || {});

	if (options && options.friction) {
		var friction = options.friction;
		if (typeof friction !== 'object' || !('x' in friction) || !('y' in friction)) {
			throw new TypeError('InertiaCalculator expects custom friction to be an object with numeric x/y properties.');
		}
	}

	if (options && options.outOfBounds) {
		var outOfBounds = options.outOfBounds;
		if (typeof outOfBounds !== 'object' || !('acceleration' in outOfBounds) || !('deceleration' in outOfBounds)) {
			throw new TypeError('InertiaCalculator expects custom outOfBounds coefficients to be an object with numeric acceleration/deceleration properties.');
		}
	}
}

var proto = InertiaCalculator.prototype;

/**
 * Calculates frames for an inertial animation
 * @param {object} position
 * @param {object} velocity
 * @param {object} scrollDistance
 * @param {boolean} preventBounce
 * @param {object} friction
 * @returns {array} animation frames
 */
proto.calculateInertiaPositions = function(position, velocity, scrollDistance, preventBounce, friction) {

	var frames = [];

	if (!friction) {
		friction = this.options.friction;
	}

	velocity = {
		x: velocity.x * FRAME_TIME,
		y: velocity.y * FRAME_TIME
	};

	if (scrollDistance.x === 0) {
		velocity.x = 0;
	}

	if (scrollDistance.y === 0) {
		velocity.y = 0;
	}

	while (Math.abs(velocity.x) > 0.01 || Math.abs(velocity.y) > 0.01) {
		if (frames.length > 5000) {
			console.warn('potential loop detected.');
			return frames;
		}

		// apply velocity to for next position
		position.x = position.x + velocity.x;
		position.y = position.y + velocity.y;

		// apply friction to velocity to slow down
		velocity.x = velocity.x * friction.x;
		velocity.y = velocity.y * friction.y;

		position.x = fastFivePointPrecision(position.x);
		position.y = fastFivePointPrecision(position.y);

		// determine if we scrolled past bounds
		var overscroll = Constraints.calculateOverscrollAmount(position, scrollDistance);

		// if we are past a boundary, we want to amplify deceleration
		// and then accelerate back in the opposite direction (spring effect)
		if (overscroll.x !== 0) {
			if (overscroll.x * velocity.x <= 0) {
				velocity.x += overscroll.x * this.options.outOfBounds.deceleration;
			}
			else {
				velocity.x = overscroll.x * this.options.outOfBounds.acceleration;
			}
		}
		if (overscroll.y !== 0) {
			if (overscroll.y * velocity.y <= 0) {
				velocity.y += overscroll.y * this.options.outOfBounds.deceleration;
			}
			else {
				velocity.y = overscroll.y * this.options.outOfBounds.acceleration;
			}
		}
		
		if (preventBounce) {
			Constraints.constrainToScrollBounds(position, scrollDistance);
		}
		
		frames.push({ x: position.x, y: position.y, velocity: { x: fastFivePointPrecision(velocity.x / FRAME_TIME), y: fastFivePointPrecision(velocity.y / FRAME_TIME) } });
	}

	if (frames.length > 1) {
		var lastFrame = frames[frames.length - 1];

		// round the last frame to get a perfect stop
		// we need this is because we are calculating velocity to 0.01
		lastFrame.x = Math.round(lastFrame.x);
		lastFrame.y = Math.round(lastFrame.y);

		Constraints.constrainToScrollBounds(lastFrame, scrollDistance);
	}

	return frames;
};

/**
 * Calculates initial velocity needed to reach an end position using the configured friction
 * @param {object} startPosition
 * @param {object} endPosition
 * @returns {object} initial velocity
 */
proto.calculateInitialVelocity = function (startPosition, endPosition) {
	var velocity = {};
	var decelerationX = 1 - this.options.friction.x;
	var decelerationY = 1 - this.options.friction.y;

	var distX = endPosition.x - startPosition.x;
    velocity.x = fastFivePointPrecision((decelerationX * distX) / FRAME_TIME);

    var distY = endPosition.y - startPosition.y;
	velocity.y = fastFivePointPrecision((decelerationY * distY) / FRAME_TIME);

	return velocity;
};

/**
 * Calculates friction needed to stop at a particular point
 * @param {object} currentPosition
 * @param {object} currentVelocity
 * @param {object} endPosition
 * @returns {object} friction
 */
proto.calculateFrictionToStopAtPoint = function(currentPosition, currentVelocity, endPosition) {
	var friction = {};
	var distX = Math.abs(endPosition.x - currentPosition.x);
	friction.x = fastFivePointPrecision(1 - ((Math.abs(currentVelocity.x) * FRAME_TIME) / distX));

	var distY = Math.abs(endPosition.y - currentPosition.y);
	friction.y = fastFivePointPrecision(1 - ((Math.abs(currentVelocity.y) * FRAME_TIME) / distY));
	friction.y = Math.min(1, friction.y);

	friction.x = Math.min(1, Math.max(0, friction.x));
	friction.y = Math.min(1, Math.max(0, friction.y));

	if (isNaN(friction.x)) {
		friction.x = 0;
	}

	if (isNaN(friction.y)) {
		friction.y = 0;
	}

	return friction;
};

module.exports = InertiaCalculator;
},{"./Constraints":902,"./utilities":914}],905:[function(require,module,exports){
var EventEmitter = require('ac-event-emitter').EventEmitter;
var Clock = require('ac-clock').Clock;

/**
 * Controls playback of inertia animations
 * @constructor
 * @augments EventEmitter
 * @param {object} scroll - an instance of Scroll to animate
 */
function InertiaPlayer (scroll) {
    this._clock = new Clock();
    this._isPlaying = false;
    this._scroll = scroll;
    this._currentFrameCnt = 0;
    this._accumulatedTime = 0;
    this._currentAnimationDuration = 0;
    this._clock.on('draw', this._draw, this);
}

var proto = InertiaPlayer.prototype = new EventEmitter();

/**
 * Stops the current animation
 */
proto.stop = function () {
    if (this._isPlaying) {
        this._clock.stop();
        this._isPlaying = false;
        this.trigger('end');
    }
    
    this._frames = [];
};

/**
 * Returns state of animation playback
 * @returns {boolean} isPlaying
 */
proto.isPlaying = function() {
    return this._isPlaying;
};

/**
 * Returns the current animation frame
 * @returns {object} currentFrame
 */
proto.getCurrentFrame = function() {
    return this._currentFrame;
};

/**
 * Returns the next frame of the animation, given a time delta
 * @param {object} object with a delta property
 * @returns {object} Next inertia animation frame
 */
proto.getNextFrame = function(e) {
    this._accumulatedTime += e.delta;

    var nextFrameIndex = Math.round(this._accumulatedTime / (1000/60));

    this._currentFrame = this._frames[nextFrameIndex];

    return this._currentFrame;
};

/**
 * Private method that handles updating/drawing animation
 * @param {object} An object with a time delta property
 * @returns {object} Next inertia animation frame given a delta
 * @fires 'end'
 */
proto._draw = function(e) {
    var nextFrame = this.getNextFrame(e);

    // if the animation was stopped or has completed,
    // trigger an 'end' event and stop the clock
    if (!this._isPlaying || (this._accumulatedTime > this._currentAnimationDuration)) {
        this._isPlaying = false;
        this.trigger('end');
        this._clock.stop();
        return;
    }

    // do not use ScrollView's setPosition because 
    // that allows users to change position during inertia animation
    this._scroll.setPosition(nextFrame);
};

/**
 * Start playback of animation
 * @param {array} Array of animation frames 
 */
proto.play = function (positions) {
    if (this._isPlaying) {
        return;
    }

    this._frames = positions;
    this._isPlaying = true;
    this._accumulatedTime = 0;
    this._currentFrameCnt = this._frames.length - 1;
    this._currentFrame = this._frames[0];

    // assuming frame calcuations were made for 60fps
    this._currentAnimationDuration = (this._currentFrameCnt / 60) * 1000;

    this._clock.start();
};

module.exports = InertiaPlayer; 
},{"ac-clock":802,"ac-event-emitter":898}],906:[function(require,module,exports){
var BaseInputDecorator = require('./BaseInputDecorator');
var UPPER_ANGLE = 45;
var LOWER_ANGLE = -UPPER_ANGLE;

function InputPreventDefault (input, axis) {
	this._parent = input;
	this._axis = axis;
	this._inputs = [];

	this._startTouchMove = null;
	this._shouldPreventDefault = null;
}

var proto = InputPreventDefault.prototype = new BaseInputDecorator();

proto._calculateTouchAngles = function () {
	var angles = {
		x:0,
		y:0
	};

	var lastTouch = this._inputs[this._inputs.length - 1];
	var firstTouch = this._inputs[0];

	var xdist = lastTouch.x - firstTouch.x;
	var ydist = lastTouch.y - firstTouch.y;
	var hypotenuse = Math.sqrt(xdist * xdist + ydist * ydist);

	if (hypotenuse === 0) {
		return false;
	}

	var xAngle = Math.asin(ydist / hypotenuse);
	var yAngle = Math.acos(xdist / hypotenuse);

	angles.x = xAngle * (180 / Math.PI);

	angles.y = yAngle * (180 / Math.PI);
	angles.y -= 90;

	return angles;
};

proto.inputStart = function (x, y, timeStamp, e) {
	this._inputs = [{
		x:x,
		y:y
	}];
	this._startTouchMove = {
		x:x,
		y:y,
		timeStamp:timeStamp,
		e:e
	};

	this._checkToPreventDefault = true;
	this._parent.inputStart.apply(this._parent, arguments);
};

proto._angleTest = function (angle) {
	return (angle <= UPPER_ANGLE && angle >= LOWER_ANGLE) ? true : false;
};

proto._preventDefault = function (x, y, timeStamp, e) {
	e.preventDefault();
	this._shouldPreventDefault = true;
	this._parent.inputMove.apply(this._parent, arguments);
};


proto.inputMove = function (x, y, timeStamp, e) {
	this._inputs[1] = {
		x:x,
		y:y
	};

	var angles = this._calculateTouchAngles();

	if (
		(this._axis === 'y' && this._angleTest(angles.y)) ||
		(this._axis === 'x' && this._angleTest(angles.x)) ||
		(this._axis === true && (this._angleTest(angles.x) || this._angleTest(angles.y)) )) {

		if (this._shouldPreventDefault !== false) {
			this._preventDefault.apply(this, arguments);
		}


	} else if (this._shouldPreventDefault === true) {
		this._preventDefault.apply(this, arguments);
	} else {
		this._shouldPreventDefault = false;
	}

};

proto.inputEnd = function (timeStamp, e) {
	this._shouldPreventDefault = true;
	this._parent.inputEnd.apply(this._parent, arguments);
};

module.exports = InputPreventDefault;

},{"./BaseInputDecorator":901}],907:[function(require,module,exports){
var assign = require('./utilities').assign;
var EventEmitter = require('ac-event-emitter').EventEmitter;
var InertiaCalculator = require('./InertiaCalculator');
var MouseWheelInput = require('./input/MouseWheel');
var MouseDrag = require('./input/MouseDrag');
var TouchInput = require('./input/Touch');
var Input = require('./input/Input');
var InputPreventDefault = require('./InputPreventDefault');
var DirectionalLock = require('./DirectionalLock');
var Scroll = require('./model/Scroll');
var Transition = require('./Transition');
var Constraints = require('./Constraints');
var InertiaPlayer = require('./InertiaPlayer');

var defaults = {
	alwaysBounceHorizontal:false,
	alwaysBounceVertical:false,
	bounces:true,
	directionalLockEnabled:false,
	mouseDrag:true,
	mouseWheel:true,
	preventDefault:true,
	scrollingEnabled:true,
	touch:true
};


function ScrollView (element, options) {

	if (!element || !element instanceof Element) {
		throw new Error('Element required as first argument for constructor.');
	}

	if (!options || options === null || !options.width || !options.height || !options.contentSize) {
		throw new Error('Scroll View requires a second argument, an object, specifying width, height, and contentSize.');
	}

	this.options = assign({}, defaults, options);

	assign(this, {
		_element: element,
		_width: this.options.width,
		_height: this.options.height,
		_contentSize: this.options.contentSize,
		_isDecelerating: false
	});


	this._scroll = new Scroll();
	this._inputNormalize = new Input(this._scroll);
	this._inputNormalize.setEnabled(this.options.scrollingEnabled);

	if (this.options.preventDefault) {
		this._inputNormalize = new InputPreventDefault(this._inputNormalize, this.options.preventDefault);
	}


	if (this.options.directionalLockEnabled) {
		this._inputNormalize = new DirectionalLock(this._inputNormalize);
	}

	this._inputNormalize.on('input_start', this.inputStart, this);
	this._inputNormalize.on('input_move', this.inputMove, this);
	this._inputNormalize.on('input_end', this.inputEnd, this);


	if (this.options.touch === true) {
		this._touch = new TouchInput(this._inputNormalize, element);
	}

	if (this.options.mouseWheel === true) {
		this._mouseWheel = new MouseWheelInput(this._inputNormalize, element);
	}

	if (this.options.mouseDrag === true) {
		this._mouseDrag = new MouseDrag(this._inputNormalize, element);
	}

	this._inertiaCalculator = new InertiaCalculator(this.options);

	// Set up inertia player
	this._inertiaPlayer = new InertiaPlayer(this._scroll);
	this._inertiaPlayer.on('end', function() {
		this._isDecelerating = false;
		this.trigger('didEndDecelerating');
	}, this);

	this._scroll.propagateTo(this);

}


var proto = ScrollView.prototype = new EventEmitter();

proto.isDecelerating = function () {
	return this._isDecelerating;
};

proto._animateToPosition = function (position) {
	var self = this;
	var startPosition = this.getPosition();

	this._transition = new Transition({
		draw: function(t) {
			self.setPosition({
				y: startPosition.y + (position.y - startPosition.y) * t,
				x: startPosition.x + (position.x - startPosition.x) * t
			});
		}
	});
	this._transition.play();
};

proto._handleConstraints = function (position) {
    var contentSize = this.getContentSize();
    var height = this.getHeight();
    var width = this.getWidth();
    var scrollDistance = this.getScrollDistance();

    // iOS behavior, at edge cut input by half
    position = Constraints.halfInputIfOutsideOfScrollBounds(this.getPosition(), position, scrollDistance);

    // By default only bounce on edges that have bleed (iOS)
    // this can be overridden with alwaysBounceHorizontal
    // or alwaysBounceVertical
    if (!this.options.alwaysBounceHorizontal &&
        contentSize.height > height &&
        contentSize.width <= width) {
        position.x = 0;
    }

    if (!this.options.alwaysBounceVertical &&
        contentSize.width > width &&
        contentSize.height <= height) {
        position.y = 0;
    }

    // No bounce option
    if (this.options.bounces === false) {
        return Constraints.constrainToScrollBounds(position, scrollDistance);
    }

    return position;
};

proto.setScrollingEnabled = function (scrollingEnabled) {
	this._inputNormalize.setEnabled(scrollingEnabled);
};

proto.isScrollingEnabled = function () {
	return this._inputNormalize.isEnabled();
};

proto.getPosition = function() {
	return this._scroll.getPosition();
};

proto.setPosition = function(position, animated) {
	// If user passes a position, but no second argument
	// and inertia is playing we will recalculate inertia from
	// the new position (used for infinite scrolling / 360).
	// If we are not doing an inertial animation, we will simply
	// setPosition.
	if (animated === undefined) {

		this._scroll.setPosition(position);

		if (this._inertiaPlayer.isPlaying()) {
			var current = this.getPosition();
			var currentFrame = this._inertiaPlayer.getCurrentFrame();
			var frames = this._inertiaCalculator.calculateInertiaPositions(current, currentFrame.velocity, this.getScrollDistance(), !this.options.bounces);

			this._inertiaPlayer.stop();
			this._inertiaPlayer.play(frames);
		}

	}
	// If the user passed false for animated, we will stop any running
	// animations and set the scroll position.
	else if (animated === false) {
		this._inertiaPlayer.stop();
		this._scroll.setPosition(position);
	}
	// If the user passed true as the second argument. This functionality
	// is experimental. It'd be nice to support it, but we should
	// do it without using animateToPosition / Transition.
	else {
		this._inertiaPlayer.stop();
		this._animateToPosition(position);
	}
};

proto.inertialScrollTo = function (position, velocity) {
	if (this._inertiaPlayer.isPlaying()) {
		this._inertiaPlayer.stop();
	}

	var current = this.getPosition();
	var overscroll = Constraints.calculateOverscrollAmount(current, this.getScrollDistance());

	// if we have overscrolled,
	// we need to instantly decelerate otherwise
	// the inertia calculations break
	// ideally, we probably want to alter the velocity so we
	// stop at the halfway point but I haven't gotten that working
	if (overscroll.x !== 0) {
		velocity.x = 0.1;
	}
	if (overscroll.y !== 0) {
		velocity.y = 0.1;
	}

	var friction = this._inertiaCalculator.calculateFrictionToStopAtPoint(this.getPosition(), velocity, position);
	var frames = this._inertiaCalculator.calculateInertiaPositions(current, velocity, this.getScrollDistance(), !this.options.bounces, friction);
	this._inertiaPlayer.play(frames);
};

proto.setHeight = function (height) {
	this._height = height;
};

proto.setWidth = function (width) {
	this._width = width;
};

proto.getHeight = function () {
	return this._height;
};

proto.getWidth = function () {
	return this._width;
};

proto.setContentSize = function (size) {
	this._contentSize.height = size.height;
	this._contentSize.width = size.width;
	return this;
};

proto.getContentSize = function () {
	return this._contentSize;
};


proto.getScrollYDistance = function () {
	var distance = this._contentSize.height - this._height;
	if (distance < 0) {
		distance = 0;
	}

	return distance;
};

proto.getScrollXDistance = function () {
	var distance = this._contentSize.width - this._width;

	if (distance < 0) {
		distance = 0;
	}

	return distance;
};

proto.getScrollDistance = function () {
	return {
		x: this.getScrollXDistance(),
		y: this.getScrollYDistance()
	};
};

proto.inputStart = function (evt) {
	this._tracking = false;
	this._isDecelerating = false;
	this._inertiaPlayer.stop();
	this.trigger('inputStart', evt);
};

proto.inputMove = function (evt) {
	if (!this._tracking) {
		this._tracking = true;
		this.trigger('willBeginTracking');
	}

	if(evt && evt.originalEvent && evt.originalEvent.type === 'mousewheel') {
		evt = Constraints.constrainToScrollBounds(evt, this.getScrollDistance());
	}

	evt = this._handleConstraints(evt);

	this._scroll.setPosition({
		x: evt.x,
		y: evt.y,
		timeStamp: evt.timeStamp,
		originalEvent: evt.originalEvent
	});
};


proto.inputEnd = function (evt) {
	var velocity = evt.velocity;
	var current = this.getPosition();
	var scrollDistance = this.getScrollDistance();
	var overscroll = Constraints.calculateOverscrollAmount(current, scrollDistance);
	var overflowVelocity = this._inertiaCalculator.calculateInitialVelocity(overscroll, {
			x:0,
			y:0
		});

    // filter out the velocity for an axis
    // if we aren't scrolling outside of bounds on that axis
    if (this._contentSize.width === this._width && !this.options.alwaysBounceHorizontal) {
        velocity.x = 0;
    }
    else if (this._contentSize.height === this._height && !this.options.alwaysBounceVertical) {
        velocity.y = 0;
    }

	// if we are out of bounds without velocity
	// give it a push to return
	if (velocity.x === 0 && overscroll.x !== 0) {
		velocity.x = overflowVelocity.x;
	}
	if (velocity.y === 0 && overscroll.y !== 0) {
		velocity.y = overflowVelocity.y;
	}


	if (velocity.x === 0 && velocity.y === 0) {
		this.trigger('didEndTracking', false);
		this.trigger('willEndTracking', {
			velocity: velocity,
			targetPosition: current,
			originalEvent: evt.originalEvent
		});
	}
	else {
		var inertiaFrames = this._inertiaCalculator.calculateInertiaPositions(current, velocity, this.getScrollDistance(), !this.options.bounces);
		var finalPosition = inertiaFrames[inertiaFrames.length - 1];
		this.trigger('willEndTracking', {
			velocity: velocity,
			targetPosition: finalPosition,
			originalEvent: evt.originalEvent
		});

		this.trigger('didEndTracking', true);
		this._isDecelerating = true;
		this.trigger('willBeginDecelerating');
		this._inertiaPlayer.play(inertiaFrames);
	}
};

module.exports = ScrollView;

},{"./Constraints":902,"./DirectionalLock":903,"./InertiaCalculator":904,"./InertiaPlayer":905,"./InputPreventDefault":906,"./Transition":908,"./input/Input":909,"./input/MouseDrag":910,"./input/MouseWheel":911,"./input/Touch":912,"./model/Scroll":913,"./utilities":914,"ac-event-emitter":898}],908:[function(require,module,exports){
var assign = require('./utilities').assign;

var defaults = {
    duration: 350
};

var easeInOutQuad = function (t, b, c, d) {
    t /= d/2;
    if (t < 1) { return c/2*t*t + b; }
    t--;
    return -c/2 * (t*(t-2) - 1) + b;
};

var easeOutQuad = function (t, b, c, d) {
    t /= d;
    return -c * t*(t-2) + b;
};

function Transition(options) {
    assign(this, defaults, options);

    if (!options.draw) {
        throw new Error('no draw function specified');
    }
}

var proto = Transition.prototype;

proto.update = function (time) {
    if (!this.startTime) {
        this.startTime = time;
    }

    var percentage = (time - this.startTime) / this.duration;
    var eased = easeInOutQuad(percentage, 0, 1, 1);

    if (percentage < 1) {
        this.draw(eased);
        this._raf = window.requestAnimationFrame(this.update.bind(this));
    }
    else {
        this.draw(1);
    }
};

proto.play = function () {
    window.requestAnimationFrame(this.update.bind(this));
};

proto.stop = function () {
    window.cancelAnimationFrame(this._raf);
};

module.exports = Transition;

},{"./utilities":914}],909:[function(require,module,exports){
var EventEmitter = require('ac-event-emitter').EventEmitter;
var fastFivePointPrecision = require('../utilities').fastFivePointPrecision;

function Input (scroll) {
	this._startingInputPosition = null;
	this._lastInputPosition = null;
	this._inputPositions = [];
	this._scroll = scroll;
	this._enabled = true;
}

var proto = Input.prototype = new EventEmitter();

proto._addPosition = function (position) {
	this._inputPositions.push(position);
	var now = Date.now();

	// Remove positions over 100ms old, if we have more than 3. 
	// This will prevent our memory usage from spiking if the user drags for a long time.
	// MouseWheeling is also slower than touch input, so we need to make sure we have at least
	// 3 points for getScrollValues to work with.
	if (this._inputPositions.length >= 3 && (now - this._inputPositions[0].timeStamp > 100)) {
		this._inputPositions.shift();
	}
};

proto._pruneOldPositions = function () {
	var now = Date.now();
	this._inputPositions = this._inputPositions.filter(function(position) {
		if (now - position.timeStamp < 100) {
			return position;
		}
	});
};

proto._calculateVelocity = function () {
	var velocity = { x: 0, y: 0 };

	// in case the user stops for long time
	this._pruneOldPositions();

	if (this._inputPositions.length < 2) {
		return velocity;
	}

	var start = this._inputPositions[0];
	var end = this._inputPositions[this._inputPositions.length - 1];

	var elapsedTime = (end.timeStamp - start.timeStamp);

	velocity.x = -(end.x - start.x) / elapsedTime;
	velocity.y = -(end.y - start.y) / elapsedTime;

	velocity.x = fastFivePointPrecision(velocity.x);
	velocity.y = fastFivePointPrecision(velocity.y);

	return velocity;
};

proto.setEnabled = function (enable) {
	this._enabled = enable;
};

proto.isEnabled = function () {
	return this._enabled;
};

proto.inputStart = function (x, y, timeStamp, evt) {
	if (!this._enabled) {
		return;
	}

	var inputPosition = {
		x:x,
		y:y,
		timeStamp:timeStamp
	};
	this._addPosition(inputPosition);
	this._startingInputPosition = inputPosition;

	this.trigger('input_start', {
		timeStamp:timeStamp,
		originalEvent:evt
	});
};


proto.inputMove = function (x, y, timeStamp, evt) {
	if (!this._enabled) {
		return;
	}

	var inputPosition = {
		x:x,
		y:y,
		timeStamp:timeStamp
	};
	this._addPosition(inputPosition);
	this._lastInputPosition = inputPosition;

	var scrollPositions = this.getScrollValues();
	this.trigger('input_move', {
		x:scrollPositions.x,
		y:scrollPositions.y,
		timeStamp:timeStamp,
		originalEvent:evt
	});

};

proto.inputEnd = function (timeStamp, evt) {
	if (!this._enabled) {
		return;
	}

	this.trigger('input_end', {
		lastInputPosition:this._lastInputPosition,
		timeStamp:timeStamp,
		originalEvent:evt,
		velocity:this._calculateVelocity()
	});

	this._positions = [];
	this._lastInputPosition = null;
	this._startingInputPosition = null;
};


proto.getScrollValues = function () {
	var inputPosition = this._inputPositions[this._inputPositions.length - 2];
	var current = this._scroll.getPosition();

	return {
		x: (inputPosition.x - this._lastInputPosition.x) + current.x,
		y: (inputPosition.y - this._lastInputPosition.y) + current.y
	};

};

module.exports = Input;

},{"../utilities":914,"ac-event-emitter":898}],910:[function(require,module,exports){
var DOMEmitter = require('ac-dom-emitter').DOMEmitter;

function MouseDrag (inputController, element) {
    this._input = inputController;
    this._element = element;
    this._domEmitter = new DOMEmitter(element);

    // prevent highlighting if using mouse drag
    element.style.webkitUserSelect = 'none';

    this.bindDOMEvents();
}

MouseDrag.prototype = {
    bindDOMEvents: function () {
        var inputController = this._input;
        var element = this._element;
        var self = this;

        var drag = function(e) {
            inputController.inputMove(e.pageX, e.pageY, e.timeStamp, e);
        };

        var dragEnd = function(e) {
            if (e.type === 'mouseout' && element.contains(e.relatedTarget)) {
                return;
            }

            self._domEmitter.off('mousemove', drag);
            self._domEmitter.off('mouseup', dragEnd);
            self._domEmitter.off('mouseout', dragEnd);

            inputController.inputEnd(e.timeStamp, e);
        };

        self._domEmitter.on('mousedown', function(e) {
            if (e.target.tagName.match(/input|textarea|select/i)) {
                return;
            }
            inputController.inputStart(e.pageX, e.pageY, e.timeStamp, e);

            self._domEmitter.on('mousemove', drag);
            self._domEmitter.on('mouseup', dragEnd);
            self._domEmitter.on('mouseout', dragEnd);
        });

    }

};

module.exports = MouseDrag;

},{"ac-dom-emitter":896}],911:[function(require,module,exports){
var DOMEmitter = require('ac-dom-emitter').DOMEmitter;
var assign = require('../utilities').assign;

function MouseWheel (inputController, element) {
	this._inputController = inputController;
	this._element = element;
	this._domEmitter = new DOMEmitter(element);

	this._scrollTop = 0;
	this._scrollLeft = 0;
	this._timeout = null;
	this._hasStarted = false;

	this._boundMouseWheelComplete = this.mouseWheelComplete.bind(this);
	this._lastEvent = null;

	this._velocities = [];

	this.bindDOMEvents();
}

MouseWheel.prototype = {

	mouseWheelComplete: function () {
		this._scrollTop = 0;
		this._scrollLeft = 0;
		this._hasStarted = false;
		this._inputController.inputEnd(new Date().getTime(), this._lastEvent);
		this._lastEvent = null;
	},

	onMouseWheel: function (e) {
		var nextTop;
		var nextLeft;
		var velocity;

		if (this._hasStarted === false) {
			this._inputController.inputStart(this._scrollLeft, this._scrollTop, e.timeStamp, e);
			this._hasStarted = true;
		}

		nextTop = this._scrollTop + e.wheelDeltaY;
		nextLeft = this._scrollLeft + e.wheelDeltaX;

		this._lastEvent = assign({}, e);

		this._scrollTop = nextTop;
		this._scrollLeft = nextLeft;

		this._inputController.inputMove(this._scrollLeft, this._scrollTop, e.timeStamp, e);


		window.clearTimeout(this._timeout);
		this._timeout = window.setTimeout(this._boundMouseWheelComplete, 100);
	},

	bindDOMEvents: function () {
		this._domEmitter.on('mousewheel', this.onMouseWheel.bind(this)); 
	}

};

module.exports = MouseWheel;

},{"../utilities":914,"ac-dom-emitter":896}],912:[function(require,module,exports){
var DOMEmitter = require('ac-dom-emitter').DOMEmitter;

function TouchInput (inputController, element) {
	this._input = inputController;
	this._element = element;
	this._domEmitter = new DOMEmitter(element);

	this.bindDOMEvents();
}

TouchInput.prototype = {

	bindDOMEvents: function () {
		var inputController = this._input;
		var element = this._element;

		this._domEmitter.on('touchstart', function (e) {
			if (e.touches && e.touches[0] && e.touches[0].target && e.touches[0].target.tagName.match(/input|textarea|select/i)) {
				return;
			}

			inputController.inputStart(e.pageX, e.pageY, e.timeStamp, e);

		});


		this._domEmitter.on('touchmove', function (e) {
			inputController.inputMove(e.pageX, e.pageY, e.timeStamp, e);
		});

		this._domEmitter.on('touchend touchcancel', function (e) {
			inputController.inputEnd(e.timeStamp, e);
		});



	}

};

module.exports = TouchInput;

},{"ac-dom-emitter":896}],913:[function(require,module,exports){
var EventEmitter = require('ac-event-emitter').EventEmitter;

function Scroll () {
	this.x = 0;
	this.y = 0;
}

var proto = Scroll.prototype = new EventEmitter();

proto.setPosition = function (position) {
	if (position.x === this.x && position.y === this.y) {
		return;
	}

	this.x = position.x;
	this.y = position.y;

	this.trigger('scroll', {
		x: this.x,
		y: this.y,
		originalEvent: position.originalEvent
	});
};

proto.getPosition = function () {
	return {
		x: this.x,
		y: this.y
	};
};


module.exports = Scroll;

},{"ac-event-emitter":898}],914:[function(require,module,exports){
// using bitwise NOT is VERY fast: http://jsperf.com/tofixed-vs-bitwise-not
// at the time of implementation this is 78x faster than toFixed on iPhone 
// and 318x faster than toFixed on OSX Safari
var fastPrecision = function(number, decimals) {
	var multiplier = Math.pow(10, decimals);
	return ~~(number * multiplier) / multiplier;
};

// use this throughout ac-scrollview
var fastFivePointPrecision = function(number) { 
	return fastPrecision(number, 5); 
};

// Object.assign polyfill
// No browsers implement this yet, so we should probably
// not set it to window.Object just yet. We can test this implementation
// here until Object.assign is more finalized.
var assign = function(target, source) {

	// test to see if we have an actual object
	var isObject = function (obj) {
		if (typeof obj !== 'object' || obj === null || obj === undefined) {
			throw new TypeError('assign: target and sources must be objects');
		}

		return obj;
	};

	var assignSrcObjectToTarget = function (key) {
		target[key] = srcObject[key];
	};

	target = isObject(target);

	var srcObject;

	// loop through sources
	for (var i = 1, length = arguments.length; i < length; i++) {
		srcObject = isObject(arguments[i]);

		// use Object.keys so we don't have to worry about hasOwnProperty
		Object.keys(srcObject).forEach(assignSrcObjectToTarget);
	}

	return target;
};

module.exports = {
	assign: assign,
	fastFivePointPrecision: fastFivePointPrecision,
	fastPrecision: fastPrecision
};
},{}],915:[function(require,module,exports){
arguments[4][135][0].apply(exports,arguments)
},{"./ac-event-emitter/EventEmitter":916,"dup":135}],916:[function(require,module,exports){
arguments[4][136][0].apply(exports,arguments)
},{"dup":136}],917:[function(require,module,exports){
/** 
 * @module ac-breakpoints-delegate
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

module.exports = {
	BreakpointsDelegate: require('./ac-breakpoints-delegate/BreakpointsDelegate')
};

},{"./ac-breakpoints-delegate/BreakpointsDelegate":918}],918:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

var SharedInstance = require('ac-shared-instance').SharedInstance,
	AC_Object = require('ac-object'),
	WindowDelegate = require('ac-window-delegate').WindowDelegate,
	WindowDelegateCustomEvent = require('ac-window-delegate').WindowDelegateCustomEvent,
	EventEmitter = require('ac-event-emitter').EventEmitter;

var sharedInstanceName = 'ac-breakpoints-delegate:BreakpointsDelegate',
	sharedInstanceVersion = '1.0.1';

var breakpointEventString = 'breakpoint',
	resizeEventsString = 'resize orientationchange';

var defaultBreakpoints = {
	'small' : {
		width : 0,
		maxDeviceWidth : 768
	},
	'medium' : {
		width : 736
	},
	'large' : {
		width : 1025,
		oldIE : true
	},
	'xlarge' : {
		width : 1442
	}
};

/**
 * @name module:ac-this.breakpoints-delegate.BreakpointsDelegate
 * @class
 * 
 * @desc EventEmitter system that handles breakpoint events and current breakpoint information
 * 
 * @param {Object} [options]
 *        Options to initialize the instance with
 */
function BreakpointsDelegate( options ) {
	this.breakpoints = AC_Object.clone( defaultBreakpoints );
	this._customEvent = new WindowDelegateCustomEvent( breakpointEventString, this._onBreakpointListenerAdded.bind( this ), this._onBreakpointListenerRemoved.bind( this ) );

	this.initialize();
}

var proto = BreakpointsDelegate.prototype;

proto.initialize = function() {
	this._breakpoint = null;
	this._lastBreakpoint = null;

	this._handleOldIE();
	this._handleDevices();

	this._breakpointOrder = this._setBreakpointOrder();
	if ( !this._isOldIE ) {
		this._handleResize();
	}
};

proto.getCustomEvent = function() {
	return this._customEvent;
};

proto.getBreakpoint = function() {
	if ( !this._customEvent.active ) {
		this._handleResize();
	}
	return this._breakpoint;
};

proto._handleResize = function() {
	var width = WindowDelegate.innerWidth(),
		newBreakpoint;

	var i,
		key,
		breakpoint,
		len = this._breakpointOrder.length;

	for ( i = 0; i < len; i++ ) {
		key = this._breakpointOrder[ i ];
		breakpoint = this.breakpoints[ key ];
		if ( breakpoint.width > width ) {
			break;
		}
	}
	if ( i > 0 ) {
		i = i - 1;
	}

	newBreakpoint = this.breakpoints[ this._breakpointOrder[ i ] ];

	if ( !this._breakpoint ) {
		this._breakpoint = newBreakpoint;
		return;
	}

	if ( newBreakpoint.name === this._breakpoint.name ) {
		return;
	}

	this._lastBreakpoint = this._breakpoint;
	this._breakpoint = newBreakpoint;

	WindowDelegate.trigger( breakpointEventString, {
		incoming : this._breakpoint,
		outgoing : this._lastBreakpoint
	});

};

proto._setBreakpointOrder = function() {
	var order = [],
		result = [],
		i;

	for ( i in this.breakpoints ) {
		if ( this.breakpoints.hasOwnProperty( i ) ) {
			this.breakpoints[ i ].name = i;
			order.push( this.breakpoints[ i ].width );
		}
	}

	order.sort( function( a, b ) {
		return a - b;
	});

	order.forEach( function( val ) {
		var i;
		for ( i in this.breakpoints ) {
			if ( this.breakpoints.hasOwnProperty( i ) ) {
				if ( this.breakpoints[ i ].width  === val ) {
					result.push( i );
				}
			}
		}
	}.bind( this ));

	return result;
};

proto._handleOldIE = function() {
	var classTarget = document.documentElement,
		oldIE = 'oldie';
	// remove all this.breakpoints other than the oldIE : true ones
	if ( classTarget.className.indexOf( 'no-' + oldIE ) > -1 || classTarget.className.indexOf( oldIE ) === -1 ) {
		return;
	}

	this._breakpoint = this.breakpoints[ 'large' ];
	this._isOldIE = true;

	this._replaceBreakpoints( function( breakpoint ) {
		return breakpoint.oldIE === true;
	});
};

proto._handleDevices = function() {

	this._replaceBreakpoints( function( breakpoint ) {
		if ( typeof breakpoint.maxDeviceWidth !== 'number' ) {
			return true;
		}

		if ( window.screen && window.screen.width <= breakpoint.maxDeviceWidth ) {
			return true;
		}

		return false;
	});
};

proto._replaceBreakpoints = function( condition ) {
	var i,
		newBreakpoints = {},
		breakpoint;
	for ( i in this.breakpoints ) {
		if ( this.breakpoints.hasOwnProperty( i ) ) {
			breakpoint = this.breakpoints[ i ];
			if ( condition( breakpoint )) {
				newBreakpoints[ i ] = AC_Object.clone( this.breakpoints[ i ] );
			}


		}
	}

	this.breakpoints = newBreakpoints;
};

proto._onBreakpointListenerAdded = function() {
	WindowDelegate.on( resizeEventsString, this._handleResize, this );
};

proto._onBreakpointListenerRemoved = function() {
	WindowDelegate.off( resizeEventsString, this._handleResize, this );
};

module.exports = SharedInstance.share( sharedInstanceName, sharedInstanceVersion, BreakpointsDelegate );

},{"ac-event-emitter":915,"ac-object":810,"ac-shared-instance":919,"ac-window-delegate":970}],919:[function(require,module,exports){
arguments[4][137][0].apply(exports,arguments)
},{"./ac-shared-instance/SharedInstance":920,"dup":137}],920:[function(require,module,exports){
arguments[4][138][0].apply(exports,arguments)
},{"dup":138}],921:[function(require,module,exports){
arguments[4][88][0].apply(exports,arguments)
},{"dup":88}],922:[function(require,module,exports){
arguments[4][89][0].apply(exports,arguments)
},{"dup":89}],923:[function(require,module,exports){
arguments[4][90][0].apply(exports,arguments)
},{"dup":90}],924:[function(require,module,exports){
arguments[4][91][0].apply(exports,arguments)
},{"dup":91}],925:[function(require,module,exports){
arguments[4][92][0].apply(exports,arguments)
},{"dup":92}],926:[function(require,module,exports){
arguments[4][93][0].apply(exports,arguments)
},{"dup":93}],927:[function(require,module,exports){
arguments[4][94][0].apply(exports,arguments)
},{"dup":94}],928:[function(require,module,exports){
arguments[4][95][0].apply(exports,arguments)
},{"dup":95}],929:[function(require,module,exports){
arguments[4][96][0].apply(exports,arguments)
},{"./ELEMENT_NODE":926,"./internal/isNodeType":935,"ac-polyfills/Array/prototype.filter":797,"ac-polyfills/Array/prototype.slice":799,"dup":96}],930:[function(require,module,exports){
arguments[4][97][0].apply(exports,arguments)
},{"./COMMENT_NODE":922,"./DOCUMENT_FRAGMENT_NODE":923,"./DOCUMENT_NODE":924,"./DOCUMENT_TYPE_NODE":925,"./ELEMENT_NODE":926,"./TEXT_NODE":927,"./createDocumentFragment":928,"./filterByNodeType":929,"./insertAfter":931,"./insertBefore":932,"./insertFirstChild":933,"./insertLastChild":934,"./isComment":937,"./isDocument":938,"./isDocumentFragment":939,"./isDocumentType":940,"./isElement":941,"./isNode":942,"./isNodeList":943,"./isTextNode":944,"./remove":945,"./replace":946,"dup":97}],931:[function(require,module,exports){
arguments[4][98][0].apply(exports,arguments)
},{"./internal/validate":936,"dup":98}],932:[function(require,module,exports){
arguments[4][99][0].apply(exports,arguments)
},{"./internal/validate":936,"dup":99}],933:[function(require,module,exports){
arguments[4][100][0].apply(exports,arguments)
},{"./internal/validate":936,"dup":100}],934:[function(require,module,exports){
arguments[4][101][0].apply(exports,arguments)
},{"./internal/validate":936,"dup":101}],935:[function(require,module,exports){
arguments[4][102][0].apply(exports,arguments)
},{"../isNode":942,"dup":102}],936:[function(require,module,exports){
arguments[4][103][0].apply(exports,arguments)
},{"../COMMENT_NODE":922,"../DOCUMENT_FRAGMENT_NODE":923,"../ELEMENT_NODE":926,"../TEXT_NODE":927,"./isNodeType":935,"dup":103}],937:[function(require,module,exports){
arguments[4][104][0].apply(exports,arguments)
},{"./COMMENT_NODE":922,"./internal/isNodeType":935,"dup":104}],938:[function(require,module,exports){
arguments[4][105][0].apply(exports,arguments)
},{"./DOCUMENT_NODE":924,"./internal/isNodeType":935,"dup":105}],939:[function(require,module,exports){
arguments[4][106][0].apply(exports,arguments)
},{"./DOCUMENT_FRAGMENT_NODE":923,"./internal/isNodeType":935,"dup":106}],940:[function(require,module,exports){
arguments[4][107][0].apply(exports,arguments)
},{"./DOCUMENT_TYPE_NODE":925,"./internal/isNodeType":935,"dup":107}],941:[function(require,module,exports){
arguments[4][108][0].apply(exports,arguments)
},{"./ELEMENT_NODE":926,"./internal/isNodeType":935,"dup":108}],942:[function(require,module,exports){
arguments[4][109][0].apply(exports,arguments)
},{"dup":109}],943:[function(require,module,exports){
arguments[4][110][0].apply(exports,arguments)
},{"dup":110}],944:[function(require,module,exports){
arguments[4][111][0].apply(exports,arguments)
},{"./TEXT_NODE":927,"./internal/isNodeType":935,"dup":111}],945:[function(require,module,exports){
arguments[4][112][0].apply(exports,arguments)
},{"./internal/validate":936,"dup":112}],946:[function(require,module,exports){
arguments[4][113][0].apply(exports,arguments)
},{"./internal/validate":936,"dup":113}],947:[function(require,module,exports){
arguments[4][114][0].apply(exports,arguments)
},{"./ac-dom-traversal/ancestor":948,"./ac-dom-traversal/ancestors":949,"./ac-dom-traversal/children":950,"./ac-dom-traversal/filterBySelector":951,"./ac-dom-traversal/firstChild":952,"./ac-dom-traversal/lastChild":955,"./ac-dom-traversal/matchesSelector":956,"./ac-dom-traversal/nextSibling":957,"./ac-dom-traversal/nextSiblings":958,"./ac-dom-traversal/previousSibling":959,"./ac-dom-traversal/previousSiblings":960,"./ac-dom-traversal/querySelector":961,"./ac-dom-traversal/querySelectorAll":962,"./ac-dom-traversal/shims/ie":963,"./ac-dom-traversal/siblings":964,"dup":114}],948:[function(require,module,exports){
arguments[4][115][0].apply(exports,arguments)
},{"./helpers/validate":954,"./matchesSelector":956,"ac-dom-nodes":930,"dup":115}],949:[function(require,module,exports){
arguments[4][116][0].apply(exports,arguments)
},{"./helpers/validate":954,"./matchesSelector":956,"ac-dom-nodes":930,"dup":116}],950:[function(require,module,exports){
arguments[4][117][0].apply(exports,arguments)
},{"./filterBySelector":951,"./helpers/validate":954,"ac-dom-nodes":930,"dup":117}],951:[function(require,module,exports){
arguments[4][118][0].apply(exports,arguments)
},{"./helpers/validate":954,"./matchesSelector":956,"dup":118}],952:[function(require,module,exports){
arguments[4][119][0].apply(exports,arguments)
},{"./children":950,"./helpers/validate":954,"dup":119}],953:[function(require,module,exports){
arguments[4][120][0].apply(exports,arguments)
},{"dup":120}],954:[function(require,module,exports){
arguments[4][121][0].apply(exports,arguments)
},{"ac-dom-nodes":930,"dup":121}],955:[function(require,module,exports){
arguments[4][122][0].apply(exports,arguments)
},{"./children":950,"./helpers/validate":954,"dup":122}],956:[function(require,module,exports){
arguments[4][123][0].apply(exports,arguments)
},{"./helpers/nativeMatches":953,"./helpers/validate":954,"ac-dom-nodes":930,"dup":123}],957:[function(require,module,exports){
arguments[4][124][0].apply(exports,arguments)
},{"./helpers/validate":954,"./matchesSelector":956,"ac-dom-nodes":930,"dup":124}],958:[function(require,module,exports){
arguments[4][125][0].apply(exports,arguments)
},{"./helpers/validate":954,"./matchesSelector":956,"ac-dom-nodes":930,"dup":125}],959:[function(require,module,exports){
arguments[4][126][0].apply(exports,arguments)
},{"./helpers/validate":954,"./matchesSelector":956,"ac-dom-nodes":930,"dup":126}],960:[function(require,module,exports){
arguments[4][127][0].apply(exports,arguments)
},{"./helpers/validate":954,"./matchesSelector":956,"ac-dom-nodes":930,"dup":127}],961:[function(require,module,exports){
arguments[4][128][0].apply(exports,arguments)
},{"./helpers/validate":954,"dup":128}],962:[function(require,module,exports){
arguments[4][129][0].apply(exports,arguments)
},{"./helpers/validate":954,"dup":129}],963:[function(require,module,exports){
arguments[4][130][0].apply(exports,arguments)
},{"../helpers/nativeMatches":953,"../helpers/validate":954,"../vendor/sizzle/sizzle":965,"ac-dom-nodes":930,"dup":130}],964:[function(require,module,exports){
arguments[4][131][0].apply(exports,arguments)
},{"./children":950,"./helpers/validate":954,"dup":131}],965:[function(require,module,exports){
arguments[4][132][0].apply(exports,arguments)
},{"dup":132}],966:[function(require,module,exports){
arguments[4][133][0].apply(exports,arguments)
},{"./ac-dom-emitter/DOMEmitter":967,"dup":133}],967:[function(require,module,exports){
arguments[4][134][0].apply(exports,arguments)
},{"ac-dom-events":921,"ac-dom-traversal":947,"ac-event-emitter":968,"dup":134}],968:[function(require,module,exports){
arguments[4][135][0].apply(exports,arguments)
},{"./ac-event-emitter/EventEmitter":969,"dup":135}],969:[function(require,module,exports){
arguments[4][136][0].apply(exports,arguments)
},{"dup":136}],970:[function(require,module,exports){
arguments[4][139][0].apply(exports,arguments)
},{"./ac-window-delegate/WindowDelegate":973,"./ac-window-delegate/WindowDelegateCustomEvent":974,"./ac-window-delegate/WindowDelegateOptimizer":975,"dup":139}],971:[function(require,module,exports){
arguments[4][140][0].apply(exports,arguments)
},{"ac-event-emitter":968,"dup":140}],972:[function(require,module,exports){
arguments[4][141][0].apply(exports,arguments)
},{"ac-event-emitter":968,"dup":141}],973:[function(require,module,exports){
arguments[4][142][0].apply(exports,arguments)
},{"./CustomEventController":971,"./OptimizerController":972,"./optimizers/optimizers":978,"./queries/queries":987,"ac-dom-emitter":966,"ac-shared-instance":919,"dup":142}],974:[function(require,module,exports){
arguments[4][143][0].apply(exports,arguments)
},{"ac-event-emitter":968,"dup":143}],975:[function(require,module,exports){
arguments[4][144][0].apply(exports,arguments)
},{"ac-event-emitter":968,"dup":144}],976:[function(require,module,exports){
arguments[4][145][0].apply(exports,arguments)
},{"../../WindowDelegateOptimizer":975,"../../queries/queries":987,"dup":145}],977:[function(require,module,exports){
arguments[4][146][0].apply(exports,arguments)
},{"../../WindowDelegateOptimizer":975,"../../queries/queries":987,"dup":146}],978:[function(require,module,exports){
arguments[4][147][0].apply(exports,arguments)
},{"./events/resize":976,"./events/scroll":977,"dup":147}],979:[function(require,module,exports){
arguments[4][148][0].apply(exports,arguments)
},{"dup":148}],980:[function(require,module,exports){
arguments[4][149][0].apply(exports,arguments)
},{"dup":149}],981:[function(require,module,exports){
arguments[4][150][0].apply(exports,arguments)
},{"dup":150}],982:[function(require,module,exports){
arguments[4][151][0].apply(exports,arguments)
},{"dup":151}],983:[function(require,module,exports){
arguments[4][152][0].apply(exports,arguments)
},{"dup":152}],984:[function(require,module,exports){
arguments[4][153][0].apply(exports,arguments)
},{"dup":153}],985:[function(require,module,exports){
arguments[4][154][0].apply(exports,arguments)
},{"dup":154}],986:[function(require,module,exports){
arguments[4][155][0].apply(exports,arguments)
},{"dup":155}],987:[function(require,module,exports){
arguments[4][156][0].apply(exports,arguments)
},{"./methods/clientHeight":979,"./methods/clientWidth":980,"./methods/innerHeight":981,"./methods/innerWidth":982,"./methods/maxScrollX":983,"./methods/maxScrollY":984,"./methods/scrollX":985,"./methods/scrollY":986,"dup":156}],988:[function(require,module,exports){
/** 
 * @module ac-viewport
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

module.exports = {
	Viewport: require('./ac-viewport/Viewport')
};

},{"./ac-viewport/Viewport":989}],989:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

var SharedInstance = require('ac-shared-instance').SharedInstance,
	WindowDelegate = require('ac-window-delegate').WindowDelegate,
	BreakpointsDelegate = require('ac-breakpoints-delegate').BreakpointsDelegate;

var sharedInstanceName = 'ac-viewport:Viewport',
	sharedInstanceVersion = '1.0.0';

var proto;

/**
 * @name module:ac-viewport.Viewport
 * @class
 * 
 * @desc Composite object of WindowDelegate and BreakpointsDelegate for viewport-level data and events
 * 
 * @param {Object} [options]
 *        Options to initialize the instance with
 */
function Viewport(options) {
	// The majority of functionality is delegated to WindowDelegate, so we extend from that to start
	var prop,
		baseObj = WindowDelegate;
	for ( prop in baseObj ) {
		// Extend instance properties
		if ( baseObj.hasOwnProperty( prop ) )  {
			this[ prop ] = baseObj[ prop ];
		} else {
			// Extend prototypes
			proto[ prop ] = baseObj[ prop ];
		}
	}

	// Extend support for 'breakpoint' events
	this.addCustomEvent( BreakpointsDelegate.getCustomEvent() );
}

proto = Viewport.prototype;

proto.getBreakpoint = function() {
	return BreakpointsDelegate.getBreakpoint();
};

module.exports = SharedInstance.share( sharedInstanceName, sharedInstanceVersion, Viewport );
},{"ac-breakpoints-delegate":917,"ac-shared-instance":919,"ac-window-delegate":970}],990:[function(require,module,exports){
/**
 * @module ac-renderplayer
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

module.exports.createAmbient       = require('./factories/createAmbient');
module.exports.createBasicPlayer   = require('./factories/createBasicPlayer');
module.exports.createClickToPlay   = require('./factories/createClickToPlay');
module.exports.createGrabber       = require('./factories/createGrabber');
module.exports.createScrubOnScroll = require('./factories/createScrubOnScroll');

},{"./factories/createAmbient":1009,"./factories/createBasicPlayer":1010,"./factories/createClickToPlay":1011,"./factories/createGrabber":1012,"./factories/createScrubOnScroll":1013}],991:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

var ac_Object = require('ac-object');
var destroy   = require('../utils/destroy');

var proto;
var defaults = {
};

/**
 * @class
 * @name ac-renderplayer.Controller
 *
 * @desc TODO
 *
 * @param {Object} [options]
 *        Options to initialize the instance with
 */
function Controller(mediaObject, viewElement, options) {
	this.options = ac_Object.defaults(defaults, options || {});

	this.mediaObject = mediaObject;

	if (viewElement && this.View) {
		this.view = new this.View(viewElement, this.options);
	}

	this._setupMediaObjectListeners();
}

proto = Controller.prototype = {};

proto.View = require('./Controller/View');

proto.destroy = function () {
	this._unbindMediaObjectListeners();
	destroy(this, false);
};

/**
 * Sub-classes should overwrite this and only use what they need
 *
 * Call super only for debugging
 *
 */
proto._setupMediaObjectListeners = function () {
	this._getMediaObjectListeners().forEach(function (obj) {
		this.mediaObject[obj.method](obj.event, obj.callback, this);
	}, this);
};

proto._getMediaObjectListeners = function () {
	return [
		{ method: 'on',   event: 'play',       callback: this._onPlay       },
		{ method: 'on',   event: 'ended',      callback: this._onEnded      },
		{ method: 'on',   event: 'pause',      callback: this._onPause      },
		{ method: 'on',   event: 'stop',       callback: this._onStop       },
		{ method: 'on',   event: 'timeupdate', callback: this._onTimeupdate },
		{ method: 'once', event: 'loadstart',  callback: this._onLoadstart  },
		{ method: 'once', event: 'loaded',     callback: this._onLoad       },
		{ method: 'once', event: 'ready',      callback: this._onRead       },
		{ method: 'once', event: 'degrade',    callback: this.destroy       }
	];
};

proto._onPlay = function () {
	// Stubbed for inheritance
	// console.log('Controller#_onPlay');
};

proto._onEnded = function () {
	// Stubbed for inheritance
	//console.log('Controller#_onEnded');
};

proto._onPause = function () {
	// Stubbed for inheritance
	//console.log('Controller#_onPause');
};

proto._onStop = function () {
	// Stubbed for inheritance
	//console.log('Controller#_onStop');
};

proto._onTimeupdate = function () {
	// Stubbed for inheritance
	// console.log('Controller#_onTimeupdate');
};

proto._onLoadstart = function () {
	// Stubbed for inheritance
	// console.log('Controller#_onLoadstart');
};

proto._onLoad = function () {
	// Stubbed for inheritance
	// console.log('Controller#_onLoad');
};

proto._onReady = function () {
	// Stubbed for inheritance
	// console.log('Controller#_onReady');
};

proto._unbindMediaObjectListeners = function () {
	this._mediaObjectListeners.forEach(function (obj) {
		if (this.mediaObject && typeof this.mediaObject.off === 'function') {
			this.mediaObject.off(obj.event, obj.callback);
		}
	}, this);
};

module.exports = Controller;

},{"../utils/destroy":1014,"./Controller/View":996,"ac-object":810}],992:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

var ac_Object = require('ac-object');
var Super     = require('../Controller');

var proto;
var defaults = {
	behavior: 'play',
	stopableWhilePlaying: true,
	disableWhilePlaying: false
};

/**
 * @class
 * @name ac-renderplayer.Controller
 *
 * @desc TODO
 *
 * @param {Object} [options]
 *        Options to initialize the instance with
 */
function ClickToPlay(mediaObject, viewElement, options) {
	Super.call(this, mediaObject, viewElement, ac_Object.defaults(defaults, options || {}));

	this.view.on('click', this._onTriggerClicked, this);

	if (this.options.behavior === 'stop' || this.options.behavior === 'pause') {
		this.view.disable();
	}
}

proto = ClickToPlay.prototype = ac_Object.create(Super.prototype);

proto.View = require('./View/Trigger');

proto._onTriggerClicked = function (evt) {
	if (this.options.behavior === 'play') {
		// Are we playing? And if so, a click means stop!
		// Assume active is always and only true while mediaObject is playing
		if (this.view.active && this.options.stopableWhilePlaying) {
			this.mediaObject.stop();

		// If not playing, play
		// click event not fired if disabled
		} else {
			// If at the end, reset to beginning
			// video does this automatically, flow does not
			if (this.mediaObject.currentTime() === this.mediaObject.duration) {
				this.mediaObject.reset();
			}
			this.mediaObject.play();
		}
	} else if (this.options.behavior === 'stop') {
		this.mediaObject.stop();
	} else if (this.options.behavior === 'pause') {
		this.mediaObject.pause();
	}
};

proto._reset = function () {
	this.view.deactivate();
	this.view.enable();
};

proto._setupMediaObjectListeners = function () {
	this.mediaObject.on('play', this._onPlay, this);
	this.mediaObject.on('pause', this._onPause, this);
	this.mediaObject.on('ended', this._onEnded, this);
	this.mediaObject.on('stop', this._onStop, this);
	this.mediaObject.once('degrade', this.destroy, this);
};

proto._unbindMediaObjectListeners = function () {
	this.mediaObject.off('play', this._onPlay);
	this.mediaObject.off('pause', this._onPause);
	this.mediaObject.off('ended', this._onEnded);
	this.mediaObject.off('stop', this._onStop);
	this.view.off('click', this._onTriggerClicked);
};

proto._onPlay = function () {
	if (this.options.behavior === 'play') {
		this.view.activate();
	} else if (this.options.behavior === 'pause') {
		this.view.deactivate();
	}

	if (this.options.disableWhilePlaying) {
		this.view.disable();
	} else if (this.options.behavior === 'stop' || this.options.behavior === 'pause') {
		this.view.enable();
	}
};

proto._onPause = function () {
	if (this.options.behavior === 'play') {
		this.view.removeReplayState();
		this.view.deactivate();
		this.view.enable();
	} else if (this.options.behavior === 'pause') {
		this.view.activate();
	}
};

proto._onStop = function () {
	this._onEnded();
};

proto._onEnded = function () {
	if (this.options.behavior === 'play') {
		this.view.addReplayState();
		this.view.enable();
	} else if (this.options.behavior === 'stop' || this.options.behavior === 'pause') {
		this.view.disable();
	} else {
		this.view.enable();
	}
	this.view.deactivate();
};

module.exports = ClickToPlay;


},{"../Controller":991,"./View/Trigger":998,"ac-object":810}],993:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

var ac_Object  = require('ac-object');
var ac_Element = require('ac-base').Element;
var ScrollView = require('ac-scrollview').ScrollView;
var Super      = require('../Controller');
var clock      = require('ac-clock');

var proto;
var defaults = {
	continuous: true,
	speed: 0.25,
	direction: 1,
	mouseWheel: false,
	mouseDrag: true,
	friction: 0.88,
	bounces: false,
	clock: clock
};

/**
 * @class
 * @name ac-renderplayer.Controller
 *
 * @desc TODO
 *
 * @param {Object} [options]
 *        Options to initialize the instance with
 */
function Grabber(mediaObject, viewElement, options) {
	Super.call(this, mediaObject, viewElement, ac_Object.defaults(defaults, options || {}));

	this._value = null;

	this._setupScrollView();
	this._trackScrollView();
	this._setupClock();
}

proto = Grabber.prototype = ac_Object.create(Super.prototype);

proto.View = require('./View/Grabbable');

proto._setupMediaObjectListeners = function () {
	// Stubbed for performance
};

proto._setupScrollView = function () {
	var dim = ac_Element.getBoundingBox(this.view.element);

	this._totalDistance = dim.width * (1 / this.options.speed);

	this._scrollview = new ScrollView(this.view.element, {
		contentSize: {
			width: this._totalDistance * 2,
			height: dim.height
		},
		friction: { x: this.options.friction, y: 0.95 },
		width: this._totalDistance,
		height: this._totalDistance,
		mouseWheel: this.options.mouseWheel,
		mouseDrag: this.options.mouseDrag,
		preventDefault: true,
		bounces: !this.options.continuous && this.options.bounces
	});

	// Animation is repeated twice per totalDistance, so we can start
	// either scrubbing forwards or backwards and complete a whole
	// rotation of a 360.
	// TODO what to do when not continuous?
	this._scrollview.setPosition({ x: this._totalDistance, y: 0 });
};

proto._trackScrollView = function () {
	// Updating grabbing cursor for desktop
	this._scrollview.on('willBeginTracking', function (evt) {
		this.view.setGrabbing(true);
	}, this);
	this._scrollview.on('didEndTracking', function (evt) {
		this.view.setGrabbing(false);
	}, this);
	this._scrollview.on('scroll', this._onScroll, this);
};

proto._setupClock = function () {
	if (!this.options.clock.isRunning()) {
		this.options.clock.start();
	}
	this.options.clock.on('draw', this._draw, this);
};

proto._onScroll = function (evt) {
	if (evt.x >= this._totalDistance || evt.x <= 0) {
		if (this.options.continuous) {
			this._scrollview.setPosition({ x: (this._totalDistance / 2), y: 0 });
		} else {
			// TODO not continuous
		}
	}

	this._value = (evt.x % (this._totalDistance / 2)) / (this._totalDistance / 2);

	// Invert if we’re going the other direction
	this._value = (this.options.direction < 0) ? 1 - this._value : this._value;
};

proto._draw = function (evt) {
	if (this._value !== null) {
		this.mediaObject.goToDurationPercent(this._value);
	}

	this._value = null;
};

module.exports = Grabber;


},{"../Controller":991,"./View/Grabbable":997,"ac-base":2,"ac-clock":802,"ac-object":810,"ac-scrollview":900}],994:[function(require,module,exports){
/*global module,DEBUG */
'use strict';

var ac_Element              = require('ac-base').Element;
var ac_Object               = require('ac-object');
var ElementScrollTimeUpdate = require('ac-scroll-time-update').ElementScrollTimeUpdate;
var Super                   = require('../Controller');
var ac_Viewport             = require('ac-viewport').Viewport;

var proto;
var unbind = false;
var defaults = {
	reversed: false,
	smooth: true,
	startInView: false,
	offsetTop: false,
	offsetBottom: false
};

function ScrubOnScroll(mediaObject, options) {
	this.tracker = null;

	// No view for ScrubOnScroll, because it uses the mediaObject
	Super.call(this, mediaObject, null, ac_Object.defaults(defaults, options || {}));
}

proto = ScrubOnScroll.prototype = ac_Object.create(Super.prototype);

proto.View = null;

proto.start = function () {
	this.tracker.on('draw', this._draw, this);
	this.tracker.start();
};

proto.stop = function () {
	this.tracker.off('draw', this._draw);
	this.tracker.stop();
};

proto.setSmoothing = function (bool) {
	this.options.smooth = !!bool;

	if (this.tracker) {
		this.tracker.setSmoothing(this.options.smooth);
	}
};

proto.setOffsets = function (top, bottom) {
	if (this.tracker) {
		top = this._parseOffset(top);
		bottom = this._parseOffset(bottom);

		if (top) {
			this.tracker.options.offsetTop = top;
		}

		if (bottom) {
			this.tracker.options.offsetBottom = bottom;
		}

		this.tracker.setOffsets();
		this.tracker.setCurrentTime(null, true);
	}
};

proto._parseOffset = function (offset) {
	var containerHeight;
	var updateContainerHeight;

	if (typeof offset === 'number' || typeof offset === 'function') {
		return offset;

	} else if (typeof offset === 'string') {
		if (/\%$/.test(offset)) {
			// Convert offset to a perc in syntax: 0-1
			offset = (parseFloat(offset, 10) / 100);

			// Update variable trapped in closure so that offset function can access new value
			// But if we are degraded, then unbind the viewport listeners
			updateContainerHeight = function () {
				if (unbind) {
					ac_Viewport.off('resize orientationchange', updateContainerHeight);
				}
				containerHeight = ac_Element.getBoundingBox(this).height;
				return containerHeight;
			}.bind(this.mediaObject.view.container);

			// Update container height value any time we resize or change orientation
			// as that could force us to a new breakpoint
			ac_Viewport.on('resize orientationchange', updateContainerHeight);
			updateContainerHeight();

			// Function calculates the percentate offset times current container height
			return function () {
				return offset * containerHeight;
			};
		} else if (/vh$/.test(offset)) {
			// Convert offset to a perc in syntax: 0-1
			offset = (parseFloat(offset, 10) / 100);

			// Function calculates the percentate offset times current container height
			return function () {
				return offset * ac_Viewport.innerHeight();
			};
		}
	}

	return false;
};

proto._setupMediaObjectListeners = function () {
	if (this.mediaObject.ready) {
		this._onReady();
	} else {
		this.mediaObject.once('ready', this._onReady, this);
	}
};

proto._unbindMediaObjectListeners = function () {
	this.mediaObject.off('ready', this._onReady);
	// update the outside closure variable
	unbind = true;
};

proto._onReady = function () {
	var options = ac_Object.clone(this.options);

	// ElementScrollTimeUpdate has this logic reversed...
	options.startInView = !options.startInView;

	options.offsetTop = this._parseOffset(options.offsetTop);
	options.offsetBottom = this._parseOffset(options.offsetBottom);

	this.tracker = new ElementScrollTimeUpdate(this.mediaObject.container, options);

	this.start();
};

proto._draw = function (evt) {
	/**
	 * @TODO Remove reference to nested media currentTime property
	 * [Implement `goToDurationPercent`](https://interactive-git.apple.com/Interactive-Interfaces/ac-media-object/issues/58)
	 */
	if (this.options.reversed) {
		this.mediaObject.goToDurationPercent(1 - evt.time);
	} else {
		this.mediaObject.goToDurationPercent(evt.time);
	}
};

module.exports = ScrubOnScroll;

},{"../Controller":991,"ac-base":2,"ac-object":810,"ac-scroll-time-update":893,"ac-viewport":988}],995:[function(require,module,exports){
/*global module,DEBUG */
'use strict';

var ac_Object         = require('ac-object');
var ElementEngagement = require('ac-element-engagement');
var Super             = require('../Controller');

var proto;
var defaults = {
	loopInterval: false,
	reversed: false,
	timeToEngage: 500
};

function UserEnganged(mediaObject, options) {
	// No view for ScrubOnScroll, because it uses the mediaObject
	Super.call(this, mediaObject, null, ac_Object.defaults(defaults, options || {}));
}

proto = UserEnganged.prototype = {};

proto.destroy = function () {
	ElementEngagement.stop(this.tracker);
	if (this.tracker && typeof this.tracker.off === 'function') {
		this.tracker.off();
	}
	Super.prototype.destroy.call(this);
};

proto._setupMediaObjectListeners = function () {
	this.mediaObject.once('degrade', this.destroy, this);
	if (this.mediaObject.ready) {
		this._onReady();
	} else {
		this.mediaObject.once('ready', this._onReady, this);
	}
};

proto._onReady = function () {
	this.tracker = ElementEngagement.addElement(this.mediaObject.container);

	if (!ElementEngagement.tracking) {
		ElementEngagement.start();
	}

	this.tracker.on('engaged', this._onEngaged, this);
};

proto._onEngaged = function () {
	if (typeof this.options.loopInterval === 'number') {
		this._startLoop();
	} else {
		this.tracker.off('engaged', this._onEngaged, this);
	}

	if (this.options.reversed) {
		this.mediaObject.setTime(this.mediaObject.duration);
		this.mediaObject.setPlaybackRate(-1);
	}

	this.mediaObject.play();
	this.tracker.once('exitview', this._onExitView, this);
};

proto._onExitView = function () {
	this.mediaObject.stop();
};

proto._startLoop = function () {
	this.mediaObject.once('stop pause', this._cancelLoop, this);
	this.mediaObject.on('ended', this._startLoopInterval, this);
};

proto._cancelLoop = function () {
	if (this._loopIntervalTimeout) {
		window.clearTimeout(this._loopIntervalTimeout);
	}

	this.mediaObject.off('ended', this._startLoopInterval, this);
};

proto._startLoopInterval = function () {
	if (this.options.loopInterval > 0) {
		this._loopIntervalTimeout = window.setTimeout(function () {
			this.mediaObject.reset();
			this.mediaObject.play();
			this._loopIntervalTimeout = null;
		}.bind(this), this.options.loopInterval);
	} else {
		this.mediaObject.reset();
		this.mediaObject.play();
	}
};

proto._unbindMediaObjectListeners = function () {
	if (this.mediaObject && typeof this.mediaObject.off === 'function') {
		this.mediaObject.off('exitview', this._onExitView);
		this.mediaObject.off('ended', this._startLoopInterval);
		this.mediaObject.off('stop pause', this._cancelLoop);
		this.mediaObject.off('ready', this._onReady);
	}
};

module.exports = UserEnganged;

},{"../Controller":991,"ac-element-engagement":385,"ac-object":810}],996:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

var ac_Element   = require('ac-base').Element;
var ac_Object    = require('ac-object');
var destroy      = require('../../utils/destroy');
var EventEmitter = require('ac-event-emitter').EventEmitter;

var proto;
var defaults = {
	stateNameActive:   'renderplayer-active',
	stateNameDisabled: 'renderplayer-disabled',
	stateNameReplay:   'renderplayer-replay'
};

/**
 * @class
 * @name ac-renderplayer.View
 *
 * @desc TODO
 *
 * @param {Object} [options]
 *        Options to initialize the instance with
 */
function View(element, options) {
	this.options = ac_Object.defaults(defaults, options || {});

	this.element = ac_Element.getElementById(element);

	if (this.element === null) {
		throw 'RenderPlayer.Controller.View: Incorrect view element reference.';
	}
}

proto = View.prototype = new EventEmitter();


proto.addReplayState = function () {
	ac_Element.addClassName(this.element, this.options.stateNameReplay);
};


proto.removeReplayState = function () {
	ac_Element.removeClassName(this.element, this.options.stateNameReplay);
};


proto.activate = function () {
	this.active = true;
	ac_Element.addClassName(this.element, this.options.stateNameActive);
};


proto.deactivate = function () {
	this.active = false;
	ac_Element.removeClassName(this.element, this.options.stateNameActive);
};


proto.disable = function () {
	this.disabled = true;
	ac_Element.addClassName(this.element, this.options.stateNameDisabled);
};


proto.enable = function () {
	this.disabled = false;
	ac_Element.removeClassName(this.element, this.options.stateNameDisabled);
};


proto.destroy = function () {
	destroy(this);
};


module.exports = View;

},{"../../utils/destroy":1014,"ac-base":2,"ac-event-emitter":387,"ac-object":810}],997:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

var ac_Element = require('ac-base').Element;
var ac_Object  = require('ac-object');
var Super      = require('../View');

var defaults = {
};

/**
 * @class
 * @name ac-renderplayer.Grabber
 *
 * @desc TODO
 *
 * @param {Object} [options]
 *        Options to initialize the instance with
 */
function Grabber(element, options) {
	Super.call(this, element, ac_Object.defaults(defaults, options || {}));

	ac_Element.addClassName(this.element, 'renderplayer-grabbable');
}

var proto = Grabber.prototype = ac_Object.create(Super.prototype);

proto.setGrabbing = function (bool) {
	if (bool) {
		ac_Element.addClassName(document.body, 'renderplayer-grabbing');
	} else {
		ac_Element.removeClassName(document.body, 'renderplayer-grabbing');
	}
};

module.exports = Grabber;

},{"../View":996,"ac-base":2,"ac-object":810}],998:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

var ac_Element  = require('ac-base').Element;
var ac_Function = require('ac-base').Function;
var ac_Event    = require('ac-base').Event;
var ac_Object   = require('ac-object');

var Super = require('../View');

var defaults = {
};

/**
 * @class
 * @name ac-renderplayer.Trigger
 *
 * @desc TODO
 *
 * @param {Object} [options]
 *        Options to initialize the instance with
 */
function Trigger(element, options) {
	Super.call(this, element, ac_Object.defaults(defaults, options || {}));

	// Set up a click handler on the element
	this._boundOnClick = ac_Function.bindAsEventListener(this._onClick, this);
	ac_Element.addEventListener(this.element, 'click', this._boundOnClick);
}

var proto = Trigger.prototype = ac_Object.create(Super.prototype);

proto._onClick = function (evt) {
	// preventDefault and stopPropagation
	ac_Event.stop(evt);

	if (!this._disabled) {
		// Trigger event for Controller to respond to the click
		this.trigger('click', evt);
	}
};

module.exports = Trigger;

},{"../View":996,"ac-base":2,"ac-object":810}],999:[function(require,module,exports){
'use strict';

var destroy = require('../utils/destroy');

var proto;

function Enhancer(mediaObject, enhanceFunc, enhancerOptions) {
	this.mediaObject = mediaObject;
	this.enhanceFunc = enhanceFunc;
	this.options = enhancerOptions || {};
	this.didEnhance = false;

	// Skip this behavior if enhancement happens manually
	this.mediaObject.once('enhance', this._onEnhance, this);

	// self destruct if mediaObject is degraded before enhancing
	this.mediaObject.once('degrade', this.destroy, this);

	this._loadedCheck();
}

proto = Enhancer.prototype = {};

proto._enhance = function () {
	// only try to enhance once
	if (this.didEnhance || (this.options && this.options.autoEnhance === false)) {
		return;
	}
	// If it wasn’t already enhanced outside of enhancer
	if (this.mediaObject && this.mediaObject.view && !this.mediaObject.view.enhanced) {
		this.mediaObject.enhance();
		this.didEnhance = true;
	}
};

proto.destroy = function () {
	// make sure to remove all event listeners.
	if (this.mediaObject && typeof this.mediaObject.off === 'function') {
		this.mediaObject.off('enhance', this._onEnhance);
		this.mediaObject.off('ready', this._onReady);
		this.mediaObject.off('destroy', this.destroy);
	}
	destroy(this, false);
};

proto._loadedCheck = function () {
	if (this.mediaObject.ready) {
		this._onReady();
	} else {
		this.mediaObject.load();
		this.mediaObject.once('ready', this._onReady, this);
	}
};

proto._onEnhance = function () {
	// If it was enhanced outside of enhancer, don’t listen to ready
	this.mediaObject.off('ready', this._onReady, this);

	this.enhanceFunc();

	this.destroy();
};

proto._onReady = function () {
	this._enhance();
};

module.exports = Enhancer;

},{"../utils/destroy":1014}],1000:[function(require,module,exports){
'use strict';

var ac_Object         = require('ac-object');
var destroy           = require('../../utils/destroy');
var ElementEngagement = require('ac-element-engagement');
var Super             = require('../Enhancer');

var proto;

function OutOfViewEnhancer(mediaObject, enhanceFunc, enhancerOptions) {
	Super.apply(this, arguments);
}

proto = OutOfViewEnhancer.prototype = ac_Object.create(Super.prototype);

proto._inViewCheck = function () {
	if (!this.didEnhance && this.mediaObject && this.mediaObject.view && !this.mediaObject.view.enhanced) {
		this.tracker = ElementEngagement.addElement(this.mediaObject.container);

		if (!ElementEngagement.tracking) {
			ElementEngagement.start();
		}

		ElementEngagement.refreshElementState(this.tracker);

		if (!this.tracker.inView) {
			this._enhance();
		} else {
			this.tracker.once('exitview', this._enhance, this);
		}
	}
};

proto.destroy = function () {
	if (this.tracker && typeof this.tracker.off === 'function') {
		ElementEngagement.stop(this.tracker);
		this.tracker.off('exitview', this._enhance);
	}
	Super.prototype.destroy.call(this);
};

proto._onReady = function () {
	this._inViewCheck();
};

module.exports = OutOfViewEnhancer;

},{"../../utils/destroy":1014,"../Enhancer":999,"ac-element-engagement":385,"ac-object":810}],1001:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

var proto;

/**
 * @class
 * @name ac-renderplayer.PlayController
 *
 * @desc TODO
 *
 * @param {Object} [options]
 *        Options to initialize the instance with
 */
function PlayController() {
	this._active = null;
}

proto = PlayController.prototype;

proto.add = function (mediaObject) {
	// Overwrite play method to proxy via PlayController
	mediaObject._originalPlayMethod = mediaObject.play;
	mediaObject.play = this.play.bind(this, mediaObject);
};

proto.play = function (mediaObject) {
	if (mediaObject) {
		this._play(mediaObject);
	}
};

proto._play = function (mediaObject) {
	if (this._active !== mediaObject) {
		this.stop();
	}

	this._active = mediaObject;

	// If it doesn't have a proxied play method, then add to PlayController now!
	if (!this._active._originalPlayMethod) {
		this.add(this._active);
	}

	// If it was added, we are overwriting the play method. Call OG
	this._active._originalPlayMethod.call(this._active);

	this._active.once('pause', this.stop, this);
	this._active.once('stop', this.stop, this);
	this._active.once('ended', this.stop, this);
};

proto.stop = function (eventData) {
	if (this._active) {
		this._active.off('pause', this.stop);
		this._active.off('stop', this.stop);
		this._active.off('ended', this.stop);

		// Events assumed to always give us some eventData
		// TODO: Is this necessary?
		if (eventData === undefined) {
			this._active.stop();
		}
	}

	this._active = null;
};

var sharedInstance = new PlayController();

sharedInstance.PlayController = PlayController;

module.exports = sharedInstance;

},{}],1002:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

var ac_Object     = require('ac-object');
var DeferredQueue = require('ac-deferredqueue').DeferredQueue;
var Super         = require('../PlayController').PlayController;

var proto;

/**
 * @class
 * @name ac-renderplayer.QueuedPlayController
 *
 * @desc TODO
 *
 * @param {Object} [options]
 *        Options to initialize the instance with
 */
function QueuedPlayController() {
	Super.call(this);

	this.deferredQueue = new DeferredQueue({
		autoplay: true,
		asynchronous: true
	});
}

proto = QueuedPlayController.prototype = ac_Object.create(Super.prototype);

proto._play = function (mediaObject) {
	mediaObject.once('play', this._onPlay, this);

	this.deferredQueue.add(mediaObject._originalPlayMethod.bind(mediaObject));
};

proto._onPlay = function (mediaObject) {
	this._active = mediaObject;

	this._active.once('pause', this.stop, this);
	this._active.once('stop', this.stop, this);
	this._active.once('ended', this.stop, this);
};

proto.stop = function (eventData) {
	Super.prototype.stop.call(this, eventData);

	this.deferredQueue.didFinish();
};

var sharedInstance = new QueuedPlayController();

sharedInstance.QueuedPlayController = QueuedPlayController;

module.exports = sharedInstance;

},{"../PlayController":1001,"ac-deferredqueue":806,"ac-object":810}],1003:[function(require,module,exports){
'use strict';

/**
 * @name canPlay
 *
 * @function
 *
 * @desc Whether or not we have a media object that works for this instance in this environment
 *
 * @returns {Boolean} Can we play?
 *
 */
module.exports = function canPlay(mediaObject) {
	if (mediaObject !== null) {
		mediaObject.container.classList.add('renderplayer-canplay');
		return true;
	}

	return false;
};

},{}],1004:[function(require,module,exports){
'use strict';

var ThrottledClock = require('ac-clock').ThrottledClock;

module.exports = function (unit) {
	unit = isNaN(unit) ? 30 : unit;
	return new ThrottledClock(unit);
};

},{"ac-clock":802}],1005:[function(require,module,exports){
'use strict';

module.exports = function createTrigger(innerHTML, container) {
	var trigger = document.createElement('a');

	if (innerHTML) {
		trigger.innerHTML = innerHTML;
	}

	trigger.setAttribute('href', '#');

	if (container && container.parentNode) {
		container.parentNode.replaceChild(trigger, container);
		trigger.appendChild(container);
	}

	return trigger;
};

},{}],1006:[function(require,module,exports){
'use strict';

var ac_Viewport = require('ac-viewport').Viewport;


module.exports = function (mediaObject, options) {
	options = options || {};
	var callback = typeof options.callback === 'function' ? options.callback : null;
	var breakpointsBlacklist = Array.isArray(options.degradeOnBreakpointBlacklist) ? options.degradeOnBreakpointBlacklist : null;

	function destroy () {
		ac_Viewport.off('breakpoint', onBreakpoint);
	}

	function onBreakpoint (bp) {
		if (breakpointsBlacklist && breakpointsBlacklist.indexOf(bp.incoming) > -1) {
			return;
		} else {
			mediaObject.degrade();
			if (callback) {
				callback();
			}
		}
	}

	ac_Viewport.on('breakpoint', onBreakpoint);

	mediaObject.once('destroy', destroy);


};

},{"ac-viewport":988}],1007:[function(require,module,exports){
'use strict';

var ac_Object = require('ac-object');

var proto;

var defaults = {
	'pause': true,
	'stop': true,
	'ended': true
};

module.exports = function doAfterPlayed(mediaObject, func, options) {
	options = ac_Object.defaults(defaults, options || {});

	var thingToDo = function () {
		// Call func only once
		func();

		// Redefine as empty function
		func = function () {};
	};

	for (var evt in options) {
		if (options[evt]) {
			mediaObject.once(evt, thingToDo);
		}
	}
};

},{"ac-object":810}],1008:[function(require,module,exports){
'use strict';

module.exports = function spinner(mediaObject) {
	/**
	 * @todo  progress indication?
	 */

	mediaObject.once('loadstart', function () {
		mediaObject.container.classList.add('loading');
	});

	mediaObject.once('loaded', function () {
		mediaObject.container.classList.remove('loading');
	});
};

},{}],1009:[function(require,module,exports){
'use strict';

var ac_Element             = require('ac-base').Element;
var ac_Object              = require('ac-object');
var canPlay                = require('./behaviors/canPlay');
var Controller_UserEngaged = require('./../ac-renderplayer/Controller/UserEngaged');
var createScrubOnScroll    = require('./createScrubOnScroll');
var doAfterPlay            = require('./behaviors/doAfterPlay');
var Enhancer               = require('../ac-renderplayer/Enhancer');
var OutOfViewEnhancer      = require('../ac-renderplayer/Enhancer/OutOfViewEnhancer');
var QueuedPlayController   = require('../ac-renderplayer/PlayController/QueuedPlayController');
var degradeOnBreakpointChange = require('./behaviors/degradeOnBreakpointChange');

var defaults = {
	reversed: false,
	startInView: false,
	tiedToScrollAfterPlayed: false,
	loopInterval: false,
	degradeAfterPlayed: true
};

module.exports = function createAmbient(mediaObject, options, enhancerOptions) {
	var player = {};
	var controller;
	var breakpointOptions;

	options = ac_Object.defaults(defaults, options || {});

	if (!canPlay(mediaObject)) {
		return null;
	}

	// Force to play via QueuedPlayController, which plays this MediaObject after others
	// that are already playing if they were also added to play controller
	QueuedPlayController.add(mediaObject);

	if (options.startInView) {
		new Enhancer(mediaObject, function () {
			controller = new Controller_UserEngaged(mediaObject, {
				reversed: options.reversed,
				loopInterval: options.loopInterval
			});
		}, enhancerOptions);
	} else {
		new OutOfViewEnhancer(mediaObject, function () {
			controller = new Controller_UserEngaged(mediaObject, {
				reversed: options.reversed,
				loopInterval: options.loopInterval
			});
		}, enhancerOptions);
	}

	player.controllers = [controller];

	if (typeof options.loopInterval !== 'number') {
		if (options.tiedToScrollAfterPlayed) {
			doAfterPlay(mediaObject, function () {
				var controller;
				var offset = ac_Element.cumulativeOffset(mediaObject.container);
				var scrubOnScrollOptions = {};

				if (options.startInView) {
					scrubOnScrollOptions.startInView = true;
					scrubOnScrollOptions.reversed = !options.reversed;
					scrubOnScrollOptions.offsetTop = offset.top * -1;
				}

				controller = createScrubOnScroll(mediaObject, scrubOnScrollOptions);
				player.controllers.push(controller);
			}, {
				'ended': options.startInView
			});
		} else if (options.degradeAfterPlayed) {
			doAfterPlay(mediaObject, function () {
				mediaObject.degrade.call(mediaObject);
			});
		}
	}

	// degrade on breakpoint change behavior
	if (options.degradeOnBreakpointChange) {
		breakpointOptions = {
			degradeOnBreakpointBlacklist: options.degradeOnBreakpointBlacklist
		};
		degradeOnBreakpointChange(mediaObject, breakpointOptions);
	}

	return player;

};

},{"../ac-renderplayer/Enhancer":999,"../ac-renderplayer/Enhancer/OutOfViewEnhancer":1000,"../ac-renderplayer/PlayController/QueuedPlayController":1002,"./../ac-renderplayer/Controller/UserEngaged":995,"./behaviors/canPlay":1003,"./behaviors/degradeOnBreakpointChange":1006,"./behaviors/doAfterPlay":1007,"./createScrubOnScroll":1013,"ac-base":2,"ac-object":810}],1010:[function(require,module,exports){
'use strict';

var ac_Element = require('ac-base').Element;

var canPlay                = require('./behaviors/canPlay');
var Controller = require('../ac-renderplayer/Controller');
var Enhancer = require('../ac-renderplayer/Enhancer');
var degradeOnBreakpointChange = require('./behaviors/degradeOnBreakpointChange');

module.exports = function createAutoplay(mediaObject, options) {
	options = options || {};
	var player = {};
	var controller;
	var breakpointOptions;

	if (!canPlay(mediaObject)) {
		return null;
	}

	var enhance = function() {
		var controller = new Controller(mediaObject);
		player.controllers = [controller];
	};

	new Enhancer(mediaObject, enhance, options);

	// degrade on breakpoint change behavior
	if (options.degradeOnBreakpointChange) {
		breakpointOptions = {
			degradeOnBreakpointBlacklist: options.degradeOnBreakpointBlacklist
		};
		degradeOnBreakpointChange(mediaObject, breakpointOptions);
	}


	return player;
};

},{"../ac-renderplayer/Controller":991,"../ac-renderplayer/Enhancer":999,"./behaviors/canPlay":1003,"./behaviors/degradeOnBreakpointChange":1006,"ac-base":2}],1011:[function(require,module,exports){
'use strict';

var ac_Element             = require('ac-base').Element;
var ac_Object              = require('ac-object');
var canPlay                = require('./behaviors/canPlay');
var Controller_ClickToPlay = require('../ac-renderplayer/Controller/ClickToPlay');
var createTrigger          = require('./behaviors/createTrigger');
var PlayController         = require('../ac-renderplayer/PlayController');
var spinner                = require('./behaviors/spinner');
var degradeOnBreakpointChange = require('./behaviors/degradeOnBreakpointChange');

var defaults = {
	trigger: null
};

var setupTrigger = function (triggerReference, mediaObject) {
	var options = {};
	var triggerEl = ac_Element.isElement(triggerReference) ? triggerReference : createTrigger('', mediaObject.container);
	var behavior = triggerEl.href.replace(/.*#/, '');

	if (behavior === 'play' || behavior === 'stop' || behavior === 'pause') {
		options.behavior = behavior;
	} else if (behavior === 'replay') {
		options.behavior = 'play';
		options.stopableWhilePlaying = false;
		options.disableWhilePlaying = true;
	}

	return new Controller_ClickToPlay(mediaObject, triggerEl, options);
};

var setupTriggers = function (triggerReferences, mediaObject) {
	if (typeof triggerReferences === 'string') {
		triggerReferences = ac_Element.selectAll(triggerReferences);
	}

	triggerReferences = [].concat(triggerReferences);

	var controllers = triggerReferences.map(function (triggerReference) {
		return setupTrigger(triggerReference, mediaObject);
	});

	return controllers;
};


module.exports = function createClickToPlay(mediaObject, options) {
	var player = {};
	var breakpointOptions;

	options = ac_Object.defaults(defaults, options || {});

	if (!canPlay(mediaObject)) {
		return null;
	}

	// Force to play via PlayController, which stops other instances of MediaObject already playing
	// if they were also added to play controller
	PlayController.add(mediaObject);

	// Add loading spinner
	spinner(mediaObject);

	player.controllers = setupTriggers(options.trigger, mediaObject);

	// degrade on breakpoint change behavior
	if (options.degradeOnBreakpointChange) {
		breakpointOptions = {
			degradeOnBreakpointBlacklist: options.degradeOnBreakpointBlacklist
		};
		degradeOnBreakpointChange(mediaObject, breakpointOptions);
	}

	mediaObject.enhance();


	return player;
};

},{"../ac-renderplayer/Controller/ClickToPlay":992,"../ac-renderplayer/PlayController":1001,"./behaviors/canPlay":1003,"./behaviors/createTrigger":1005,"./behaviors/degradeOnBreakpointChange":1006,"./behaviors/spinner":1008,"ac-base":2,"ac-object":810}],1012:[function(require,module,exports){
'use strict';

var ac_Object          = require('ac-object');
var canPlay            = require('./behaviors/canPlay');
var clock30fps         = require('./behaviors/clock30fps');
var Controller_Grabber = require('../ac-renderplayer/Controller/Grabber');
var Enhancer           = require('../ac-renderplayer/Enhancer');
var spinner            = require('./behaviors/spinner');
var degradeOnBreakpointChange = require('./behaviors/degradeOnBreakpointChange');

var defaults = {
	clock: clock30fps()
};

module.exports = function createGrabber(mediaObject, options) {
	var player = {};
	var breakpointOptions;

	options = ac_Object.defaults(defaults, options || {});

	if (!canPlay(mediaObject)) {
		return null;
	}

	// Add loading spinner
	spinner(mediaObject);

	new Enhancer(mediaObject, function () {
		var controller = new Controller_Grabber(mediaObject, mediaObject.container, options);
		player.controllers = [controller];
	});

	// degrade on breakpoint change behavior
	if (options.degradeOnBreakpointChange) {
		breakpointOptions = {
			degradeOnBreakpointBlacklist: options.degradeOnBreakpointBlacklist
		};
		degradeOnBreakpointChange(mediaObject, breakpointOptions);
	}

	return player;
};

},{"../ac-renderplayer/Controller/Grabber":993,"../ac-renderplayer/Enhancer":999,"./behaviors/canPlay":1003,"./behaviors/clock30fps":1004,"./behaviors/degradeOnBreakpointChange":1006,"./behaviors/spinner":1008,"ac-object":810}],1013:[function(require,module,exports){
'use strict';

var ac_Object                = require('ac-object');
var canPlay                  = require('./behaviors/canPlay');
var clock30fps               = require('./behaviors/clock30fps');
var Controller_ScrubOnScroll = require('./../ac-renderplayer/Controller/ScrubOnScroll');
var Enhancer                 = require('../ac-renderplayer/Enhancer');
var getAttribute             = require('../utils/getAttribute');
var OutOfViewEnhancer        = require('../ac-renderplayer/Enhancer/OutOfViewEnhancer');
var degradeOnBreakpointChange = require('./behaviors/degradeOnBreakpointChange');

var defaults = {
	clock: clock30fps(),
	enhanceInView: false
};

module.exports = function createScrubOnScroll(mediaObject, options, enhancerOptions) {
	var player = {};
	var breakpointOptions;

	options = ac_Object.defaults(defaults, options || {});
	options.offsetTop = options.offsetTop || getAttribute(mediaObject.container, 'data-offsetTop', true);
	options.offsetBottom = options.offsetBottom || getAttribute(mediaObject.container, 'data-offsetBottom', true);

	if (!canPlay(mediaObject)) {
		return null;
	}

	var enhance = function () {
		var controller = new Controller_ScrubOnScroll(mediaObject, options);

		// Expose on player
		player.setOffsets = function (top, bottom) {
			controller.setOffsets(top, bottom);
		};
		player.setSmoothing = function (bool) {
			controller.setSmoothing(bool);
		};

		player.controllers = [controller];
	};

	if (options.startInView || options.enhanceInView) {
		new Enhancer(mediaObject, enhance, enhancerOptions);
	} else {
		new OutOfViewEnhancer(mediaObject, enhance, enhancerOptions);
	}

	// degrade on breakpoint change behavior
	if (options.degradeOnBreakpointChange) {
		breakpointOptions = {
			degradeOnBreakpointBlacklist: options.degradeOnBreakpointBlacklist
		};
		degradeOnBreakpointChange(mediaObject, breakpointOptions);
	}

	return player;
};

},{"../ac-renderplayer/Enhancer":999,"../ac-renderplayer/Enhancer/OutOfViewEnhancer":1000,"../utils/getAttribute":1015,"./../ac-renderplayer/Controller/ScrubOnScroll":994,"./behaviors/canPlay":1003,"./behaviors/clock30fps":1004,"./behaviors/degradeOnBreakpointChange":1006,"ac-object":810}],1014:[function(require,module,exports){
arguments[4][715][0].apply(exports,arguments)
},{"dup":715}],1015:[function(require,module,exports){
'use strict';

module.exports = function getAttribute(el, attr, isFloat) {
	var val = el.getAttribute(attr) || null;

	if (val) {
		if (val === 'true') {
			val = true;

		} else if (val === 'false') {
			val = false;

		} else if (isFloat) {
			val = parseFloat(val, 10);
		}
	}

	return val;
};

},{}],1016:[function(require,module,exports){
arguments[4][135][0].apply(exports,arguments)
},{"./ac-event-emitter/EventEmitter":1017,"dup":135}],1017:[function(require,module,exports){
arguments[4][136][0].apply(exports,arguments)
},{"dup":136}],1018:[function(require,module,exports){
arguments[4][1][0].apply(exports,arguments)
},{"dup":1}],1019:[function(require,module,exports){
arguments[4][375][0].apply(exports,arguments)
},{"./ac-object/clone":1020,"./ac-object/create":1021,"./ac-object/defaults":1022,"./ac-object/extend":1023,"./ac-object/getPrototypeOf":1024,"./ac-object/isDate":1025,"./ac-object/isEmpty":1026,"./ac-object/isRegExp":1027,"./ac-object/toQueryParameters":1028,"dup":375}],1020:[function(require,module,exports){
arguments[4][376][0].apply(exports,arguments)
},{"./extend":1023,"dup":376}],1021:[function(require,module,exports){
arguments[4][377][0].apply(exports,arguments)
},{"dup":377}],1022:[function(require,module,exports){
arguments[4][378][0].apply(exports,arguments)
},{"./extend":1023,"dup":378}],1023:[function(require,module,exports){
arguments[4][379][0].apply(exports,arguments)
},{"dup":379}],1024:[function(require,module,exports){
arguments[4][380][0].apply(exports,arguments)
},{"dup":380}],1025:[function(require,module,exports){
arguments[4][381][0].apply(exports,arguments)
},{"dup":381}],1026:[function(require,module,exports){
arguments[4][382][0].apply(exports,arguments)
},{"dup":382}],1027:[function(require,module,exports){
arguments[4][383][0].apply(exports,arguments)
},{"dup":383}],1028:[function(require,module,exports){
arguments[4][384][0].apply(exports,arguments)
},{"dup":384,"qs":1018}],1029:[function(require,module,exports){
arguments[4][917][0].apply(exports,arguments)
},{"./ac-breakpoints-delegate/BreakpointsDelegate":1030,"dup":917}],1030:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

var SharedInstance = require('ac-shared-instance').SharedInstance,
	AC_Object = require('ac-object'),
	WindowDelegate = require('ac-window-delegate').WindowDelegate,
	WindowDelegateCustomEvent = require('ac-window-delegate').WindowDelegateCustomEvent,
	EventEmitter = require('ac-event-emitter').EventEmitter;

var sharedInstanceName = 'ac-breakpoints-delegate:BreakpointsDelegate',
	sharedInstanceVersion = '2.0.0-2';

var breakpointEventString = 'breakpoint',
	resizeEventsString = 'resize orientationchange';

// from toolkit
var defaultBreakpoints = {

	'large' : {
		'min-width': 1069,
		'max-width': 1441,
		'content': 980,
		'oldie': true
	},
	'xlarge' : {
		'min-width': 1442,
		'content': 980
	},
	'medium' : {
		'min-width': 736,
		'max-width': 1068,
		'content': 692
	},
	'small' : {
		'min-width': 320,
		'max-width': 735,
		'content': 288,
		'max-device-width': 768
	}
};

var viewportProperties = {
	minWidth : 'min-width',
	maxWidth : 'max-width',
	maxDeviceWidth : 'max-device-width',
	content : 'content',
	oldIE : 'oldie'
};

/**
 * @name module:ac-this.breakpoints-delegate.BreakpointsDelegate
 * @class
 * 
 * @desc EventEmitter system that handles breakpoint events and current breakpoint information
 * 
 * @param {Object} [options]
 *        Options to initialize the instance with
 */
function BreakpointsDelegate( options ) {
	this._customEvent = new WindowDelegateCustomEvent( breakpointEventString, this._onBreakpointListenerAdded.bind( this ), this._onBreakpointListenerRemoved.bind( this ) );
	this.setBreakpoints( defaultBreakpoints );
}

var proto = BreakpointsDelegate.prototype;

proto.initialize = function() {
	this._breakpoint = null;
	this._lastBreakpoint = null;

	this._handleOldIE();
	this._handleDevices();

	this._breakpointOrder = this._setBreakpointOrder();

	if ( !this._isOldIE ) {
		this._handleResize();
	}
};

proto.getCustomEvent = function() {
	return this._customEvent;
};

proto.getBreakpoint = function() {
	if ( !this._customEvent.active ) {
		this._handleResize();
	}
	return this._breakpoint;
};

proto.setBreakpoints = function( breakpoints ) {
	this.breakpoints = AC_Object.clone( breakpoints );
	this.initialize();
};

proto._handleResize = function() {
	var width = WindowDelegate.innerWidth(),
		newBreakpoint;

	var i,
		key,
		breakpoint,
		len = this._breakpointOrder.length;

	for ( i = 0; i < len; i++ ) {
		key = this._breakpointOrder[ i ];
		breakpoint = this.breakpoints[ key ];
		if ( breakpoint._breakPosition > width ) {
			break;
		}
	}
	if ( i > 0 ) {
		i = i - 1;
	}

	newBreakpoint = this.breakpoints[ this._breakpointOrder[ i ] ];

	if ( !this._breakpoint ) {
		this._breakpoint = newBreakpoint;
		return;
	}

	if ( newBreakpoint.name === this._breakpoint.name ) {
		return;
	}

	this._lastBreakpoint = this._breakpoint;
	this._breakpoint = newBreakpoint;

	WindowDelegate.trigger( breakpointEventString, {
		incoming : this._breakpoint,
		outgoing : this._lastBreakpoint
	});

};

proto._setBreakpointOrder = function() {
	var breakPosition = 0,
		order = [],
		result = [],
		minWidth = viewportProperties.minWidth,
		i;

	for ( i in this.breakpoints ) {
		if ( this.breakpoints.hasOwnProperty( i ) ) {
			this.breakpoints[ i ].name = i;
			order.push( this.breakpoints[ i ][ minWidth ] );
		}
	}

	order.sort( function( a, b ) {
		return a - b;
	});

	order.forEach( function( val ) {
		var i;
		for ( i in this.breakpoints ) {
			if ( this.breakpoints.hasOwnProperty( i ) ) {
				if ( this.breakpoints[ i ][ minWidth ]  === val ) {
					result.push( i );
				}
			}
		}
	}, this );

	// set the x-axis pixel locations for where breakpoints should occur
	result.forEach( function( key, i ) {
		this.breakpoints[ key ]._breakPosition = breakPosition;

		if ( result[ i + 1 ] ) {
			breakPosition = this.breakpoints[ result[ i + 1 ] ][ minWidth ];
		}

	}, this );

	return result;
};

proto._handleOldIE = function() {
	var classTarget = document.documentElement,
		oldIE = viewportProperties.oldIE;
	// remove all this.breakpoints other than the oldIE : true ones
	if ( classTarget.className.indexOf( 'no-' + oldIE ) > -1 || classTarget.className.indexOf( oldIE ) === -1 ) {
		return;
	}

	this._isOldIE = true;
	this._replaceBreakpoints( function( breakpoint ) {
		return breakpoint[ oldIE ] === true;
	});

	// set the remaining { oldie : true } breakpoint to be the current one
	var i;
	for ( i in this.breakpoints ) {
		if ( this.breakpoints.hasOwnProperty( i ) ) {
			this._breakpoint = this.breakpoints[ i ];
			return;
		}
	}
};

proto._handleDevices = function() {
	var maxDeviceWidth = viewportProperties.maxDeviceWidth;
	this._replaceBreakpoints( function( breakpoint ) {
		if ( typeof breakpoint[ maxDeviceWidth ] !== 'number' ) {
			return true;
		}

		if ( window.screen && window.screen.width <= breakpoint[ maxDeviceWidth ] ) {
			return true;
		}

		return false;
	});
};

proto._replaceBreakpoints = function( condition ) {
	var i,
		newBreakpoints = {},
		breakpoint;
	for ( i in this.breakpoints ) {
		if ( this.breakpoints.hasOwnProperty( i ) ) {
			breakpoint = this.breakpoints[ i ];
			if ( condition( breakpoint )) {
				newBreakpoints[ i ] = AC_Object.clone( this.breakpoints[ i ] );
			}


		}
	}

	this.breakpoints = newBreakpoints;
};

proto._onBreakpointListenerAdded = function() {
	WindowDelegate.on( resizeEventsString, this._handleResize, this );
};

proto._onBreakpointListenerRemoved = function() {
	WindowDelegate.off( resizeEventsString, this._handleResize, this );
};

module.exports = SharedInstance.share( sharedInstanceName, sharedInstanceVersion, BreakpointsDelegate );

},{"ac-event-emitter":1016,"ac-object":1019,"ac-shared-instance":1031,"ac-window-delegate":1093}],1031:[function(require,module,exports){
arguments[4][137][0].apply(exports,arguments)
},{"./ac-shared-instance/SharedInstance":1032,"dup":137}],1032:[function(require,module,exports){
arguments[4][138][0].apply(exports,arguments)
},{"dup":138}],1033:[function(require,module,exports){
arguments[4][396][0].apply(exports,arguments)
},{"./ac-prefixer/Prefixer":1034,"dup":396}],1034:[function(require,module,exports){
arguments[4][397][0].apply(exports,arguments)
},{"./Prefixer/camelCasedEvents":1035,"dup":397}],1035:[function(require,module,exports){
arguments[4][398][0].apply(exports,arguments)
},{"dup":398}],1036:[function(require,module,exports){
/**
 * Helper methods for handling DOM events with cross-browser compatibility.
 * @module ac-dom-events
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

module.exports = {
	addEventListener: require('./ac-dom-events/addEventListener'),
	dispatchEvent: require('./ac-dom-events/dispatchEvent'),
	preventDefault: require('./ac-dom-events/preventDefault'),
	removeEventListener: require('./ac-dom-events/removeEventListener'),
	stop: require('./ac-dom-events/stop'),
	stopPropagation: require('./ac-dom-events/stopPropagation'),
	target: require('./ac-dom-events/target')
};

},{"./ac-dom-events/addEventListener":1037,"./ac-dom-events/dispatchEvent":1038,"./ac-dom-events/preventDefault":1039,"./ac-dom-events/removeEventListener":1040,"./ac-dom-events/stop":1041,"./ac-dom-events/stopPropagation":1042,"./ac-dom-events/target":1043}],1037:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var prefixer = require('ac-prefixer');

/**
 * @name module:ac-dom-events.addEventListener
 *
 * @function
 *
 * @desc Register the specified listener on a target.
 *       Automatically handles vendor prefixed and camel-cased event types.
 *
 * @param {Object} target
 *        The event target to listen to.
 *        Usually an Element, document, or window.
 *
 * @param {String} type
 *        A lowercase string representing the event type.
 *        e.g., "click", "transitionend"
 *
 * @param {Function} listener
 *        A Function to be called when the event type is triggered.
 *
 * @param {Boolean} [useCapture=false]
 *        `true` listens for the event in the capture phase.
 *        `false` (default) listens for the event in the bubbling phases.
 *        IE < 9 does not support useCapture
 *
 * @returns {Object} target
 */
module.exports = function addEventListener (target, type, listener, useCapture) {
	type = prefixer.getEventType(type);

	if (target.addEventListener) {
		target.addEventListener(type, listener, useCapture);
	} else {
		type = 'on' + type.toLowerCase();
		target.attachEvent(type, listener);
	}

	return target;
};

},{"ac-prefixer":1033}],1038:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name module:ac-dom-events.dispatchEvent
 *
 * @function
 *
 * @desc Creates and dispatches an Event on a target.
 *
 * @param {Object} target
 *        The event target.
 *        Usually an Element, document, or window.
 *
 * @param {String} type
 *        A lowercase string representing the event type to dispatch.
 *
 * @param {Object} [options]
 *
 * @param {Boolean} [options.bubbles=false]
 *        Whether or not the event bubbles up through the DOM.
 *        IE < 9 ignores this options, using the `true` behavior.
 *
 * @param {Boolean} [options.cancelable=false]
 *        Whether or not the event can be cancelled.
 *        IE < 9 ignores this options, using the `false` behavior.
 *
 * @param {*} [options.detail]
 *        The data passed to event listeners.
 *
 * @returns {Object} target
 */
module.exports = function dispatchEvent (target, type, options) {
	var evt;

	type = type.toLowerCase();

	if (window.CustomEvent) {
		// Expects polyfill for CustomEvent constructor
		if (options) {
			evt = new CustomEvent(type, options);
		} else {
			evt = new CustomEvent(type);
		}

		target.dispatchEvent(evt);

	} else {
		evt = document.createEventObject();

		if (options && 'detail' in options) {
			evt.detail = options.detail;
		}

		target.fireEvent('on' + type, evt);
	}

	return target;
};

},{}],1039:[function(require,module,exports){
arguments[4][70][0].apply(exports,arguments)
},{"dup":70}],1040:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/** @ignore */
var prefixer = require('ac-prefixer');

/**
 * @name module:ac-dom-events.removeEventListener
 *
 * @function
 *
 * @desc Removes a previously added event listener.
 *       Automatically handles vendor prefixed and camel-cased event types.
 *
 * @param {Object} target
 *        The event target.
 *        Usually an Element, document, or window.
 *
 * @param {String} type
 *        A lowercase string representing the event type.
 *        e.g., "click", "transitionend"
 *
 * @param {Function} listener
 *        The listener Function to be removed.
 *
 * @param {Boolean} [useCapture=false]
 *        `true` for the a listener on the capture phase.
 *        `false` (default) for a listener on the bubbling phases.
 *
 * @returns {Object} target
 */
module.exports = function removeEventListener (target, type, listener, useCapture) {
	type = prefixer.getEventType(type);

	if (target.removeEventListener) {
		target.removeEventListener(type, listener, useCapture);
	} else {
		type = 'on' + type.toLowerCase();
		target.detachEvent(type, listener);
	}

	return target;
};

},{"ac-prefixer":1033}],1041:[function(require,module,exports){
arguments[4][73][0].apply(exports,arguments)
},{"./preventDefault":1039,"./stopPropagation":1042,"dup":73}],1042:[function(require,module,exports){
arguments[4][74][0].apply(exports,arguments)
},{"dup":74}],1043:[function(require,module,exports){
/**
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

/**
 * @name module:ac-dom-events.target
 *
 * @function
 *
 * @desc Get the target of an Event.
 *
 * @param {Event} evt
 *
 * @returns {Object} target
 */
module.exports = function target (evt) {
	evt = evt || window.event;
	return (typeof evt.target !== 'undefined') ? evt.target : evt.srcElement;
};

},{}],1044:[function(require,module,exports){
arguments[4][89][0].apply(exports,arguments)
},{"dup":89}],1045:[function(require,module,exports){
arguments[4][90][0].apply(exports,arguments)
},{"dup":90}],1046:[function(require,module,exports){
arguments[4][91][0].apply(exports,arguments)
},{"dup":91}],1047:[function(require,module,exports){
arguments[4][92][0].apply(exports,arguments)
},{"dup":92}],1048:[function(require,module,exports){
arguments[4][93][0].apply(exports,arguments)
},{"dup":93}],1049:[function(require,module,exports){
arguments[4][94][0].apply(exports,arguments)
},{"dup":94}],1050:[function(require,module,exports){
arguments[4][95][0].apply(exports,arguments)
},{"dup":95}],1051:[function(require,module,exports){
arguments[4][96][0].apply(exports,arguments)
},{"./ELEMENT_NODE":1048,"./internal/isNodeType":1057,"ac-polyfills/Array/prototype.filter":797,"ac-polyfills/Array/prototype.slice":799,"dup":96}],1052:[function(require,module,exports){
arguments[4][97][0].apply(exports,arguments)
},{"./COMMENT_NODE":1044,"./DOCUMENT_FRAGMENT_NODE":1045,"./DOCUMENT_NODE":1046,"./DOCUMENT_TYPE_NODE":1047,"./ELEMENT_NODE":1048,"./TEXT_NODE":1049,"./createDocumentFragment":1050,"./filterByNodeType":1051,"./insertAfter":1053,"./insertBefore":1054,"./insertFirstChild":1055,"./insertLastChild":1056,"./isComment":1059,"./isDocument":1060,"./isDocumentFragment":1061,"./isDocumentType":1062,"./isElement":1063,"./isNode":1064,"./isNodeList":1065,"./isTextNode":1066,"./remove":1067,"./replace":1068,"dup":97}],1053:[function(require,module,exports){
arguments[4][98][0].apply(exports,arguments)
},{"./internal/validate":1058,"dup":98}],1054:[function(require,module,exports){
arguments[4][99][0].apply(exports,arguments)
},{"./internal/validate":1058,"dup":99}],1055:[function(require,module,exports){
arguments[4][100][0].apply(exports,arguments)
},{"./internal/validate":1058,"dup":100}],1056:[function(require,module,exports){
arguments[4][101][0].apply(exports,arguments)
},{"./internal/validate":1058,"dup":101}],1057:[function(require,module,exports){
arguments[4][102][0].apply(exports,arguments)
},{"../isNode":1064,"dup":102}],1058:[function(require,module,exports){
arguments[4][103][0].apply(exports,arguments)
},{"../COMMENT_NODE":1044,"../DOCUMENT_FRAGMENT_NODE":1045,"../ELEMENT_NODE":1048,"../TEXT_NODE":1049,"./isNodeType":1057,"dup":103}],1059:[function(require,module,exports){
arguments[4][104][0].apply(exports,arguments)
},{"./COMMENT_NODE":1044,"./internal/isNodeType":1057,"dup":104}],1060:[function(require,module,exports){
arguments[4][105][0].apply(exports,arguments)
},{"./DOCUMENT_NODE":1046,"./internal/isNodeType":1057,"dup":105}],1061:[function(require,module,exports){
arguments[4][106][0].apply(exports,arguments)
},{"./DOCUMENT_FRAGMENT_NODE":1045,"./internal/isNodeType":1057,"dup":106}],1062:[function(require,module,exports){
arguments[4][107][0].apply(exports,arguments)
},{"./DOCUMENT_TYPE_NODE":1047,"./internal/isNodeType":1057,"dup":107}],1063:[function(require,module,exports){
arguments[4][108][0].apply(exports,arguments)
},{"./ELEMENT_NODE":1048,"./internal/isNodeType":1057,"dup":108}],1064:[function(require,module,exports){
arguments[4][109][0].apply(exports,arguments)
},{"dup":109}],1065:[function(require,module,exports){
arguments[4][110][0].apply(exports,arguments)
},{"dup":110}],1066:[function(require,module,exports){
arguments[4][111][0].apply(exports,arguments)
},{"./TEXT_NODE":1049,"./internal/isNodeType":1057,"dup":111}],1067:[function(require,module,exports){
arguments[4][112][0].apply(exports,arguments)
},{"./internal/validate":1058,"dup":112}],1068:[function(require,module,exports){
arguments[4][113][0].apply(exports,arguments)
},{"./internal/validate":1058,"dup":113}],1069:[function(require,module,exports){
arguments[4][114][0].apply(exports,arguments)
},{"./ac-dom-traversal/ancestor":1070,"./ac-dom-traversal/ancestors":1071,"./ac-dom-traversal/children":1072,"./ac-dom-traversal/filterBySelector":1073,"./ac-dom-traversal/firstChild":1074,"./ac-dom-traversal/lastChild":1077,"./ac-dom-traversal/matchesSelector":1078,"./ac-dom-traversal/nextSibling":1079,"./ac-dom-traversal/nextSiblings":1080,"./ac-dom-traversal/previousSibling":1081,"./ac-dom-traversal/previousSiblings":1082,"./ac-dom-traversal/querySelector":1083,"./ac-dom-traversal/querySelectorAll":1084,"./ac-dom-traversal/shims/ie":1085,"./ac-dom-traversal/siblings":1086,"dup":114}],1070:[function(require,module,exports){
arguments[4][115][0].apply(exports,arguments)
},{"./helpers/validate":1076,"./matchesSelector":1078,"ac-dom-nodes":1052,"dup":115}],1071:[function(require,module,exports){
arguments[4][116][0].apply(exports,arguments)
},{"./helpers/validate":1076,"./matchesSelector":1078,"ac-dom-nodes":1052,"dup":116}],1072:[function(require,module,exports){
arguments[4][117][0].apply(exports,arguments)
},{"./filterBySelector":1073,"./helpers/validate":1076,"ac-dom-nodes":1052,"dup":117}],1073:[function(require,module,exports){
arguments[4][118][0].apply(exports,arguments)
},{"./helpers/validate":1076,"./matchesSelector":1078,"dup":118}],1074:[function(require,module,exports){
arguments[4][119][0].apply(exports,arguments)
},{"./children":1072,"./helpers/validate":1076,"dup":119}],1075:[function(require,module,exports){
arguments[4][120][0].apply(exports,arguments)
},{"dup":120}],1076:[function(require,module,exports){
arguments[4][121][0].apply(exports,arguments)
},{"ac-dom-nodes":1052,"dup":121}],1077:[function(require,module,exports){
arguments[4][122][0].apply(exports,arguments)
},{"./children":1072,"./helpers/validate":1076,"dup":122}],1078:[function(require,module,exports){
arguments[4][123][0].apply(exports,arguments)
},{"./helpers/nativeMatches":1075,"./helpers/validate":1076,"ac-dom-nodes":1052,"dup":123}],1079:[function(require,module,exports){
arguments[4][124][0].apply(exports,arguments)
},{"./helpers/validate":1076,"./matchesSelector":1078,"ac-dom-nodes":1052,"dup":124}],1080:[function(require,module,exports){
arguments[4][125][0].apply(exports,arguments)
},{"./helpers/validate":1076,"./matchesSelector":1078,"ac-dom-nodes":1052,"dup":125}],1081:[function(require,module,exports){
arguments[4][126][0].apply(exports,arguments)
},{"./helpers/validate":1076,"./matchesSelector":1078,"ac-dom-nodes":1052,"dup":126}],1082:[function(require,module,exports){
arguments[4][127][0].apply(exports,arguments)
},{"./helpers/validate":1076,"./matchesSelector":1078,"ac-dom-nodes":1052,"dup":127}],1083:[function(require,module,exports){
arguments[4][128][0].apply(exports,arguments)
},{"./helpers/validate":1076,"dup":128}],1084:[function(require,module,exports){
arguments[4][129][0].apply(exports,arguments)
},{"./helpers/validate":1076,"dup":129}],1085:[function(require,module,exports){
arguments[4][130][0].apply(exports,arguments)
},{"../helpers/nativeMatches":1075,"../helpers/validate":1076,"../vendor/sizzle/sizzle":1087,"ac-dom-nodes":1052,"dup":130}],1086:[function(require,module,exports){
arguments[4][131][0].apply(exports,arguments)
},{"./children":1072,"./helpers/validate":1076,"dup":131}],1087:[function(require,module,exports){
arguments[4][132][0].apply(exports,arguments)
},{"dup":132}],1088:[function(require,module,exports){
/** 
 * @module ac-dom-emitter
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

module.exports = {
	DOMEmitter : require('./ac-dom-emitter/DOMEmitter')
};
},{"./ac-dom-emitter/DOMEmitter":1089}],1089:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';
var proto;

var EventEmitter = require('ac-event-emitter').EventEmitter,
    DOMEmitterEvent = require('./DOMEmitterEvent'),
    ac_dom_events = require('ac-dom-events'),
    ac_dom_traversal = require('ac-dom-traversal');

/**
 * @name .DOMEmitter
 * @class DOMEmitter
 * <pre>DOMEmitter = require('/DOMEmitter');</pre>
 */

var internalEventPrefix = 'dom-emitter';

function DOMEmitter( el ) {
    if ( el === null ) {
        return;
    }
    this.el = el;
    this._bindings = {};
    this._delegateFuncs = {};
    this._eventEmitter = new EventEmitter();
}

proto = DOMEmitter.prototype;

proto.on = function() {
    this._normalizeArgumentsAndCall( Array.prototype.slice.call( arguments, 0 ), this._on );
    return this;
};

proto.once = function() {
    this._normalizeArgumentsAndCall( Array.prototype.slice.call( arguments, 0 ), this._once );
    return this;
};

proto.off = function() {
    this._normalizeArgumentsAndCall( Array.prototype.slice.call( arguments, 0 ), this._off );
    return this;
};

proto.has = function( evt, callbackOrDelegateQuery, callbackOrContext, context ) {
    // normalize input a bit here
    var delegateQuery,
        callback;

    if ( typeof callbackOrDelegateQuery === 'string' ) {
        delegateQuery = callbackOrDelegateQuery;
        callback = callbackOrContext;
    } else {
        callback = callbackOrDelegateQuery;
        context = callbackOrContext;
    }

    // if a delegateQuery exists, we check inside of this._delegateFuncs for binding info
    if ( delegateQuery ) {
        var matchIdx = this._getDelegateFuncBindingIdx( evt, delegateQuery, callback, context, true );
        if ( matchIdx > -1 ) {
            return true;
        }
        return false;
    }

    if ( this._eventEmitter && this._eventEmitter.has.apply( this._eventEmitter, arguments ) ) {
        return true;
    }
    return false;
};

proto.trigger = function( evts, dataOrDelegateQuery, doNotPropogateOrData, doNotPropogate ) {
    evts = this._parseEventNames( evts );
    // clean strings for matching
    evts = this._cleanStringData( evts );

    var delegateQuery,
        data,
        i,
        len = evts.length;

    if ( typeof dataOrDelegateQuery === 'string' ) {
        delegateQuery = this._cleanStringData( dataOrDelegateQuery );
        data = doNotPropogateOrData;
    } else {
        data = dataOrDelegateQuery;
        doNotPropogate = doNotPropogateOrData;
    }

    for ( i = 0; i < len; i++ ) {
        this._triggerDOMEvents( evts[ i ], data, delegateQuery );
    }

    return this;
    
};

// direct EventEmitter trigger for higher-performance trigger outside of the DOM ( but doesn't support delgation )
proto.emitterTrigger = function ( evts, data, doNotPropogate ) {
    if ( !this._eventEmitter ) {
        return this;
    }

    evts = this._parseEventNames( evts );
    // clean strings for matching
    evts = this._cleanStringData( evts );

    // normalize event data sent to eventEmitter
    data = new DOMEmitterEvent( data, this );

    var i,
        len = evts.length;
    for ( i = 0; i < len; i++ ) {
        this._eventEmitter.trigger( evts[ i ], data, doNotPropogate );
    }

    return this;
};

proto.propagateTo = function( eventEmitter, prefix ) {
    this._eventEmitter.propagateTo( eventEmitter, prefix );
    return this;
};

proto.stopPropagatingTo = function( eventEmitter ) {
    this._eventEmitter.stopPropagatingTo( eventEmitter );
    return this;
};

proto.stopImmediatePropagation = function() {
    this._eventEmitter.stopImmediatePropagation();
    return this;
};

proto.destroy = function() {
    this._triggerInternalEvent( 'willdestroy' );
    this.off();

    var i;
    for ( i in this ) {
        if ( this.hasOwnProperty( i ) ) {
            this[ i ] = null;
        }
    }
};

proto._parseEventNames = function( evt ) {
    // handle any undefined/nulls and send em back
    if ( !evt ) {
        return [ evt ];
    }
    // remove empty string events
    return evt.split(' ');
};

proto._onListenerEvent = function( evtName, e ) {
    // since we're ensured that only one event will be called, we can be quick and hit the EventEmitter directly
    var data = new DOMEmitterEvent( e, this );
    this._eventEmitter.trigger( evtName, data, false );
};

proto._setListener = function( evt ) {
    this._bindings[ evt ] = this._onListenerEvent.bind( this, evt );
    ac_dom_events.addEventListener( this.el, evt, this._bindings[ evt ] );
};

proto._removeListener = function( evt ) {
    ac_dom_events.removeEventListener( this.el, evt, this._bindings[ evt ] );
    this._bindings[ evt ] = null;
};

proto._triggerInternalEvent = function( evt, data ) {
    this.emitterTrigger( internalEventPrefix + ':' + evt, data );
};

proto._normalizeArgumentsAndCall = function( argsArr, func ) {
    /**
     * We use this method to normalize these options:
     *  // Sans-delegation
     *  domEmitter.on( 'click touchend', myFunc ); // 2-arg; string, function
     *  domEmitter.on( 'click touchend', myFunc, ctx ); // 3-arg; string, function, object
     *   
     *  // With Delegation
     *  domEmitter.on( 'click touchend', '.delegate query', myFunc ); // 3-arg; string, string, function
     *  domEmitter.on( 'click touchend', '.delegate query', myFunc, ctx ); // 4-arg; string, string, function, object
     *   
     *  // Object syntax
     *  domEmitter.on({
     *      'click touchend' : myFunc, // Sans-delegation
     *      'click touchend: .delegate query' : myFunc // With delegation
     *  }); // 1-arg; object
     *   
     *  domEmitter.on({
     *      'click' : myFunc,
     *      'click: .delegate query' : myFunc // With delegation
     *  }, ctx ); // 2-arg; object, object
     *
     * domEmitter.off(); // no args
     *
    **/

    var binding = {};

    // handle no-arg situation
    if ( argsArr.length === 0 ) {
        func.call( this, binding );
        return;
    }

    // handle non-object based syntax first
    if ( typeof argsArr[ 0 ] === 'string' || argsArr[ 0 ] === null ) {
        argsArr = this._cleanStringData( argsArr );
        binding.events = argsArr[ 0 ];

        // handle delegate query
        if ( typeof argsArr[ 1 ] === 'string' ) {
            binding.delegateQuery = argsArr[ 1 ];
            binding.callback = argsArr[ 2 ];
            binding.context = argsArr[ 3 ];
        } else {
             // handle non-delegate query
            binding.callback = argsArr[ 1 ];
            binding.context = argsArr[ 2 ];
        }

       func.call( this, binding );
       return;
    }

    // assume type is object here
    var i,
        splits,
        splitChar = ':',
        obj = argsArr[ 0 ];
    for ( i in obj ) {
        if ( obj.hasOwnProperty( i ) ) {
            binding = {};
            // if a colon exists, which will split delegate queries and event names
            splits = this._cleanStringData( i.split( splitChar ) );
            
            // save both. if splits[ 1 ] DNE then it will simply be undefined anyway
            binding.events = splits[ 0 ];
            binding.delegateQuery = splits[ 1 ];

            // set callback and context
            binding.callback = obj[ i ];
            binding.context = argsArr[ 1 ];

            func.call( this, binding );
        }
    }
};

proto._registerDelegateFunc = function( evt, delegateQuery, callback, unboundCallback, context ) {
    // bind a new delegateFunc
    var delegateFunc = this._delegateFunc.bind( this, evt, delegateQuery, callback, context );
    // create an array for delegate funcs with this key if DNE
    this._delegateFuncs[ delegateQuery ] = this._delegateFuncs[ delegateQuery ] || {};
    this._delegateFuncs[ delegateQuery ][ evt ] = this._delegateFuncs[ delegateQuery ][ evt ] || [];
    this._delegateFuncs[ delegateQuery ][ evt ].push({
        func : unboundCallback,
        context : context,
        delegateFunc : delegateFunc
    });

    return delegateFunc;
};

// remove whitespace before/after strings, as well as any empty strings in arrays
proto._cleanStringData = function( arr ) {
    // force it into an array if just a string is passed
    var isString = false;
    if ( typeof arr === 'string' ) {
        arr = [ arr ];
        isString = true; 
    }

    var result = [],
        i,
        val,
        valLen,
        spaceIdx,
        len = arr.length;

    for ( i = 0; i < len; i++ ) {
        val = arr[ i ];

        // if it's a string, check to see if we want it
        if ( typeof val === 'string' ) {
            // if it's an empty string or space, we don't want it. continue
            if ( val === '' || val === ' ' ) {
                continue;
            }

            // we'll remove whitespace in the beginning recursively
            valLen = val.length;
            while( val[ 0 ] === ' ' ) {
                val = val.slice( 1, valLen );
                valLen--;
            }

            // recursively remove whitespace in the end of the string
            while( val[ valLen - 1 ] === ' ' ) {
                val = val.slice( 0, valLen - 1 );
                valLen--;
            }
        }

        result.push( val );
    }

    if ( isString ) {
        return result[ 0 ];
    }

    return result;
};

proto._unregisterDelegateFunc = function( evt, delegateQuery, unboundCallback, context ) {
    // if no delegate functions exist, return
    if ( !this._delegateFuncs[ delegateQuery ] || !this._delegateFuncs[ delegateQuery ][ evt ] ) {
        return;
    }

    // find the index where the binding exists at
    var matchIdx = this._getDelegateFuncBindingIdx( evt, delegateQuery, unboundCallback, context ),
        delegateFunc;

    // if an index was found, remove it from the delegateFunc array
    if ( matchIdx > -1 ) {
        // save the delegate function so it can be unbound via EventEmitter later
        delegateFunc = this._delegateFuncs[ delegateQuery ][ evt ][ matchIdx ].delegateFunc;
        // remove this registry in the array
        this._delegateFuncs[ delegateQuery ][ evt ].splice( matchIdx, 1 );
        // if there aren't any left in the array, nullify this._delegateFuncs[ delegateQuery ][ evt ]
        if ( this._delegateFuncs[ delegateQuery ][ evt ].length === 0 ) {
            this._delegateFuncs[ delegateQuery ][ evt ] = null;
        }
    }

    return delegateFunc;

};

proto._unregisterDelegateFuncs = function( evt, delegateQuery ) {
    // only continue if there are events that need to be removed
    if ( !this._delegateFuncs[ delegateQuery ] ) {
        return;
    }

    if ( evt !== null && !this._delegateFuncs[ delegateQuery ][ evt ] ) {
        return;
    }

    // if the event is null, we just want to iterate over all and unbind
    if ( evt === null ) {
        var i;
        for ( i in this._delegateFuncs[ delegateQuery ] ) {
            if ( this._delegateFuncs[ delegateQuery ].hasOwnProperty( i ) ) {
                this._unbindDelegateFunc( i, delegateQuery );
            }
        }
        return;
    }

    // unbind callbacks just for that event
    this._unbindDelegateFunc( evt, delegateQuery );
};

proto._unbindDelegateFunc = function( evt, delegateQuery ) {
    var binding,
        preRemoveLen,
        i = 0;

    while( this._delegateFuncs[ delegateQuery ][ evt ] && this._delegateFuncs[ delegateQuery ][ evt ][ i ] ) {
        binding = this._delegateFuncs[ delegateQuery ][ evt ][ i ];
        
        // save the length of the events for the delegateQuery stack
        preRemoveLen = this._delegateFuncs[ delegateQuery ][ evt ][ i ].length;
        this._off({
            events : evt,
            delegateQuery : delegateQuery,
            callback : binding.func,
            context : binding.context
        });
        
        // test if an unbind did occur, and if not, we'll add one to 'i' to continue looking for new events
        // if it has changed, we want to keep the current idx because the array has already shifted
        if ( this._delegateFuncs[ delegateQuery ][ evt ] && preRemoveLen === this._delegateFuncs[ delegateQuery ][ evt ].length ) {
            i++;
        }
    }

     binding = preRemoveLen = null;
};

proto._unregisterDelegateFuncsByEvent = function( evt ) {
    var i;
    // for each delegate query
    for ( i in this._delegateFuncs ) {
        if ( this._delegateFuncs.hasOwnProperty( i ) ) {
             this._unregisterDelegateFuncs( evt, i );
        }
    }
};

proto._delegateFunc = function( evt, delegateQuery, callback, context, e ) {
    // it's possible that a user has interacted with an element nested below a delegate target
    // in this case, we check to see if any nodes between the target and this.el match the delegate query
    // this is important because we'll miss a large amount of matching event triggers otherwise
    if ( this._targetHasDelegateAncestor( e.target, delegateQuery ) ) {

        var args = Array.prototype.slice.call( arguments, 0 ),
            // remove the four arguments we added ourselves
            unboundArgs = args.slice( 4, args.length );

        context = context || window;
        // if it was a CustomEvent, just get the event data and ignore the rest from the DOM
        if ( typeof e.detail === 'object' ) {
            unboundArgs[ 0 ] = e.detail;
        }
        // call the callback with the natural arguments, minus the three we added ourselves
        callback.apply( context, unboundArgs );
    }
};

proto._targetHasDelegateAncestor = function( target, delegateQuery ) {
    var ancestor = target;
    while( ancestor && ancestor !== this.el && ancestor !== document.documentElement ) {

        if ( ac_dom_traversal.matchesSelector( ancestor, delegateQuery ) ) {
            return true;
        }
        ancestor = ancestor.parentNode;

    }

    return false;
};

proto._on = function( binding ) {
    var evts = binding.events,
        callback = binding.callback,
        delegateQuery = binding.delegateQuery,
        context = binding.context,
        unboundCallback = binding.unboundCallback || callback;

    evts = this._parseEventNames( evts );
    evts.forEach( function( callback, unboundCallback, context, delegateQuery, evt ) {

        if ( !this.has( evt ) ) {
            this._setListener( evt );
        }

        // if this should be delegated, register a delegationFunc for it
        if ( typeof delegateQuery === 'string' ) {
            callback = this._registerDelegateFunc( evt, delegateQuery, callback, unboundCallback, context );
        }

         this._triggerInternalEvent( 'willon', {
            evt : evt,
            callback : callback,
            context : context,
            delegateQuery : delegateQuery
        });

        this._eventEmitter.on( evt, callback, context );
       
        this._triggerInternalEvent( 'didon', {
            evt : evt,
            callback : callback,
            context : context,
            delegateQuery : delegateQuery
        });

    }.bind( this, callback, unboundCallback, context, delegateQuery ));

    evts = callback = unboundCallback = delegateQuery = context = null;
};

proto._off = function( binding ) {
    var evts = binding.events,
        callback = binding.callback,
        delegateQuery = binding.delegateQuery,
        context = binding.context,
        unboundCallback = binding.unboundCallback || callback;

     // Handle unbinding all events ( this.off(); )
    if ( typeof evts === 'undefined' ) {
        this._eventEmitter.off();

        // for each event, unbind it
        var i;
        for ( i in this._bindings ) {
            if ( this._bindings.hasOwnProperty( i ) ) {
                this._removeListener( i );
            }
        }

        // for each event in the _delegateFuncs, remove them
        for ( i in this._delegateFuncs ) {
            if ( this._delegateFuncs.hasOwnProperty( i ) ) {
                this._delegateFuncs[ i ] = null;
            }
        }
        return;
    }

    evts = this._parseEventNames( evts );
    evts.forEach( function( callback, unboundCallback, context, delegateQuery, evt ) {

        // if this should be delegated, register a delegationFunc for it
        if ( typeof delegateQuery === 'string' && typeof unboundCallback === 'function' ) {
            callback = this._unregisterDelegateFunc( evt, delegateQuery, unboundCallback, context );
            // if a callback isn't found here, it means that the query was incorrect.
            // this could cause some issues if we let it continue, so we'll return false here
            if ( !callback ) {
                return;
            }
        }

        // if a delegate string was added, but no callback was given, it's essentially .off() just for that query
        if ( typeof delegateQuery === 'string' && typeof callback === 'undefined' ) {
            // we'll iterate over each one and unbind them seperately
            this._unregisterDelegateFuncs( evt, delegateQuery );
            return;
        }

        // if an event was called, with no other params, we want to make sure we remove related delegateBindings from memory too
        if ( typeof evt === 'string' && typeof callback === 'undefined' ) {
            this._unregisterDelegateFuncsByEvent( evt );
            // don't continue here if we had a delegate query, since it will run through this again with correct params
            if ( typeof delegateQuery === 'string' ) {
                return;
            }
        }

        this._triggerInternalEvent( 'willoff', {
            evt : evt,
            callback : callback,
            context : context,
            delegateQuery : delegateQuery
        });

        this._eventEmitter.off( evt, callback, context );
        
        this._triggerInternalEvent( 'didoff', {
            evt : evt,
            callback : callback,
            context : context,
            delegateQuery : delegateQuery
        });

        // for specific events
        if ( !this.has( evt ) ) {
            this._removeListener( evt );
        }
            
    }.bind( this, callback, unboundCallback, context, delegateQuery ));

    evts = callback = unboundCallback = delegateQuery = context = null;
};

proto._once = function( binding ) {
    var evts = binding.events,
        callback = binding.callback,
        delegateQuery = binding.delegateQuery,
        context = binding.context;

    evts = this._parseEventNames( evts );
    evts.forEach( function( callback, context, delegateQuery, evt ) {

        // .once() on a delegate is tricky, because it needs to stay bound until it triggers the callback on the delegate, not this.el
        if ( typeof delegateQuery === 'string' ) {
            // to handle this, it's easiest to polyfill a delegate's .once() on our own
            return this._handleDelegateOnce( evt, callback, context, delegateQuery );
        }
        
        if ( !this.has( evt ) ) {
            this._setListener( evt );
        }

        this._triggerInternalEvent( 'willonce', {
            evt : evt,
            callback : callback,
            context : context,
            delegateQuery : delegateQuery
        });

        // we can trick EventEmitter with .call here, where when it calls .on() internally, it call this.on() instead
        this._eventEmitter.once.call( this, evt, callback, context );
        
        this._triggerInternalEvent( 'didonce', {
            evt : evt,
            callback : callback,
            context : context,
            delegateQuery : delegateQuery
        });

    }.bind( this, callback, context, delegateQuery ));

    evts = callback = delegateQuery = context = null;
};

proto._handleDelegateOnce = function( evt, callback, context, delegateQuery ) {
    this._triggerInternalEvent( 'willonce', {
        evt : evt,
        callback : callback,
        context : context,
        delegateQuery : delegateQuery
    });

    // bind the event with a naturalCallback so we can match correctly
    this._on({
        events: evt,
        context : context,
        delegateQuery: delegateQuery,
        callback: this._getDelegateOnceCallback.bind( this, evt, callback, context, delegateQuery ),
        unboundCallback: callback
    });

    this._triggerInternalEvent( 'didonce', {
        evt : evt,
        callback : callback,
        context : context,
        delegateQuery : delegateQuery
    });

    return this;
};

proto._getDelegateOnceCallback = function( evt, callback, context, delegateQuery ) {
    // there could be any number of arguments, so we'll get them all
    var args = Array.prototype.slice.call( arguments, 0 ),
        // strip the args we added ourselves
        passedArgs = args.slice( 4, args.length );
    // if context, call the callback with the context given and the args
    callback.apply( context, passedArgs );
    // unbind the event after it was called with this.off();
    this._off({
        events : evt,
        delegateQuery : delegateQuery,
        callback : callback,
        context : context 
    });
};

proto._getDelegateFuncBindingIdx = function( evt, delegateQuery, unboundCallback, context, ignoreFuncMatch ) {
    var idx = -1;

    if ( this._delegateFuncs[ delegateQuery ] && this._delegateFuncs[ delegateQuery ][ evt ] ) {
        var i,
            bindingObj,
            len = this._delegateFuncs[ delegateQuery ][ evt ].length;
        for ( i = 0; i < len; i++ ) {
            bindingObj = this._delegateFuncs[ delegateQuery ][ evt ][ i ];

            // sometimes we want to match on whether or not the callback is defined, specifically for .has()
            if ( ignoreFuncMatch && typeof unboundCallback === 'undefined' ) {
                unboundCallback = bindingObj.func;
            }

            if ( bindingObj.func === unboundCallback && bindingObj.context === context ) {
                idx = i;
                break;
            }
        }
    }

    return idx;
};

proto._triggerDOMEvents = function( evt, data, delegateQuery ) {
    var targets = [ this.el ];

    if ( delegateQuery ) {
        targets = ac_dom_traversal.querySelectorAll( delegateQuery, this.el );
    }

    var i,
        target,
        len = targets.length;
    for ( i = 0; i < len; i++ ) {
        ac_dom_events.dispatchEvent( targets[ i ], evt, {
            bubbles : true,
            cancelable : true,
            detail : data
        });
    }
};

module.exports = DOMEmitter;
},{"./DOMEmitterEvent":1090,"ac-dom-events":1036,"ac-dom-traversal":1069,"ac-event-emitter":1091}],1090:[function(require,module,exports){
'use strict';

var ac_dom_events = require('ac-dom-events');

var proto;

var DOMEmitterEvent = function( eventData, domEmitter ) {
	this._domEmitter = domEmitter;
    this.originalEvent = eventData || {};
    
    this._originalTarget = ac_dom_events.target( this.originalEvent );
	this.target = this._originalTarget || this._domEmitter.el;
	this.currentTarget = this._domEmitter.el;
	this.timeStamp = this.originalEvent.timeStamp || Date.now();

    // set event data if needed
    if ( this._isDOMEvent( this.originalEvent ) ) {

        // if event data was set, save it to result.data
        if ( typeof this.originalEvent.detail === 'object' ) {
            this.data = this.originalEvent.detail;
        }

    } else if ( eventData ) {
        // if this is a custom event, the data is the whole event
        this.data = this.originalEvent;
        this.originalEvent = {};
    }
};

proto = DOMEmitterEvent.prototype;

proto.preventDefault = function() {
    ac_dom_events.preventDefault( this.originalEvent );
};

proto.stopPropagation = function() {
    ac_dom_events.stopPropagation( this.originalEvent );
};

proto.stopImmediatePropagation = function() {
    if ( this.originalEvent.stopImmediatePropagation ) {
        this.originalEvent.stopImmediatePropagation();
    }
    // stop the eventEmitter from running future callbacks as well
    this._domEmitter.stopImmediatePropagation();
};

proto._isDOMEvent = function( e ) {
    // This could be better, however it's not a terrible solution since ( target || srcElement ) should handle all cases
    if ( this._originalTarget || ( document.createEvent !== 'undefined' && typeof CustomEvent !== 'undefined' && e instanceof CustomEvent ) ) {
        return true;
    }
    return false;
};

module.exports = DOMEmitterEvent;
},{"ac-dom-events":1036}],1091:[function(require,module,exports){
arguments[4][135][0].apply(exports,arguments)
},{"./ac-event-emitter/EventEmitter":1092,"dup":135}],1092:[function(require,module,exports){
arguments[4][136][0].apply(exports,arguments)
},{"dup":136}],1093:[function(require,module,exports){
arguments[4][139][0].apply(exports,arguments)
},{"./ac-window-delegate/WindowDelegate":1096,"./ac-window-delegate/WindowDelegateCustomEvent":1097,"./ac-window-delegate/WindowDelegateOptimizer":1098,"dup":139}],1094:[function(require,module,exports){
arguments[4][140][0].apply(exports,arguments)
},{"ac-event-emitter":1091,"dup":140}],1095:[function(require,module,exports){
arguments[4][141][0].apply(exports,arguments)
},{"ac-event-emitter":1091,"dup":141}],1096:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

var proto;

var SharedInstance = require('ac-shared-instance').SharedInstance,
	DOMEmitter = require('ac-dom-emitter').DOMEmitter,
	OptimizerController = require('./OptimizerController'),
	CustomEventController = require('./CustomEventController'),
	queries = require('./queries/queries'),
	optimizers = require('./optimizers/optimizers');

var sharedInstanceName = 'ac-window-delegate:WindowDelegate',
	sharedInstanceVersion = '3.0.0-4';

/**
 * @name .WindowDelegate
 * @class WindowDelegate
 * <pre>WindowDelegate = require('/WindowDelegate');</pre>
 */
function WindowDelegate() {

	this._emitter = new DOMEmitter( window );
	this._controllers = {
		optimizer : new OptimizerController( optimizers ),
		customEvent : new CustomEventController()
	};

	// Set property queries dynamically
	var i;
	for ( i in queries ) {
		if ( queries.hasOwnProperty( i ) ) {
			// Set instance functions for getting each poperty
			this[ i ] = this._getProperty.bind( this, i ); 
			// Override query functions to bind to WindowDelegate
			queries[ i ] = queries[ i ].bind( this );
		}
	}

	this._bindEvents();
}

proto = WindowDelegate.prototype;

/* Event Emitter Delegation */

proto.on = function( evts, callback, context ) {
	var evtsObj = this._seperateCustomEvents( evts );
	this._optimizeEvents( evtsObj.standardEvents );
	this._customEventOn( evtsObj.customEvents, callback, context );
	this._emitterOn.apply( this, arguments );
	return this;
};

proto.once = function( evts, callback, context ) {
	var evtsObj = this._seperateCustomEvents( evts );
	this._optimizeEvents( evtsObj.standardEvents );
	this._customEventOnce( evtsObj.customEvents, callback, context );
	this._emitterOnce.apply( this, arguments );
	return this;
};

proto.off = function( evts, callback, context ) {
	var evtsObj = this._seperateCustomEvents( evts ),
		force = false;

	if ( !evts ) {
		force = true;
	}

	this._customEventOff( evtsObj.customEvents, callback, context, force );
	this._emitterOff.apply( this, arguments );

	/* If no arguments are passed, we have to assume that all events from windowEmitter have been removed.
	 * In this case, we have to rebind our internal events after this fact and assume they didn't fire.
	 * A try/catch makes sense here in case .destroy() was called, in which case it would fail.
	 */
	if ( force ) {
		try {

			// Deoptimize all events
			var evt;
			for ( evt in this._controllers.optimizer._events ) {
				if ( this._controllers.optimizer._events.hasOwnProperty( evt ) && this._shouldDeoptimizeEvent( evt, true ) ) {
					this._deoptimizeEvent( evt );
				}
			}

			// Rebind internal events
			this._bindEvents();
		} catch( e ) {}
	}

	return this;
};

proto.has = function( evt, callback, context ) {
	return this._emitter.has.apply( this._emitter, arguments );
};

proto.trigger = function() {
	this._emitter.trigger.apply( this._emitter, arguments );
	return this;
};

proto.emitterTrigger = function() {
	this._emitter.emitterTrigger.apply( this._emitter, arguments );
	return this;
};

proto.propagateTo = function() {
	this._emitter.propagateTo.apply( this._emitter, arguments );
	return this;
};

proto.stopPropagatingTo = function() {
	this._emitter.stopPropagatingTo.apply( this._emitter, arguments );
	return this;
};

proto.addOptimizer = function( optimizer ) {
	this._controllers.optimizer.add( optimizer );
	return this;
};

proto.addCustomEvent = function( customEvent ) {
	this._controllers.customEvent.add( customEvent );
	return this;
};

proto._emitterOn = function() {
	this._emitter.on.apply( this._emitter, arguments );
};

proto._emitterOnce = function() {
	this._emitter.once.apply( this._emitter, arguments );
};

proto._emitterOff = function() {
	this._emitter.off.apply( this._emitter, arguments );
};

proto._onEventUnbound = function( e ) {
	var evt = e.data.evt;

	if ( this._shouldDeoptimizeEvent( evt ) ) {
		this._deoptimizeEvent( evt );
	}
};

proto._customEventOn = function( evtsArr, callback, context ) {
	if ( evtsArr.length === 0 ) {
		return;
	}
	this._controllers.customEvent.on( evtsArr.join(' '), callback, context );
};

proto._customEventOnce = function( evtsArr, callback, context ) {
	if ( evtsArr.length === 0 ) {
		return;
	}
	this._controllers.customEvent.once( evtsArr.join(' '), callback, context );
};

proto._customEventOff = function( evtsArr, callback, context, force ) {
	if ( !force && evtsArr.length === 0 ) {
		return;
	}

	// handle the WindowDelegate.off() (no args) scenario
	if ( force && evtsArr.length === 0 ) {
		this._controllers.customEvent.off();
		return;
	}

	this._controllers.customEvent.off( evtsArr.join(' '), callback, context );
};

/* WindowDelegate specific functionality */

proto._getProperty = function( prop, forceQuery ) {
	var value = null;

	if ( !forceQuery ) {
		value = this._getOptimizedValue( prop );
	}

	if ( value === null ) {
		value = queries[ prop ].call( this, forceQuery );
	}

	return value;
};

proto._optimizeEvents = function( evts ) {
	var evt,
		i,
		len = evts.length;
	for ( i = 0; i < len; i++ ) {
		evt = evts[ i ];
		if ( this._shouldOptimizeEvent( evt ) ) {
			this._optimizeEvent( evt );
		}
	}
};

proto._shouldOptimizeEvent = function( evt ) {
	if ( this._controllers.optimizer.canOptimizeEvent( evt ) && !this._controllers.optimizer.isOptimizingEvent( evt ) ) {
		return true;
	}
	return false;
};

proto._shouldDeoptimizeEvent = function( evt, force ) {
	// if we know we have one event bound (the optimization) and that's all that's left to be fired, we'll remove it
	if ( this._controllers.optimizer.isOptimizingEvent( evt ) && ( force || this._emitter._eventEmitter._events[ evt ].length <= 1 ) ) {
		return true;
	}
	return false;
};

proto._optimizeEvent = function( evt ) {
	var optimizer = this._controllers.optimizer.getOptimizerByEvent( evt );
	optimizer.activate();
	this._emitterOn( evt, optimizer.callback, optimizer );
};

proto._deoptimizeEvent = function( evt ) {
	var optimizer = this._controllers.optimizer.getOptimizerByEvent( evt );
	optimizer.deactivate();
	this._emitterOff( evt, optimizer.callback, optimizer );
};

proto._getOptimizedValue = function( prop ) {
	return this._controllers.optimizer.get( prop );
};

proto._seperateCustomEvents = function( evtString ) {

	var result = {
		customEvents : [],
		standardEvents : []
	};

	if( typeof evtString === 'string' ) {
		var evtsArray = evtString.split(' '),
			evt,
			i,
			len = evtsArray.length;
		for ( i = 0; i < len; i++ ) {
			evt = evtsArray[ i ];
			if ( this._controllers.customEvent.canHandleCustomEvent( evt ) ) {
				result.customEvents.push( evt );
			} else {
				result.standardEvents.push( evt );
			}
		}
	}

	return result;
};

proto._bindEvents = function() {
	// Bind to DOMEmitter's internal 'off' event to help us determine if we should remove optimizations
	this._emitter.on( 'dom-emitter:didoff', this._onEventUnbound, this );
};

module.exports = SharedInstance.share( sharedInstanceName, sharedInstanceVersion, WindowDelegate );
},{"./CustomEventController":1094,"./OptimizerController":1095,"./optimizers/optimizers":1101,"./queries/queries":1110,"ac-dom-emitter":1088,"ac-shared-instance":1031}],1097:[function(require,module,exports){
arguments[4][143][0].apply(exports,arguments)
},{"ac-event-emitter":1091,"dup":143}],1098:[function(require,module,exports){
arguments[4][144][0].apply(exports,arguments)
},{"ac-event-emitter":1091,"dup":144}],1099:[function(require,module,exports){
arguments[4][145][0].apply(exports,arguments)
},{"../../WindowDelegateOptimizer":1098,"../../queries/queries":1110,"dup":145}],1100:[function(require,module,exports){
arguments[4][146][0].apply(exports,arguments)
},{"../../WindowDelegateOptimizer":1098,"../../queries/queries":1110,"dup":146}],1101:[function(require,module,exports){
arguments[4][147][0].apply(exports,arguments)
},{"./events/resize":1099,"./events/scroll":1100,"dup":147}],1102:[function(require,module,exports){
arguments[4][148][0].apply(exports,arguments)
},{"dup":148}],1103:[function(require,module,exports){
arguments[4][149][0].apply(exports,arguments)
},{"dup":149}],1104:[function(require,module,exports){
arguments[4][150][0].apply(exports,arguments)
},{"dup":150}],1105:[function(require,module,exports){
arguments[4][151][0].apply(exports,arguments)
},{"dup":151}],1106:[function(require,module,exports){
arguments[4][152][0].apply(exports,arguments)
},{"dup":152}],1107:[function(require,module,exports){
arguments[4][153][0].apply(exports,arguments)
},{"dup":153}],1108:[function(require,module,exports){
arguments[4][154][0].apply(exports,arguments)
},{"dup":154}],1109:[function(require,module,exports){
arguments[4][155][0].apply(exports,arguments)
},{"dup":155}],1110:[function(require,module,exports){
arguments[4][156][0].apply(exports,arguments)
},{"./methods/clientHeight":1102,"./methods/clientWidth":1103,"./methods/innerHeight":1104,"./methods/innerWidth":1105,"./methods/maxScrollX":1106,"./methods/maxScrollY":1107,"./methods/scrollX":1108,"./methods/scrollY":1109,"dup":156}],1111:[function(require,module,exports){
arguments[4][988][0].apply(exports,arguments)
},{"./ac-viewport/Viewport":1112,"dup":988}],1112:[function(require,module,exports){
/** 
 * @copyright 2014 Apple Inc. All rights reserved.
 */
'use strict';

var SharedInstance = require('ac-shared-instance').SharedInstance,
	WindowDelegate = require('ac-window-delegate').WindowDelegate,
	BreakpointsDelegate = require('ac-breakpoints-delegate').BreakpointsDelegate;

var sharedInstanceName = 'ac-viewport:Viewport',
	sharedInstanceVersion = '3.0.0-1';

var proto;

/**
 * @name module:ac-viewport.Viewport
 * @class
 * 
 * @desc Composite object of WindowDelegate and BreakpointsDelegate for viewport-level data and events
 * 
 * @param {Object} [options]
 *        Options to initialize the instance with
 */
function Viewport(options) {
	// The majority of functionality is delegated to WindowDelegate, so we extend from that to start
	var prop,
		baseObj = WindowDelegate;
	for ( prop in baseObj ) {
		// Extend instance properties
		if ( baseObj.hasOwnProperty( prop ) )  {
			this[ prop ] = baseObj[ prop ];
		} else {
			// Extend prototypes
			proto[ prop ] = baseObj[ prop ];
		}
	}

	// Extend support for 'breakpoint' events
	this.addCustomEvent( BreakpointsDelegate.getCustomEvent() );
}

proto = Viewport.prototype;

proto.getBreakpoint = function() {
	return BreakpointsDelegate.getBreakpoint();
};

proto.setBreakpoints = function( breakpoints ) {
	return BreakpointsDelegate.setBreakpoints( breakpoints );
};

module.exports = SharedInstance.share( sharedInstanceName, sharedInstanceVersion, Viewport );
},{"ac-breakpoints-delegate":1029,"ac-shared-instance":1031,"ac-window-delegate":1093}],1113:[function(require,module,exports){
/*global require, module */
'use strict';

var ac_dom_events = require('ac-dom-events'),
	ac_domTraversal = require('ac-dom-traversal');

var Clip = require('ac-eclipse').Clip,
	elmBoundingBox = require('ac-dom-metrics/utils').getBoundingClientRect,
	setStyle = require('ac-dom-styles/setStyle'),
	Viewport = require('ac-viewport').Viewport;

// If JS is disabled expected behavior:
// Text nav is centered in the navigation container.
// If text is larger than the nav container, the container is scrollable, but items will not center on selection.
var centerScrollNav = {

	_setEndTriggerCenters : function (navContainerElm, firstNavItemElm, lastNavItemElm) {
		var navContainerElmCenter = elmBoundingBox(navContainerElm).width / 2;

		var firstTriggerElm = ac_domTraversal.firstChild(firstNavItemElm),
			firstTriggerCenter = elmBoundingBox(firstTriggerElm).width / 2,
			firstTriggerCenterDif = Math.round(navContainerElmCenter - firstTriggerCenter);

		var lastTriggerElm = ac_domTraversal.firstChild(lastNavItemElm),
			lastTriggerCenter = elmBoundingBox(lastTriggerElm).width / 2,
			lastTriggerCenterDif = Math.round(navContainerElmCenter - lastTriggerCenter);

		setStyle(firstNavItemElm, {
			paddingLeft : firstTriggerCenterDif + 'px'
		});

		setStyle(lastNavItemElm, {
			paddingRight : lastTriggerCenterDif + 'px'
		});
	},

	_resetEndTriggers : function (firstNavItem, lastNavItem) {
		setStyle(firstNavItem, {
			paddingLeft : 0 + 'px'
		});

		setStyle(lastNavItem, {
			paddingRight : 0 + 'px'
		});
	},

	_centerCurrentTrigger : function (navContainerElm, targetTriggerElm, orientChangeBool) {
		var navContainerBoundingRect = elmBoundingBox(navContainerElm),
			navContainerViewCenter = (navContainerBoundingRect.width / 2) + navContainerBoundingRect.left;

		var currentTriggerCenter = (elmBoundingBox(targetTriggerElm).width / 2) + elmBoundingBox(targetTriggerElm).left,
			currentTriggerCenterDif = Math.round(currentTriggerCenter - navContainerViewCenter);

		var navScrollLeftCurrentPos = navContainerElm.scrollLeft,
			navScollLeftNewPos = navScrollLeftCurrentPos + currentTriggerCenterDif;

		var centerAnimation;

		if(orientChangeBool){

			navContainerElm.scrollLeft = navScollLeftNewPos;

		} else {

			centerAnimation = new Clip({scroll : navScrollLeftCurrentPos}, 0.5, {scroll : navScollLeftNewPos}, {
				onDraw : function (evt) {
					navContainerElm.scrollLeft = evt.target.scroll;
				}
			}).play();

			centerAnimation.on('complete', function () {
				centerAnimation.destroy();
			});

		}
	},

	centerGalleryTriggers : function (galleryObj, navContainerClassName) {
		var navContainer = ac_domTraversal.querySelector('.' + navContainerClassName),
			navList = ac_domTraversal.firstChild(navContainer),
			firstNavItem = ac_domTraversal.firstChild(navList),
			lastNavItem = ac_domTraversal.lastChild(navList),
			currentTriggerElm;

		galleryObj.on('ready', function () {

			currentTriggerElm = ac_domTraversal.querySelector('.current');

		}.bind(this));
		//Ensure we are only centering the end triggers if viewport is small and not in landscape
		if(Viewport.getBreakpoint().name === 'small' && Math.abs(window.orientation) !== 90) {
			this._setEndTriggerCenters(navContainer, firstNavItem, lastNavItem);
		}

		galleryObj.on('willShow', function (evt) {

				currentTriggerElm = evt.interactionEvent.target;
			//Ensure we are only centering the current trigger if viewport is small and not in landscape
			if(Viewport.getBreakpoint().name === 'small' && Math.abs(window.orientation) !== 90) {
				this._centerCurrentTrigger(navContainer, currentTriggerElm, false);
			}

		}.bind(this));


		ac_dom_events.addEventListener(window, 'orientationchange', function () {
			//Reset to static trigger view if viewport is larger than small or in landscape orientation.
			if(Viewport.getBreakpoint().name !== 'small' || Math.abs(window.orientation) === 90){
				this._resetEndTriggers(firstNavItem, lastNavItem);
			} else {
				navContainer.scrollLeft = 0;
				this._setEndTriggerCenters(navContainer, firstNavItem, lastNavItem);
				this._centerCurrentTrigger(navContainer, currentTriggerElm, true);
			}
		}.bind(this));
	}
};

module.exports = centerScrollNav;
},{"ac-dom-events":65,"ac-dom-metrics/utils":157,"ac-dom-styles/setStyle":172,"ac-dom-traversal":178,"ac-eclipse":269,"ac-viewport":1111}],1114:[function(require,module,exports){
/*global require, module */
'use strict';

var ac_domTraversal = require('ac-dom-traversal'),
	ac_gallery = require('ac-gallery');

var FadeGallery = ac_gallery.FadeGallery;

var spotlightGallery = {
	createGallery : function () {
		var galleryId = 'gallery-spotlight',
			viewfinder = document.getElementById(galleryId),
			viewElms;

		if(viewfinder){
			viewElms = ac_domTraversal.querySelectorAll('.ac-gallery-content', viewfinder);

			return FadeGallery.create({
				id : galleryId,
				el : viewfinder,
				model : viewElms,
				triggerSelector : '.trigger-spotlight'
			});
		} else {
			return viewfinder;
		}
	}
};

module.exports = spotlightGallery;
},{"ac-dom-traversal":178,"ac-gallery":660}],1115:[function(require,module,exports){
/*global require, module */
'use strict';

var spotlightGallery    = require('./galleries/spotlight-gallery');
var centerScrollNav     = require('./galleries/spotlight-center-gallery-scrollNav');
var RenderPlayerFactory = require('./shared/RenderPlayerFactory');
var ac_browser          = require('ac-browser');
var ac_feature          = require('ac-feature');
var Main = (function() {

	return {

		initialize: function() {
			var macSpotlightGallery = spotlightGallery.createGallery();

			// only enable for desktop currently
			if (ac_feature.isDesktop()) {
				RenderPlayerFactory.init();
			}

			if (macSpotlightGallery && (!ac_browser.IE || ac_browser.IE.documentMode > 8)) {
				centerScrollNav.centerGalleryTriggers(macSpotlightGallery, 'textnav');
			}

			return this;
		}
	};

}());

module.exports = Main.initialize();

},{"./galleries/spotlight-center-gallery-scrollNav":1113,"./galleries/spotlight-gallery":1114,"./shared/RenderPlayerFactory":1116,"ac-browser":49,"ac-feature":399}],1116:[function(require,module,exports){
'use strict';

var ac_dom_traversal    = require('ac-dom-traversal');
var ac_classlist_remove = require('ac-classlist/remove');
var generateMediaObject = require('./RenderPlayerFactory/generateMediaObject');
var renderConfigs       = require('./RenderPlayerFactory/renderConfigs');
var ReplayRender        = require('./RenderPlayerFactory/ReplayRender');

var DATA_ATTR           = 'data-renderplayer';
var players;

var initRenderPlayerFromContainer = function(container) {
	var src          = container.getAttribute(DATA_ATTR);
	var locale       = container.getAttribute(DATA_ATTR + '-locale') || 'us';
	var config       = renderConfigs[src];
	var player       = null;
	var queueLoading = true;

	var playerOptions;
	var mediaObjectOptions;
	var mediaObject,
		resizable,
		replayable,
		viewportSize;

	if (config) {

		if (config.replayable) {
			replayable = config.replayable || false;
		}

		if (typeof config.factory !== 'function') {
			throw 'RenderPlayerFactory: No factory method assigned to render `' + src + '`';
		}

		//If there is no priority set, then queueLoading does not need to be used. This is for the Click to Play controller
		if (!config.priority) {
			queueLoading = false;
		}

		if (config.playerOptions) {
			playerOptions = config.playerOptions || {};
		}

		if (config.mediaObjectOptions){
			mediaObjectOptions = config.mediaObjectOptions || {};
		}

		if (config.size) {
			viewportSize = config.size.replace('_2x', '');
		}

		for (var breakpoint in config.staticBreakpoints) {
			if(config.staticBreakpoints[breakpoint] === viewportSize) {
				return;
			}
		}

		mediaObject = generateMediaObject(container, locale, src, config.type, config.size, config.priority, !!config.keyframes, !!config.loop, mediaObjectOptions, queueLoading);
		player      = config.factory(mediaObject, playerOptions);

	} else {
		throw 'RenderPlayerFactory: No config found for render `' + src + '`';
	}

	return {
		'container': container,
		'replayable': replayable,
		'player': player,
		'mediaObject': mediaObject,
		'size': viewportSize
	};
};

function stopRender(render) {
	ac_classlist_remove(render.container, 'mediaObject-playing');
}

module.exports = {
	init: function init() {
		var renderPlayerContainers = ac_dom_traversal.querySelectorAll('[' + DATA_ATTR + ']');

		players = renderPlayerContainers.map(initRenderPlayerFromContainer);

		for (var i = 0; i < players.length; i++){
			if (players[i]) {
				if (players[i].mediaObject) {
					players[i].mediaObject.on('stop', stopRender, players[i]);
					if (players[i].replayable) {
						new ReplayRender(players[i]);
					}
				}
			}
		}

		return players;
	}
};

},{"./RenderPlayerFactory/ReplayRender":1117,"./RenderPlayerFactory/generateMediaObject":1118,"./RenderPlayerFactory/renderConfigs":1119,"ac-classlist/remove":61,"ac-dom-traversal":178}],1117:[function(require,module,exports){
var ac_Element = require('ac-dom-traversal');
var ac_classList = require('ac-classlist');
var ac_domEvents = require('ac-dom-events');

var ReplayRender = function(render) {
	this.render = render;
	this.triggerAttribute = 'data-renderplayer-trigger';
	this.triggerId = render.container.getAttribute(this.triggerAttribute);
	this.replayBtn = ac_Element.querySelector('#' + this.triggerId);

	this.init();
};

var proto = ReplayRender.prototype;

proto.init = function() {
	this.replayerMediaObj = this.render.mediaObject;
	this.replayerMediaObj.on('ended', this.activate, this);
};

proto.activate = function() {

	var self = this;

	ac_classList.remove(this.replayBtn, 'playing');

	ac_classList.add(this.replayBtn, 'active');
	ac_classList.add(this.render.container, 'replayEnded');

	ac_domEvents.addEventListener(this.replayBtn, 'click', function(e) {
		if (!ac_classList.contains(self.replayBtn, 'playing')) {
			e.preventDefault();
			e.stopPropagation();
			self.replay(self);
		}
	});
};

proto.replay = function(ctx) {

	ctx.replayerMediaObj.reset();
	ctx.replayerMediaObj.play();

	ac_classList.remove(ctx.replayBtn, 'active');
	ac_classList.remove(ctx.render.container, 'replayEnded');

	ac_classList.add(ctx.replayBtn, 'playing');
};

module.exports = ReplayRender;

},{"ac-classlist":60,"ac-dom-events":65,"ac-dom-traversal":178}],1118:[function(require,module,exports){
'use strict';

var ac_MediaObject = require('ac-media-object');
var ac_Browser     = require('ac-browser');
var ac_Object      = require('ac-object');

var jpg = 'jpg';

module.exports = function generateMediaObject(container, locale, src, type, size, priority, keyframes, loop, options, queueLoading) {

	var basePath = ac_MediaObject.cname('/105/media/' + locale + '/osx/2015/c8d04c1b-8035-4a33-9137-a7961fdc3ddc/osx-preview/overview/flows/' + size + '/');

	var mediaSrc = {
		basePath: basePath + type + '/',
		filename: type,
		fileFormat: ((type === 'flow') ? 'jpg' : 'mp4'),
		loop: !!loop
	};

	var defaults = {
		type: type,
		queueLoading: queueLoading,
		loadPriority: priority
	};

	options = ac_Object.defaults(defaults, options || {});

	if (keyframes) {
		if (ac_Browser.name === 'Safari' && type === 'h264') {
			mediaSrc.posterframeSrc = basePath + 'h264/h264_startframe.' + jpg;
			mediaSrc.endstateSrc    = basePath + 'h264/h264_endframe.' + jpg;
		} else {
			mediaSrc.posterframeSrc = basePath + 'flow/flow_startframe.' + jpg;
			mediaSrc.endstateSrc    = basePath + 'flow/flow_endframe.' + jpg;
		}
	}

	var mediaObject = ac_MediaObject.create(container, mediaSrc, options);

	return mediaObject;
};

},{"ac-browser":49,"ac-media-object":770,"ac-object":790}],1119:[function(require,module,exports){
'use strict';

var experienceReport  = require('../experience-report.js');
var RenderPlayer      = require('ac-renderplayer');
var glancesExperience = experienceReport.ambient.experienceObject.platform === 'tablet' ? 'static' : experienceReport.ambient.experience;

module.exports = {

	'overview/predictive-typer': {
		factory: RenderPlayer.createAmbient,
		type: 'flow',
		size: experienceReport.sizes.experience,
		priority: 1,
		keyframes: false,
		replayable: false,
		mediaObjectOptions: {
			frameRate: 30
		},
		playerOptions: {
			degradeOnBreakpointChange: true,
			degradeAfterPlayed: false
		}
	}

};

},{"../experience-report.js":1121,"ac-renderplayer":990}],1120:[function(require,module,exports){
module.exports={
  "ambient": [
    {
      "platform": "desktop",
      "browser": "safari",
      "type": "flow"
    },
    {
      "platform": "desktop",
      "browser": "chrome",
      "type": "flow"
    },
    {
      "platform": "desktop",
      "browser": "firefox",
      "type": "flow"
    },
    {
      "platform": "desktop",
      "browser": "ie",
      "browser_version": 9,
      "type": "flow"
    },
    {
      "platform": "tablet",
      "browser": "safari mobile",
      "type": "flow"
    },
    {
      "platform": "handheld",
      "browser": "safari mobile",
      "type": "flow"
    }
  ],
  "scrollable": [
    {
      "platform": "desktop",
      "browser": "safari",
      "type": "h264"
    },
    {
      "platform": "desktop",
      "browser": "chrome",
      "type": "h264"
    },
    {
      "platform": "desktop",
      "browser": "firefox",
      "type": "h264"
    },
    {
      "platform": "desktop",
      "browser": "ie",
      "browser_version": 9,
      "type": "h264"
    },
    {
      "platform": "tablet",
      "browser": "safari mobile",
      "browser_version": 8,
      "type": "flow"
    },
    {
      "platform": "handheld",
      "browser": "safari mobile",
      "browser_version": 8,
      "type": "flow"
    }
  ],
  "scrubbable": [
    {
      "platform": "desktop",
      "browser": "safari",
      "type": "h264"
    },
    {
      "platform": "desktop",
      "browser": "chrome",
      "type": "h264"
    },
    {
      "platform": "desktop",
      "browser": "firefox",
      "type": "h264"
    },
    {
      "platform": "desktop",
      "browser": "ie",
      "browser_version": 9,
      "type": "h264"
    },
    {
      "platform": "tablet",
      "browser": "safari mobile",
      "type": "flow"
    },
    {
      "platform": "handheld",
      "browser": "safari mobile",
      "type": "flow"
    }
  ],
  "sizes": [
    {
      "retina": true,
      "min_viewport_width": 1069,
      "type": "large_2x"
    },
    {
      "retina": false,
      "min_viewport_width": 1069,
      "type": "large"
    },
    {
      "retina": true,
      "min_viewport_width": 736,
      "type": "medium_2x"
    },
    {
      "retina": false,
      "min_viewport_width": 736,
      "type": "medium"
    }
  ]
}

},{}],1121:[function(require,module,exports){
(function () {
	'use strict';

	var ac_ExperienceReporter = require('ac-experience-reporter');
	var experienceData        = require('./asset-type-matrix.json');

	function buildExperienceObject () {
		var experienceObj = {};

		Object.keys(experienceData).forEach(function (dataset) {
			experienceObj[dataset] = ac_ExperienceReporter.newExperience(experienceData[dataset]);
		});

		return experienceObj;
	}

	module.exports = buildExperienceObject();

}());

},{"./asset-type-matrix.json":1120,"ac-experience-reporter":392}]},{},[1115]);
