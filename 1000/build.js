function Singleton(){return compose(_.toArray(arguments),{},!0)}function Composition(){var e=_.toArray(arguments),t=_.isFunction(e[e.length-1])?{}:e.pop();return compose(e,t,!1)}function compose(e,t,r){function i(){v=arguments,c.forEach(o,this),P.forEach(a,this)}function a(e){this[e]=this[e].bind(this)}function o(e){e.apply(this,v)}function n(e){if(e=e.slice(0).reverse(),0==e.length)return _.identity;if(1==e.length)return e[0];if(2==e.length){var t=e[0],r=e[1];return function(e,i,a,o,n,s,l,c,p,d,h){t.call(this,e,i,a,o,n,s,l,c,p,d,h),r.call(this,e,i,a,o,n,s,l,c,p,d,h)}}if(3==e.length){var t=e[0],r=e[1],i=e[2];return function(e,a,o,n,s,l,c,p,d,h,g){t.call(this,e,a,o,n,s,l,c,p,d,h,g),r.call(this,e,a,o,n,s,l,c,p,d,h,g),i.call(this,e,a,o,n,s,l,c,p,d,h,g)}}var a=e.pop(),o=e.length;return function(t,r,i,n,s,l,c,p,d,h,g){for(d=0;o>d;d++)e[d].call(this,t,r,i,n,s,l,c,p,d,h,g);a.call(this,t,r,i,n,s,l,c,p,d,h,g)}}for(var s in e){var l=e[s];if(!_.isFunction(l)&&!_.isObject(l))throw new Error("Invalid mixin argument: "+l)}_mixins=e.slice(0),e=e.reverse(),r&&e.forEach(function(t,r){_.isFunction(t)&&(e[r]=t.prototype)});var c=[],p={},d={};for(var h in t)p[h]=p[h]||[],p[h].push(t[h]);for(var s=0,g=e.length;g>s;s++){var u=e[s];if(_.isFunction(u)){for(var h in u.prototype)if("constructor"!=h){try{u.prototype[h]}catch(m){continue}var f=u.prototype[h];_.isFunction(f)&&(p[h]=p[h]||[],p[h].unshift(f))}c.unshift(u)}for(var h in u)if(u.hasOwnProperty(h))if(_.isFunction(u[h])){if("constructor"==h)continue;void 0===d[h]&&(d[h]=[],d[h].__methodList=!0),d[h].push(u[h])}else d[h]=u[h]}_.each(p,function(e,t){var a=r?i:i.prototype;a[t]=n(e)});var v,P=_.keys(p);return Object.defineProperty(r?i:i.prototype,"instanceof",{value:function(e){return e===i?!0:void _mixins.forEach(function(t){return t instanceof e||t===e})}}),_.each(d,function(e,t){i[t]=_.isArray(e)&&e.__methodList?n(e):e}),i}function map(e,t,r,i,a){return i+(a-i)*(e-t)/(r-t)}function lerp(e,t,r){return(t-e)*r+e}function normalize(e,t,r){return(e-t)/(r-t)}function clamp(e,t,r){return Math.max(t,Math.min(r,e))}function cmap(e,t,r,i,a){return lerp(i,a,cnormalize(e,t,r))}function cnormalize(e,t,r){return clamp(normalize(e,t,r),0,1)}function clerp(e,t,r){return clamp(lerp(e,t,r))}function between(e,t){return function(r){return r>=e&&t>r}}function random(e,t){return 1==arguments.length?_.isArray(e)?e[~~(random.generator()*(e.length-1))]:random.generator()*e:2==arguments.length?random.generator()*(t-e)+e:random.generator()}function Jiggler(){this.strength=5,this.mass=6,this.damping=.46,this.value=0,this.target=0,this.velocity=0,this.stopped=!1}function ParticleProxy(e){this.data=e,this.index=Particle.all.length;this.position=new THREE.Vector3,this.scale=new THREE.Vector3(1,1,1);this.tags=[],this.hasTag={},e.tags&&(this.tags=_.filter(tags,function(t,r){return-1!==e.tags.indexOf(r)})),this.tags.length||(this.tags=[tags.none]),this.tags.forEach(function(e){this.hasTag[e.name]=!0},this),this.hoverPosition=new THREE.Vector3,this.tagScale=1,this.scaleJiggler=new Jiggler;var t=lerp(.4,1.5,Math.pow(random(),4));if(this.originalScale=this.scaleJiggler.value=this.scaleJiggler.setTarget(t),this.scaleJiggler.strength=.1,this.scaleJiggler.mass=1,this.scaleJiggler.damping=.25,e.blacklist||(e.blacklist={mobile:!this.hasTag.mobile,iframe:Project.blacklist.iframe.indexOf(e.slug)>=0,e404:Project.blacklist[404].indexOf(e.slug)>=0}),e.blacklist.e404)for(var r in this.hasTag)this.hasTag[r]=!1}function Particle(e){ParticleProxy.call(this,e),Particle.all.push(this),this.proxy=new ParticleProxy(e),this.proxyStart=new ParticleProxy(e),this.proxyEnd=new ParticleProxy(e),this.proxyA=this.proxyStart,this.proxyB=this.proxyEnd,Particle.proxies.push(this.proxy),Particle.proxiesEnd.push(this.proxyEnd),this.pattern=_.min(_.pluck(this.tags,"pattern")),this.color=this.tags[0].color,this.resetColor()}

function fail(){
    //trackEvent("summary","errorpage"),
    fallback.className="fail",
    fallback.style.display="block",
    loader.style.display="none"
}
function start(){
    fallback.style.display="none",
    master.style.display="block",
    Assets.load({ files:ASSETS,basePath:ASSETS_BASE_PATH}).then(init)
}
function init(){
    _.extend(Project,Assets("data/experiments.json")),
    codeMirrorLoaded.then(initEditor),
    loadCodeMirror(),
    initTags(),
    initThree(),
    updateFrustumSlice(),
    Particle.init(),
    initListeners(),
    animate()
}
    function initListeners(){canvas.addEventListener("mousemove",onMouseMove,!1),window.addEventListener("resize",onResize,!1),window.addEventListener("orientationchange",onResize,!1),document.addEventListener("mouseout",onMouseOut,!1),document.addEventListener("touchmove",function(e){editorActive||e.preventDefault()},!1),canvas.addEventListener("touchstart",preventDefault,!1),canvas.addEventListener("mouseout",onMouseOut,!1),hammer(fullscreen).on("tap",requestFullscreen),hammer(iframeBack).on("tap",closeProject),hammer(tagButton).on("tap",toggleTagList),hammer(editorButton).on("tap",setEditor),hammer(editorReloadButton).on("tap",applyCustomBehavior),hammer(editorCloseButton).on("tap",closeEditor),hammer(bitmapButton).on("tap",setBitmap),hammer(gridButton).on("tap",setGrid),hammer(graphButton).on("tap",setGraph),hammer(tagWrapper).on("tap",function(){_.defer(function(){!tagChanged&&toggleTagList()})}),hammer(tagClear).on("tap",clearFilter),hammer(mobileWarningButton).on("tap",function(){setTag({target:document.getElementById("tag-mobile")})}),hammer(shareFacebook).on("tap",popup("https://www.facebook.com/sharer/sharer.php?u="+Project.url,550,200,"fb")),hammer(shareTwitter).on("tap",popup("https://twitter.com/home?status="+Project.tweet,550,225,"twitter")),hammer(shareGoogle).on("tap",popup("https://plus.google.com/share?url="+Project.url,550,430,"google")),hammer(canvas).on("tap",onTap),hammer(canvas).on("tap panleft panright panup pandown",onMouseMove),hammer(caption).on("tap",onTapCaption),onResize()}function requestFullscreen(){master.requestFullscreen?master.requestFullscreen():master.msRequestFullscreen?master.msRequestFullscreen():master.mozRequestFullScreen?master.mozRequestFullScreen():master.webkitRequestFullscreen&&master.webkitRequestFullscreen()}function initTags(){_.templateSettings={interpolate:/\{\{(.+?)\}\}/g};var e=_.template(tagTemplate);_.each(Project.tags,function(t,r){t=_.defaults(t,tags[r]),tagContainer.innerHTML+=e(t);var i=document.querySelector("#tag-"+t.slug);2236962===t.color.getHex()&&i.classList.add("black")},this),_.each(document.querySelectorAll(".tag"),function(e){hammer(e).on("tap",setTag)})}function initEditor(){editor=CodeMirror.fromTextArea(document.getElementById("editor"),{mode:"text/javascript",theme:"solarized"})}function initThree(){scene=new THREE.Scene,scene.matrixAutoUpdate=!1,camera=new THREE.PerspectiveCamera(75,width/height,1,6e3),camera.position.z=230,renderer=new THREE.WebGLRenderer({antialias:!1,canvas:canvas}),renderer.setClearColor(0,1),renderer.setPixelRatio(PIXEL_RATIO),renderer.shadowMapEnabled=!1,renderer.sortObjects=!1,scene.add(container),plane=new THREE.Mesh(new THREE.PlaneBufferGeometry(600,600,20,20),new THREE.MeshBasicMaterial({color:65280,wireframe:!0})),plane.visible=!1,plane.lookAt(camera.position),scene.add(plane),initGraph()}function initGraph(){scene.add(graphContainer);var e=new THREE.LineBasicMaterial({color:2236962});lineMaterialYear=new THREE.LineBasicMaterial({color:6710886});var t=new Date(Project.DateApprovedFirst),r=new Date(Project.DateApprovedLast),i=t.getMonth()+12*t.getFullYear()-7-12,a=r.getMonth()+12*r.getFullYear()+6+18;lineGeometry=new THREE.Geometry,lineHeight=400,lineGeometry.vertices.push(new THREE.Vector3(0,0,0)),lineGeometry.vertices.push(new THREE.Vector3(0,lineHeight,0));for(var o=ANDROID?3:1,n=i;a>n;n+=o){var s,l=~~(n/12),c=n%12,p=new Date(l,c);if(0===c)s=makeLabel(l,35,7);else{s=new THREE.Object3D;var d=new THREE.Line(lineGeometry,e);d.matrixAutoUpdate=!1,d.updateMatrix(),s.add(d)}s.position.x=GraphBehavior.GetXPosition(p),s.startPosition=new THREE.Vector3,s.startPosition.copy(s.position),s.originalPosition=new THREE.Vector3,s.originalPosition.copy(s.position),graphContainer.add(s),graphLines.push(s)}}function makeLabel(e,t,r){var i=new THREE.Object3D,a=makeLabelSprite(e,t,r),o=.25*a.width;a.sprite.position.y=lineHeight/2,a.sprite.matrixAutoUpdate=!1,a.sprite.updateMatrix(),i.add(a.sprite);var n;return n=new THREE.Line(lineGeometry,lineMaterialYear),n.position.y-=+o/2,n.scale.y=.5,n.matrixAutoUpdate=!1,n.updateMatrix(),i.add(n),n=new THREE.Line(lineGeometry,lineMaterialYear),n.position.y+=lineHeight/2+o/2,n.scale.y=.5,n.matrixAutoUpdate=!1,n.updateMatrix(),i.add(n),i}function makeLabelSprite(e,t,r){e+="";var i=document.createElement("canvas"),a=i.getContext("2d");i.width=128,i.height=128;var o=new THREE.Texture(i);if(a.fillStyle="rgba(255, 255, 255, 0.01 )",a.fillRect(0,0,i.width,i.height),a.font=t+'px "'+FONT_FAMILY+'", sans-serif',a.fillStyle="white",a.textBaseline="middle",a.textAlign="left",r){for(var n=0,s=0,l=e.length;l>s;s++)n+=a.measureText(e[s]).width,s!==e.length-1&&(n+=r);for(var c=i.width/2-n/2,s=0,l=e.length;l>s;s++){var p=a.measureText(e[s]).width;a.fillText(e[s],c,i.height/2),c+=p+r}}else a.fillText(e,i.width/2,i.height/2);o._needsUpdate=!0;var d=new THREE.SpriteMaterial({map:o,depthWrite:!1,depthTest:!0,transparent:!1,rotation:Math.PI/4}),h=new THREE.Sprite(d);return h.scale.setLength(35),{sprite:h,width:i.width}}function hammer(e){return new Hammer(_.isString(e)?document.getElementById(e):e)}function animate(){requestAnimationFrame(animate),frame++,iframeOpen||(prev=now,now=.001*getNow(),void 0!==prev&&(delta=now-prev),tagIndex=0,tagJiggler.target=tagFilter?.05:1,tagJiggler.update(),Particle.update(),renderer.render(scene,camera))}function setGrid(){document.body.classList.contains("mode-grid")||(clearActiveButtons(gridButton),Particle.setBehavior(Particle.GridBehavior),Particle.unhover(),setHash("#/grid"),setModeClass("grid"))}function setBitmap(e){document.body.classList.contains("mode-bitmap")||(clearActiveButtons(bitmapButton),Particle.setBehavior(portrait?Particle.BitmapBehaviorPortrait:Particle.BitmapBehavior),Particle.unhover(),e!==!0&&setHash("/"),setModeClass("bitmap"))}function setGraph(){document.body.classList.contains("mode-graph")||(clearActiveButtons(graphButton),Particle.setBehavior(Particle.GraphBehavior),Particle.unhover(),setHash("#/graph"),setModeClass("graph"))}function setEditor(){document.body.classList.add("codemirror-loading"),codeMirrorLoaded.then(function(){Particle.unhover(),applyCustomBehavior(),document.body.classList.remove("codemirror-loading")}),editorActive=!0,clearActiveButtons(editorButton),setHash("#/editor"),setModeClass("custom"),document.body.classList.add("editor-open"),refreshEditor()}function closeEditor(){editorActive=!1,Particle.unhover(),document.body.classList.remove("editor-open")}function openProject(e){if(!document.body.classList.contains("editor-open")){if(e.blacklist.iframe)return void window.open(e.url);document.body.classList.add("project-open"),document.body.classList.remove("project-loaded"),iframeOpen=!0,projectFrame.addEventListener("load",function(){document.body.classList.add("project-loaded")}),document.head.querySelector("title").innerHTML=e.title+" - "+e.author,setHash("#/experiment/"+e.slug),setTimeout(function(){projectFrame.contentWindow.location.replace(e.url)},500)}}function closeProject(){setHash(prevHash),document.body.classList.remove("project-open"),setTimeout(function(){iframeOpen=!1,document.body.classList.remove("project-loaded")},10),setTimeout(function(){projectFrame.contentWindow.location.replace("about:blank"),document.head.querySelector("title").innerHTML=Project.title},600)}function setHash(e){prevHash=hash,hash=e,(URL_SAVE||DEEP_LINK)&&history.replaceState({},"",e)}
    function setModeClass(e){
        switch(
            document.body.classList.remove("mode-bitmap"),
            document.body.classList.remove("mode-custom"),
            document.body.classList.remove("mode-graph"),
            document.body.classList.remove("mode-grid"),
            document.body.classList.add("mode-"+e),
            //trackEvent("summary","changemode",e),
            e) {
                case"graph":bitmapMode=!1;
                break;
                case"bitmap":bitmapMode=!0;
                break;
                default:bitmapMode=!1
                }
        checkGraphContainer()
        }
    function checkGraphContainer(){}
    function clearActiveButtons(e){
        _.each(document.querySelectorAll("#buttons .button"),
        function(e){
            e.classList.remove("active")
        }),
        e.classList.add("active")
    }
    function onMouseMove(e){
        if(!document.body.classList.contains("editor-open") && !iframeOpen) {
            e.preventDefault && e.preventDefault(),
            WEB_AUDIO && Particle.hover && Particle.hover !== Particle.prevHover && Assets("mp3/drag.mp3").play({ volume:.5, duration:.3,ramp:.1});
            var t = e.center?e.center.x:e.clientX,
            r = e.center?e.center.y:e.clientY,
            i = lockLandscape?r:t,
            a = lockLandscape?t:r;
            light.copy(planePoint),
            light.z = 45,
            mouse.x = 2*(i/width-.5),
            mouse.y = 2*(-(a/height)+.5),
            lockLandscape && (mouse.y *= -1),
            Particle.hoverNeedsUpdate = !0
        }}
    
    function applyCustomBehavior(){
        //trackEvent("summary","runcode");
        var code=editor?editor.getValue():document.getElementById("editor").innerHTML,behaviorProto=eval(";( function( scope ) { "+code+" } )( this );"),behavior=Composition(ParticleBehavior,behaviorProto);behavior=Composition(HoverBehavior,behavior),Particle.setBehavior(new behavior)}function setTag(e){for(var t=e.target;!t.getAttribute("slug")&&t.parentElement;)t=t.parentElement;var r=t.getAttribute("slug");if(tagFilter=tagFilter===r?"":r,_.each(document.querySelectorAll(".tag"),function(e){e.classList.remove("active")}),tagFilter){
            
            //trackEvent("summary","changetag",tagFilter);
            for(var i=tags[r],a=0,o=Particle.all.length;o>a;a++){
                var n=Particle.all[a];
                n.hasTag[r]&&n.setColor(i.color,i.pattern)
            }
            t.classList.add("active"),document.body.classList.add("tag-active")}else clearFilter();tagChanged=!0,setTimeout(function(){tagChanged=!1},5),preferMobile=!tagFilter&&HANDHELD}function clearFilter(){tagFilter="",_.each(document.querySelectorAll(".tag"),function(e){e.classList.remove("active")});
            for(var e=0,t=Particle.all.length;t>e;e++) Particle.all[e].resetColor();
            document.body.classList.remove("tag-active"),
            preferMobile=HANDHELD,
            //trackEvent("summary","cleartag"),
            tagChanged=!0,
            setTimeout(function(){tagChanged=!1},5)}function toggleTagList(){tagChanged=!0,setTimeout(function(){tagChanged=!1},5),toggleClass("tags-open"),setTagSize()}function onTap(e){var t=lockLandscape?e.center.y:e.center.x,r=lockLandscape?width-e.center.x:e.center.y,i=Math.sqrt(Math.pow(t-screenPosition.x,2)+Math.pow(r-screenPosition.y,2));Particle.hover&&85>i&&!iframeOpen&&!editorActive?openProject(Particle.hover.data):Particle.unhover()}function onTapCaption(){Particle.hover&&openProject(Particle.hover.data)}function onMouseOut(){mouseOut=!0,Particle.unhover()}function onResize(){width=window.innerWidth,height=window.innerHeight;var e=portrait;if(portrait=height>width,lockLandscape=LOCK_LANDSCAPE&&portrait){var t=width;width=height,height=t}smallScreen=height<SMALL_BREAKPOINT,camera.fov=75*Math.min(1,height/width),camera.aspect=width/height,camera.updateProjectionMatrix(),refreshEditor(),bitmapMode&&(portrait&&!e?Particle.setBehavior(Particle.BitmapBehaviorPortrait):e&&!portrait&&Particle.setBehavior(Particle.BitmapBehavior)),screenSize.set(Math.max(width,height)*PIXEL_RATIO*1.25,0),iframeContainer.classList.remove("transition"),checkGraphContainer(),_.defer(function(){captionWidth=caption.offsetWidth,captionHeight=caption.offsetHeight,master.style.width=width+"px",master.style.height=height+"px",renderer.setSize(width,height),document.body.classList.remove("unsized"),iframeContainer.classList.add("transition"),setTagSize()}),updateFrustumSlice()}function setTagSize(){document.body.classList.contains("tags-open")&&_.defer(function(){_.each(document.querySelectorAll(".tag"),function(e){var t=e.querySelector(".inner");e.style.width=t.offsetWidth+"px",e.style.height=t.offsetHeight+"px"})})}function preventDefault(e){e.preventDefault()}function getExperimentBySlug(e){for(var t=Project.experiments,r=0;r<t.length;r++){var i=t[r];if(i.slug===e)return i}return null}function updateFrustumSlice(){var e=-camera.position.z;camera.updateProjectionMatrix();for(var t,r,i=(e-camera.near)/(camera.far-camera.near),a=[],o=0;4>o;o++)vec.set(RECT[o][0],RECT[o][1],-1),vec.unproject(camera),t=vec.clone(),vec.set(RECT[o][0],RECT[o][1],1),vec.unproject(camera),r=vec.clone(),r.sub(t),r.multiplyScalar(i),r.add(t),a.push(r);_.extend(frustumSlice,{top:a[0].y,right:a[2].x,bottom:a[2].y,left:a[1].x,corners:a,width:Math.abs(a[2].x-a[1].x),height:Math.abs(a[0].y-a[2].y)})}function popup(e,t,r,i){return function(){
                /*trackEvent("summary","share",i);*/
                var a=screen.width/2-t/2,
                o=screen.height/2-r/2;
                return window.open(e,void 0,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+t+", height="+r+", top="+o+", left="+a)}}
                
                function loadCodeMirror(){var e=document.createElement("script");e.addEventListener("load",codeMirrorLoaded.resolve,!1),e.type="text/javascript",e.async=!0,e.src="codemirror.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}function refreshEditor(){codeMirrorLoaded.then(function(){editor.refresh()})}/*function trackEvent(e,t,r){_gaq.push(["_trackEvent",e,t,r])}*/var Project={title:"Chrome Experiment #1000",titlePrefix:"1000 Chrome Experiments: ",description:"An interactive celebration of the first 1,000 experiments.",url:"http://1000.chromeexperiments.com/",tweet:"Celebrating 1,000 Chrome Experiments (@ChromeExp). g.co/1000",twitter_publisher_handle:"ChromeExp",twitter_author_handle:"ChromeExp",analytics_id:"UA-59249714-1"};!this.Element&&(module.exports=Project),function(e){var t=document.createElement("canvas"),r=t.getContext("2d");e.Bitmap=function(e){t.width=e.width,t.height=e.height,r.drawImage(e,0,0,e.width,e.height),this.data=r.getImageData(0,0,e.width,e.height).data,this.width=e.width,this.height=e.height};var i=e.Bitmap;i.prototype.color=function(e,t,r){var i=~~t+~~r*this.width;return this.data[4*i+e]},i.prototype.eachPixel=function(e){for(var t=0;t<this.data.length;t+=4){var r=~~(t/4)%this.width,i=~~(t/4/this.width);e(this.data[t],this.data[t+1],this.data[t+2],this.data[t+3],r,i)}}}(this),random.generator=Math.random.bind(Math),random.range=function(e,t){var r=-1,i=1;switch(arguments.length){case 1:r=-e,i=e;break;case 2:r=e,i=t}return random.generator()*(i-r)+r},random["int"]=function(e,t){var r=-1,i=1;switch(arguments.length){case 1:r=-e,i=e;break;case 2:r=e,i=t}return~~(random.generator()*(i-r)+r)},random.angle=function(){return random.generator()*TWO_PI},random.chance=function(e){return random.generator()<(e||.5)},random.sign=function(){return random.generator()<.5?1:-1},Jiggler.prototype.update=function(){if(!this.stopped){if(d=this.target-this.value,Math.abs(d)<.1&&this.velocity<.1)return this.target=this.value,this.velocity=0,void(this.stopped=!0);this.velocity=(this.velocity+this.strength*d/this.mass)*this.damping,this.value+=this.velocity}},Jiggler.prototype.setTarget=function(e){return e||0===e||console.trace(e),this.target=e,this.stopped=!1,e},Particle.prototype.resetColor=function(){this.setColor(this.color,this.pattern)},Particle.prototype.setColor=function(e,t){spriteColors[3*this.index]=e.r,spriteColors[3*this.index+1]=e.g,spriteColors[3*this.index+2]=e.b,spritePatterns[this.index]=2*t,spriteGeometry.attributes.color.needsUpdate=!0,spriteGeometry.attributes.pattern.needsUpdate=!0},Particle.prototype.resetScale=function(){this.proxy.scaleJiggler.setTarget(this.proxy.originalScale),this.proxyEnd.scaleJiggler.setTarget(this.proxyEnd.originalScale),this.proxyStart.scaleJiggler.setTarget(this.proxyStart.originalScale)},Particle.prototype.reset=ParticleProxy.prototype.reset=function(){this.position.set(0,0,0),this.scale.set(1,1,1)},Particle.prototype.lerp=ParticleProxy.prototype.lerp=function(e,t,r){this.scaleJiggler.strength=t.scaleJiggler.strength,this.scaleJiggler.mass=t.scaleJiggler.mass,this.scaleJiggler.damping=t.scaleJiggler.damping,this.scaleJiggler.setTarget(t.scaleJiggler.target),this.position.copy(e.position).lerp(t.position,r),this.scale.copy(e.scale).lerp(t.scale,r)},Particle.prototype.copy=ParticleProxy.prototype.copy=function(e){this.scaleJiggler.strength=e.scaleJiggler.strength,this.scaleJiggler.mass=e.scaleJiggler.mass,this.scaleJiggler.damping=e.scaleJiggler.damping,this.scaleJiggler.setTarget(e.scaleJiggler.target),this.position.copy(e.position),this.scale.copy(e.scale)},_.extend(Particle,{all:[],proxies:[],proxiesEnd:[],behavior:null,hover:null,prevHover:null,hoverNeedsUpdate:!1,fadeStart:0,fadeDuration:1.5,fadeDurationJitter:.7,fadeStagger:.33,init:function(){var e=Project.experiments,t=_.keys(e).length;normalTex=new THREE.Texture(Assets("textures/normals.png")),normalTex._needsUpdate=!0,patternTex=new THREE.Texture(Assets("textures/patterns.png")),patternTex._needsUpdate=!0,spritePositions=new Float32Array(3*t),spriteColors=new Float32Array(3*t),spriteSizes=new Float32Array(t),spritePatterns=new Float32Array(t),spriteGeometry.addAttribute("position",new THREE.BufferAttribute(spritePositions,3)),spriteGeometry.addAttribute("size",new THREE.BufferAttribute(spriteSizes,1)),spriteGeometry.addAttribute("pattern",new THREE.BufferAttribute(spritePatterns,1)),spriteGeometry.addAttribute("color",new THREE.BufferAttribute(spriteColors,3)),spriteStroke=new THREE.PointCloud(spriteGeometry,Particle.makeSpriteMaterial(1,1,new THREE.Texture(Assets("textures/disc.png"))));var r=Particle.makeSpriteMaterial(1,1,new THREE.Texture(Assets("textures/gem.png")));spritesOcclude=new THREE.PointCloud(spriteGeometry,r);var i=new THREE.SpriteMaterial({color:16777215,transparent:!0,size:200,opacity:.1});mouseSprite=new THREE.Sprite(i),mouseSprite.scale.set(150,150,150),scene.add(spriteStroke);for(var a=0;t>a;a++)new Particle(e[Particle.all.length]);scene.add(spritesOcclude),Particle.GraphBehavior=new GraphBehavior,Particle.GridBehavior=new GridBehavior,Particle.BitmapBehavior=new BitmapBehavior(Assets("img/1000.gif")),Particle.BitmapBehaviorPortrait=new BitmapBehavior(Assets("img/1000square.gif"));var o=window.location.hash.match(/\#\/([a-z1-9]*)\/?/i)||[];switch(o[1]){case"grid":setGrid();break;case"graph":setGraph();break;case"editor":setBitmap(),setEditor();break;case"experiment":var n=window.location.hash.replace(/\#\/experiment\//i,"");openProject(getExperimentBySlug(n)),setBitmap(!0);break;default:setBitmap()}Particle.fadeDurations=_.map(_.range(Particle.all.length),function(){return Particle.fadeDuration+random.range(Particle.fadeDurationJitter/2)}),Particle.staggerIndeces=_.shuffle(_.range(Particle.all.length))},setBehavior:function(e){portrait&&e===Particle.BehaviorBitmap?e=Particle.BitmapBehaviorPortrait:portrait||e!==Particle.BitmapBehaviorPortrait||(e=Particle.BitmapBehavior),Particle.fadeStart=now,Particle.prevBehavior=Particle.behavior,Particle.behavior=e,Particle.behavior.initOnce(),Particle.all.forEach(Particle.initParticle);for(var t=0,r=graphLines.length;r>t;t++)graphLines[t].startPosition.copy(graphLines[t].position)},initParticle:function(e,t){e.resetScale();var r=e.proxyStart;e.proxyStart=e.proxyEnd,e.proxyEnd=r,e.proxyStart.copy(e.proxy),e.proxyEnd.reset(),Particle.behavior.init(e.proxyEnd,t)},fadeEasing:function(e,t){var r,t=.035,i=.5;return 0===e?0:1===e?1:(!t||1>t?(t=1,r=i/4):r=i*Math.asin(1/t)/(2*Math.PI),t*Math.pow(2,-10*e)*Math.sin(2*(e-r)*Math.PI/i)+1)},update:function(){Particle.behavior.updateOnce(),!disableMove&&Particle.hoverNeedsUpdate&&Particle.updateHover();for(var e=0,t=Particle.all.length;t>e;e++){var r=Particle.all[e],i=Particle.fadeStart+Particle.fadeStagger*Particle.staggerIndeces[e]/Particle.all.length,a=i+Particle.fadeDurations[e];Particle.behavior.update(r.proxyEnd,now,delta);if(a>now){var o=cnormalize(now,i,a);r.proxy.lerp(r.proxyStart,r.proxyEnd,Particle.fadeEasing(o,lerp(.01,1.25,e/Particle.all.length)))}else r.proxy.copy(r.proxyEnd);spritePositions[3*r.index]=r.proxy.position.x,spritePositions[3*r.index+1]=r.proxy.position.y,spritePositions[3*r.index+2]=r.proxy.position.z,spriteGeometry.attributes.position.needsUpdate=!0,r.proxy.scaleJiggler.update();var n=!tagFilter||r.proxy.hasTag[tagFilter]?1:.1;r.proxy.tagScale+=.1*(n-r.proxy.tagScale);var s=Particle.hover===r?1:r.proxy.scale.z,l=Math.max(.01,7.5*s*r.proxy.tagScale*r.proxy.scaleJiggler.value);l!==spriteSizes[r.index]&&(spriteSizes[r.index]=l,spriteGeometry.attributes.size.needsUpdate=!0)}for(var c=Particle.behavior===Particle.GraphBehavior?-lineHeight/2:4*-lineHeight,e=0,t=graphLines.length;t>e;e++){var i=Particle.fadeStart+Particle.fadeStagger*e/graphLines.length*(Particle.behavior===Particle.GraphBehavior?2.5:0),a=i+2.75,p=graphLines[e];if(a>now){var o=cnormalize(now,i,a);o=Particle.fadeEasing(o,.2),p.position.y=lerp(p.startPosition.y,c,o)}else now>i&&(p.position.y=c)}if(planePoint.lerp(targetPlanePoint,.065),mouseSprite.position.copy(planePoint),light.copy(planePoint),light.z=20,Particle.hover){screenPosition.copy(Particle.hover.proxy.position.project(camera)),screenPosition.x=(screenPosition.x/2+.5)*width,screenPosition.y=(-screenPosition.y/2+.5)*height;var d=smallScreen?45:96;screenPosition.y>height/2&&(d=smallScreen?-120:-190);{var c=~~(screenPosition.y+d),h=~~(screenPosition.x-captionWidth/2);preferMobile&&Particle.hover.data.blacklist.mobile}h=clamp(h,0,width-captionWidth),c=clamp(c,0,height-captionHeight),caption.style.webkitTransform=caption.style.transform="translate3d( "+h+"px, "+c+"px, 0 )"}},toggleHover:_.debounce(function(){Particle.hover&&(title.innerHTML=Particle.hover.data.title,authorCaption.innerHTML=Particle.hover.data.author,captionWidth=caption.offsetWidth,captionHeight=caption.offsetHeight),toggleClass("hover-particle",Particle.hover),toggleClass("mobile-warning",Particle.hover&&Particle.hover.data.blacklist.mobile)},220),updateHover:function(){Particle.hoverNeedsUpdate=!1,raycaster.setFromCamera(mouse,camera),Particle.prevHover=Particle.hover;var e=raycaster.intersectObject(plane)[0];if(e){var t,r,i,a=1/0,o=1/0;targetPlanePoint=e.point;for(var n=0,s=Particle.all.length;s>n;n++){var l=Particle.all[n],c=l.data;if(!(c.blacklist.e404||tagFilter&&!l.hasTag[tagFilter])){var p=Particle.rayDistanceToPointSq(raycaster.ray,l.proxyEnd.hoverPosition);a>p&&(a=p,r=l),o>p&&!c.blacklist.mobile&&(o=p,i=l)}}if(preferMobile&&o<MOBILE_HOVER_DISTANCE_SQUARED?t=i:a<HOVER_DISTANCE_SQUARED&&(t=r),Particle.hover!==t&&(Particle.unhover(),Particle.prevHover=Particle.hover,Particle.hover=t,t))for(var n=0,s=Particle.all.length;s>n;n++)n===Particle.hover.index?Particle.behavior.onOver(Particle.all[n].proxyEnd):Particle.behavior.onOverOther(Particle.all[n].proxyEnd);Particle.hover&&!Particle.prevHover&&(document.body.style.cursor="pointer"),Particle.toggleHover()}},unhover:function(){if(Particle.hover)for(var e=0,t=Particle.all.length;t>e;e++)e===Particle.hover.index?Particle.behavior.onOut(Particle.all[e].proxyEnd):Particle.behavior.onOutOther(Particle.all[e].proxyEnd);Particle.hover=void 0,document.body.classList.remove("hover-particle"),document.body.style.cursor=""},makeSpriteMaterial:function(e,t,r){return r._needsUpdate=!0,new THREE.ShaderMaterial({uniforms:{texture:{type:"t",value:r},normalMap:{type:"t",value:normalTex},patterns:{type:"t",value:patternTex},scale:{type:"f",value:t},screenSize:{type:"v2",value:screenSize},light:{type:"v3",value:light}},attributes:{size:{type:"f",value:null},bubble:{type:"f",value:null},color:{type:"c",value:null},pattern:{type:"f",value:null}},vertexShader:Assets("shaders/disc.vs"),fragmentShader:Assets("shaders/disc.fs"),depthTest:!1,depthWrite:!1,transparent:!0})},rayDistanceToPointSq:function(){var e=new THREE.Vector3;return function(t,r){var i=e.subVectors(r,t.origin).dot(t.direction);return 0>i?t.origin.distanceToSquared(r):(e.copy(t.direction).multiplyScalar(i).add(t.origin),e.distanceToSquared(r))}}()}),function(e){e.ParticleBehavior=Composition({updateOnce:function(){},position:function(){},init:function(){},initOnce:function(){},update:function(){}}),e.DriftBehavior=Composition(ParticleBehavior,{init:function(e,t){e.driftRadiusJiggler=e.driftRadiusJiggler||new Jiggler,e.driftCenter=e.driftCenter||new THREE.Vector3,e.originalDriftCenter=e.originalDriftCenter||new THREE.Vector3,e.targetDriftCenter=e.targetDriftCenter||new THREE.Vector3,e.driftRadiusJiggler.strength=.2,e.driftRadiusJiggler.mass=1.5,e.driftRadiusJiggler.damping=.65,e.driftRadiusJiggler.target=e.driftRadiusJiggler.setTarget(random(1,7)),this.position(e,t),e.originalDriftRadius=e.driftRadiusJiggler.value=e.driftRadiusJiggler.target,e.speed=random(.05,2)*random.sign(),e.yAmp=1,e.easing=1,e.originalDriftCenter.copy(e.driftCenter),e.targetDriftCenter.copy(e.driftCenter),e.hoverPosition.copy(e.driftCenter)},update:function(e,t){e.driftRadiusJiggler.update(),e.driftCenter.lerp(e.targetDriftCenter,e.easing),e.position.copy(e.driftCenter);var r=t*e.speed+e.speed,i=e.driftRadiusJiggler.value;e.position.x+=Math.cos(r)*i,e.position.y+=Math.sin(2*r+e.speed)*i*e.yAmp*.5,e.position.z+=Math.sin(r)*i*i*e.yAmp*.00125},onOver:function(e){e.scaleJiggler.setTarget(5),e.scaleJiggler.strength=3,e.scaleJiggler.mass=3,e.scaleJiggler.damping=.6,e.targetDriftCenter.copy(targetPlanePoint),e.easing=.8},onOverOther:function(e){var t=Particle.hover.proxyEnd.hoverPosition;e.hoverPosition.distanceToSquared(t)<1225&&(e.targetDriftCenter.copy(t),e.driftRadiusJiggler.setTarget(35),e.easing=.12,e.orbiting=!0)},onOut:function(e){e.scaleJiggler.setTarget(e.originalScale),e.scaleJiggler.strength=.1,e.scaleJiggler.mass=1,e.scaleJiggler.damping=.25,e.targetDriftCenter.copy(e.originalDriftCenter),e.easing=.5},onOutOther:function(e){e.originalDriftCenter&&(e.targetDriftCenter.copy(e.originalDriftCenter),e.driftRadiusJiggler.setTarget(e.originalDriftRadius),e.scaleJiggler.setTarget(e.originalScale),e.easing=.033,e.orbiting=!1)}}),e.BitmapBehavior=Composition(DriftBehavior,function(e){this.bitmap=new Bitmap(e),this.whitePixels=[],this.bitmap.eachPixel(function(e,t,r,i,a,o){e>200&&a%2===0&&this.whitePixels.push([a,o])}.bind(this)),_.shuffle(this.whitePixels)},{position:function(e,t){var r=this.whitePixels[t%this.whitePixels.length];e.driftCenter.set(r[0]-this.bitmap.width/2,r[1]-this.bitmap.height/2,0),e.driftCenter.x+=random.range(2),e.driftCenter.y+=random.range(2)}}),e.GridBehavior=Composition(DriftBehavior,function(){this.rows=25,this.cols=40,this.spacing=5.5,this.center=new THREE.Vector3(Math.floor(this.cols/2),-Math.floor(this.rows/2),0)},{position:function(e){var t=e.index%this.cols,r=Math.floor(e.index/this.cols);e.driftCenter.set(t,-r,0),e.driftCenter.sub(this.center),e.driftCenter.multiplyScalar(this.spacing),e.driftRadiusJiggler.target=0,e.gridPosition=e.gridPosition||new THREE.Vector3,e.gridPosition.copy(e.driftCenter),e.originalGridPosition=e.originalGridPosition||new THREE.Vector3,e.originalGridPosition.copy(e.gridPosition)},initOnce:function(){targetPlanePoint.set(0,0,0),planePoint.set(0,0,0)},update:function(e){if(!(Particle.hover&&Particle.hover.proxyEnd===this||this.orbiting)){portrait?(e.gridPosition.x=-e.originalGridPosition.y,e.gridPosition.y=e.originalGridPosition.x):e.gridPosition.copy(e.originalGridPosition),e.targetDriftCenter.copy(e.gridPosition),e.hoverPosition.copy(e.targetDriftCenter);var t=e.gridPosition.distanceTo(planePoint);e.easing=.08,vec.copy(e.driftCenter),e.driftCenter.sub(planePoint),e.driftCenter.setLength(Math.pow(t,1.05)),e.driftCenter.add(planePoint)}}}),e.GraphBehavior=Composition({Width:250,HeightPercent:.5,GetXPosition:function(e){return this.First=this.First||new Date(Project.DateApprovedFirst).getTime(),this.Last=this.Last||new Date(Project.DateApprovedLast).getTime(),map(e.getTime(),this.First,this.Last,-this.Width/2,this.Width/2)}},DriftBehavior,{position:function(e){var t=GraphBehavior.GetXPosition(new Date(e.data.approved_at)),r=e.index/Particle.all.length;e.driftCenter.set(t,r,0),e.gridPosition=e.gridPosition||new THREE.Vector3,e.gridPosition.copy(e.driftCenter)},initOnce:function(){_.defer(function(){targetPlanePoint.set(portrait?90:120,0,0),planePoint.copy(targetPlanePoint)})},updateOnce:function(){for(var e=0,t=graphLines.length;t>e;e++){{var r=graphLines[e],i=planePoint.x;
planePoint.y}vec.x=i,vec.y=r.originalPosition.y;var a=Math.pow(r.originalPosition.x-planePoint.x,2);r.position.copy(r.originalPosition),r.position.x-=i,r.position.x*=3e-4*frustumSlice.width,r.position.x*=Math.sqrt(.01*a),r.position.x+=i}},update:function(e){if(Particle.hover===this||this.orbiting)return e.yAmp=1;vec.x=e.gridPosition.x,vec.y=planePoint.y;var t=Math.pow(e.gridPosition.x-planePoint.x,2);e.easing=.1,vec.x=e.originalDriftCenter.x,tagFilter?e.hasTag[tagFilter]?(tagIndex++,vec.y=frustumSlice.height*GraphBehavior.HeightPercent*(tagIndex/Project.tags[tagFilter].count)-frustumSlice.height*GraphBehavior.HeightPercent/2):vec.y=-frustumSlice.height*GraphBehavior.HeightPercent/2:(tagIndex++,vec.y=frustumSlice.height*GraphBehavior.HeightPercent*(tagIndex/Particle.all.length)-frustumSlice.height*GraphBehavior.HeightPercent/2),vec.x-=planePoint.x,vec.x*=3e-4*frustumSlice.width,vec.x*=Math.sqrt(.01*t),vec.x+=planePoint.x,e.targetDriftCenter.x=vec.x,e.targetDriftCenter.y=vec.y,e.hoverPosition.copy(e.driftCenter)}}),e.HoverBehavior=Composition(ParticleBehavior,{init:function(){},update:function(e){Particle.hover&&Particle.hover.proxyEnd===e?e.position.copy(e.hoverPosition):e.hoverPosition.copy(e.position)},onOver:function(e){e.scaleJiggler.setTarget(5),e.scaleJiggler.strength=3,e.scaleJiggler.mass=3,e.scaleJiggler.damping=.6,e.hoverPosition.copy(e.position)},onOut:function(e){e.scaleJiggler.setTarget(e.originalScale),e.scaleJiggler.strength=.1,e.scaleJiggler.mass=1,e.scaleJiggler.damping=.25},onOutOther:function(){},onOverOther:function(){}})}(this);var scene,camera,renderer,now=0,prev=0,delta=0,frame=0,width,height,light=new THREE.Vector3,mouse=new THREE.Vector2,container=new THREE.Object3D,screenSize=new THREE.Vector2,screenPosition=new THREE.Vector2,vec=new THREE.Vector3,raycaster=new THREE.Raycaster,plane,planePoint=new THREE.Vector3,targetPlanePoint=new THREE.Vector3,frustumSlice={},RECT=[[-1,-1],[1,-1],[-1,1],[1,1]],graphLines=[],tagTemplate='<div class="tag" slug="{{ slug }}" id="tag-{{ slug }}" ><div class="inner" style="background-color: {{ color.getStyle() }}"><span class="title">{{ name }}</span> <span class="count">{{ count }}</span></div></div>',lineGeometry,lineHeight,lineMaterialLight,lineMaterialDark,lineMaterialYear,defaultBehavior,currentBehavior,tagFilter,tagIndex=0,tagCount,graphContainer=new THREE.Object3D,normalTex,patternTex,tagJiggler=new Jiggler,tagContainer=document.getElementById("tag-container"),tagWrapper=document.getElementById("tag-wrapper"),tagClear=document.getElementById("tag-clear"),tagButton=document.getElementById("tag-button"),gridButton=document.getElementById("grid-button"),bitmapButton=document.getElementById("bitmap-button"),graphButton=document.getElementById("graph-button"),authorCaption=document.getElementById("author"),hoverable=[],spriteGeometry=new THREE.BufferGeometry,spritePositions,spriteSizes,spriteColors,spriteStroke,lockLandscape=!1,portrait=!1,editor,editorActive=!1,editorButton=document.getElementById("editor-button"),editorWrapper=document.getElementById("editor-wrapper"),mobileWarningButton=document.getElementById("mobile-warning"),editorCloseButton=document.getElementById("editor-close"),editorReloadButton=document.getElementById("editor-reload"),mouseOut=!1,mouseSprite,iframeOpen=!1,iframeBack=document.getElementById("iframe-back"),projectFrame=document.getElementById("project-frame"),iframeContainer=document.getElementById("iframe-container"),captionWidth,captionHeight,smallScreen=!1,prevHash="/",hash="/",disableMove=!1,disableMoveTimeout,preferMobile=HANDHELD,tagChanged=!1,bitmapMode=!1,codeMirrorLoaded=new Promise,getNow=function(){if(window.performance&&window.performance.now)return function(){return performance.now()};if(Date.now){var e;return function(){return e=Date.now(),getNow=function(){return Date.now()-e},0}}return function(){var e;return function(){return e=(new Date).getTime(),getNow=function(){return(new Date).getTime()-e},0}}}(),tags={none:{name:"none",color:new THREE.Color(2236962),pattern:3},"3d":{name:"3d",color:new THREE.Color(15466635),pattern:2},academic:{name:"academic",color:new THREE.Color(16758272),pattern:0},"motion-control":{name:"motion-control",color:new THREE.Color(16776960),pattern:0},"sound-and-music":{name:"sound-and-music",color:new THREE.Color(2236962),pattern:1},demoscene:{name:"demoscene",color:new THREE.Color(65383),pattern:0},drawing:{name:"drawing",color:new THREE.Color(16758272),pattern:0},fractal:{name:"fractal",color:new THREE.Color(65383),pattern:0},games:{name:"games",color:new THREE.Color(44527),pattern:1},generative:{name:"generative",color:new THREE.Color(16723968),pattern:0},geographic:{name:"geographic",color:new THREE.Color(16758272),pattern:0},gravity:{name:"gravity",color:new THREE.Color(16776960),pattern:0},"interactive-music-video":{name:"interactive-music-video",color:new THREE.Color(65383),pattern:0},"microphone-input":{name:"microphone-input",color:new THREE.Color(15658734),pattern:3},mobile:{name:"mobile",color:new THREE.Color(65383),pattern:3},"mobile-controller":{name:"mobile-controller",color:new THREE.Color(10551551),pattern:0},"multi-window":{name:"multi-window",color:new THREE.Color(44527),pattern:1},multiplayer:{name:"multiplayer",color:new THREE.Color(16723968),pattern:0},"not-webgl":{name:"not-webgl",color:new THREE.Color(16776960),pattern:0},particles:{name:"particles",color:new THREE.Color(65383),pattern:0},"realtime-coding":{name:"realtime-coding",color:new THREE.Color(44527),pattern:0},"social-data":{name:"social-data",color:new THREE.Color(8849407),pattern:0},"speech-recognition":{name:"speech-recognition",color:new THREE.Color(10551551),pattern:0},tools:{name:"tools",color:new THREE.Color(15658734),pattern:1},trippin:{name:"trippin",color:new THREE.Color(16758272),pattern:3},video:{name:"video",color:new THREE.Color(65383),pattern:0},"virtual-reality":{name:"virtual-reality",color:new THREE.Color(44527),pattern:1},"webcam-input":{name:"webcam-input",color:new THREE.Color(2236962),pattern:0},webgl:{name:"webgl",color:new THREE.Color(10551551),pattern:2}};WEBGL?start():fail();